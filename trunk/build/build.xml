<?xml version="1.0"?>

<project name="Concrete5" default="export" basedir=".">
    <target name="export">
        <echo msg="Exporting C5" />
		<svnexport
		   svnpath="/usr/bin/svn"
		   username="andrew"
		   password="botw8bal"
		   force="true"
		   nocache="true"
		   repositoryurl="http://concrete5.svnrepository.com/svn/concrete5/trunk/web"
		   todir="./export"/>
    </target>

	
    <target name="prepare_short_tags">
    	<echo msg="Replacing Short Tags" />
		<reflexive>
			<filterchain>
			  <replaceregexp>
				<regexp pattern='&lt;\?' replace='&lt;?php ' ignoreCase="true"/>
				<regexp pattern="&lt;\?php php" replace="&lt;?php " ignoreCase="true"/>
				<regexp pattern="&lt;\?php =" replace="&lt;?php echo " ignoreCase="true"/>
			  </replaceregexp>
			</filterchain>
			<fileset dir="./export">
				<include name="**/**.php" />
			</fileset>
		</reflexive>
	</target>

	 <target name="generate_po">
    	<echo msg="Generating Translation Files" />
    	<touch file="messages.po" />
		<exec command="find export/concrete/ -iname '*.php' -exec xgettext --default-domain=messages --keyword=t -l PHP -j {} \;" />
	</target>

	 <target name="sanitize_ds_store">
    	<echo msg="Removing stupid OS X files" />
    	<touch file="messages.po" />
		<exec command="find export -iname '.DS_Store' -exec rm {} \;" />
	</target>

	<!--
	 <target name="localize_output_de_DE">
    	<echo msg="Moving German Files" />
		<exec command="msgfmt -o ../web/concrete/locale/de_DE/LC_MESSAGES/messages.mo messages_de_DE.po" />
	</target>
	//-->
    
    <echo msg="MAKE SURE TO REMOVE ALL THE BLOCKS AND SINGLE PAGES AND SHIT AND UPDATE THE VERSION NUMBER FILE ON CONCRETE5.ORG" />
</project>