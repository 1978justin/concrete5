(function(b){var a=function(){var X={},c,R=65,y,T='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" class="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><input type="button" class="colorpicker_none" name="none" value="'+ccmi18n.x+'" /><input type="button" class="colorpicker_submit" name="save" value="'+ccmi18n.ok+'" /></div>',G={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onNone:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},N=function(Y,aa){var Z=m(Y);b(aa).data("colorpicker").fields.eq(1).val(Z.r).end().eq(2).val(Z.g).end().eq(3).val(Z.b).end()},z=function(Y,Z){b(Z).data("colorpicker").fields.eq(4).val(Y.h).end().eq(5).val(Y.s).end().eq(6).val(Y.b).end()},g=function(Y,Z){b(Z).data("colorpicker").fields.eq(0).val(V(Y)).end()},o=function(Y,Z){b(Z).data("colorpicker").selector.css("backgroundColor","#"+V({h:Y.h,s:100,b:100}));b(Z).data("colorpicker").selectorIndic.css({left:parseInt(150*Y.s/100,10),top:parseInt(150*(100-Y.b)/100,10)})},K=function(Y,Z){b(Z).data("colorpicker").hue.css("top",parseInt(150-150*Y.h/360,10))},k=function(Y,Z){b(Z).data("colorpicker").currentColor.css("backgroundColor","#"+V(Y))},J=function(Y,Z){b(Z).data("colorpicker").newColor.css("backgroundColor","#"+V(Y))},q=function(Y){var aa=Y.charCode||Y.keyCode||-1;if((aa>R&&aa<=90)||aa==32){return false}var Z=b(this).parent().parent();if(Z.data("colorpicker").livePreview===true){e.apply(this)}},e=function(Z){var aa=b(this).parent().parent(),Y;if(!aa.data("colorpicker")||!aa.data("colorpicker").fields){return}if(this.parentNode.className.indexOf("_hex")>0){aa.data("colorpicker").color=Y=p(D(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){aa.data("colorpicker").color=Y=f({h:parseInt(aa.data("colorpicker").fields.eq(4).val(),10),s:parseInt(aa.data("colorpicker").fields.eq(5).val(),10),b:parseInt(aa.data("colorpicker").fields.eq(6).val(),10)})}else{aa.data("colorpicker").color=Y=l(P({r:parseInt(aa.data("colorpicker").fields.eq(1).val(),10),g:parseInt(aa.data("colorpicker").fields.eq(2).val(),10),b:parseInt(aa.data("colorpicker").fields.eq(3).val(),10)}))}}if(Z){N(Y,aa.get(0));g(Y,aa.get(0));z(Y,aa.get(0))}o(Y,aa.get(0));K(Y,aa.get(0));J(Y,aa.get(0));aa.data("colorpicker").onChange.apply(aa,[Y,V(Y),m(Y)])},s=function(Z){var aa=b(this).parent().parent();var Y=aa.data("colorpicker");if(Y&&Y.fields){Y.fields.parent().removeClass("colorpicker_focus")}},O=function(){R=this.parentNode.className.indexOf("_hex")>0?70:65;var Y=b(this).parent().parent().data("colorpicker");if(Y&&Y.fields){Y.fields.parent().removeClass("colorpicker_focus")}b(this).parent().addClass("colorpicker_focus")},M=function(Y){var aa=b(this).parent().find("input").focus();var Z={el:b(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:Y.pageY,field:aa,val:parseInt(aa.val(),10),preview:b(this).parent().parent().data("colorpicker").livePreview};b(document).bind("mouseup",Z,x);b(document).bind("mousemove",Z,Q)},Q=function(Y){Y.data.field.val(Math.max(0,Math.min(Y.data.max,parseInt(Y.data.val+Y.pageY-Y.data.y,10))));if(Y.data.preview){e.apply(Y.data.field.get(0),[true])}return false},x=function(Y){e.apply(Y.data.field.get(0),[true]);Y.data.el.removeClass("colorpicker_slider").find("input").focus();b(document).unbind("mouseup",x);b(document).unbind("mousemove",Q);return false},B=function(Y){var Z={cal:b(this).parent(),y:b(this).offset().top};Z.preview=Z.cal.data("colorpicker").livePreview;b(document).bind("mouseup",Z,v);b(document).bind("mousemove",Z,n)},n=function(Y){e.apply(Y.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(Y.pageY-Y.data.y))))/150,10)).get(0),[Y.data.preview]);return false},v=function(Y){N(Y.data.cal.data("colorpicker").color,Y.data.cal.get(0));g(Y.data.cal.data("colorpicker").color,Y.data.cal.get(0));b(document).unbind("mouseup",v);b(document).unbind("mousemove",n);return false},C=function(Y){var Z={cal:b(this).parent(),pos:b(this).offset()};Z.preview=Z.cal.data("colorpicker").livePreview;b(document).bind("mouseup",Z,F);b(document).bind("mousemove",Z,u)},u=function(Y){e.apply(Y.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(Y.pageY-Y.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(Y.pageX-Y.data.pos.left))))/150,10)).get(0),[Y.data.preview]);return false},F=function(Y){N(Y.data.cal.data("colorpicker").color,Y.data.cal.get(0));g(Y.data.cal.data("colorpicker").color,Y.data.cal.get(0));b(document).unbind("mouseup",F);b(document).unbind("mousemove",u);return false},A=function(Y){b(this).addClass("colorpicker_focus")},U=function(Y){b(this).removeClass("colorpicker_focus")},t=function(Z){var ab=b(this).parent();var Y=ab.data("colorpicker").color;ab.data("colorpicker").origColor=Y;k(Y,ab.get(0));var aa=b("#"+b(this).data("colorpickerId"));ab.data("colorpicker").onSubmit(Y,V(Y),m(Y),ab)},W=function(Y){var Z=b(this).parent();Z.data("colorpicker").onNone(Z);Z.hide()},I=function(Y){var ac=b("#"+b(this).data("colorpickerId"));ac.data("colorpicker").onBeforeShow.apply(this,[ac.get(0)]);var ad=b(this).offset();var ab=E();var aa=ad.top+this.offsetHeight;var Z=ad.left;if(aa+176>ab.t+ab.h){aa-=this.offsetHeight+176}if(Z+356>ab.l+ab.w){Z-=356}ac.css({left:Z+"px",top:aa+"px"});if(ac.data("colorpicker").onShow.apply(this,[ac.get(0)])!=false){ac.show()}b(document).bind("mousedown",{cal:ac},S);return false},S=function(Y){if(!L(Y.data.cal.get(0),Y.target,Y.data.cal.get(0))){if(Y.data.cal.data("colorpicker").onHide.apply(this,[Y.data.cal.get(0)])!=false){Y.data.cal.hide()}b(document).unbind("mousedown",S)}},L=function(aa,Z,Y){if(aa==Z){return true}if(aa.contains){return aa.contains(Z)}if(aa.compareDocumentPosition){return !!(aa.compareDocumentPosition(Z)&16)}var ab=Z.parentNode;while(ab&&ab!=Y){if(ab==aa){return true}ab=ab.parentNode}return false},E=function(){var Y=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(Y?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(Y?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(Y?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(Y?document.documentElement.clientHeight:document.body.clientHeight)}},f=function(Y){return{h:Math.min(360,Math.max(0,Y.h)),s:Math.min(100,Math.max(0,Y.s)),b:Math.min(100,Math.max(0,Y.b))}},P=function(Y){return{r:Math.min(255,Math.max(0,Y.r)),g:Math.min(255,Math.max(0,Y.g)),b:Math.min(255,Math.max(0,Y.b))}},D=function(aa){var Y=6-aa.length;if(Y>0){var ab=[];for(var Z=0;Z<Y;Z++){ab.push("0")}ab.push(aa);aa=ab.join("")}return aa},d=function(Y){var Y=parseInt(((Y.indexOf("#")>-1)?Y.substring(1):Y),16);return{r:Y>>16,g:(Y&65280)>>8,b:(Y&255)}},p=function(Y){return l(d(Y))},l=function(Z){var Y={};Y.b=Math.max(Math.max(Z.r,Z.g),Z.b);Y.s=(Y.b<=0)?0:Math.round(100*(Y.b-Math.min(Math.min(Z.r,Z.g),Z.b))/Y.b);Y.b=Math.round((Y.b/255)*100);if((Z.r==Z.g)&&(Z.g==Z.b)){Y.h=0}else{if(Z.r>=Z.g&&Z.g>=Z.b){Y.h=60*(Z.g-Z.b)/(Z.r-Z.b)}else{if(Z.g>=Z.r&&Z.r>=Z.b){Y.h=60+60*(Z.g-Z.r)/(Z.g-Z.b)}else{if(Z.g>=Z.b&&Z.b>=Z.r){Y.h=120+60*(Z.b-Z.r)/(Z.g-Z.r)}else{if(Z.b>=Z.g&&Z.g>=Z.r){Y.h=180+60*(Z.b-Z.g)/(Z.b-Z.r)}else{if(Z.b>=Z.r&&Z.r>=Z.g){Y.h=240+60*(Z.r-Z.g)/(Z.b-Z.g)}else{if(Z.r>=Z.b&&Z.b>=Z.g){Y.h=300+60*(Z.r-Z.b)/(Z.r-Z.g)}else{Y.h=0}}}}}}}Y.h=Math.round(Y.h);return Y},m=function(Y){var aa={};var ae=Math.round(Y.h);var ad=Math.round(Y.s*255/100);var Z=Math.round(Y.b*255/100);if(ad==0){aa.r=aa.g=aa.b=Z}else{var af=Z;var ac=(255-ad)*Z/255;var ab=(af-ac)*(ae%60)/60;if(ae==360){ae=0}if(ae<60){aa.r=af;aa.b=ac;aa.g=ac+ab}else{if(ae<120){aa.g=af;aa.b=ac;aa.r=af-ab}else{if(ae<180){aa.g=af;aa.r=ac;aa.b=ac+ab}else{if(ae<240){aa.b=af;aa.r=ac;aa.g=af-ab}else{if(ae<300){aa.b=af;aa.g=ac;aa.r=ac+ab}else{if(ae<360){aa.r=af;aa.g=ac;aa.b=af-ab}else{aa.r=0;aa.g=0;aa.b=0}}}}}}}return{r:Math.round(aa.r),g:Math.round(aa.g),b:Math.round(aa.b)}},H=function(Y){var Z=[Y.r.toString(16),Y.g.toString(16),Y.b.toString(16)];b.each(Z,function(aa,ab){if(ab.length==1){Z[aa]="0"+ab}});return Z.join("")},V=function(Y){return H(m(Y))};return{init:function(Y){Y=b.extend({},G,Y||{});if(typeof Y.color=="string"){Y.color=p(Y.color)}else{if(Y.color.r!=undefined&&Y.color.g!=undefined&&Y.color.b!=undefined){Y.color=l(Y.color)}else{if(Y.color.h!=undefined&&Y.color.s!=undefined&&Y.color.b!=undefined){Y.color=f(Y.color)}else{return this}}}Y.origColor=Y.color;return this.each(function(){if(!b(this).data("colorpickerId")){var aa="collorpicker_"+parseInt(Math.random()*1000);b(this).data("colorpickerId",aa);var Z=b(T).attr("id",aa);if(Y.flat){Z.appendTo(this).show()}else{Z.appendTo(document.body)}Y.fields=Z.find("input").bind("keydown",q).bind("change",e).bind("blur",s).bind("focus",O);Z.find("span").bind("mousedown",M);Y.selector=Z.find("div.colorpicker_color").bind("mousedown",C);Y.selectorIndic=Y.selector.find("div div");Y.hue=Z.find("div.colorpicker_hue div");Z.find("div.colorpicker_hue").bind("mousedown",B);Y.newColor=Z.find("div.colorpicker_new_color");Y.currentColor=Z.find("div.colorpicker_current_color");Z.data("colorpicker",Y);Z.find("input.colorpicker_none").bind("click",W);Z.find("input.colorpicker_submit").bind("click",t);N(Y.color,Z.get(0));z(Y.color,Z.get(0));g(Y.color,Z.get(0));K(Y.color,Z.get(0));o(Y.color,Z.get(0));k(Y.color,Z.get(0));J(Y.color,Z.get(0));if(Y.flat){Z.css({position:"relative",display:"block"})}else{b(this).bind(Y.eventName,I)}}})},showPicker:function(){return this.each(function(){if(b(this).data("colorpickerId")){I.apply(this)}})},hidePicker:function(){return this.each(function(){if(b(this).data("colorpickerId")){b("#"+b(this).data("colorpickerId")).hide()}})},setColor:function(Y){if(typeof Y=="string"){Y=p(Y)}else{if(Y.r!=undefined&&Y.g!=undefined&&Y.b!=undefined){Y=l(Y)}else{if(Y.h!=undefined&&Y.s!=undefined&&Y.b!=undefined){Y=f(Y)}else{return this}}}return this.each(function(){if(b(this).data("colorpickerId")){var Z=b("#"+b(this).data("colorpickerId"));Z.data("colorpicker").color=Y;Z.data("colorpicker").origColor=Y;N(Y,Z.get(0));z(Y,Z.get(0));g(Y,Z.get(0));K(Y,Z.get(0));o(Y,Z.get(0));k(Y,Z.get(0));J(Y,Z.get(0))}})}}}();b.fn.extend({ColorPicker:a.init,ColorPickerHide:a.hide,ColorPickerShow:a.show,ColorPickerSetColor:a.setColor})})(jQuery);(function(d){var a=null;var c="blocktypes";var b=null;d.fn.liveUpdate=function(f,e){return this.each(function(){new d.liveUpdate(this,f,e)})};d.liveUpdate=function(k,g,f){this.field=d(k);this.list=d("#"+g);this.lutype="blocktypes";if(typeof(f)!="undefined"){this.lutype=f}if(this.list.length>0){this.init()}};d.liveUpdate.prototype={init:function(){var e=this;this.setupCache();this.field.parents("form").submit(function(){return false});this.field.keyup(function(){e.filter()});e.filter()},filter:function(){if(this.field.val()!=b){if(d.trim(this.field.val())==""){if(this.lutype=="blocktypes"){this.list.children("li").addClass("ccm-block-type-available");this.list.children("li").removeClass("ccm-block-type-selected")}else{if(this.lutype=="attributes"){this.list.children("li").addClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected")}else{if(this.lutype=="stacks"){this.list.children("li").addClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected")}else{if(this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}else{this.list.children("li").show()}}}}return}if(this.lutype!="intelligent-search"||this.field.val().length>2){this.displayResults(this.getScores(this.field.val().toLowerCase()))}else{if(this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}}}b=this.field.val();if(b==""&&this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}},setupCache:function(){var e=this;this.cache=[];this.rows=[];var f=this.lutype;this.list.find("li").each(function(){if(f=="blocktypes"){e.cache.push(d(this).find("a.ccm-block-type-inner").html().toLowerCase())}else{if(f=="attributes"){var g=d(this).find("a,span").html().toLowerCase();e.cache.push(g)}else{if(f=="stacks"){var g=d(this).find("a,span").html().toLowerCase();e.cache.push(g)}else{if(f=="fileset"){e.cache.push(d(this).find("label").html().toLowerCase())}else{if(f=="intelligent-search"){e.cache.push(d(this).find("span").html().toLowerCase())}}}}}e.rows.push(d(this))});this.cache_length=this.cache.length},displayResults:function(g){var e=this;if(this.lutype=="blocktypes"){this.list.children("li").removeClass("ccm-block-type-available");this.list.children("li").removeClass("ccm-block-type-selected");d.each(g,function(k,l){e.rows[l[1]].addClass("ccm-block-type-available")});d(this.list.find("li.ccm-block-type-available")[0]).addClass("ccm-block-type-selected")}else{if(this.lutype=="attributes"){this.list.children("li").removeClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected");this.list.children("li").removeClass("ccm-item-selected");d.each(g,function(k,l){e.rows[l[1]].addClass("ccm-attribute-available")});this.list.children("li.icon-select-list-header").removeClass("ccm-attribute-available");d(this.list.find("li.ccm-attribute-available")[0]).addClass("ccm-item-selected")}else{if(this.lutype=="stacks"){this.list.children("li").removeClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected");this.list.children("li").removeClass("ccm-item-selected");d.each(g,function(k,l){e.rows[l[1]].addClass("ccm-stack-available")});this.list.children("li.icon-select-list-header").removeClass("ccm-stack-available");d(this.list.find("li.ccm-stack-available")[0]).addClass("ccm-item-selected")}else{if(this.lutype=="intelligent-search"){if(!this.list.is(":visible")){this.list.fadeIn(160,"easeOutExpo")}this.list.find(".ccm-intelligent-search-results-module-onsite").hide();this.list.find("li").hide();var f=0;d.each(g,function(k,l){$li=e.rows[l[1]];if(l[0]>0.7){f++;if(!$li.parent().parent().is(":visible")){$li.parent().parent().show()}$li.show()}});this.list.find("li a").removeClass("ccm-intelligent-search-result-selected");this.list.find("li:visible a:first").addClass("ccm-intelligent-search-result-selected")}else{this.list.children("li").hide();d.each(g,function(k,l){e.rows[l[1]].show()})}}}}},getScores:function(f){var k=[];for(var e=0;e<this.cache_length;e++){var g=this.cache[e].score(f);if(g>0){k.push([g,e])}}return k.sort(function(m,l){return l[0]-m[0]})}}})(jQuery);(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length){settings.single="metadata"}var data=$.data(elem,settings.single);if(data){return data}data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m){data=m[1]}}else{if(settings.type=="elem"){if(!elem.getElementsByTagName){return}var e=elem.getElementsByTagName(settings.name);if(e.length){data=$.trim(e[0].innerHTML)}}else{if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr){data=attr}}}}if(data.indexOf("{")<0){data="{"+data+"}"}data=eval("("+data+")");$.data(elem,settings.single,data);return data}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);if(window.jQuery){(function(a){if(a.browser.msie){try{document.execCommand("BackgroundImageCache",false,true)}catch(b){}}a.fn.rating=function(d){if(this.length==0){return this}if(typeof arguments[0]=="string"){if(this.length>1){var c=arguments;return this.each(function(){a.fn.rating.apply(a(this),c)})}a.fn.rating[arguments[0]].apply(this,a.makeArray(arguments).slice(1)||[]);return this}var d=a.extend({},a.fn.rating.options,d||{});this.each(function(){var e=(this.name||"unnamed-rating").replace(/\[|\]+/g,"_");var f=a(this.form||document.body);var n=f.data("rating")||{count:0};var p=n[e];var g;if(p){g=p.data("rating");g.count++}else{g=a.extend({},d||{},(a.metadata?a(this).metadata():(a.meta?a(this).data():null))||{},{count:0,stars:[]});g.serial=n.count++;p=a('<input type="text" class="rating-star-control" name="'+this.name+'" id="'+e+'" value="" size="2"/>');a(this).before(p.hide());p.addClass("rating-to-be-drawn");if(a(this).attr("disabled")){g.readOnly=true}a(this).before(g.cancel=a('<div class="rating-cancel"><a title="'+g.cancel+'">'+g.cancelValue+"</a></div>").mouseover(function(){a(this).rating("drain");a(this).addClass("rating-star-hover")}).mouseout(function(){a(this).rating("draw");a(this).removeClass("rating-star-hover")}).click(function(){a(this).rating("select")}).data("rating",g))}var m=a('<div class="rating-star rater-'+g.serial+'"><a title="'+(this.title||this.value)+'">'+this.value+"</a></div>");a(this).after(m);if(this.id){m.attr("id",this.id)}if(this.className){m.addClass(this.className)}if(g.half){g.split=2}if(typeof g.split=="number"&&g.split>0){var l=(a.fn.width?m.width():0)||g.starWidth;var k=(g.count%g.split),o=Math.floor(l/g.split);m.width(o).find("a").css({"margin-left":"-"+(k*o)+"px"})}if(g.readOnly){m.addClass("rating-star-readonly")}else{m.addClass("rating-star-live").mouseover(function(){a(this).rating("fill")}).mouseout(function(){a(this).rating("draw")}).click(function(){a(this).rating("select")})}if(this.checked){g.current=m}a(this).remove();g.stars[g.stars.length]=m;g.element=n[e]=p;g.context=f;g.raters=n;p.data("rating",g);m.data("rating",g);f.data("rating",n)});a(".rating-to-be-drawn").rating("draw").removeClass("rating-to-be-drawn");return this};a.extend(a.fn.rating,{fill:function(){var c=this.data("rating");if(!c){return this}if(c.readOnly){return}this.rating("drain");this.prevAll().andSelf().filter(".rater-"+c.serial).addClass("rating-star-hover");if(c.focus){c.focus.apply(c.element,[this.text(),a("a",this)[0]])}},drain:function(){var c=this.data("rating");if(!c){return this}if(c.readOnly){return}c.element.siblings().filter(".rater-"+c.serial).removeClass("rating-star-on").removeClass("rating-star-hover")},draw:function(){var c=this.data("rating");if(!c){return this}this.rating("drain");if(c.current){c.element.val(c.current.text());c.current.prevAll().andSelf().filter(".rater-"+c.serial).addClass("rating-star-on")}else{c.element.val("")}c.cancel[c.readOnly||c.required?"hide":"show"]();this.siblings()[c.readOnly?"addClass":"removeClass"]("rating-star-readonly");if(c.blur){c.blur.apply(c.element,[this.text(),a("a",this)[0]])}},select:function(c){var d=this.data("rating");if(!d){return this}if(d.readOnly){return}d.current=null;if(typeof c!="undefined"){if(typeof c=="number"){return d.stars[c].rating("select")}if(typeof c=="string"){return a(d.stars).each(function(){if(this.text()==c){this.rating("select")}})}}else{if(this.is(".rater-"+d.serial)){d.current=this}}this.data("rating",d);this.rating("draw");if(d.callback){d.callback.apply(d.element,d.current?[d.current.text(),a("a",d.current)[0]]:[""])}},readOnly:function(c,d){var e=this.data("rating");if(!e){return this}e.readOnly=c?true:false;if(d){e.element.attr("disabled","disabled")}else{e.element.removeAttr("disabled")}this.data("rating",e);this.rating("draw")},disable:function(){this.rating("readOnly",true,true)},enable:function(){this.rating("readOnly",false,false)}});a.fn.rating.options={cancel:"Cancel Rating",cancelValue:"",split:0,starWidth:16};a(function(){a("input[type=radio].star").rating()})})(jQuery)}!function(c){var a;c(document).ready(function(){c.support.transition=(function(){var f=document.body||document.documentElement,g=f.style,e=g.transition!==undefined||g.WebkitTransition!==undefined||g.MozTransition!==undefined||g.MsTransition!==undefined||g.OTransition!==undefined;return e})();if(c.support.transition){a="TransitionEnd";if(c.browser.webkit){a="webkitTransitionEnd"}else{if(c.browser.mozilla){a="transitionend"}else{if(c.browser.opera){a="oTransitionEnd"}}}}});var d=function(f,e){this.$element=c(f);this.options=e;this.enabled=true;this.fixTitle()};d.prototype={show:function(){var m,f,l,e,k,g;if(this.getTitle()&&this.enabled){k=this.tip();this.setContent();if(this.options.animate){k.addClass("fade")}k.remove().css({top:0,left:0,display:"block"}).prependTo(document.body);m=c.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});f=k[0].offsetWidth;l=k[0].offsetHeight;e=b.maybeCall(this.options.placement,this.$element[0]);switch(e){case"below":g={top:m.top+m.height+this.options.offset,left:m.left+m.width/2-f/2};break;case"above":g={top:m.top-l-this.options.offset,left:m.left+m.width/2-f/2};break;case"left":g={top:m.top+m.height/2-l/2,left:m.left-f-this.options.offset};break;case"right":g={top:m.top+m.height/2-l/2,left:m.left+m.width+this.options.offset};break}k.css(g).addClass(e).addClass("in")}},setContent:function(){var e=this.tip();e.find(".twipsy-inner")[this.options.html?"html":"text"](this.getTitle());e[0].className="twipsy"},hide:function(){var f=this,g=this.tip();g.removeClass("in");function e(){g.remove()}e()},fixTitle:function(){var e=this.$element;if(e.attr("title")||typeof(e.attr("data-original-title"))!="string"){e.attr("data-original-title",e.attr("title")||"").removeAttr("title")}},getTitle:function(){var g,e=this.$element,f=this.options;this.fixTitle();if(typeof f.title=="string"){g=e.attr(f.title=="title"?"data-original-title":f.title)}else{if(typeof f.title=="function"){g=f.title.call(e[0])}}g=(""+g).replace(/(^\s*|\s*$)/,"");return g||f.fallback},tip:function(){if(!this.$tip){this.$tip=c('<div class="twipsy" />').html('<div class="twipsy-arrow"></div><div class="twipsy-inner"></div>')}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};var b={maybeCall:function(f,e){return(typeof f=="function")?(f.call(e)):f}};c.fn.twipsy=function(e){c.fn.twipsy.initWith.call(this,e,d,"twipsy");return this};c.fn.twipsy.initWith=function(q,m,e){var p,o,k,g;if(q===true){return this.data(e)}else{if(typeof q=="string"){p=this.data(e);if(p){p[q]()}return this}}q=c.extend({},c.fn[e].defaults,q);function f(t){var s=c.data(t,e);if(!s){s=new m(t,c.fn.twipsy.elementOptions(t,q));c.data(t,e,s)}return s}function l(){var s=f(this);s.hoverState="in";if(q.delayIn==0){s.show()}else{s.fixTitle();setTimeout(function(){if(s.hoverState=="in"){s.show()}},q.delayIn)}}function n(){var s=f(this);s.hoverState="out";if(q.delayOut==0){s.hide()}else{setTimeout(function(){if(s.hoverState=="out"){s.hide()}},q.delayOut)}}if(!q.live){this.each(function(){f(this)})}if(q.trigger!="manual"){o=q.live?"live":"bind";k=q.trigger=="hover"?"mouseenter":"focus";g=q.trigger=="hover"?"mouseleave":"blur";this[o](k,l)[o](g,n)}return this};c.fn.twipsy.Twipsy=d;c.fn.twipsy.defaults={animate:true,delayIn:0,delayOut:0,fallback:"",placement:"above",html:false,live:false,offset:0,title:"title",trigger:"hover"};c.fn.twipsy.elementOptions=function(f,e){return c.metadata?c.extend({},e,c(f).metadata()):e}}(window.jQuery||window.ender);var ccm_totalAdvancedSearchFields=0;var ccm_alLaunchType=new Array();var ccm_alActiveAssetField="";var ccm_alProcessorTarget="";var ccm_alDebug=false;ccm_triggerSelectFile=function(e,a){if(a==null){var a=ccm_alActiveAssetField}var d=$("#"+a+"-fm-selected");var b=$("#"+a+"-fm-display");b.hide();d.show();d.load(CCM_TOOLS_PATH+"/files/selector_data?fID="+e+"&ccm_file_selected_field="+a,function(){d.attr("fID",e);d.attr("ccm-file-manager-can-view",d.children("div").attr("ccm-file-manager-can-view"));d.attr("ccm-file-manager-can-edit",d.children("div").attr("ccm-file-manager-can-edit"));d.attr("ccm-file-manager-can-admin",d.children("div").attr("ccm-file-manager-can-admin"));d.attr("ccm-file-manager-can-replace",d.children("div").attr("ccm-file-manager-can-replace"));d.click(function(f){f.stopPropagation();ccm_alActivateMenu($(this),f)});if(typeof(ccm_triggerSelectFileComplete)=="function"){ccm_triggerSelectFileComplete(e,a)}});var c=$("#"+a+"-fm-value");c.attr("value",e);ccm_alSetupFileProcessor()};ccm_alGetFileData=function(b,a){$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?fID="+b,function(c){a(c)})};ccm_clearFile=function(f,a){f.stopPropagation();var d=$("#"+a+"-fm-selected");var b=$("#"+a+"-fm-display");var c=$("#"+a+"-fm-value");c.attr("value",0);d.hide();b.show()};ccm_activateFileManager=function(b,a){ccm_alSetupSelectFiles(a);$(document).click(function(c){c.stopPropagation();ccm_alSelectNone()});ccm_setupAdvancedSearch(a);if(b=="DASHBOARD"){$(".dialog-launch").dialog()}ccm_alLaunchType[a]=b;ccm_alSetupCheckboxes(a);ccm_alSetupFileProcessor();ccm_alSetupSingleUploadForm();$("form#ccm-"+a+"-advanced-search select[name=fssID]").change(function(){if(b=="DASHBOARD"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/files/search?fssID="+$(this).val()}else{jQuery.fn.dialog.showLoader();var c=$("div#ccm-"+a+"-overlay-wrapper input[name=dialogAction]").val()+"&refreshDialog=1&fssID="+$(this).val();$.get(c,function(d){jQuery.fn.dialog.hideLoader();$("div#ccm-"+a+"-overlay-wrapper").html(d);$("div#ccm-"+a+"-overlay-wrapper a.dialog-launch").dialog()})}});$("form#ccm-"+a+"-advanced-search a.ccm-search-saved-exit").click(function(){if(b=="DASHBOARD"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/files/search"}else{jQuery.fn.dialog.showLoader();var c=$("div#ccm-"+a+"-overlay-wrapper input[name=dialogAction]").val()+"&refreshDialog=1";$.get(c,function(d){jQuery.fn.dialog.hideLoader();$("div#ccm-"+a+"-overlay-wrapper").html(d);$("div#ccm-"+a+"-overlay-wrapper a.dialog-launch").dialog()})}});ccm_searchActivatePostFunction[a]=function(){ccm_alSetupCheckboxes(a);ccm_alSetupSelectFiles()}};ccm_alSetupSingleUploadForm=function(){$(".ccm-file-manager-submit-single").submit(function(){$(this).attr("target",ccm_alProcessorTarget);ccm_alSubmitSingle($(this).get(0))})};ccm_activateFileSelectors=function(){$(".ccm-file-manager-launch").unbind();$(".ccm-file-manager-launch").click(function(){ccm_alLaunchSelectorFileManager($(this).parent().attr("ccm-file-manager-field"))})};ccm_alLaunchSelectorFileManager=function(a){ccm_alActiveAssetField=a;var c="";var b=$("#"+a+"-fm-display input.ccm-file-manager-filter");if(b.length){for(i=0;i<b.length;i++){c+="&"+$(b[i]).attr("name")+"="+$(b[i]).attr("value")}}ccm_launchFileManager(c)};ccm_launchFileManager=function(a){$.fn.dialog.open({width:"90%",height:"70%",modal:false,href:CCM_TOOLS_PATH+"/files/search_dialog?ocID="+CCM_CID+"&search=1"+a,title:ccmi18n_filemanager.title})};ccm_launchFileSetPicker=function(a){$.fn.dialog.open({width:500,height:160,modal:false,href:CCM_TOOLS_PATH+"/files/pick_set?oldFSID="+a,title:ccmi18n_filemanager.sets})};ccm_alSubmitSetsForm=function(a){ccm_deactivateSearchResults(a);jQuery.fn.dialog.showLoader();$("#ccm-"+a+"-add-to-set-form").ajaxSubmit(function(b){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.hideLoader();$("#ccm-"+a+"-advanced-search").ajaxSubmit(function(c){$("#ccm-"+a+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:a},function(){ccm_parseAdvancedSearchResponse(c,a)})})})};ccm_alSubmitPasswordForm=function(a){ccm_deactivateSearchResults(a);$("#ccm-"+a+"-password-form").ajaxSubmit(function(b){jQuery.fn.dialog.closeTop();$("#ccm-"+a+"-advanced-search").ajaxSubmit(function(c){ccm_parseAdvancedSearchResponse(c,a)})})};ccm_alSubmitStorageForm=function(a){ccm_deactivateSearchResults(a);$("#ccm-"+a+"-storage-form").ajaxSubmit(function(b){jQuery.fn.dialog.closeTop();$("#ccm-"+a+"-advanced-search").ajaxSubmit(function(c){ccm_parseAdvancedSearchResponse(c,a)})})};ccm_alSubmitPermissionsForm=function(a){ccm_deactivateSearchResults(a);$("#ccm-"+a+"-permissions-form").ajaxSubmit(function(b){jQuery.fn.dialog.closeTop();$("#ccm-"+a+"-advanced-search").ajaxSubmit(function(c){ccm_parseAdvancedSearchResponse(c,a)})})};ccm_alSetupSetsForm=function(a){$("#fsAddToSearchName").liveUpdate("ccm-file-search-add-to-sets-list","fileset");$(".ccm-file-set-add-cb a").each(function(){var b=$(this);var c=b.attr("ccm-tri-state-startup");$(this).click(function(){var d=$(this).attr("ccm-tri-state-selected");var e=0;switch(d){case"0":if(c=="1"){e="1"}else{e="2"}break;case"1":e="2";break;case"2":e="0";break}$(this).attr("ccm-tri-state-selected",e);$(this).find("input").val(e);$(this).find("img").attr("src",CCM_IMAGE_PATH+"/checkbox_state_"+e+".png")})});$("#ccm-"+a+"-add-to-set-form input[name=fsNew]").click(function(){if(!$(this).prop("checked")){$("#ccm-"+a+"-add-to-set-form input[name=fsNewText]").val("")}});$("#ccm-"+a+"-add-to-set-form").submit(function(){ccm_alSubmitSetsForm(a);return false})};ccm_alSetupPasswordForm=function(){$("#ccm-file-password-form").submit(function(){ccm_alSubmitPasswordForm();return false})};ccm_alRescanFiles=function(){var b=CCM_TOOLS_PATH+"/files/rescan?";var a=arguments;for(i=0;i<a.length;i++){b+="fID[]="+a[i]+"&"}$.fn.dialog.open({title:ccmi18n_filemanager.rescan,href:b,width:350,modal:false,height:200,onClose:function(){if(a.length==1){$("#ccm-file-properties-wrapper").html("");jQuery.fn.dialog.showLoader();$("#ccm-file-properties-wrapper").load(CCM_TOOLS_PATH+"/files/properties?fID="+a[0]+"&reload=1",false,function(){jQuery.fn.dialog.hideLoader();$(this).find(".dialog-launch").dialog()})}}})};ccm_alSelectPermissionsEntity=function(a,f,b){var d=$("#ccm-file-permissions-entity-base").html();$("#ccm-file-permissions-entities-wrapper").append('<div class="ccm-file-permissions-entity">'+d+"</div>");var e=$(".ccm-file-permissions-entity");var c=e[e.length-1];$(c).find("h2 span").html(b);$(c).find("input[type=hidden]").val(a+"_"+f);$(c).find("input[type=radio]").each(function(){$(this).attr("name",$(this).attr("name")+"_"+a+"_"+f)});$(c).find("div.ccm-file-access-extensions input[type=checkbox]").each(function(){$(this).attr("name",$(this).attr("name")+"_"+a+"_"+f+"[]")});ccm_alActivateFilePermissionsSelector()};ccm_alActivateFilePermissionsSelector=function(){$("tr.ccm-file-access-add input").unbind();$("tr.ccm-file-access-add input").click(function(){var a=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()==ccmi18n_filemanager.PTYPE_CUSTOM){$(a).find("div.ccm-file-access-add-extensions").show()}else{$(a).find("div.ccm-file-access-add-extensions").hide()}});$("tr.ccm-file-access-file-manager input").click(function(){var a=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()!=ccmi18n_filemanager.PTYPE_NONE){$(a).find("tr.ccm-file-access-add").show();$(a).find("tr.ccm-file-access-edit").show();$(a).find("tr.ccm-file-access-admin").show()}else{$(a).find("tr.ccm-file-access-add").hide();$(a).find("tr.ccm-file-access-edit").hide();$(a).find("tr.ccm-file-access-admin").hide();$(a).find("div.ccm-file-access-add-extensions").hide()}});$("a.ccm-file-permissions-remove").click(function(){$(this).parent().parent().fadeOut(100,function(){$(this).remove()})});$("input[name=toggleCanAddExtension]").unbind();$("input[name=toggleCanAddExtension]").click(function(){var a=$(this).parent().parent().find("div.ccm-file-access-extensions");if($(this).prop("checked")==1){a.find("input").attr("checked",true)}else{a.find("input").attr("checked",false)}})};ccm_alSetupVersionSelector=function(){$("#ccm-file-versions-grid input[type=radio]").click(function(){$("#ccm-file-versions-grid tr").removeClass("ccm-file-versions-grid-active");var a=$(this).parent().parent();var d=a.attr("fID");var b=a.attr("fvID");var c="task=approve_version&fID="+d+"&fvID="+b;$.post(CCM_TOOLS_PATH+"/files/properties",c,function(e){a.addClass("ccm-file-versions-grid-active");a.find("td").show("highlight",{color:"#FFF9BB"})})});$(".ccm-file-versions-remove").click(function(){var a=$(this).parent().parent();var d=a.attr("fID");var b=a.attr("fvID");var c="task=delete_version&fID="+d+"&fvID="+b;$.post(CCM_TOOLS_PATH+"/files/properties",c,function(e){a.fadeOut(200,function(){a.remove()})});return false})};ccm_alDeleteFiles=function(a){$("#ccm-"+a+"-delete-form").ajaxSubmit(function(b){ccm_parseJSON(b,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(a);$("#ccm-"+a+"-advanced-search").ajaxSubmit(function(c){ccm_parseAdvancedSearchResponse(c,a)})})})};ccm_alDuplicateFiles=function(searchInstance){$("#ccm-"+searchInstance+"-duplicate-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);var r=eval("("+resp+")");$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance);var highlight=new Array();for(i=0;i<r.fID.length;i++){fID=r.fID[i];ccm_uploadedFiles.push(fID);highlight.push(fID)}ccm_alRefresh(highlight,searchInstance);ccm_filesUploadedDialog(searchInstance)})})})};ccm_alSetupSelectFiles=function(){$(".ccm-file-list").unbind();$(".ccm-file-list tr.ccm-list-record").click(function(a){a.stopPropagation();ccm_alActivateMenu($(this),a)});$(".ccm-file-list img.ccm-star").click(function(a){a.stopPropagation();var b=$(a.target).parents("tr.ccm-list-record")[0].id;b=b.substring(3);ccm_starFile(a.target,b)});$("div.ccm-file-list-thumbnail-image img").hover(function(c){var f=$(this).parent().attr("fID");var b=$("#fID"+f+"hoverThumbnail");if(b.length>0){var a=b.find("div");var d=b.position();a.css("top",d.top);a.css("left",d.left);a.show()}},function(){var c=$(this).parent().attr("fID");var b=$("#fID"+c+"hoverThumbnail");var a=b.find("div");a.hide()})};ccm_alSetupCheckboxes=function(a){$("#ccm-"+a+"-list-cb-all").unbind();$("#ccm-"+a+"-list-cb-all").click(function(){ccm_hideMenus();if($(this).prop("checked")==true){$("#ccm-"+a+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-"+a+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+a+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-"+a+"-list-multiple-operations").attr("disabled",true)}});$("#ccm-"+a+"-search-results td.ccm-file-list-cb input[type=checkbox]").click(function(c){c.stopPropagation();ccm_hideMenus();ccm_alRescanMultiFileMenu(a)});$("#ccm-"+a+"-search-results td.ccm-file-list-cb").click(function(c){c.stopPropagation();ccm_hideMenus();$(this).find("input[type=checkbox]").click();ccm_alRescanMultiFileMenu(a)});if(ccm_alLaunchType[a]!="DASHBOARD"&&ccm_alLaunchType[a]!="BROWSE"){var b=ccmi18n_filemanager.select;$("#ccm-"+a+"-list-multiple-operations option:eq(0)").after('<option value="choose">'+b+"</option>")}$("#ccm-"+a+"-list-multiple-operations").change(function(){var e=$(this).val();var c=ccm_alGetSelectedFileIDs(a);switch(e){case"choose":var d=new Array();$("#ccm-"+a+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){d.push($(this).val())});ccm_alSelectFile(d,true);break;case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/delete?"+c+"&searchInstance="+a,title:ccmi18n_filemanager.deleteFile});break;case"duplicate":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/duplicate?"+c+"&searchInstance="+a,title:ccmi18n_filemanager.duplicateFile});break;case"sets":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/add_to?"+c+"&searchInstance="+a,title:ccmi18n_filemanager.sets});break;case"properties":jQuery.fn.dialog.open({width:690,height:440,modal:false,href:CCM_TOOLS_PATH+"/files/bulk_properties?"+c+"&searchInstance="+a,title:ccmi18n.properties});break;case"rescan":jQuery.fn.dialog.open({width:350,height:200,modal:false,href:CCM_TOOLS_PATH+"/files/rescan?"+c+"&searchInstance="+a,title:ccmi18n_filemanager.rescan,onClose:function(){$("#ccm-"+a+"-advanced-search").submit()}});break;case"download":window.frames[ccm_alProcessorTarget].location=CCM_TOOLS_PATH+"/files/download?"+c;break}$(this).get(0).selectedIndex=0});ccm_alSetupFileSetSearch(a)};ccm_alSetupFileSetSearch=function(a){$(".ccm-"+a+"-search-advanced-sets-cb input[type=checkbox]").unbind();$(".ccm-"+a+"-search-advanced-sets-cb input[type=checkbox]").click(function(){$("input[name=fsIDNone][instance="+a+"]").attr("checked",false);$("#ccm-"+a+"-advanced-search").submit()});$("div.ccm-file-sets-search-wrapper-input input").liveUpdate("ccm-file-search-advanced-sets-list","fileset");$("input[name=fsIDNone][instance="+a+"]").unbind();$("input[name=fsIDNone][instance="+a+"]").click(function(){if($(this).prop("checked")){$(".ccm-"+a+"-search-advanced-sets-cb input[type=checkbox]").attr("checked",false);$(".ccm-"+a+"-search-advanced-sets-cb input[type=checkbox]").attr("disabled",true)}else{$(".ccm-"+a+"-search-advanced-sets-cb input[type=checkbox]").attr("disabled",false)}$("#ccm-"+a+"-advanced-search").submit()})};ccm_alGetSelectedFileIDs=function(a){var b="";$("#ccm-"+a+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){b+="fID[]="+$(this).val()+"&"});return b};ccm_alRescanMultiFileMenu=function(a){if($("#ccm-"+a+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").length>0){$("#ccm-"+a+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+a+"-list-multiple-operations").attr("disabled",true)}};ccm_alSetupFileProcessor=function(){if(ccm_alProcessorTarget!=""){return false}var b=parseInt(new Date().getTime().toString().substring(0,10));var c;try{c=document.createElement('<iframe name="ccm-al-upload-processor'+b+'">')}catch(a){c=document.createElement("iframe")}c.id="ccm-al-upload-processor"+b;c.name="ccm-al-upload-processor"+b;c.style.border="0px";c.style.width="0px";c.style.height="0px";c.style.display="none";document.body.appendChild(c);if(ccm_alDebug){ccm_alProcessorTarget="_blank"}else{ccm_alProcessorTarget="ccm-al-upload-processor"+b}};ccm_alSubmitSingle=function(a){if($(a).find(".ccm-al-upload-single-file").val()==""){alert(ccmi18n_filemanager.uploadErrorChooseFile);return false}else{$(a).find(".ccm-al-upload-single-submit").hide();$(a).find(".ccm-al-upload-single-loader").show()}};ccm_alResetSingle=function(){$(".ccm-al-upload-single-file").val("");$(".ccm-al-upload-single-loader").hide();$(".ccm-al-upload-single-submit").show()};var ccm_uploadedFiles=[];ccm_filesUploadedDialog=function(c){if(document.getElementById("ccm-file-upload-multiple-tab")){jQuery.fn.dialog.closeTop()}var a="";for(var b=0;b<ccm_uploadedFiles.length;b++){a=a+"&fID[]="+ccm_uploadedFiles[b]}jQuery.fn.dialog.open({width:690,height:440,modal:false,href:CCM_TOOLS_PATH+"/files/bulk_properties/?"+a+"&uploaded=true&searchInstance="+c,onClose:function(){ccm_deactivateSearchResults(c);$("#ccm-"+c+"-advanced-search").ajaxSubmit(function(d){ccm_parseAdvancedSearchResponse(d,c)})},title:ccmi18n_filemanager.uploadComplete});ccm_uploadedFiles=[]};ccm_alSetupUploadDetailsForm=function(a){$("#ccm-"+a+"-update-uploaded-details-form").submit(function(){ccm_alSubmitUploadDetailsForm(a);return false})};ccm_alSubmitUploadDetailsForm=function(searchInstance){jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-update-uploaded-details-form").ajaxSubmit(function(r1){var r1a=eval("("+r1+")");var form=$("#ccm-"+searchInstance+"-advanced-search");if(form.length>0){form.ajaxSubmit(function(resp){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop();ccm_parseAdvancedSearchResponse(resp,searchInstance);ccm_alHighlightFileIDArray(r1a)})})}else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop()}})};ccm_alRefresh=function(a,c,d){var b=a;ccm_deactivateSearchResults(c);$("#ccm-"+c+"-search-results").load(CCM_TOOLS_PATH+"/files/search_results",{ccm_order_by:"fvDateAdded",ccm_order_dir:"desc",fileSelector:d,searchInstance:c},function(){ccm_activateSearchResults(c);if(b!=false){ccm_alHighlightFileIDArray(b)}ccm_alSetupSelectFiles()})};ccm_alHighlightFileIDArray=function(b){for(i=0;i<b.length;i++){var c=$("tr[fID="+b[i]+"] td");var a=c.css("backgroundColor");c.animate({backgroundColor:"#FFF9BB"},{queue:true,duration:1000}).animate({backgroundColor:a},500)}};ccm_alSelectFile=function(b){if(typeof(ccm_chooseAsset)=="function"){var a="";if(typeof(b)=="object"){for(i=0;i<b.length;i++){a+="fID[]="+b[i]+"&"}}else{a+="fID="+b}$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?"+a,function(c){ccm_parseJSON(c,function(){for(i=0;i<c.length;i++){ccm_chooseAsset(c[i])}jQuery.fn.dialog.closeTop()})})}else{if(typeof(b)=="object"){for(i=0;i<b.length;i++){ccm_triggerSelectFile(b[i])}}else{ccm_triggerSelectFile(b)}jQuery.fn.dialog.closeTop()}};ccm_alActivateMenu=function(b,g){var d=$(b).find("div[ccm-file-manager-field]");var a="";if(d.length>0){a=d.attr("ccm-file-manager-field")}ccm_hideMenus();var k=$(b).attr("fID");var n=$(b).attr("ccm-file-manager-instance");var l=document.getElementById("ccm-al-menu"+k+n+a);if(!l){el=document.createElement("DIV");el.id="ccm-al-menu"+k+n+a;el.className="ccm-menu";el.style.display="none";document.body.appendChild(el);var o=$(b).attr("al-filepath");l=$("#ccm-al-menu"+k+n+a);l.css("position","absolute");var c='<div class="ccm-menu-tl"><div class="ccm-menu-tr"><div class="ccm-menu-t"></div></div></div>';c+='<div class="ccm-menu-l"><div class="ccm-menu-r">';c+="<ul>";if(ccm_alLaunchType[n]!="DASHBOARD"&&ccm_alLaunchType[n]!="BROWSE"){var m=(d.length>0)?"ccm_alLaunchSelectorFileManager('"+a+"')":"ccm_alSelectFile("+k+")";var f=(d.length>0)?ccmi18n_filemanager.chooseNew:ccmi18n_filemanager.select;c+='<li><a class="ccm-icon" dialog-modal="false" dialog-width="90%" dialog-height="70%" dialog-title="'+ccmi18n_filemanager.select+'" id="menuSelectFile'+k+'" href="javascript:void(0)" onclick="'+m+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+f+"</span></a></li>"}if(d.length>0){c+='<li><a class="ccm-icon" href="javascript:void(0)" id="menuClearFile'+k+n+a+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/remove.png)">'+ccmi18n_filemanager.clear+"</span></a></li>"}if(ccm_alLaunchType[n]!="DASHBOARD"&&ccm_alLaunchType[n]!="BROWSE"&&d.length>0){c+='<li class="header"></li>'}if($(b).attr("ccm-file-manager-can-view")=="1"){c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.view+'" id="menuView'+k+'" href="'+CCM_TOOLS_PATH+"/files/view?fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/design_small.png)">'+ccmi18n_filemanager.view+"</span></a></li>"}else{c+='<li><a class="ccm-icon" id="menuDownload'+k+'" target="'+ccm_alProcessorTarget+'" href="'+CCM_TOOLS_PATH+"/files/download?fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/design_small.png)">'+ccmi18n_filemanager.download+"</span></a></li>"}if($(b).attr("ccm-file-manager-can-edit")=="1"){c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.edit+'" id="menuEdit'+k+'" href="'+CCM_TOOLS_PATH+"/files/edit?fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/edit_small.png)">'+ccmi18n_filemanager.edit+"</span></a></li>"}c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="680" dialog-height="450" dialog-title="'+ccmi18n_filemanager.properties+'" id="menuProperties'+k+'" href="'+CCM_TOOLS_PATH+"/files/properties?searchInstance="+n+"&fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/wrench.png)">'+ccmi18n_filemanager.properties+"</span></a></li>";if($(b).attr("ccm-file-manager-can-replace")=="1"){c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="300" dialog-height="250" dialog-title="'+ccmi18n_filemanager.replace+'" id="menuFileReplace'+k+'" href="'+CCM_TOOLS_PATH+"/files/replace?searchInstance="+n+"&fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/paste_small.png)">'+ccmi18n_filemanager.replace+"</span></a></li>"}if($(b).attr("ccm-file-manager-can-duplicate")=="1"){c+='<li><a class="ccm-icon" id="menuFileDuplicate'+k+'" href="javascript:void(0)" onclick="ccm_alDuplicateFile('+k+",'"+n+'\')"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+ccmi18n_filemanager.duplicate+"</span></a></li>"}c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.sets+'" id="menuFileSets'+k+'" href="'+CCM_TOOLS_PATH+"/files/add_to?searchInstance="+n+"&fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/window_new.png)">'+ccmi18n_filemanager.sets+"</span></a></li>";if($(b).attr("ccm-file-manager-can-admin")=="1"||$(b).attr("ccm-file-manager-can-delete")=="1"){c+='<li class="header"></li>'}if($(b).attr("ccm-file-manager-can-admin")=="1"){c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="400" dialog-height="380" dialog-title="'+ccmi18n_filemanager.permissions+'" id="menuFilePermissions'+k+'" href="'+CCM_TOOLS_PATH+"/files/permissions?searchInstance="+n+"&fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/permissions_small.png)">'+ccmi18n_filemanager.permissions+"</span></a></li>"}if($(b).attr("ccm-file-manager-can-delete")=="1"){c+='<li><a class="ccm-icon dialog-launch" dialog-modal="false" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.deleteFile+'" id="menuDeleteFile'+k+'" href="'+CCM_TOOLS_PATH+"/files/delete?searchInstance="+n+"&fID="+k+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/delete_small.png)">'+ccmi18n_filemanager.deleteFile+"</span></a></li>"}c+="</ul>";c+="</div></div>";c+='<div class="ccm-menu-bl"><div class="ccm-menu-br"><div class="ccm-menu-b"></div></div></div>';l.append(c);$("#ccm-al-menu"+k+n+a+" a.dialog-launch").dialog();$("a#menuClearFile"+k+n+a).click(function(p){ccm_clearFile(p,a);ccm_hideMenus()})}else{l=$("#ccm-al-menu"+k+n+a)}ccm_fadeInMenu(l,g)};ccm_alSelectNone=function(){ccm_hideMenus()};var checkbox_status=false;toggleCheckboxStatus=function(a){if(checkbox_status){for(i=0;i<a.elements.length;i++){if(a.elements[i].type=="checkbox"){a.elements[i].checked=false}}checkbox_status=false}else{for(i=0;i<a.elements.length;i++){if(a.elements[i].type=="checkbox"){a.elements[i].checked=true}}checkbox_status=true}};ccm_alDuplicateFile=function(fID,searchInstance){var postStr="fID="+fID+"&searchInstance="+searchInstance;$.post(CCM_TOOLS_PATH+"/files/duplicate",postStr,function(resp){var r=eval("("+resp+")");if(r.error==1){ccmAlert.notice(ccmi18n.error,r.message);return false}var highlight=new Array();if(r.fID){highlight.push(r.fID);ccm_alRefresh(highlight,searchInstance);ccm_uploadedFiles.push(r.fID);ccm_filesUploadedDialog(searchInstance)}})};ccm_alSelectMultipleIncomingFiles=function(a){if($(a).prop("checked")){$("input.ccm-file-select-incoming").attr("checked",true)}else{$("input.ccm-file-select-incoming").attr("checked",false)}};ccm_starFile=function(a,c){var b="";if($(a).attr("src").indexOf(CCM_STAR_STATES.unstarred)!=-1){$(a).attr("src",$(a).attr("src").replace(CCM_STAR_STATES.unstarred,CCM_STAR_STATES.starred));b="star"}else{$(a).attr("src",$(a).attr("src").replace(CCM_STAR_STATES.starred,CCM_STAR_STATES.unstarred));b="unstar"}$.post(CCM_TOOLS_PATH+"/"+CCM_STAR_ACTION,{action:b,"file-id":c},function(d,e){})};function ccmLayout(cvalID,layout_id,area,locked){this.layout_id=layout_id;this.cvalID=cvalID;this.locked=locked;this.area=area;this.init=function(){var layoutObj=this;this.layoutWrapper=$("#ccm-layout-wrapper-"+this.cvalID);this.ccmControls=this.layoutWrapper.find("#ccm-layout-controls-"+this.cvalID);this.ccmControls.get(0).layoutObj=this;this.ccmControls.mouseover(function(){layoutObj.dontUpdateTwins=0;layoutObj.highlightAreas(1)});this.ccmControls.mouseout(function(){if(!layoutObj.moving){layoutObj.highlightAreas(0)}});this.ccmControls.find(".ccm-layout-menu-button").click(function(e){layoutObj.optionsMenu(e)});this.gridSizing()};this.highlightAreas=function(show){var els=this.layoutWrapper.find(".ccm-add-block");if(show){els.addClass("ccm-layout-area-highlight")}else{els.removeClass("ccm-layout-area-highlight")}};this.optionsMenu=function(e){ccm_hideMenus();e.stopPropagation();ccm_menuActivated=true;var aobj=document.getElementById("ccm-layout-options-menu-"+this.cvalID);if(!aobj){el=document.createElement("DIV");el.id="ccm-layout-options-menu-"+this.cvalID;el.className="ccm-menu";el.style.display="none";document.body.appendChild(el);aobj=$(el);aobj.css("position","absolute");var html='<div class="ccm-menu-tl"><div class="ccm-menu-tr"><div class="ccm-menu-t"></div></div></div>';html+='<div class="ccm-menu-l"><div class="ccm-menu-r">';html+="<ul>";html+='<li><a class="ccm-icon" dialog-title="'+ccmi18n.editAreaLayout+'" dialog-modal="false" dialog-width="550" dialog-height="280" id="menuEditLayout'+this.cvalID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&cvalID="+this.cvalID+'&atask=layout"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/layout_small.png)">'+ccmi18n.editAreaLayout+"</span></a></li>";html+='<li><a class="ccm-icon" id="menuAreaLayoutMoveUp'+this.cvalID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/icon_move_up.png)">'+ccmi18n.moveLayoutUp+"</span></a></li>";html+='<li><a class="ccm-icon" id="menuAreaLayoutMoveDown'+this.cvalID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/icon_move_down.png)">'+ccmi18n.moveLayoutDown+"</span></a></li>";var lockText=(this.locked)?ccmi18n.unlockAreaLayout:ccmi18n.lockAreaLayout;html+='<li><a class="ccm-icon" id="menuAreaLayoutLock'+this.cvalID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/permissions_small.png)">'+lockText+"</span></a></li>";html+='<li><a class="ccm-icon" id="menuAreaLayoutDelete'+this.cvalID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/delete_small.png)">'+ccmi18n.deleteLayout+"</span></a></li>";html+="</ul>";html+="</div></div>";html+='<div class="ccm-menu-bl"><div class="ccm-menu-br"><div class="ccm-menu-b"></div></div></div>';aobj.append(html);var aJQobj=$(aobj);var layoutObj=this;aJQobj.find("#menuEditLayout"+this.cvalID).dialog();aJQobj.find("#menuAreaLayoutMoveUp"+this.cvalID).click(function(){layoutObj.moveLayout("up")});aJQobj.find("#menuAreaLayoutMoveDown"+this.cvalID).click(function(){layoutObj.moveLayout("down")});aJQobj.find("#menuAreaLayoutLock"+this.cvalID).click(function(){layoutObj.lock()});aJQobj.find("#menuAreaLayoutDelete"+this.cvalID).click(function(){layoutObj.deleteLayoutOptions()})}else{aobj=$("#ccm-layout-options-menu-"+this.cvalID)}ccm_fadeInMenu(aobj,e)};this.moveLayout=function(direction){this.moving=1;ccm_hideHighlighter();this.highlightAreas(1);this.servicesAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&cvalID="+this.cvalID+"&task=move&direction="+direction,success:function(response){eval("var jObj="+response);if(parseInt(jObj.success)!=1){alert(jObj.msg)}else{ccm_mainNavDisableDirectExit()}}});var el=$("#ccm-layout-wrapper-"+this.cvalID);var layoutObj=this;if(direction=="down"){var nextLayout=el.next();if(nextLayout.hasClass("ccm-layout-wrapper")){el.slideUp(600,function(){el.insertAfter(nextLayout);el.slideDown(600,function(){layoutObj.highlightAreas(0);layoutObj.moving=0})});return}ccmAlert.hud(ccmi18n.moveLayoutAtBoundary,4000,"icon_move_down",ccmi18n.moveLayoutDown)}else{if(direction=="up"){var previousLayout=el.prev();if(previousLayout.hasClass("ccm-layout-wrapper")){el.slideUp(600,function(){el.insertBefore(previousLayout);el.slideDown(600,function(){layoutObj.highlightAreas(0);layoutObj.moving=0})});return}ccmAlert.hud(ccmi18n.moveLayoutAtBoundary,4000,"icon_move_up",ccmi18n.moveLayoutUp)}}};this.lock=function(lock,twinLock){var a=$("#menuAreaLayoutLock"+this.cvalID);this.locked=!this.locked;if(this.locked){a.find("span").html(ccmi18n.unlockAreaLayout);if(this.s){this.s.slider("disable")}}else{a.find("span").html(ccmi18n.lockAreaLayout);if(this.s){this.s.slider("enable")}}var lock=(this.locked)?1:0;if(!twinLock){this.servicesAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&task=lock&lock="+lock,success:function(response){eval("var jObj="+response);if(parseInt(jObj.success)!=1){alert(jObj.msg)}else{}}});this.getTwins();for(var i=0;i<this.layoutTwinObjs.length;i++){this.layoutTwinObjs[i].lock(lock,1)}}};this.hasBeenQuickSaved=0;this.quickSaveLayoutId=0;this.quickSave=function(){var breakPoints=this.ccmControls.find("#layout_col_break_points_"+this.cvalID).val().replace(/%/g,"");clearTimeout(this.secondSavePauseTmr);if(!this.hasBeenQuickSaved&&this.quickSaveInProgress){quickSaveLayoutObj=this;this.secondSavePauseTmr=setTimeout("quickSaveLayoutObj.quickSave()",100);return}this.quickSaveInProgress=1;var layoutObj=this;var modifyLayoutId=(this.quickSaveLayoutId)?this.quickSaveLayoutId:this.layout_id;this.quickSaveAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+modifyLayoutId+"&task=quicksave&breakpoints="+encodeURIComponent(breakPoints),success:function(response){eval("var jObj="+response);if(parseInt(jObj.success)!=1){alert(jObj.msg)}else{layoutObj.hasBeenQuickSaved=1;layoutObj.quickSaveInProgress=0;if(jObj.layoutID){layoutObj.quickSaveLayoutId=jObj.layoutID}ccm_mainNavDisableDirectExit()}}})};this.deleteLayoutOptions=function(){var hasBlocks=0;deleteLayoutObj=this;this.layoutWrapper.find(".ccm-block").each(function(i,el){if(el.style.display!="none"){hasBlocks=1}});var dialogHeight=(hasBlocks)?"110px":"50px";$.fn.dialog.open({title:ccmi18n.deleteLayoutOptsTitle,href:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&task=deleteOpts&hasBlocks="+hasBlocks,width:"340px",modal:false,height:dialogHeight})};this.deleteLayout=function(deleteBlocks){ccm_hideMenus();jQuery.fn.dialog.closeTop();this.layoutWrapper.slideUp(300);jQuery.fn.dialog.showLoader();var cvalID=this.cvalID;this.servicesAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&task=delete&deleteBlocks="+parseInt(deleteBlocks),success:function(response){eval("var jObj="+response);if(parseInt(jObj.success)!=1){alert(jObj.msg);jQuery.fn.dialog.hideLoader()}else{$("#ccm-layout-wrapper-"+cvalID).remove();ccm_hideHighlighter();ccm_mainNavDisableDirectExit();if(jObj.refreshPage){window.location=window.location}else{jQuery.fn.dialog.hideLoader()}}}})};this.gridSizing=function(){this.ccmGrid=$("#ccm-layout-"+this.layout_id);var cols=parseInt(this.ccmControls.find(".layout_column_count").val());if(cols>1){var startPoints=this.ccmControls.find("#layout_col_break_points_"+this.cvalID).val().replace(/%/g,"").split("|");this.s=this.ccmControls.find(".ccm-layout-controls-slider");this.s.get(0).layoutObj=this;this.s.get(0).ccmGrid=this.ccmGrid;this.s.slider({step:1,values:startPoints,change:function(){if(this.layoutObj.dontUpdateTwins){return}this.layoutObj.resizeGrid(this.childNodes);var breakPoints=[];for(var z=0;z<this.childNodes.length;z++){breakPoints.push(parseFloat(this.childNodes[z].style.left.replace("%","")))}breakPoints.sort(function(a,b){return(a-b)});this.layoutObj.ccmControls.find(".layout_col_break_points").val(breakPoints.join("%|")+"%");this.layoutObj.quickSave();ccm_arrangeMode=0;this.layoutObj.moving=0;this.layoutObj.highlightAreas(0)},slide:function(){ccm_arrangeMode=1;this.layoutObj.moving=1;if(this.layoutObj.dontUpdateTwins){return}this.layoutObj.resizeGrid(this.childNodes)}});if(parseInt(this.ccmControls.find(".layout_locked").val())){this.s.slider("disable")}}};this.getTwins=function(){if(!this.layoutTwins){this.layoutTwins=$(".ccm-layout-controls-layoutID-"+this.layout_id).not(this.ccmControls);this.layoutTwinObjs=[];for(var q=0;q<this.layoutTwins.length;q++){this.layoutTwinObjs.push(this.layoutTwins[q].layoutObj);this.layoutTwins[q].handles=$(this.layoutTwins[q]).find(".ui-slider-handle")}}return this.layoutTwins};this.resizeGrid=function(childNodes){var positions=[];this.getTwins();for(var y=0;y<childNodes.length;y++){var pos=parseFloat(childNodes[y].style.left.replace("%",""));positions.push(pos);if(!this.dontUpdateTwins){for(var w=0;w<this.layoutTwinObjs.length;w++){this.layoutTwinObjs[w].dontUpdateTwins=1;this.layoutTwinObjs[w].s.slider("values",y,pos)}}}positions.sort(function(a,b){return(a-b)});var prevW=0;var i;for(i=0;i<positions.length;i++){var pos=positions[i];var w=pos-prevW;prevW+=w;$(".ccm-layout-"+this.layout_id+"-col-"+(i+1)).css("width",w+"%");if(!this.dontUpdateTwins){for(j=0;j<this.layoutTwins.length;j++){this.layoutTwins[j].handles[i].style.left=pos+"%"}}}$(".ccm-layout-"+this.layout_id+"-col-"+(i+1)).css("width",(100-prevW)+"%")}}var quickSaveLayoutObj;var deleteLayoutObj;var ccmLayoutEdit={init:function(){this.showPresetDeleteIcon();$("#ccmLayoutPresentIdSelector").change(function(){var b=parseInt($(this).val());var c=$("#ccmAreaLayoutForm_layoutID").val();jQuery.fn.dialog.showLoader();if(b>0){var a=$("#ccm-layout-refresh-action").val()+"&lpID="+b}else{var a=$("#ccm-layout-refresh-action").val()+"&layoutID="+c}$.get(a,function(d){$("#ccm-layout-edit-wrapper").html(d);jQuery.fn.dialog.hideLoader();ccmLayoutEdit.showPresetDeleteIcon()})});$("#layoutPresetActionNew input[name=layoutPresetAction]").click(function(){if($(this).val()=="create_new_preset"&&$(this).prop("checked")){$("input[name=layoutPresetName]").attr("disabled",false).focus()}else{$("input[name=layoutPresetName]").val("").attr("disabled",true)}});$("#layoutPresetActions input[name=layoutPresetAction]").click(function(){if($(this).val()=="create_new_preset"&&$(this).prop("checked")){$("input[name=layoutPresetNameAlt]").attr("disabled",false).focus()}else{$("input[name=layoutPresetNameAlt]").val("").attr("disabled",true)}});if($("#layoutPresetActions").length>0){$("#ccmLayoutConfigOptions input, #ccmLayoutConfigOptions select").bind("change click",function(){$("#layoutPresetActions").show();$("#layoutPresetActionNew").hide();$("#ccmLayoutConfigOptions input, #ccmLayoutConfigOptions select").unbind("change click")})}},showPresetDeleteIcon:function(){if($("#ccmLayoutPresentIdSelector").val()>0){$("#ccm-layout-delete-preset").show()}else{$("#ccm-layout-delete-preset").hide()}},deletePreset:function(){var lpID=parseInt($("#ccmLayoutPresentIdSelector").val());if(lpID>0){if(!confirm(ccmi18n.confirmLayoutPresetDelete)){return false}jQuery.fn.dialog.showLoader();var area=$("#ccmAreaLayoutForm_arHandle").val();var url=CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(area)+"&task=deletePreset&lpID="+lpID;$.get(url,function(r){eval("var jObj="+r);if(parseInt(jObj.success)!=1){alert(jObj.msg)}else{$("#ccmLayoutPresentIdSelector option[value='"+lpID+"']").remove()}jQuery.fn.dialog.hideLoader()})}}};$.widget.bridge("jqdialog",$.ui.dialog);jQuery.fn.dialog=function(){if(arguments.length>0){$(this).jqdialog(arguments[0],arguments[1],arguments[2]);return}else{if($(this).is("div")){$(this).jqdialog();return}}return $(this).each(function(){$(this).click(function(d){var a=$(this).attr("href");var b=$(this).attr("dialog-width");var l=$(this).attr("dialog-height");var g=$(this).attr("dialog-title");var c=$(this).attr("dialog-on-open");var k=$(this).attr("dialog-on-destroy");var m=$(this).attr("dialog-append-buttons");var f=$(this).attr("dialog-on-close");obj={modal:true,href:a,width:b,height:l,title:g,appendButtons:m,onOpen:c,onDestroy:k,onClose:f};jQuery.fn.dialog.open(obj);return false})})};jQuery.fn.dialog.close=function(a){a++;$("#ccm-dialog-content"+a).jqdialog("close")};jQuery.fn.dialog.open=function(obj){jQuery.fn.dialog.showLoader();if(ccm_uiLoaded){ccm_hideMenus()}var nd=$(".ui-dialog").length;nd++;$("body").append('<div id="ccm-dialog-content'+nd+'" style="display: none"></div>');if(typeof(obj.width)=="string"){if(obj.width.indexOf("%",0)>0){w=obj.width.replace("%","");h=obj.height.replace("%","");h=$(window).height()*(h/100);w=$(window).width()*(w/100);h=h+100;w=w+50}else{w=parseInt(obj.width)+50;h=parseInt(obj.height)+100}}else{w=parseInt(obj.width)+50;h=parseInt(obj.height)+100}if(obj.appendButtons){var buttons=[{}]}else{var buttons=false}$("#ccm-dialog-content"+nd).jqdialog({modal:true,height:h,width:w,show:{effect:"fade",duration:150,easing:"easeInExpo"},hide:{effect:"drop",direction:"down",distance:60,duration:500,easing:"easeOutExpo"},escapeClose:true,buttons:buttons,title:obj.title,open:function(){$("body").css("overflow","hidden")},beforeClose:function(){$("body").css("overflow","auto")},close:function(ev,u){$(this).jqdialog("destroy").remove();$("#ccm-dialog-content"+nd).remove();if(typeof obj.onClose!="undefined"){if((typeof obj.onClose)=="function"){obj.onClose()}else{eval(obj.onClose)}}if(typeof obj.onDestroy!="undefined"){if((typeof obj.onDestroy)=="function"){obj.onDestroy()}else{eval(obj.onDestroy)}}nd--}});if(!obj.element){$.ajax({type:"GET",url:obj.href,success:function(r){jQuery.fn.dialog.hideLoader();$("#ccm-dialog-content"+nd).html(r);$("#ccm-dialog-content"+nd+" .dialog-launch").dialog();$("#ccm-dialog-content"+nd+" .ccm-dialog-close").click(function(){jQuery.fn.dialog.closeTop()});if($("#ccm-dialog-content"+nd+" .dialog-buttons").length>0){$("#ccm-dialog-content"+nd).parent().addClass("ccm-ui");$("#ccm-dialog-content"+nd).parent().find(".ui-dialog-buttonpane").html($("#ccm-dialog-content"+nd+" .dialog-buttons").html());$("#ccm-dialog-content"+nd+" .dialog-buttons").hide()}if(typeof obj.onOpen!="undefined"){if((typeof obj.onOpen)=="function"){obj.onOpen()}else{eval(obj.onOpen)}}}})}else{jQuery.fn.dialog.hideLoader();$("#ccm-dialog-content"+nd).append($(obj.element));if($(obj.element).css("display")=="none"){$(obj.element).show()}$("#ccm-dialog-content"+nd+" .dialog-launch").dialog();$("#ccm-dialog-content"+nd+" .ccm-dialog-close").click(function(){jQuery.fn.dialog.closeTop()});if(typeof obj.onOpen!="undefined"){if((typeof obj.onOpen)=="function"){obj.onOpen()}else{eval(obj.onOpen)}}}};jQuery.fn.dialog.replaceTop=function(a){var b=$(".ui-dialog").length;$("#ccm-dialog-content"+b).html(a)};jQuery.fn.dialog.showLoader=function(a){if(typeof(imgLoader)=="undefined"||!imgLoader||!imgLoader.src){return false}if($("#ccm-dialog-loader").length<1){$("body").append("<div id='ccm-dialog-loader-wrapper'><img id='ccm-dialog-loader' src='"+imgLoader.src+"' /></div>")}$("#ccm-dialog-loader-wrapper").css("opacity",0.8);$("#ccm-dialog-loader-wrapper").show()};jQuery.fn.dialog.hideLoader=function(){$("#ccm-dialog-loader-wrapper").hide()};jQuery.fn.dialog.closeTop=function(){var a=$(".ui-dialog").length;$("#ccm-dialog-content"+a).jqdialog("close")};jQuery.fn.dialog.closeAll=function(){$(".ui-dialog-content").jqdialog("close")};var imgLoader;var ccm_dialogOpen=0;jQuery.fn.dialog.loaderImage=CCM_IMAGE_PATH+"/throbber_white_32.gif";var ccmAlert={notice:function(c,b,a){$.fn.dialog.open({href:CCM_TOOLS_PATH+"/alert",title:c,width:320,height:160,modal:false,onOpen:function(){$("#ccm-popup-alert-message").html(b)},onDestroy:a})},hud:function(b,d,a,e){if($("#ccm-notification-inner").length==0){$(document.body).append('<div id="ccm-notification"><div id="ccm-notification-inner"></div></div>')}if(a==null){a="edit_small"}if(e==null){var c=b}else{var c="<h3>"+e+"</h3>"+b}$("#ccm-notification-inner").html('<table border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><img id="ccm-notification-icon" src="'+CCM_IMAGE_PATH+"/icons/"+a+'.png" width="16" height="16" /></td><td valign="top">'+c+"</td></tr></table>");$("#ccm-notification").show();if(d>0){setTimeout(function(){$("#ccm-notification").fadeOut({easing:"easeOutExpo",duration:300})},d)}}};$(document).ready(function(){imgLoader=new Image();imgLoader.src=jQuery.fn.dialog.loaderImage});(function(l,k,q){var p=k.event,o;p.special.smartresize={setup:function(){k(this).bind("resize",p.special.smartresize.handler)},teardown:function(){k(this).unbind("resize",p.special.smartresize.handler)},handler:function(f,e){var s=this,g=arguments;f.type="smartresize",o&&clearTimeout(o),o=setTimeout(function(){jQuery.event.handle.apply(s,g)},e==="execAsap"?0:100)}},k.fn.smartresize=function(b){return b?this.bind("smartresize",b):this.trigger("smartresize",["execAsap"])},k.Mason=function(b,d){this.element=k(d),this._create(b),this._init()};var n=["position","height"];k.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1},k.Mason.prototype={_filterFindBricks:function(d){var c=this.options.itemSelector;return c?d.filter(c).add(d.find(c)):d},_getBricks:function(d){var c=this._filterFindBricks(d).css({position:"absolute"}).addClass("masonry-brick");return c},_create:function(v){this.options=k.extend(!0,{},k.Mason.settings,v),this.styleQueue=[],this.reloadItems();var u=this.element[0].style;this.originalStyle={};for(var t=0,s=n.length;t<s;t++){var f=n[t];this.originalStyle[f]=u[f]||null}this.element.css({position:"relative"}),this.horizontalDirection=this.options.isRTL?"right":"left",this.offset={};var b=k(document.createElement("div"));this.element.prepend(b),this.offset.y=Math.round(b.position().top),this.options.isRTL?(b.css({"float":"right",display:"inline-block"}),this.offset.x=Math.round(this.element.outerWidth()-b.position().left)):this.offset.x=Math.round(b.position().left),b.remove();var a=this;setTimeout(function(){a.element.addClass("masonry")},0),this.options.isResizable&&k(l).bind("smartresize.masonry",function(){a.resize()})},_init:function(b){this._getColumns("masonry"),this._reLayout(b)},option:function(b,d){k.isPlainObject(b)&&(this.options=k.extend(!0,this.options,b))},layout:function(F,E){var D,C,B,A,z,y;for(var x=0,v=F.length;x<v;x++){D=k(F[x]),C=Math.ceil(D.outerWidth(!0)/this.columnWidth),C=Math.min(C,this.cols);if(C===1){this._placeBrick(D,this.colYs)}else{B=this.cols+1-C,A=[];for(y=0;y<B;y++){z=this.colYs.slice(y,y+C),A[y]=Math.max.apply(Math,z)}this._placeBrick(D,A)}}var u={};u.height=Math.max.apply(Math,this.colYs)-this.offset.y,this.options.isFitWidth&&(u.width=this.cols*this.columnWidth-this.options.gutterWidth),this.styleQueue.push({$el:this.element,style:u});var t=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",s=this.options.animationOptions,b;for(x=0,v=this.styleQueue.length;x<v;x++){b=this.styleQueue[x],b.$el[t](b.style,s)}this.styleQueue=[],E&&E.call(F),this.isLaidOut=!0},_getColumns:function(){var d=this.options.isFitWidth?this.element.parent():this.element,c=d.width();this.columnWidth=this.options.columnWidth||this.$bricks.outerWidth(!0)||c,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((c+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(B,A){var z=Math.min.apply(Math,A),y=0;for(var x=0,v=A.length;x<v;x++){if(A[x]===z){y=x;break}}var u={top:z};u[this.horizontalDirection]=this.columnWidth*y+this.offset.x,this.styleQueue.push({$el:B,style:u});var t=z+B.outerHeight(!0),s=this.cols+1-v;for(x=0;x<s;x++){this.colYs[y+x]=t}},resize:function(){var b=this.cols;this._getColumns("masonry"),this.cols!==b&&this._reLayout()},_reLayout:function(d){var c=this.cols;this.colYs=[];while(c--){this.colYs.push(this.offset.y)}this.layout(this.$bricks,d)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(b){this.reloadItems(),this._init(b)},appended:function(f,e,s){if(e){this._filterFindBricks(f).css({top:this.element.height()});var g=this;setTimeout(function(){g._appended(f,s)},1)}else{this._appended(f,s)}},_appended:function(e,d){var f=this._getBricks(e);this.$bricks=this.$bricks.add(f),this.layout(f,d)},remove:function(b){this.$bricks=this.$bricks.not(b),b.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position=null,this.style.top=null,this.style.left=null});var s=this.element[0].style;for(var f=0,b=n.length;f<b;f++){var a=n[f];s[a]=this.originalStyle[a]}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),k(l).unbind(".masonry")}},k.fn.imagesLoaded=function(s){var c=this.find("img"),x=c.length,v="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",u=this,t=function(){--x<=0&&this.src!==v&&(s.call(u),c.unbind("load",t))};if(!x){s.call(this);return this}c.bind("load",t).each(function(){if(this.complete||this.complete===q){var b=this.src;this.src=v,this.src=b}});return this};var m=function(b){this.console&&console.error(b)};k.fn.masonry=function(b){if(typeof b=="string"){var d=Array.prototype.slice.call(arguments,1);this.each(function(){var a=k.data(this,"masonry");if(!a){m("cannot call methods on masonry prior to initialization; attempted to call method '"+b+"'")}else{if(!k.isFunction(a[b])||b.charAt(0)==="_"){m("no such method '"+b+"' for masonry instance");return}a[b].apply(a,d)}})}else{this.each(function(){var a=k.data(this,"masonry");a?(a.option(b||{}),a._init()):k.data(this,"masonry",new k.Mason(b,this))})}return this}})(window,jQuery);String.prototype.score=function(m,d){d=d||0;if(m.length==0){return 0.9}if(m.length>this.length){return 0}for(var g=m.length;g>0;g--){var o=m.substring(0,g);var k=this.indexOf(o);if(k<0){continue}if(k+m.length>this.length+d){continue}var n=this.substring(k+o.length);var f=null;if(g>=m.length){f=""}else{f=m.substring(g)}var e=n.score(f,d+k);if(e>0){var a=this.length-n.length;if(k!=0){var b=0;var l=this.charCodeAt(k-1);if(l==32||l==9){for(var b=(k-2);b>=0;b--){l=this.charCodeAt(b);a-=((l==32||l==9)?1:0.15)}}else{a-=k}}a+=e*n.length;a/=this.length;return a}}return 0};var ccm_searchActivatePostFunction=new Array();ccm_setupAdvancedSearchFields=function(a){ccm_totalAdvancedSearchFields=$(".ccm-search-request-field-set").length;$("#ccm-"+a+"-search-add-option").unbind();$("#ccm-"+a+"-search-add-option").click(function(){ccm_totalAdvancedSearchFields++;$("#ccm-search-fields-wrapper").append('<div class="ccm-search-field" id="ccm-'+a+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</div>");ccm_activateAdvancedSearchFields(a,ccm_totalAdvancedSearchFields)});var b=1;$(".ccm-search-request-field-set").each(function(){ccm_activateAdvancedSearchFields(a,b);b++})};ccm_setupAdvancedSearch=function(a){ccm_setupAdvancedSearchFields(a);$("#ccm-"+a+"-advanced-search").ajaxForm({beforeSubmit:function(){ccm_deactivateSearchResults(a)},success:function(b){ccm_parseAdvancedSearchResponse(b,a)}});ccm_setupInPagePaginationAndSorting(a);ccm_setupSortableColumnSelection(a)};ccm_parseAdvancedSearchResponse=function(c,a){var b=$("#ccm-"+a+"-search-results");if(b.length==0||a==null){b=$("#ccm-search-results")}b.html(c);ccm_activateSearchResults(a)};ccm_deactivateSearchResults=function(a){var b=$("#ccm-"+a+"-search-fields-submit");if(b.length==0||a==null){b=$("#ccm-search-fields-submit")}b.attr("disabled",true);var b=$("#ccm-"+a+"-search-loading");if(b.length==0||a==null){b=$("#ccm-search-loading")}b.show()};ccm_activateSearchResults=function(a){var b=$("#ccm-"+a+"-search-loading");if(b.length==0||a==null){b=$("#ccm-search-loading")}b.hide();var b=$("#ccm-"+a+"-search-fields-submit");if(b.length==0||a==null){b=$("#ccm-search-fields-submit")}b.attr("disabled",false);ccm_setupInPagePaginationAndSorting(a);ccm_setupSortableColumnSelection(a);if(typeof(ccm_searchActivatePostFunction[a])=="function"){ccm_searchActivatePostFunction[a]()}};ccm_setupInPagePaginationAndSorting=function(a){$(".ccm-results-list th a").click(function(){ccm_deactivateSearchResults(a);var b=$("#ccm-"+a+"-search-results");if(b.length==0){b=$("#ccm-search-results")}b.load($(this).attr("href"),false,function(){ccm_activateSearchResults(a)});return false});$("div.ccm-pagination a").click(function(){ccm_deactivateSearchResults(a);var b=$("#ccm-"+a+"-search-results");if(b.length==0){b=$("#ccm-search-results")}b.load($(this).attr("href"),false,function(){ccm_activateSearchResults(a);$("div.ccm-dialog-content").attr("scrollTop",0)});return false})};ccm_setupSortableColumnSelection=function(a){$("#ccm-search-add-column").unbind();$("#ccm-search-add-column").click(function(){jQuery.fn.dialog.open({width:550,height:350,modal:false,href:$(this).attr("href"),title:ccmi18n.customizeSearch});return false})};ccm_checkSelectedAdvancedSearchField=function(b,a){$("#ccm-"+b+"-search-field-set"+a+" .ccm-search-option[search-field=date_added] input").each(function(){if($(this).attr("id")=="date_from"){$(this).attr("id","date_from"+a)}else{if($(this).attr("id")=="date_to"){$(this).attr("id","date_to"+a)}}});$("#ccm-"+b+"-search-field-set"+a+" .ccm-search-option input.ccm-input-date").each(function(){$(this).attr("id",$(this).attr("id")+a)});$("#ccm-"+b+"-search-field-set"+a+" .ccm-search-option[search-field=date_added] input").datepicker({showAnim:"fadeIn"});$("#ccm-"+b+"-search-field-set"+a+" .ccm-search-option-type-date_time input").datepicker({showAnim:"fadeIn"});$("#ccm-"+b+"-search-field-set"+a+" .ccm-search-option-type-rating input").rating()};ccm_activateAdvancedSearchFields=function(c,b){var a=$("#ccm-"+c+"-search-field-set"+b+" select:first");a.unbind();a.change(function(){var d=$(this).find(":selected").val();$(this).next("input.ccm-"+c+"-selected-field").val(d);var e=$("#ccm-"+c+"-search-field-base-elements span[search-field="+d+"]");$("#ccm-"+c+"-search-field-set"+b+" .ccm-selected-field-content").html("");e.clone().appendTo("#ccm-"+c+"-search-field-set"+b+" .ccm-selected-field-content");$("#ccm-"+c+"-search-field-set"+b+" .ccm-selected-field-content .ccm-search-option").show();ccm_checkSelectedAdvancedSearchField(c,b)});$("#ccm-"+c+"-search-field-set"+b+" .ccm-search-remove-option").unbind();$("#ccm-"+c+"-search-field-set"+b+" .ccm-search-remove-option").click(function(){$(this).parents("div.ccm-search-field").remove()});ccm_checkSelectedAdvancedSearchField(c,b)};ccm_activateEditablePropertiesGrid=function(){$("tr.ccm-attribute-editable-field").each(function(){var a=$(this);$(this).find("a").click(function(){a.find(".ccm-attribute-editable-field-text").hide();a.find(".ccm-attribute-editable-field-clear-button").hide();a.find(".ccm-attribute-editable-field-form").show();a.find(".ccm-attribute-editable-field-save-button").show()});a.find("form").submit(function(){ccm_submitEditablePropertiesGrid(a);return false});a.find(".ccm-attribute-editable-field-save-button").parent().click(function(){ccm_submitEditablePropertiesGrid(a)});a.find(".ccm-attribute-editable-field-clear-button").parent().unbind();a.find(".ccm-attribute-editable-field-clear-button").parent().click(function(){a.find("form input[name=task]").val("clear_extended_attribute");ccm_submitEditablePropertiesGrid(a);return false})})};ccm_submitEditablePropertiesGrid=function(a){a.find(".ccm-attribute-editable-field-save-button").hide();a.find(".ccm-attribute-editable-field-clear-button").hide();a.find(".ccm-attribute-editable-field-loading").show();try{tinyMCE.triggerSave(true,true)}catch(b){}a.find("form").ajaxSubmit(function(c){a.find(".ccm-attribute-editable-field-loading").hide();a.find(".ccm-attribute-editable-field-save-button").show();a.find(".ccm-attribute-editable-field-text").html(c);a.find(".ccm-attribute-editable-field-form").hide();a.find(".ccm-attribute-editable-field-save-button").hide();a.find(".ccm-attribute-editable-field-text").show();a.find(".ccm-attribute-editable-field-clear-button").show();a.find("td").show("highlight",{color:"#FFF9BB"})})};var tr_activeNode=false;if(typeof(tr_doAnim)=="undefined"){var tr_doAnim=false}var tr_parseSubnodes=true;var tr_reorderMode=false;var tr_moveCopyMode=false;showPageMenu=function(f,d){ccm_hideMenus();d.stopPropagation();var a=$("#ccm-page-menu"+f.cID);if(!a.get(0)){el=document.createElement("DIV");el.id="ccm-page-menu"+f.cID;el.className="ccm-menu";el.style.display="none";document.body.appendChild(el);a=$("#ccm-page-menu"+f.cID);a.css("position","absolute");var b='<div class="ccm-menu-tl"><div class="ccm-menu-tr"><div class="ccm-menu-t"></div></div></div>';b+='<div class="ccm-menu-l"><div class="ccm-menu-r">';b+="<ul>";if(f.cAlias=="LINK"||f.cAlias=="POINTER"){b+='<li><a class="ccm-icon" id="menuVisit'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/window_new.png)">'+ccmi18n_sitemap.visitExternalLink+"</span></a></li>";if(f.cAlias=="LINK"){b+='<li><a class="ccm-icon" dialog-width="350" dialog-height="300" dialog-title="'+ccmi18n_sitemap.editExternalLink+'" dialog-modal="false" id="menuLink'+f.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+f.cID+'&ctask=edit_external"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+ccmi18n_sitemap.editExternalLink+"</span></a></li>"}b+='<li><a class="ccm-icon" id="menuDelete'+f.cID+'" href="javascript:deletePage('+f.cID+",'"+f.instance_id+"', '"+f.display_mode+"', '"+f.select_mode+'\')"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/delete_small.png)">'+ccmi18n_sitemap.deleteExternalLink+"</span></a></li>"}else{if(f.canWrite=="false"){b+='<li><a class="ccm-icon" id="menuVisit'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/window_new.png)">'+ccmi18n_sitemap.visitPage+"</span></a></li>"}else{b+='<li><a class="ccm-icon" id="menuVisit'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/window_new.png)">'+ccmi18n_sitemap.visitPage+"</span></a></li>";if(f.canCompose){b+='<li><a class="ccm-icon" id="menuComposer'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/composer/write/-/edit/"+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/edit_small.png)">'+ccmi18n_sitemap.editInComposer+"</span></a></li>"}b+='<li><a class="ccm-icon" dialog-width="640" dialog-height="360" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pagePropertiesTitle+'" id="menuProperties'+f.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+f.cID+'&ctask=edit_metadata"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/edit_small.png)">'+ccmi18n_sitemap.pageProperties+"</span></a></li>";b+='<li><a class="ccm-icon" dialog-width="640" dialog-height="310" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.setPagePermissions+'" id="menuPermissions'+f.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+f.cID+'&ctask=edit_permissions"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/permissions_small.png)">'+ccmi18n_sitemap.setPagePermissions+"</span></a></li>";b+='<li><a class="ccm-icon" dialog-width="680" dialog-height="420" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageDesign+'" id="menuDesign'+f.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+f.cID+'&ctask=set_theme"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/design_small.png)">'+ccmi18n_sitemap.pageDesign+"</span></a></li>";b+='<li><a class="ccm-icon" dialog-width="640" dialog-height="340" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageVersions+'" id="menuVersions'+f.cID+'" href="'+CCM_TOOLS_PATH+"/versions.php?rel=SITEMAP&cID="+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/versions_small.png)">'+ccmi18n_sitemap.pageVersions+"</span></a></li>";b+='<li><a class="ccm-icon" id="menuDelete'+f.cID+'" href="javascript:deletePage('+f.cID+",'"+f.instance_id+"','"+f.display_mode+"', '"+f.select_mode+'\')"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/delete_small.png)">'+ccmi18n_sitemap.deletePage+"</span></a></li>";b+='<li class="header"></li>';if(f.display_mode=="explore"||f.display_mode=="search"){b+='<li><a class="ccm-icon" dialog-width="640" dialog-height="340" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.moveCopyPage+'" id="menuMoveCopy'+f.cID+'" href="'+CCM_TOOLS_PATH+"/sitemap_overlay?instance_id="+f.instance_id+"&display_mode="+f.display_mode+"&select_mode=move_copy_delete&cID="+f.cID+'" id="menuMoveCopy'+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/up_down.png)">'+ccmi18n_sitemap.moveCopyPage+"</span></a></li>";if(f.display_mode=="explore"){b+='<li><a class="ccm-icon" id="menuSendToStop'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+f.cID+'&task=send_to_top"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/sitemap_up.png)">'+ccmi18n_sitemap.sendToTop+"</span></a></li>";b+='<li><a class="ccm-icon" id="menuSendToBottom'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+f.cID+'&task=send_to_bottom"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/sitemap_down.png)">'+ccmi18n_sitemap.sendToBottom+"</span></a></li>"}if(f.cNumChildren==0){b+='<li class="header"></li>'}}if(f.cNumChildren>0){var c=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/search/?selectedSearchField[]=parent&cParentAll=1&cParentIDSearchField="+f.cID;if(f.display_mode=="full"||f.display_mode==""||f.display_mode=="explore"){b+='<li><a class="ccm-icon ccm-icon-sitemap-search" id="menuSearch'+f.cID+'" href="'+c+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/magnifying.png)">'+ccmi18n_sitemap.searchPages+"</span></a></li>"}if(f.display_mode!="explore"){b+='<li><a class="ccm-icon ccm-icon-sitemap-explore" id="menuExplore'+f.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+f.cID+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/magnifying.png)">'+ccmi18n_sitemap.explorePages+"</span></a></li>"}b+='<li class="header"></li>'}b+='<li><a class="ccm-icon" dialog-width="680" dialog-modal="false" dialog-height="440" dialog-title="'+ccmi18n_sitemap.addPage+'" id="menuSubPage'+f.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&mode="+f.display_mode+"&cID="+f.cID+'&ctask=add"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+ccmi18n_sitemap.addPage+"</span></a></li>";if(f.display_mode!="search"){b+='<li><a class="ccm-icon" dialog-width="350" dialog-modal="false" dialog-height="160" dialog-title="'+ccmi18n_sitemap.addExternalLink+'" dialog-modal="false" id="menuLink'+f.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+f.cID+'&ctask=add_external"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+ccmi18n_sitemap.addExternalLink+"</span></a></li>"}}}b+="</ul>";b+="</div></div>";b+='<div class="ccm-menu-bl"><div class="ccm-menu-br"><div class="ccm-menu-b"></div></div></div>';a.append(b);$("#menuProperties"+f.cID).dialog();$("#menuSubPage"+f.cID).dialog();$("#menuDesign"+f.cID).dialog();$("#menuLink"+f.cID).dialog();$("#menuVersions"+f.cID).dialog();$("#menuPermissions"+f.cID).dialog();$("#menuMoveCopy"+f.cID).dialog()}else{a=$("#ccm-page-menu"+f.cID)}ccm_fadeInMenu(a,d)};deletePage=function(a,c,b,d){ccm_hideMenus();if(confirm(ccmi18n_sitemap.areYouSure)){jQuery.fn.dialog.showLoader();$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_delete_request.php",{cID:a,ccm_token:CCM_SECURITY_TOKEN},function(e){ccm_parseJSON(e,function(){jQuery.fn.dialog.hideLoader();if(b=="explore"){ccmSitemapExploreNode(c,"explore",d,e.cParentID)}else{deleteBranchFade(a)}ccmAlert.hud(ccmi18n_sitemap.deletePageSuccessMsg,2000,"delete_small",ccmi18n_sitemap.deletePage)})})}};hideBranch=function(a){$("#tree-node"+a).hide();$("#tree-dz"+a).hide()};cancelReorder=function(){if(tr_reorderMode){tr_reorderMode=false;$("li.tree-node").draggable("destroy");if(!tr_moveCopyMode){hideSitemapMessage()}}};searchSubPages=function(a){$("#ccm-tree-search-trigger"+a).hide();if(ccm_animEffects){$("#ccm-tree-search"+a).fadeIn(200,function(){$("#ccm-tree-search"+a+" input").get(0).focus()})}else{$("#ccm-tree-search"+a).show();$("#ccm-tree-search"+a+" input").get(0).focus()}};activateReorder=function(){tr_reorderMode=true;$("li.tree-node").draggable({handle:"img.handle",opacity:0.5,revert:false,helper:"clone",start:function(){$(document.body).css("overflowX","hidden")},stop:function(){$(document.body).css("overflowX","auto")}});fixResortingDroppables()};deleteBranchFade=function(a){if(ccm_animEffects){$("#tree-node"+a).fadeOut(300,function(){$("#tree-node"+a).remove()});$("#tree-dz"+a).fadeOut(300,function(){$("#tree-dz"+a).remove()})}else{deleteBranchDirect(a)}};deleteBranchDirect=function(a){$("#tree-node"+a).remove();$("#tree-dz"+a).remove()};showBranch=function(a){var b=$("#tree-node"+a);$("#tree-node"+a).show();$("#tree-dz"+a).show()};rescanDisplayOrder=function(b){setLoading(b);var c="?foo=1";var a=$("#tree-root"+b).children("li.tree-node");for(i=0;i<a.length;i++){if($(a[i]).hasClass("ui-draggable-dragging")){continue}c+="&cID[]="+$(a[i]).attr("id").substring(9)}$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_update.php",c,function(d){ccm_parseJSON(d,function(){});removeLoading(b)})};var SITEMAP_LAST_DIALOGUE_URL="";var ccm_sitemap_html="";parseSitemapResponse=function(b,e,f,c,d){var a=$("ul[tree-root-node-id="+c+"][sitemap-instance-id="+b+"]");a.html(d);a.slideDown(150,"easeOutExpo")};selectMoveCopyTarget=function(n,d,l,a,f){if(!f){var f=CCM_CID}var g=ccmi18n_sitemap.moveCopyPage;var b=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?instance_id="+n+"&display_mode="+d+"&select_mode="+l+"&origCID="+f+"&destCID="+a;var c=350;var m=350;try{if(CCM_NODE_ACTION=="<none>"){if(CCM_TARGET_ID!=""){$("#"+CCM_TARGET_ID).val(a)}$.fn.dialog.closeTop();return}if(CCM_NODE_ACTION!=""){b=CCM_NODE_ACTION+"?destCID="+a}if(CCM_DIALOG_TITLE!=""){g=CCM_DIALOG_TITLE}if(CCM_DIALOG_HEIGHT!=""){c=CCM_DIALOG_HEIGHT}if(CCM_DIALOG_WIDTH!=""){m=CCM_DIALOG_WIDTH}}catch(k){}$.fn.dialog.open({title:g,href:b,width:m,modal:false,height:c,onClose:function(){if(typeof(CCM_TARGET_ID)!="undefined"&&CCM_TARGET_ID!=""){$("#"+CCM_TARGET_ID).val(a)}if(tr_moveCopyMode==true){deactivateMoveCopy()}}})};selectLabel=function(e,node){var cNumChildren=node.attr("tree-node-children");if(node.attr("sitemap-select-mode")=="move_copy_delete"||tr_moveCopyMode==true){var destCID=node.attr("id").substring(10);var origCID=node.attr("selected-page-id");selectMoveCopyTarget(node.attr("sitemap-instance-id"),node.attr("sitemap-display-mode"),node.attr("sitemap-select-mode"),destCID,origCID)}else{if(node.attr("sitemap-select-mode")=="select_page"){var callback=node.parents("[sitemap-wrapper=1]").attr("sitemap-select-callback");if(callback==null||callback==""||typeof(callback)=="undefined"){callback="ccm_selectSitemapNode"}eval(callback+"(node.attr('id').substring(10), unescape(node.attr('tree-node-title')));");jQuery.fn.dialog.closeTop()}else{node.addClass("tree-label-selected");if(tr_activeNode!=false){if(tr_activeNode.attr("id")!=node.attr("id")){tr_activeNode.removeClass("tree-label-selected")}}params={cID:node.attr("id").substring(10),display_mode:node.attr("sitemap-display-mode"),select_mode:node.attr("sitemap-select-mode"),instance_id:node.attr("sitemap-instance-id"),canCompose:node.attr("tree-node-cancompose"),canWrite:node.attr("tree-node-canwrite"),cNumChildren:node.attr("tree-node-children"),cAlias:node.attr("tree-node-alias")};showPageMenu(params,e);tr_activeNode=node}}};ccmSitemapHighlightPageLabel=function(a,b){var c=$("#tree-label"+a+" span");if(c.length==0){var c=$("tr.ccm-list-record[cID="+a+"]");if(c.length>0){$("#ccm-page-advanced-search").submit()}}else{if(b!=null){c.html(b)}}c.show("highlight")};activateLabels=function(c,b,d){var a=$("ul[sitemap-instance-id="+c+"]");a.find("div.tree-label span").unbind();a.find("div.tree-label span").click(function(f){selectLabel(f,$(this).parent())});a.find("ul[tree-root-state=closed]").each(function(){var e=$(this);var f=$(this).attr("tree-root-node-id");if($(this).find("li").length>0){e.attr("tree-root-state","open");$("#tree-collapse"+f).attr("src",CCM_IMAGE_PATH+"/dashboard/minus.jpg")}});if(d=="select_page"||d=="move_copy_delete"){a.find("li.ccm-sitemap-explore-paging a").each(function(){$(this).click(function(){var e=$(this).parentsUntil("ul").parent().attr("tree-root-node-id");jQuery.fn.dialog.showLoader();$.get($(this).attr("href"),function(f){parseSitemapResponse(c,b,d,e,f);activateLabels(c,b,d);jQuery.fn.dialog.hideLoader()});return false})})}if(b=="full"&&(!d)){a.find("img.handle").addClass("moveable");a.find("div.tree-label").droppable({accept:".tree-node",hoverClass:"on-drop",drop:function(m,l){var n=l.draggable;var k=$(this).attr("id").substring(10);var g=$(n).attr("id").substring(9);if(k==g){return false}var f=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?instance_id="+c+"&origCID="+g+"&destCID="+k;if(SITEMAP_LAST_DIALOGUE_URL==f){return false}else{SITEMAP_LAST_DIALOGUE_URL=f}$.fn.dialog.open({title:ccmi18n_sitemap.moveCopyPage,href:f,width:350,modal:false,height:350,onClose:function(){showBranch(g)}})}});a.find("li.tree-node[draggable=true]").draggable({handle:"img.handle",opacity:0.5,revert:false,helper:"clone",start:function(){$(document.body).css("overflowX","hidden")},stop:function(){$(document.body).css("overflowX","auto")}})}};moveCopyAliasNode=function(f){var g=$("#origCID").val();var a=$("#destParentID").val();var c=$("#destCID").val();var k=$("input[name=ctask]:checked").val();var m=$("input[name=instance_id]").val();var d=$("input[name=display_mode]").val();var l=$("input[name=select_mode]").val();var e=$("input[name=copyAll]:checked").val();var b=$("input[name=saveOldPagePath]:checked").val();params={origCID:g,destCID:c,ctask:k,ccm_token:CCM_SECURITY_TOKEN,copyAll:e,saveOldPagePath:b};jQuery.fn.dialog.showLoader();$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php",params,function(n){ccm_parseJSON(n,function(){ccmAlert.hud(n.message,2000);jQuery.fn.dialog.hideLoader();if(f==true){if(typeof(CCM_LAUNCHER_SITEMAP)!="undefined"){if(CCM_LAUNCHER_SITEMAP=="explore"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+c;return false}}else{window.location.href=CCM_DISPATCHER_FILENAME+"?cID="+n.cID;return false}}switch(k){case"COPY":case"ALIAS":showBranch(g);break;case"MOVE":deleteBranchDirect(g);break}openSub(m,a,d,l,function(){openSub(m,c,d,l)});jQuery.fn.dialog.closeTop();jQuery.fn.dialog.closeTop()})})};toggleSub=function(b,c,d,e){ccm_hideMenus();var a=$("ul[tree-root-node-id="+c+"][sitemap-instance-id="+b+"]");if(a.attr("tree-root-state")=="closed"){openSub(b,c,d,e)}else{closeSub(b,c,d,e)}};setLoading=function(b){var a=$("#tree-node"+b);a.removeClass("tree-node-"+a.attr("tree-node-type"));a.addClass("tree-node-loading")};removeLoading=function(b){var a=$("#tree-node"+b);a.removeClass("tree-node-loading");a.addClass("tree-node-"+a.attr("tree-node-type"))};openSub=function(b,d,e,f,c){setLoading(d);var a=$("#tree-root"+d);cancelReorder();ccm_sitemap_html="";$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?instance_id="+b+"&node="+d+"&display_mode="+e+"&select_mode="+f+"&selectedPageID="+a.attr("selected-page-id"),function(g){parseSitemapResponse(b,"full",f,d,g);activateLabels(b,"full",f);if(f!="move_copy_delete"&&f!="select_page"){activateReorder()}setTimeout(function(){removeLoading(d);if(c!=null){c()}},200)})};closeSub=function(b,c,d,e){var a=$("ul[tree-root-node-id="+c+"][sitemap-instance-id="+b+"]");if(tr_doAnim){setLoading(c);a.slideUp(150,"easeOutExpo",function(){removeLoading(c);a.attr("tree-root-state","closed");a.html("");$("#ccm-tree-search"+c).hide();$("#tree-collapse"+c).attr("src",CCM_IMAGE_PATH+"/dashboard/plus.jpg");a.removeClass("ccm-sitemap-search-results")})}else{a.hide();a.attr("tree-root-state","closed");a.removeClass("ccm-sitemap-search-results");$("#ccm-tree-search"+c).hide();$("#tree-collapse"+c).attr("src",CCM_IMAGE_PATH+"/dashboard/plus.jpg")}if(tr_moveCopyMode==true){$("#ccm-tree-search-trigger"+cID).show()}$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?instance_id="+b+"&select_mode="+e+"&display_mode="+d+"&node="+c+"&display_mode=full&ctask=close-node")};toggleMove=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=true;$("#copyChildren").get(0).disabled=true;$("#saveOldPagePath").attr("disabled",false)}};toggleAlias=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=true;$("#copyChildren").get(0).disabled=true;$("#saveOldPagePath").attr("checked",false);$("#saveOldPagePath").attr("disabled","disabled")}};toggleCopy=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=false;$("#copyThisPage").get(0).checked=true;$("#copyChildren").get(0).disabled=false;$("#saveOldPagePath").attr("checked",false);$("#saveOldPagePath").attr("disabled","disabled")}};showSitemapMessage=function(a){$("#ccm-sitemap-message").addClass("message");$("#ccm-sitemap-message").html(a);$("#ccm-sitemap-message").fadeIn(200)};hideSitemapMessage=function(){$("#ccm-sitemap-message").hide()};function fixResortingDroppables(){if(tr_reorderMode==false){return false}var a=$(".dropzone");for(var b=0;b<a.length;b++){var c=$(a[b]).attr("id").substr(7);if(c.indexOf("-sub")>0){c=c.substr(0,(c.length-4))}addResortDroppable(c)}}function addResortDroppable(a){if($(".tree-branch"+a).length<=1){return}$("div.tree-dz"+a).droppable({accept:".tree-branch"+a,activeClass:"dropzone-ready",hoverClass:"dropzone-active",drop:function(d,c){var b=c.draggable;$(b).insertAfter(this);var f=$(b).attr("id").substring(9);$("#tree-dz"+f).insertAfter($(b));rescanDisplayOrder($(this).attr("tree-parent"))}})}ccmSitemapExploreNode=function(d,c,e,a,b){jQuery.fn.dialog.showLoader();$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php",{instance_id:d,display_mode:c,select_mode:e,node:a,selectedPageID:b},function(f){parseSitemapResponse(d,"explore",e,0,f);activateLabels(d,"explore",e);jQuery.fn.dialog.hideLoader();ccm_sitemap_html=""})};ccmSitemapLoad=function(e,d,f,b,a,c){if(f=="move_copy_delete"||f=="select_page"){ccmSitemapExploreNode(e,d,f,b,a)}else{if(d=="full"){ccm_hidePane=function(){jQuery.fn.dialog.closeTop()};activateLabels(e,d,f);if(f!="move_copy_delete"&&f!="select_page"){activateReorder()}tr_doAnim=true;tr_parseSubnodes=false;ccm_sitemap_html=""}else{if(f!="move_copy_delete"&&f!="select_page"){$("ul[sitemap-instance-id="+e+"]").sortable({cursor:"move",items:"li[draggable=true]",opacity:0.5,stop:function(l){var g=$("ul[sitemap-instance-id="+e+"]").sortable("toArray");var k="";for(i=0;i<g.length;i++){if(g[i]!=""){k+="&cID[]="+g[i].substring(9)}}$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_update.php",k,function(m){ccm_parseJSON(m,function(){})})}})}activateLabels(e,d,f)}}if(c){c()}};ccm_sitemapSetupSearch=function(a){ccm_setupAdvancedSearch(a);ccm_sitemapSetupSearchPages(a);ccm_searchActivatePostFunction[a]=function(){ccm_sitemapSetupSearchPages(a);ccm_sitemapSearchSetupCheckboxes(a)};ccm_sitemapSearchSetupCheckboxes(a)};ccm_sitemapSearchSetupCheckboxes=function(a){$("#ccm-"+a+"-list-cb-all").click(function(b){b.stopPropagation();if($(this).prop("checked")==true){$(".ccm-list-record td.ccm-"+a+"-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-"+a+"-list-multiple-operations").attr("disabled",false)}else{$(".ccm-list-record td.ccm-"+a+"-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-"+a+"-list-multiple-operations").attr("disabled",true)}});$("td.ccm-"+a+"-list-cb input[type=checkbox]").click(function(b){b.stopPropagation();if($("td.ccm-"+a+"-list-cb input[type=checkbox]:checked").length>0){$("#ccm-"+a+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+a+"-list-multiple-operations").attr("disabled",true)}});$("#ccm-"+a+"-list-multiple-operations").change(function(){var b=$(this).val();switch(b){case"properties":cIDstring="";$("td.ccm-"+a+"-list-cb input[type=checkbox]:checked").each(function(){cIDstring=cIDstring+"&cID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/pages/bulk_metadata_update?"+cIDstring,title:ccmi18n_sitemap.pagePropertiesTitle});break}$(this).get(0).selectedIndex=0})};ccm_sitemapSetupSearchPages=function(instance_id){$("#ccm-"+instance_id+"-list tr").click(function(e){var node=$(this);if(node.hasClass("ccm-results-list-header")){return false}if(node.attr("sitemap-select-mode")=="select_page"){var callback=node.attr("sitemap-select-callback");if(callback==null||callback==""||typeof(callback)=="undefined"){callback="ccm_selectSitemapNode"}eval(callback+"(node.attr('cID'), unescape(node.attr('cName')));");jQuery.fn.dialog.closeTop()}else{if(node.attr("sitemap-select-mode")=="move_copy_delete"){var destCID=node.attr("cID");var origCID=node.attr("selected-page-id");selectMoveCopyTarget(node.attr("sitemap-instance-id"),node.attr("sitemap-display-mode"),node.attr("sitemap-select-mode"),destCID,origCID)}else{params={cID:node.attr("cID"),select_mode:node.attr("sitemap-select-mode"),display_mode:node.attr("sitemap-display-mode"),instance_id:node.attr("sitemap-instance-id"),canCompose:node.attr("tree-node-cancompose"),canWrite:node.attr("canWrite"),cNumChildren:node.attr("cNumChildren"),cAlias:node.attr("cAlias")};showPageMenu(params,e)}}})};ccm_sitemapSelectDisplayMode=function(e,d,f,a){var b=$("ul[sitemap-instance-id="+e+"]");b.html("");b.attr("sitemap-display-mode",d);b.attr("sitemap-select-mode",f);b.attr("sitemap-display-mode",d);if(d=="explore"){var c=1}else{var c=0}ccmSitemapLoad(e,d,f,c,a,function(){if(d=="explore"){$("div[sitemap-wrapper=1][sitemap-instance-id="+e+"]").addClass("ccm-sitemap-explore")}else{$("div[sitemap-wrapper=1][sitemap-instance-id="+e+"]").removeClass("ccm-sitemap-explore")}});$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?task=save_sitemap_display_mode&display_mode="+d)};$(function(){$(document).click(function(){ccm_hideMenus();$("div.tree-label").removeClass("tree-label-selected")});$("#ccm-show-all-pages-cb").click(function(){var a=$(this).get(0).checked==true?1:0;$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?show_system="+a,function(b){location.reload()})})});function ccm_previewInternalTheme(a,b,c){var d=$("input[name=ctID]").val();$.fn.dialog.open({title:c,href:CCM_TOOLS_PATH+"/themes/preview?themeID="+b+"&previewCID="+a+"&ctID="+d,width:"85%",modal:false,height:"75%"})}function ccm_previewMarketplaceTheme(a,c,d,b){var e=$("input[name=ctID]").val();$.fn.dialog.open({title:d,href:CCM_TOOLS_PATH+"/themes/preview?themeCID="+c+"&previewCID="+a+"&themeHandle="+encodeURIComponent(b)+"&ctID="+e,width:"85%",modal:false,height:"75%"})}$(function(){ccm_intelligentSearchActivateResults();ccm_intelligentSearchDoOffsite($("#ccm-nav-intelligent-search").val())});ccm_activateToolbar=function(){$("#ccm-toolbar li a").click(function(){$(this).parent().addClass("ccm-system-nav-selected")});$("#ccm-dashboard-overlay-main").masonry({itemSelector:".ccm-dashboard-overlay-module",isResizable:false});$("#ccm-dashboard-overlay-packages").masonry({itemSelector:".ccm-dashboard-overlay-module",isResizable:false});$("#ccm-dashboard-overlay").css("visibility","visible").hide();$("#ccm-nav-intelligent-search-wrapper").click(function(){$("#ccm-nav-intelligent-search").focus()});$("#ccm-nav-intelligent-search").focus(function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(this).parent().addClass("ccm-system-nav-selected");if($("#ccm-dashboard-overlay").is(":visible")){$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")}});$("#ccm-nav-dashboard").click(function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(this).parent().addClass("ccm-system-nav-selected");$("#ccm-nav-intelligent-search").val("");$("#ccm-intelligent-search-results").fadeOut(90,"easeOutExpo");if($("#ccm-edit-overlay").is(":visible")){$("#ccm-edit-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.ccm-edit")}if($("#ccm-dashboard-overlay").is(":visible")){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")}else{$("#ccm-dashboard-overlay").fadeIn(160,"easeOutExpo");$(window).bind("click.dashboard-nav",function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")})}return false});$("#ccm-nav-intelligent-search").bind("keydown.ccm-intelligent-search",function(d){if(d.keyCode==13||d.keyCode==40||d.keyCode==38){d.preventDefault();d.stopPropagation();if(d.keyCode==13&&$("a.ccm-intelligent-search-result-selected").length>0){var a=$("a.ccm-intelligent-search-result-selected").attr("href");if(!a||a=="#"||a=="javascript:void(0)"){$("a.ccm-intelligent-search-result-selected").click()}else{window.location.href=a}}var b=$("#ccm-intelligent-search-results li:visible");var c;if(d.keyCode==40||d.keyCode==38){$.each(b,function(e,f){if($(f).children("a").hasClass("ccm-intelligent-search-result-selected")){if(d.keyCode==38){io=b[e-1]}else{io=b[e+1]}c=$(io).find("a")}});if(c&&c.length>0){$("a.ccm-intelligent-search-result-selected").removeClass();$(c).addClass("ccm-intelligent-search-result-selected")}}}});$("#ccm-nav-intelligent-search").bind("keyup.ccm-intelligent-search",function(a){ccm_intelligentSearchDoOffsite($(this).val())});$("#ccm-nav-intelligent-search").blur(function(){$(this).parent().removeClass("ccm-system-nav-selected")});$("#ccm-nav-intelligent-search").liveUpdate("ccm-intelligent-search-results","intelligent-search");$("#ccm-nav-intelligent-search").bind("click",function(a){if(this.value==""){$("#ccm-intelligent-search-results").hide()}});$("#ccm-toolbar-nav-properties").dialog();$("#ccm-toolbar-nav-versions").dialog();$("#ccm-nav-edit").click(function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(this).parent().addClass("ccm-system-nav-selected");$("#ccm-nav-intelligent-search").val("");$("#ccm-intelligent-search-results").fadeOut(90,"easeOutExpo");if($("#ccm-dashboard-overlay").is(":visible")){$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")}if($("#ccm-edit-overlay").is(":visible")){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-edit-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.ccm-edit")}else{$("#ccm-edit-overlay").fadeIn(160,"easeOutExpo");$(window).bind("click.ccm-edit",function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-edit-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.ccm-edit")})}return false})};var ajaxtimer=null;var ajaxquery=null;ccm_intelligentSearchActivateResults=function(){if($("#ccm-intelligent-search-results div:visible").length==0){$("#ccm-intelligent-search-results").hide()}$("#ccm-intelligent-search-results a").hover(function(){$("a.ccm-intelligent-search-result-selected").removeClass();$(this).addClass("ccm-intelligent-search-result-selected")},function(){$(this).removeClass("ccm-intelligent-search-result-selected")})};ccm_intelligentSearchDoOffsite=function(a){if(!a){return}if(a.trim().length>2){if(a.trim()==ajaxquery){return}if(ajaxtimer){window.clearTimeout(ajaxtimer)}ajaxquery=a.trim();ajaxtimer=window.setTimeout(function(){ajaxtimer=null;$("#ccm-intelligent-search-results-list-marketplace").parent().show();$("#ccm-intelligent-search-results-list-help").parent().show();$("#ccm-intelligent-search-results-list-marketplace").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").parent().addClass("ccm-intelligent-search-results-module-loading");$.getJSON(CCM_TOOLS_PATH+"/marketplace/intelligent_search",{q:ajaxquery},function(c){$("#ccm-intelligent-search-results-list-marketplace").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-marketplace").html("");for(i=0;i<c.length;i++){var b=c[i];$("#ccm-intelligent-search-results-list-marketplace").append('<li><a href="'+b.href+'"><img src="'+b.img+'" />'+b.name+"</a></li>")}if(c.length==0){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}ccm_intelligentSearchActivateResults()}).error(function(){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/get_remote_help",{q:ajaxquery},function(c){$("#ccm-intelligent-search-results-list-help").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").html("");for(i=0;i<c.length;i++){var b=c[i];$("#ccm-intelligent-search-results-list-help").append('<li><a href="'+b.href+'">'+b.name+"</a></li>")}if(c.length==0){$("#ccm-intelligent-search-results-list-help").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}ccm_intelligentSearchActivateResults()}).error(function(){$("#ccm-intelligent-search-results-list-help").parent().hide()})},500)}};var ccm_arrangeMode=false;var ccm_selectedDomID=false;ccm_menuInit=function(a){if(CCM_EDIT_MODE&&(!CCM_ARRANGE_MODE)){switch(a.type){case"BLOCK":$("#b"+a.bID+"-"+a.aID).mouseover(function(b){ccm_activate(a,"#b"+a.bID+"-"+a.aID)});break;case"AREA":$("#a"+a.aID+"controls").mouseover(function(b){ccm_activate(a,"#a"+a.aID+"controls")});break}}};ccm_showBlockMenu=function(d,c){ccm_hideMenus();c.stopPropagation();var a=document.getElementById("ccm-block-menu"+d.bID+"-"+d.aID);if(!a){el=document.createElement("DIV");el.id="ccm-block-menu"+d.bID+"-"+d.aID;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);a=$("#ccm-block-menu"+d.bID+"-"+d.aID);a.css("position","absolute");var b='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';b+="<ul>";if(d.canWrite){b+=(d.editInline)?'<li><a class="ccm-menu-icon ccm-icon-edit-menu" id="menuEdit'+d.bID+"-"+d.aID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+"&btask=edit#_edit"+d.bID+'">'+ccmi18n.editBlock+"</a></li>":'<li><a class="ccm-menu-icon ccm-icon-edit-menu" dialog-title="'+ccmi18n.editBlock+" "+d.btName+'" dialog-append-buttons="true" dialog-modal="false" dialog-on-close="ccm_blockWindowAfterClose()" dialog-width="'+d.width+'" dialog-height="'+d.height+'" id="menuEdit'+d.bID+"-"+d.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+'&btask=edit">'+ccmi18n.editBlock+"</a></li>"}if(d.canWriteStack){b+='<li><a class="ccm-menu-icon ccm-icon-edit-menu" id="menuEdit'+d.bID+"-"+d.aID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/stacks/-/view_details/"+d.stID+'">'+ccmi18n.editStackContents+"</a></li>";b+='<li class="header"></li>'}if(d.canCopyToScrapbook){b+='<li><a class="ccm-menu-icon ccm-icon-clipboard-menu" id="menuAddToScrapbook'+d.bID+"-"+d.aID+'" href="#" onclick="javascript:ccm_addToScrapbook('+d.cID+","+d.bID+",'"+encodeURIComponent(d.arHandle)+"');return false;\">"+ccmi18n.copyBlockToScrapbook+"</a></li>"}if(d.canArrange){b+='<li><a class="ccm-menu-icon ccm-icon-move-menu" id="menuArrange'+d.bID+"-"+d.aID+'" href="javascript:ccm_arrangeInit()">'+ccmi18n.arrangeBlock+"</a></li>"}if(d.canDelete){b+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" id="menuDelete'+d.bID+"-"+d.aID+'" href="#" onclick="javascript:ccm_deleteBlock('+d.cID+","+d.bID+","+d.aID+", '"+encodeURIComponent(d.arHandle)+"', '"+d.deleteMessage+"');return false;\">"+ccmi18n.deleteBlock+"</a></li>"}if(d.canDesign||d.canWrite){b+='<li class="ccm-menu-separator"></li>'}if(d.canDesign){b+='<li><a class="ccm-menu-icon ccm-icon-design-menu" dialog-modal="false" dialog-title="'+ccmi18n.changeBlockBaseStyle+'" dialog-width="450" dialog-height="420" id="menuChangeCSS'+d.bID+"-"+d.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+'&btask=block_css&modal=true&width=300&height=100" title="'+ccmi18n.changeBlockCSS+'">'+ccmi18n.changeBlockCSS+"</a></li>"}if(d.canWrite){b+='<li><a class="ccm-menu-icon ccm-icon-custom-template-menu" dialog-modal="false" dialog-title="'+ccmi18n.changeBlockTemplate+'" dialog-width="300" dialog-height="100" id="menuChangeTemplate'+d.bID+"-"+d.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+'&btask=template&modal=true&width=300&height=100" title="'+ccmi18n.changeBlockTemplate+'">'+ccmi18n.changeBlockTemplate+"</a></li>"}if(d.canModifyGroups||d.canAliasBlockOut||d.canSetupComposer){b+='<li class="ccm-menu-separator"></li>'}if(d.canModifyGroups){b+='<li><a title="'+ccmi18n.setBlockPermissions+'" class="ccm-menu-icon ccm-icon-permissions-menu" dialog-width="400" dialog-height="380" id="menuBlockGroups'+d.bID+"-"+d.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+'&btask=groups" dialog-title="'+ccmi18n.setBlockPermissions+'">'+ccmi18n.setBlockPermissions+"</a></li>"}if(d.canAliasBlockOut){b+='<li><a class="ccm-menu-icon ccm-icon-setup-child-pages-menu" dialog-width="550" dialog-height="450" id="menuBlockAliasOut'+d.bID+"-"+d.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+'&btask=child_pages" dialog-title="'+ccmi18n.setBlockAlias+'">'+ccmi18n.setBlockAlias+"</a></li>"}if(d.canSetupComposer){b+='<li><a class="ccm-menu-icon ccm-icon-setup-composer-menu" dialog-width="300" dialog-modal="false" dialog-height="150" id="menuBlockSetupComposer'+d.bID+"-"+d.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+d.cID+"&bID="+d.bID+"&arHandle="+encodeURIComponent(d.arHandle)+'&btask=composer" dialog-title="'+ccmi18n.setBlockComposerSettings+'">'+ccmi18n.setBlockComposerSettings+"</a></li>"}b+="</ul>";b+="</div></div></div>";a.append(b);if(d.canWrite&&(!d.editInline)){$("a#menuEdit"+d.bID+"-"+d.aID).dialog();$("a#menuChangeTemplate"+d.bID+"-"+d.aID).dialog()}if(d.canDesign){$("a#menuChangeCSS"+d.bID+"-"+d.aID).dialog()}if(d.canAliasBlockOut){$("a#menuBlockAliasOut"+d.bID+"-"+d.aID).dialog()}if(d.canSetupComposer){$("a#menuBlockSetupComposer"+d.bID+"-"+d.aID).dialog()}if(d.canModifyGroups){$("#menuBlockGroups"+d.bID+"-"+d.aID).dialog()}}else{a=$("#ccm-block-menu"+d.bID+"-"+d.aID)}ccm_fadeInMenu(a,c)};ccm_openAreaAddBlock=function(b,c,a){if(!c){c=0}if(!a){a=CCM_CID}$.fn.dialog.open({title:ccmi18n.blockAreaMenu,href:CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+a+"&atask=add&arHandle="+b+"&addOnly="+c,width:550,modal:false,height:380})};ccm_showAreaMenu=function(f,d){var c=(f.addOnly)?1:0;if(d.shiftKey){ccm_openAreaAddBlock(f.arHandle,c)}else{ccm_hideMenus();d.stopPropagation();var a=document.getElementById("ccm-area-menu"+f.aID);if(!a){el=document.createElement("DIV");el.id="ccm-area-menu"+f.aID;el.className="ccm-menu";el.style.display="none";document.body.appendChild(el);a=$("#ccm-area-menu"+f.aID);a.css("position","absolute");var b='<div class="ccm-menu-tl"><div class="ccm-menu-tr"><div class="ccm-menu-t"></div></div></div>';b+='<div class="ccm-menu-l"><div class="ccm-menu-r">';b+="<ul>";if(f.canAddBlocks){b+='<li><a class="ccm-menu-icon" dialog-title="'+ccmi18n.addBlockNew+'" dialog-modal="false" dialog-width="550" dialog-height="380" id="menuAddNewBlock'+f.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(f.arHandle)+"&atask=add&addOnly="+c+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+ccmi18n.addBlockNew+"</span></a></li>";b+='<li><a class="ccm-menu-icon" dialog-title="'+ccmi18n.addBlockStack+'" dialog-modal="false" dialog-width="550" dialog-height="380" id="menuAddNewBlock'+f.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(f.arHandle)+"&atask=add_from_stack&addOnly="+c+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/add.png)">'+ccmi18n.addBlockStack+"</span></a></li>";b+='<li><a class="ccm-menu-icon" dialog-title="'+ccmi18n.addBlockPaste+'" dialog-modal="false" dialog-width="550" dialog-height="380" id="menuAddPaste'+f.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(f.arHandle)+"&atask=paste&addOnly="+c+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/paste_small.png)">'+ccmi18n.addBlockPaste+"</span></a></li>"}if(f.canAddBlocks&&(f.canDesign||f.canLayout)){b+='<li class="header"></li>'}if(f.canLayout){b+='<li><a class="ccm-menu-icon" dialog-title="'+ccmi18n.addAreaLayout+'" dialog-modal="false" dialog-width="550" dialog-height="280" id="menuAreaLayout'+f.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(f.arHandle)+'&atask=layout"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/layout_small.png)">'+ccmi18n.addAreaLayout+"</span></a></li>"}if(f.canDesign){b+='<li><a class="ccm-menu-icon" dialog-title="'+ccmi18n.changeAreaCSS+'" dialog-modal="false" dialog-width="450" dialog-height="420" id="menuAreaStyle'+f.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(f.arHandle)+'&atask=design"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/design_small.png)">'+ccmi18n.changeAreaCSS+"</span></a></li>"}if(f.canWrite&&f.canModifyGroups){b+='<li class="header"></li>'}if(f.canModifyGroups){b+='<li><a title="'+ccmi18n.setAreaPermissions+'" dialog-modal="false" class="ccm-menu-icon" dialog-width="580" dialog-height="420" id="menuAreaGroups'+f.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(f.arHandle)+'&atask=groups" dialog-title="'+ccmi18n.setAreaPermissions+'"><span style="background-image: url('+CCM_IMAGE_PATH+'/icons/permissions_small.png)">'+ccmi18n.setAreaPermissions+"</span></a></li>"}b+="</ul>";b+="</div></div>";b+='<div class="ccm-menu-bl"><div class="ccm-menu-br"><div class="ccm-menu-b"></div></div></div>';a.append(b);if(f.canAddBlocks){$("a#menuAddNewBlock"+f.aID).dialog();$("a#menuAddPaste"+f.aID).dialog()}if(f.canWrite){$("a#menuAreaStyle"+f.aID).dialog();$("a#menuAreaLayout"+f.aID).dialog()}if(f.canModifyGroups){$("a#menuAreaGroups"+f.aID).dialog()}}else{a=$("#ccm-area-menu"+f.aID)}ccm_fadeInMenu(a,d)}};ccm_hideHighlighter=function(){$("#ccm-highlighter").css("display","none");$("div.ccm-menu-hotspot-active").removeClass("ccm-menu-hotspot-active")};ccm_addError=function(a){if(!ccm_isBlockError){ccm_blockError+="<ul>"}ccm_isBlockError=true;ccm_blockError+="<li>"+a+"</li>"};ccm_resetBlockErrors=function(){ccm_isBlockError=false;ccm_blockError=""};ccm_addToScrapbook=function(a,c,b){ccm_mainNavDisableDirectExit();ccm_hideHighlighter();$.ajax({type:"POST",url:CCM_TOOLS_PATH+"/pile_manager.php",data:"cID="+a+"&bID="+c+"&arHandle="+b+"&btask=add&scrapbookName=userScrapbook",success:function(d){ccm_hideHighlighter();ccmAlert.hud(ccmi18n.copyBlockToScrapbookMsg,2000,"add",ccmi18n.copyBlockToScrapbook)}})};ccm_deleteBlock=function(a,c,d,b,e){if(confirm(e)){ccm_mainNavDisableDirectExit();ccm_hideHighlighter();$d=$("#b"+c+"-"+d);$d.hide();ccmAlert.hud(ccmi18n.deleteBlockMsg,2000,"delete_small",ccmi18n.deleteBlock);$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+a+"&ccm_token="+CCM_SECURITY_TOKEN+"&isAjax=true&btask=remove&bID="+c+"&arHandle="+b})}};ccm_hideMenus=function(){$("div.ccm-menu").hide();$("div.ccm-menu").css("visibility","hidden");$("div.ccm-menu").show()};ccm_parseBlockResponse=function(r,currentBlockID,task){try{r=r.replace(/(<([^>]+)>)/ig,"");resp=eval("("+r+")");if(resp.error==true){var message="<ul>";for(i=0;i<resp.response.length;i++){message+="<li>"+resp.response[i]+"</li>"}message+="</ul>";ccmAlert.notice(ccmi18n.error,message)}else{ccm_blockWindowClose();if(resp.cID){cID=resp.cID}else{cID=CCM_CID}var action=CCM_TOOLS_PATH+"/edit_block_popup?cID="+cID+"&bID="+resp.bID+"&arHandle="+encodeURIComponent(resp.arHandle)+"&btask=view_edit_mode";$.get(action,function(r){if(task=="add"){if($("#a"+resp.aID+" div.ccm-area-styles-a"+resp.aID).length>0){$("#a"+resp.aID+" div.ccm-area-styles-a"+resp.aID).append(r)}else{$("#a"+resp.aID).append(r)}}else{$("#b"+currentBlockID+"-"+resp.aID).before(r).remove()}jQuery.fn.dialog.hideLoader();ccm_mainNavDisableDirectExit();if(task=="add"){ccmAlert.hud(ccmi18n.addBlockMsg,2000,"add",ccmi18n.addBlock);jQuery.fn.dialog.closeAll()}else{ccmAlert.hud(ccmi18n.updateBlockMsg,2000,"success",ccmi18n.updateBlock)}if(typeof window.ccm_parseBlockResponsePost=="function"){ccm_parseBlockResponsePost(resp)}})}}catch(e){ccmAlert.notice(ccmi18n.error,r)}};ccm_mainNavDisableDirectExit=function(a){$("li.ccm-main-nav-exit-edit-mode-direct").remove();if(!a){$("li.ccm-main-nav-exit-edit-mode").show()}};ccm_setupBlockForm=function(c,b,a){c.ajaxForm({type:"POST",iframe:true,beforeSubmit:function(){ccm_hideHighlighter();$("input[name=ccm-block-form-method]").val("AJAX");jQuery.fn.dialog.showLoader();return ccm_blockFormSubmit()},success:function(d){ccm_parseBlockResponse(d,b,a)}})};ccm_activate=function(b,a){if(ccm_arrangeMode){return false}if(ccm_selectedDomID){$(ccm_selectedDomID).removeClass("ccm-menu-hotspot-active")}aobj=$(a);aobj.addClass("ccm-menu-hotspot-active");ccm_selectedDomID=a;offs=aobj.offset();$("#ccm-highlighter").css("width",aobj.outerWidth()-4);$("#ccm-highlighter").css("height",aobj.outerHeight()-4);$("#ccm-highlighter").css("top",offs.top+2);$("#ccm-highlighter").css("left",offs.left+2);$("#ccm-highlighter").fadeIn(120,"easeOutExpo");$("#ccm-highlighter").unbind("click");$("#ccm-highlighter").click(function(c){switch(b.type){case"BLOCK":ccm_showBlockMenu(b,c);break;case"AREA":ccm_showAreaMenu(b,c);break}})};ccm_editInit=function(){document.write=function(){void (0)};$(document.body).append('<div style="position: absolute; display:none" id="ccm-highlighter">&nbsp;</div>');$(document).click(function(){ccm_hideMenus()});$(document.body).css("user-select","none");$(document.body).css("-khtml-user-select","none");$(document.body).css("-webkit-user-select","none");$(document.body).css("-moz-user-select","none");$("a").click(function(a){ccm_hideMenus();return false});$("#ccm-highlighter").mouseout(function(){ccm_hideHighlighter()})};ccm_triggerSelectUser=function(b,c,a){alert(b);alert(c);alert(a)};ccm_setupUserSearch=function(){$("#ccm-user-list-cb-all").click(function(){if($(this).prop("checked")==true){$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-user-list-multiple-operations").attr("disabled",false)}else{$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-user-list-multiple-operations").attr("disabled",true)}});$("td.ccm-user-list-cb input[type=checkbox]").click(function(a){if($("td.ccm-user-list-cb input[type=checkbox]:checked").length>0){$("#ccm-user-list-multiple-operations").attr("disabled",false)}else{$("#ccm-user-list-multiple-operations").attr("disabled",true)}});$("#ccm-user-list-multiple-operations").change(function(){var a=$(this).val();switch(a){case"choose":var b="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){ccm_triggerSelectUser($(this).val(),$(this).attr("user-name"),$(this).attr("user-email"))});jQuery.fn.dialog.closeTop();break;case"properties":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_properties?"+uIDstring,title:ccmi18n.properties});break}$(this).get(0).selectedIndex=0});$("div.ccm-user-search-advanced-groups-cb input[type=checkbox]").unbind();$("div.ccm-user-search-advanced-groups-cb input[type=checkbox]").click(function(){$("#ccm-user-advanced-search").submit()})};ccm_triggerSelectGroup=function(b,a){alert(b);alert(a)};ccm_setupGroupSearch=function(){$("div.ccm-group a").unbind();$("div.ccm-group a").each(function(b){var a=$(this);$(this).click(function(){ccm_triggerSelectGroup(a.attr("group-id"),a.attr("group-name"));$.fn.dialog.closeTop();return false})});$("#ccm-group-search").ajaxForm({beforeSubmit:function(){$("#ccm-group-search-wrapper").html("")},success:function(a){$("#ccm-group-search-wrapper").html(a)}});$("div#ccm-group-paging a").click(function(){$("#ccm-group-search-wrapper").html("");$.ajax({type:"GET",url:$(this).attr("href"),success:function(a){$("#ccm-group-search-wrapper").html(a)}});return false})};ccm_saveArrangement=function(a){if(!a){a=CCM_CID}ccm_mainNavDisableDirectExit(true);var b="";$("div.ccm-area").each(function(){areaStr="&area["+$(this).attr("id").substring(1)+"][]=";bArray=$(this).sortable("toArray");for(i=0;i<bArray.length;i++){if(bArray[i]!=""&&bArray[i].substring(0,1)=="b"){var c=bArray[i].substring(1,bArray[i].indexOf("-"));var d=$("#"+bArray[i]);if(d.attr("custom-style")){c+="-"+d.attr("custom-style")}b+=areaStr+c}}});$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+a+"&ccm_token="+CCM_SECURITY_TOKEN+"&btask=ajax_do_arrange"+b,success:function(c){console.log(c);$("div.ccm-area").removeClass("ccm-move-mode");$("div.ccm-block-arrange").each(function(){$(this).addClass("ccm-block");$(this).removeClass("ccm-block-arrange")});ccm_arrangeMode=false;$(".ccm-main-nav-arrange-option").fadeOut(300,function(){$(".ccm-main-nav-edit-option").fadeIn(300,function(){ccm_removeHeaderLoading()})});ccmAlert.hud(ccmi18n.arrangeBlockMsg,2000,"up_down",ccmi18n.arrangeBlock)}})};ccm_arrangeInit=function(){ccm_arrangeMode=true;ccm_hideHighlighter();$("div.ccm-block").each(function(){$(this).addClass("ccm-block-arrange");$(this).removeClass("ccm-block")});$(".ccm-main-nav-edit-option").fadeOut(300,function(){$(".ccm-main-nav-arrange-option").fadeIn(300)});$("div.ccm-area").each(function(){$(this).addClass("ccm-move-mode");$(this).sortable({items:"div.ccm-block-arrange",connectWith:$("div.ccm-area"),accept:"div.ccm-block-arrange",opacity:0.5})});$("a#ccm-nav-save-arrange").click(function(){ccm_saveArrangement()})};ccm_selectSitemapNode=function(b,a){alert(b);alert(a)};ccm_goToSitemapNode=function(b,a){window.location.href=CCM_DISPATCHER_FILENAME+"?cID="+b};ccm_fadeInMenu=function(b,d){var c=b.find("div.popover div.inner").width();var a=b.find("div.popover").height();b.hide();b.css("visibility","visible");var g=d.pageX+2;var f=d.pageY+2;if($(window).height()<d.clientY+a){f=f-a-10;g=g-(c/2);b.find("div.popover").removeClass("below");b.find("div.popover").addClass("above")}else{g=g-(c/2);f=f+10;b.find("div.popover").removeClass("above");b.find("div.popover").addClass("below")}b.css("top",f+"px");b.css("left",g+"px");b.fadeIn(60)};ccm_blockWindowClose=function(){jQuery.fn.dialog.closeTop();ccm_blockWindowAfterClose()};ccm_blockWindowAfterClose=function(){ccmValidateBlockForm=function(){return true}};ccm_blockFormSubmit=function(){if(typeof window.ccmValidateBlockForm=="function"){r=window.ccmValidateBlockForm();if(!r){jQuery.fn.dialog.hideLoader()}if(ccm_isBlockError){if(ccm_blockError){ccmAlert.notice(ccmi18n.error,ccm_blockError+"</ul>")}ccm_resetBlockErrors();return false}}return true};ccm_setupGridStriping=function(b){$("#"+b+" tr").removeClass();var a=0;$("#"+b+" tr").each(function(){if($(this).css("display")!="none"){if(a%2==0){$(this).addClass("ccm-row-alt")}a++}})};ccm_dashboardRequestRemoteInformation=function(){$.get(CCM_TOOLS_PATH+"/dashboard/get_remote_information")};ccm_getMarketplaceItem=function(b){var c=b.mpID;var a=b.closeTop;this.onComplete=function(){};if(b.onComplete){ccm_getMarketplaceItem.onComplete=b.onComplete}if(a){jQuery.fn.dialog.closeTop()}jQuery.fn.dialog.showLoader();params={mpID:c};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(d){jQuery.fn.dialog.hideLoader();if(d.isConnected){if(!d.purchaseRequired){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/download?install=1&mpID="+c,width:350,modal:false,height:240})}}else{$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?mpID="+c,width:"90%",modal:false,height:"70%"})}})};ccm_t=function(a){return $("input[name=ccm-string-"+a+"]").val()};var ccmCustomStyle={tabs:function(a,b){$(".ccm-styleEditPane").hide();$("#ccm-styleEditPane-"+b).show();$(a.parentNode.parentNode).find("li").removeClass("ccm-nav-active");$(a.parentNode).addClass("ccm-nav-active");return false},resetAll:function(){if(!confirm(ccmi18n.confirmCssReset)){return false}jQuery.fn.dialog.showLoader();$("#ccm-reset-style").val(1);$("#ccmCustomCssForm").get(0).submit();return true},showPresetDeleteIcon:function(){if($("select[name=cspID]").val()>0){$("#ccm-style-delete-preset").show()}else{$("#ccm-style-delete-preset").hide()}},deletePreset:function(){var b=$("select[name=cspID]").val();if(b>0){if(!confirm(ccmi18n.confirmCssPresetDelete)){return false}var a=$("#ccm-custom-style-refresh-action").val()+"&deleteCspID="+b+"&subtask=delete_custom_style_preset";jQuery.fn.dialog.showLoader();$.get(a,function(c){$("#ccm-custom-style-wrapper").html(c);jQuery.fn.dialog.hideLoader()})}},initForm:function(){if($("#cspFooterPreset").length>0){$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select, #ccmCustomCssFormTabs textarea").bind("change click",function(){$("#cspFooterPreset").show();$("#cspFooterNoPreset").remove();$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select").unbind("change click")})}$("input[name=cspPresetAction]").click(function(){if($(this).val()=="create_new_preset"&&$(this).prop("checked")){$("input[name=cspName]").attr("disabled",false).focus()}else{$("input[name=cspName]").val("").attr("disabled",true)}});ccmCustomStyle.showPresetDeleteIcon();ccmCustomStyle.lastPresetID=parseInt($("select[name=cspID]").val());$("select[name=cspID]").change(function(){var c=parseInt($(this).val());var b=parseInt($("input[name=selectedCsrID]").val());if(ccmCustomStyle.lastPresetID==c){return false}ccmCustomStyle.lastPresetID=c;jQuery.fn.dialog.showLoader();if(c>0){var a=$("#ccm-custom-style-refresh-action").val()+"&cspID="+c}else{var a=$("#ccm-custom-style-refresh-action").val()+"&csrID="+b}$.get(a,function(d){$("#ccm-custom-style-wrapper").html(d);jQuery.fn.dialog.hideLoader()})});$("#ccmCustomCssForm").submit(function(){if($("input[name=cspCreateNew]").prop("checked")==true){if($("input[name=cspName]").val()==""){$("input[name=cspName]").focus();alert(ccmi18n.errorCustomStylePresetNoName);return false}}jQuery.fn.dialog.showLoader();return true});if(!parseInt(ccmCustomStyle.lastPresetID)){setTimeout('$("#ccmCustomCssFormTabs input").attr("disabled", false).get(0).focus()',500)}},validIdCheck:function(a,c){var b=$("#"+a.value);if(b&&b.get(0)&&b.get(0).id!=c){$("#ccm-styles-invalid-id").css("display","block")}else{$("#ccm-styles-invalid-id").css("display","none")}}};