!function(a,b){"use strict";function c(a,c){var d=this;c=b.extend({inputName:!1,unit:"px",appendTo:document.body},c),d.options=c,d.opened=!1,d.$element=a,d.$container=b(d.options.appendTo),d._chooseTemplate=_.template(d.chooseTemplate,{options:d.options,i18n:ccmi18n}),d._selectorTemplate=_.template(d.selectorWidgetTemplate,{options:d.options,i18n:ccmi18n}),d.$element.append(d._chooseTemplate),d.$widget=b(d._selectorTemplate),d.$container.append(d.$widget),d.$widget.find(".launch-tooltip").tooltip(),d.$widget.find("div.ccm-style-customizer-palette-actions button").on("click.style-customizer-palette",function(a){return d.save(a),!1}),d.$element.on("click.style-customizer-palette","[data-launch=style-customizer-palette]",function(a){if(d.opened)d.closeSelector(a);else{var c=d.getPosition();d.$widget.css({top:c.top,left:c.left}).show().on("click.style-customizer-palette",function(a){a.stopPropagation()}),b(document).on("click.style-customizer-palette",function(a){d.closeSelector(a)}),d.opened=!0}return!1})}c.prototype={setValue:function(a,b){var c=this;c.$element.find("input[data-style-customizer-input="+a+"]").val(b)},getPosition:function(){var a=this,b=a.getOffset(a.$widget,a.$element);return b},getOffset:function(a,c){var d=-5,e=a.outerWidth(),f=a.outerHeight(),g=c.outerHeight(),h=a[0].ownerDocument,i=h.documentElement,j=i.clientWidth+b(h).scrollLeft(),k=i.clientHeight+b(h).scrollTop(),l=c.offset();return l.top+=g,l.left-=Math.min(l.left,l.left+e>j&&j>e?Math.abs(l.left+e-j):0),l.top-=Math.min(l.top,l.top+f>k&&k>f?Math.abs(f+g-d):d),l},getValue:function(a){var b=this;return b.$element.find("input[data-style-customizer-input="+a+"]").val()},closeSelector:function(){var a=this;a.$widget.hide(),a.opened=!1,b(document).unbind("click.style-customizer-palette")},updateSwatch:function(){alert("You must implement this method updateSwatch.")},save:function(a){var b=this;b.updateSwatch(),b.closeSelector(a),ConcreteEvent.publish("StyleCustomizerControlUpdate")}},a.ConcreteStyleCustomizerPalette=c}(this,$),function(a,b){"use strict";function c(a,c){var d=this;c=b.extend({inputName:!1,value:!1},c),ConcreteStyleCustomizerPalette.call(d,a,c),d.$widget.find("div[data-style-customizer-field=image]").concreteFileSelector({inputName:d.options.inputName})}c.prototype=Object.create(ConcreteStyleCustomizerPalette.prototype),c.prototype.chooseTemplate='<span data-launch="style-customizer-palette" class="ccm-style-customizer-display-swatch"><input type="hidden" name="<%=options.inputName%>[fID]" data-style-customizer-input="fID" /><span class="ccm-ui"><i class="fa fa-picture-o"></i></span></span>',c.prototype.selectorWidgetTemplate='<div class="ccm-ui ccm-style-customizer-palette"><% if (options.value) { %><div><label><%=i18n.currentImage%></label><div><img src="<%=options.value%>" /></div></div><% } %><div><label><%=i18n.image%></label><div data-style-customizer-field="image" class="ccm-file-selector"></div></div><div class="ccm-style-customizer-palette-actions"><button class="btn btn-primary"><%=i18n.save%></button></div></div>',c.prototype.save=function(a){var b=this,c=0,d=b.$widget.find("div.ccm-file-selector-file-selected");d.length&&(c=d.find("input[type=hidden]").val()),b.setValue("fID",c),ConcreteEvent.publish("StyleCustomizerControlUpdate"),b.closeSelector(a)},b.fn.concreteStyleCustomizerImageSelector=function(a){return b.each(b(this),function(){new c(b(this),a)})},a.ConcreteStyleCustomizerImageSelector=c}(this,$),function(a,b){"use strict";function c(a,c){var d=this,e=1;c=b.extend({inputName:!1,unit:"px",value:0,appendTo:document.body},c),ConcreteStyleCustomizerPalette.call(d,a,c),d.$slider=d.$widget.find("div.ccm-style-customizer-slider"),"em"==d.options.unit&&(e=.1),d.$slider.slider({min:0,max:400,step:e,value:d.options.value,create:function(){b(this).parent().find("span").html(d.options.value+d.options.unit)},slide:function(a,c){b(this).parent().find("span").html(c.value+d.options.unit)}})}c.prototype=Object.create(ConcreteStyleCustomizerPalette.prototype),c.prototype.chooseTemplate='<span data-launch="style-customizer-palette"><input type="hidden" name="<%=options.inputName%>[size]" value="<%=options.value%>" data-style-customizer-input="size" /><input type="hidden" name="<%=options.inputName%>[unit]" value="<%=options.unit%>" /><span><%=options.value + options.unit%></span></span>',c.prototype.selectorWidgetTemplate='<div class="ccm-ui ccm-style-customizer-palette ccm-style-customizer-palette-large"><div><label><%=i18n.size%></label><div data-style-customizer-field="size"><div class="ccm-style-customizer-slider"></div><span class="ccm-style-customizer-slider-value"><%=options.value%><%=options.unit%></span></div></div><div class="ccm-style-customizer-palette-actions"><button class="btn btn-primary"><%=i18n.save%></button></div></div>',c.prototype.updateSwatch=function(){var a=this,b=a.$element.find("span[data-launch=style-customizer-palette] span");b.html(a.getValue("size")+a.options.unit)},c.prototype.save=function(a){var b=this;b.setValue("size",b.$widget.find("div[data-style-customizer-field=size] div.ccm-style-customizer-slider").slider("value")),b.updateSwatch(),ConcreteEvent.publish("StyleCustomizerControlUpdate"),b.closeSelector(a)},b.fn.concreteSizeSelector=function(a){return b.each(b(this),function(){new c(b(this),a)})},a.ConcreteSizeSelector=c}(this,$),function(a,b){"use strict";function c(a,c){var d,e,f=this;c=b.extend({inputName:!1,fontFamily:-1,color:-1,italic:-1,underline:-1,uppercase:-1,fontSizeValue:-1,fontSizeUnit:"px",fontWeight:-1,letterSpacingValue:-1,letterSpacingUnit:"px",lineHeightValue:-1,lineHeightUnit:"px"},c),ConcreteStyleCustomizerPalette.call(f,a,c),f.$fontMenu=f.$widget.find("select[data-style-customizer-field=font]"),f.$sliders=f.$widget.find("div.ccm-style-customizer-slider"),f.$sliders.slider({min:0,max:64,value:0,create:function(){b(this).parent().find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-number").html("0")},slide:function(a,c){b(this).parent().find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-number").html(c.value)}}),f.$colorpicker=f.$widget.find("input[data-style-customizer-field=color]"),f.$colorpicker.spectrum({preferredFormat:"rgb",showAlpha:!0,className:"ccm-widget-colorpicker",showInitial:!0,showInput:!0}),f.$fontMenu.on("change",function(){var a=b(this).val();b(this).css("font-family",a)}),b.each(f.fonts,function(a,b){f.$fontMenu.append('<option value="'+b+'">'+b+"</option>")}),-1!=f.options.fontFamily?(f.setValue("font-family",f.options.fontFamily),_.indexOf(f.fonts,f.options.fontFamily)<0&&f.$fontMenu.append(b("<option>",{value:f.options.fontFamily,text:f.options.fontFamily})),f.$fontMenu.val(f.options.fontFamily)):(f.$widget.find("[data-wrapper=fontFamily]").remove(),f.$element.find("[data-wrapper=fontFamily]").remove()),-1!=f.options.color?(f.$colorpicker.spectrum("set",f.options.color),f.setValue("color",f.options.color)):(f.$widget.find("[data-wrapper=color]").remove(),f.$element.find("[data-wrapper=color]").remove()),-1!=f.options.underline?(f.$widget.find("input[data-style-customizer-field=underline]").prop("checked",f.options.underline),f.setValue("underline",f.options.underline?1:0)):(f.$widget.find("[data-wrapper=underline]").remove(),f.$element.find("[data-wrapper=underline]").remove()),-1!=f.options.uppercase?(f.$widget.find("input[data-style-customizer-field=uppercase]").prop("checked",f.options.uppercase),f.setValue("uppercase",f.options.uppercase?1:0)):(f.$widget.find("[data-wrapper=uppercase]").remove(),f.$element.find("[data-wrapper=uppercase]").remove()),-1!=f.options.italic?(f.$widget.find("input[data-style-customizer-field=italic]").prop("checked",f.options.italic),f.setValue("italic",f.options.italic?1:0)):(f.$widget.find("[data-wrapper=italic]").remove(),f.$element.find("[data-wrapper=italic]").remove()),-1!=f.options.fontSizeValue?(d=f.$widget.find("div[data-style-customizer-field=font-size]"),e=d.find("div.ccm-style-customizer-slider"),e.slider("value",f.options.fontSizeValue),"em"==f.options.fontSizeUnit&&(e.slider("option","step",.1),e.slider("option","max",10)),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-number").html(f.options.fontSizeValue),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-unit").html(f.options.fontSizeUnit),f.setValue("font-size",f.options.fontSizeValue)):(f.$widget.find("[data-wrapper=fontSize]").remove(),f.$element.find("[data-wrapper=fontSize]").remove()),-1!=f.options.fontWeight?(d=f.$widget.find("div[data-style-customizer-field=font-weight]"),e=d.find("div.ccm-style-customizer-slider"),e.slider("option","step",100),e.slider("option","max",900),e.slider("option","min",100),e.slider("value",f.options.fontWeight),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-number").html(f.options.fontWeight),f.setValue("font-weight",f.options.fontWeight)):(f.$widget.find("[data-wrapper=fontWeight]").remove(),f.$element.find("[data-wrapper=fontWeight]").remove()),-1!=f.options.letterSpacingValue?(d=f.$widget.find("div[data-style-customizer-field=letter-spacing]"),e=d.find("div.ccm-style-customizer-slider"),e.slider("value",f.options.letterSpacingValue),"em"==f.options.letterSpacingUnit&&(e.slider("option","step",.1),e.slider("option","max",10)),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-number").html(f.options.letterSpacingValue),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-unit").html(f.options.letterSpacingUnit),f.setValue("letter-spacing",f.options.letterSpacingValue)):(f.$widget.find("[data-wrapper=letterSpacing]").remove(),f.$element.find("[data-wrapper=letterSpacing]").remove()),-1!=f.options.lineHeightValue?(d=f.$widget.find("div[data-style-customizer-field=line-height]"),e=d.find("div.ccm-style-customizer-slider"),e.slider("value",f.options.lineHeightValue),"em"==f.options.lineHeightUnit&&(e.slider("option","step",.1),e.slider("option","max",10)),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-number").html(f.options.lineHeightValue),d.find("span.ccm-style-customizer-slider-value span.ccm-style-customizer-unit").html(f.options.lineHeightUnit),f.setValue("line-height",f.options.lineHeightValue)):(f.$widget.find("[data-wrapper=lineHeight]").remove(),f.$element.find("[data-wrapper=lineHeight]").remove()),f.updateSwatch()}c.prototype=Object.create(ConcreteStyleCustomizerPalette.prototype),c.prototype.fonts=["Arial","Helvetica","Georgia","Verdana","Trebuchet MS","Book Antiqua","Tahoma","Times New Roman","Courier New","Arial Black","Comic Sans MS"],c.prototype.chooseTemplate='<span class="ccm-style-customizer-display-swatch" data-launch="style-customizer-palette"><div data-wrapper="fontFamily"><input type="hidden" name="<%=options.inputName%>[font-family]" data-style-customizer-input="font-family" /></div><div data-wrapper="color"><input type="hidden" name="<%=options.inputName%>[color]" data-style-customizer-input="color" /></div><div data-wrapper="italic"><input type="hidden" name="<%=options.inputName%>[italic]" data-style-customizer-input="italic" /></div><div data-wrapper="underline"><input type="hidden" name="<%=options.inputName%>[underline]" data-style-customizer-input="underline" /></div><div data-wrapper="uppercase"><input type="hidden" name="<%=options.inputName%>[uppercase]" data-style-customizer-input="uppercase" /></div><div data-wrapper="fontWeight"><input type="hidden" name="<%=options.inputName%>[font-weight]" data-style-customizer-input="font-weight" /></div><div data-wrapper="fontSize"><input type="hidden" name="<%=options.inputName%>[font-size][size]" data-style-customizer-input="font-size" /><input type="hidden" name="<%=options.inputName%>[font-size][unit]" value="<%=options.fontSizeUnit%>" /></div><div data-wrapper="letterSpacing"><input type="hidden" name="<%=options.inputName%>[letter-spacing][size]" data-style-customizer-input="letter-spacing" /><input type="hidden" name="<%=options.inputName%>[letter-spacing][unit]" value="<%=options.letterSpacingUnit%>" /></div><div data-wrapper="lineHeight"><input type="hidden" name="<%=options.inputName%>[line-height][size]" data-style-customizer-input="line-height" /><input type="hidden" name="<%=options.inputName%>[line-height][unit]" value="<%=options.lineHeightUnit%>" /></div><span>T</span></span>',c.prototype.selectorWidgetTemplate='<div class="ccm-ui ccm-style-customizer-palette"><div><select data-style-customizer-field="font" data-wrapper="fontFamily"><option value=""><%=i18n.chooseFont%></option></select> <span data-wrapper="color"><input type="text" data-style-customizer-field="color"></span></div><div data-wrapper="italic" class="checkbox"><label><input type="checkbox" class="ccm-flat-checkbox" data-style-customizer-field="italic"> <%=i18n.italic%></label></div><div data-wrapper="underline" class="checkbox"><label><input type="checkbox" class="ccm-flat-checkbox" data-style-customizer-field="underline"> <%=i18n.underline%></label></div><div data-wrapper="uppercase" class="checkbox"><label><input type="checkbox" class="ccm-flat-checkbox" data-style-customizer-field="uppercase"> <%=i18n.uppercase%></label></div><div data-wrapper="fontSize"><label><%=i18n.fontSize%></label><div data-style-customizer-field="font-size"><div class="ccm-style-customizer-slider"></div><span class="ccm-style-customizer-slider-value"><span class="ccm-style-customizer-number"></span><span class="ccm-style-customizer-unit">px</span></span></div></div><div data-wrapper="fontWeight"><label><%=i18n.fontWeight%> <i class="fa fa-question-circle launch-tooltip" title="400 = Normal, 700 = Bold"></i></label><div data-style-customizer-field="font-weight"><div class="ccm-style-customizer-slider"></div><span class="ccm-style-customizer-slider-value"><span class="ccm-style-customizer-number"></span></span></div></div><div data-wrapper="letterSpacing"><label><%=i18n.letterSpacing%></label><div data-style-customizer-field="letter-spacing"><div class="ccm-style-customizer-slider"></div><span class="ccm-style-customizer-slider-value"><span class="ccm-style-customizer-number"></span><span class="ccm-style-customizer-unit">px</span></span></div></div><div data-wrapper="lineHeight"><label><%=i18n.lineHeight%></label><div data-style-customizer-field="line-height"><div class="ccm-style-customizer-slider"></div><span class="ccm-style-customizer-slider-value"><span class="ccm-style-customizer-number"></span><span class="ccm-style-customizer-unit">px</span></span></div></div><div class="ccm-style-customizer-palette-actions"><button class="btn btn-primary"><%=i18n.save%></button></div></div>',c.prototype.updateSwatch=function(){var a=this,b=a.$element.find("span.ccm-style-customizer-display-swatch");a.getValue("font-family")&&b.css("font-family",a.getValue("font-family")),a.getValue("color")&&b.css("color",a.getValue("color")),b.css("font-weight","inherit"),b.css("font-style","inherit"),b.css("text-decoration","inherit"),b.css("text-transform","inherit"),"1"===a.getValue("italic")&&b.css("font-style","italic"),"1"===a.getValue("underline")&&b.css("text-decoration","underline"),b.css("font-weight",a.getValue("font-weight")),"1"===a.getValue("uppercase")&&b.css("text-transform","uppercase"),b.css("font-size","14px")},c.prototype.save=function(a){var b=this;b.setValue("font-family",b.$fontMenu.val()),b.setValue("color",b.$widget.find("input[data-style-customizer-field=color]").spectrum("get")),b.setValue("italic",b.$widget.find("input[data-style-customizer-field=italic]").is(":checked")?"1":0),b.setValue("underline",b.$widget.find("input[data-style-customizer-field=underline]").is(":checked")?"1":0),b.setValue("uppercase",b.$widget.find("input[data-style-customizer-field=uppercase]").is(":checked")?"1":0),b.setValue("font-size",b.$widget.find("div[data-style-customizer-field=font-size] div.ccm-style-customizer-slider").slider("value")),b.setValue("font-weight",b.$widget.find("div[data-style-customizer-field=font-weight] div.ccm-style-customizer-slider").slider("value")),b.setValue("letter-spacing",b.$widget.find("div[data-style-customizer-field=letter-spacing] div.ccm-style-customizer-slider").slider("value")),b.setValue("line-height",b.$widget.find("div[data-style-customizer-field=line-height] div.ccm-style-customizer-slider").slider("value")),b.updateSwatch(),ConcreteEvent.publish("StyleCustomizerControlUpdate"),b.closeSelector(a)},b.fn.concreteTypographySelector=function(a){return b.each(b(this),function(){new c(b(this),a)})},a.ConcreteTypographySelector=c}(this,$),function(a,b){"use strict";function c(a,c){var d=this;c=b.extend({},c),d.options=c,d.$element=a,d.$toolbar=d.$element.find(">ul"),d.$toolbar.find("div.dropdown-menu").on("click",function(a){return b(a.target).is("button")?!0:void a.stopPropagation()}),d.setupForm(),d.setupButtons(),d.setupSliders()}function d(a,b){var d=this;c.call(d,a,b)}function e(a,b){var d=this;c.call(d,a,b)}c.prototype={refreshStyles:function(a){a.oldIssID&&b("head").find("style[data-style-set="+a.oldIssID+"]").remove(),a.issID&&b("head").append(b("<style />",{"data-style-set":a.issID,text:a.css}))},setupForm:function(){var a=this;a.$element.concreteAjaxForm({success:function(b){a.handleResponse(b)},error:function(){a.$toolbar.prependTo("#ccm-inline-toolbar-container").show()}})},setupButtons:function(){var a=this;a.$toolbar.on("click.inlineStyleCustomizer","button[data-action=cancel-design]",function(){return a.$element.hide(),ConcreteEvent.fire("EditModeExitInline"),!1}),a.$toolbar.on("click.inlineStyleCustomizer","button[data-action=reset-design]",function(){return b.concreteAjax({url:b(this).attr("data-reset-action"),success:function(b){a.handleResponse(b)}}),!1}),a.$toolbar.on("click.inlineStyleCustomizer","button[data-action=save-design]",function(){return a.$toolbar.hide().prependTo(a.$element),a.$element.submit(),ConcreteEvent.unsubscribe("EditModeExitInlineComplete"),!1})},setupSliders:function(){var a=this;a.$toolbar.find(".ccm-inline-style-sliders").each(function(){var a=parseInt(b(this).attr("data-style-slider-min")),c=parseInt(b(this).attr("data-style-slider-max")),d=parseInt(b(this).children(".ccm-inline-style-slider-value").val());isNaN(d)&&(d=parseInt(b(this).attr("data-style-slider-default-setting"))),b(this).slider({min:a,max:c,value:d,slide:function(a,c){b(this).children(".ccm-inline-style-slider-value").val(c.value),b(this).next(".ccm-inline-style-slider-total-display").children(".ccm-inline-style-slider-display-value").text(c.value)}})})}},d.prototype=Object.create(c.prototype),d.prototype.handleResponse=function(a){var c=this,d=new Concrete.getEditMode,e=d.getAreaByID(a.aID),f=e.getBlockByID(parseInt(a.originalBlockID)),g=e.getEnableGridContainer()?1:0,h=CCM_DISPATCHER_FILENAME+"/ccm/system/block/render";b.get(h,{arHandle:e.getHandle(),cID:a.cID,bID:a.bID,arEnableGridContainer:g},function(b){ConcreteToolbar.disableDirectExit();var e=f.replace(a.bID,b);ConcreteAlert.notify({message:a.message}),c.refreshStyles(a),d.destroyInlineEditModeToolbars(),ConcreteEvent.fire("EditModeExitInlineComplete",{block:e})})},e.prototype=Object.create(c.prototype),e.prototype.handleResponse=function(a){var b=this,c=new Concrete.getEditMode,d=c.getAreaByID(a.aID);b.refreshStyles(a),d.getElem().removeClassExcept("ccm-area ccm-global-area"),a.containerClass&&d.getElem().addClass(a.containerClass),c.destroyInlineEditModeToolbars()},b.fn.concreteBlockInlineStyleCustomizer=function(a){return b.each(b(this),function(){new d(b(this),a)})},b.fn.concreteAreaInlineStyleCustomizer=function(a){return b.each(b(this),function(){new e(b(this),a)})},b.fn.removeClassExcept=function(a){return this.each(function(c,d){for(var e=a.split(" "),f=[],g=b(d),h=0;h<e.length;h++)g.hasClass(e[h])&&f.push(e[h]);g.removeClass().addClass(f.join(" "))})},a.ConcreteBlockInlineStyleCustomizer=d,a.ConcreteAreaInlineStyleCustomizer=e}(this,$);