(function($){var ColorPicker=function(){var ids={},inAction,charMin=65,visible,tpl='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" class="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><input type="button" class="colorpicker_none" name="none" value="x" /><input type="button" class="colorpicker_submit" name="save" value="Ok" /></div>',defaults={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onNone:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},fillRGBFields=function(hsb,cal){var rgb=HSBToRGB(hsb);$(cal).data("colorpicker").fields.eq(1).val(rgb.r).end().eq(2).val(rgb.g).end().eq(3).val(rgb.b).end()},fillHSBFields=function(hsb,cal){$(cal).data("colorpicker").fields.eq(4).val(hsb.h).end().eq(5).val(hsb.s).end().eq(6).val(hsb.b).end()},fillHexFields=function(hsb,cal){$(cal).data("colorpicker").fields.eq(0).val(HSBToHex(hsb)).end()},setSelector=function(hsb,cal){$(cal).data("colorpicker").selector.css("backgroundColor","#"+HSBToHex({h:hsb.h,s:100,b:100}));$(cal).data("colorpicker").selectorIndic.css({left:parseInt(150*hsb.s/100,10),top:parseInt(150*(100-hsb.b)/100,10)})},setHue=function(hsb,cal){$(cal).data("colorpicker").hue.css("top",parseInt(150-150*hsb.h/360,10))},setCurrentColor=function(hsb,cal){$(cal).data("colorpicker").currentColor.css("backgroundColor","#"+HSBToHex(hsb))},setNewColor=function(hsb,cal){$(cal).data("colorpicker").newColor.css("backgroundColor","#"+HSBToHex(hsb))},keyDown=function(ev){var pressedKey=ev.charCode||ev.keyCode||-1;if(pressedKey>charMin&&pressedKey<=90||pressedKey==32){return false}var cal=$(this).parent().parent();if(cal.data("colorpicker").livePreview===true){change.apply(this)}},change=function(ev){var cal=$(this).parent().parent(),col;if(!cal.data("colorpicker")||!cal.data("colorpicker").fields)return;if(this.parentNode.className.indexOf("_hex")>0){cal.data("colorpicker").color=col=HexToHSB(fixHex(this.value))}else if(this.parentNode.className.indexOf("_hsb")>0){cal.data("colorpicker").color=col=fixHSB({h:parseInt(cal.data("colorpicker").fields.eq(4).val(),10),s:parseInt(cal.data("colorpicker").fields.eq(5).val(),10),b:parseInt(cal.data("colorpicker").fields.eq(6).val(),10)})}else{cal.data("colorpicker").color=col=RGBToHSB(fixRGB({r:parseInt(cal.data("colorpicker").fields.eq(1).val(),10),g:parseInt(cal.data("colorpicker").fields.eq(2).val(),10),b:parseInt(cal.data("colorpicker").fields.eq(3).val(),10)}))}if(ev){fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0))}setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data("colorpicker").onChange.apply(cal,[col,HSBToHex(col),HSBToRGB(col)])},blur=function(ev){var cal=$(this).parent().parent();var colorpicker=cal.data("colorpicker");if(colorpicker&&colorpicker.fields)colorpicker.fields.parent().removeClass("colorpicker_focus")},focus=function(){charMin=this.parentNode.className.indexOf("_hex")>0?70:65;var colorpicker=$(this).parent().parent().data("colorpicker");if(colorpicker&&colorpicker.fields)colorpicker.fields.parent().removeClass("colorpicker_focus");$(this).parent().addClass("colorpicker_focus")},downIncrement=function(ev){var field=$(this).parent().find("input").focus();var current={el:$(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:ev.pageY,field:field,val:parseInt(field.val(),10),preview:$(this).parent().parent().data("colorpicker").livePreview};$(document).bind("mouseup",current,upIncrement);$(document).bind("mousemove",current,moveIncrement)},moveIncrement=function(ev){ev.data.field.val(Math.max(0,Math.min(ev.data.max,parseInt(ev.data.val+ev.pageY-ev.data.y,10))));if(ev.data.preview){change.apply(ev.data.field.get(0),[true])}return false},upIncrement=function(ev){change.apply(ev.data.field.get(0),[true]);ev.data.el.removeClass("colorpicker_slider").find("input").focus();$(document).unbind("mouseup",upIncrement);$(document).unbind("mousemove",moveIncrement);return false},downHue=function(ev){var current={cal:$(this).parent(),y:$(this).offset().top};current.preview=current.cal.data("colorpicker").livePreview;$(document).bind("mouseup",current,upHue);$(document).bind("mousemove",current,moveHue)},moveHue=function(ev){change.apply(ev.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,ev.pageY-ev.data.y)))/150,10)).get(0),[ev.data.preview]);return false},upHue=function(ev){fillRGBFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));$(document).unbind("mouseup",upHue);$(document).unbind("mousemove",moveHue);return false},downSelector=function(ev){var current={cal:$(this).parent(),pos:$(this).offset()};current.preview=current.cal.data("colorpicker").livePreview;$(document).bind("mouseup",current,upSelector);$(document).bind("mousemove",current,moveSelector)},moveSelector=function(ev){change.apply(ev.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,ev.pageY-ev.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,ev.pageX-ev.data.pos.left))/150,10)).get(0),[ev.data.preview]);return false},upSelector=function(ev){fillRGBFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));$(document).unbind("mouseup",upSelector);$(document).unbind("mousemove",moveSelector);return false},enterSubmit=function(ev){$(this).addClass("colorpicker_focus")},leaveSubmit=function(ev){$(this).removeClass("colorpicker_focus")},clickSubmit=function(ev){var cal=$(this).parent();var col=cal.data("colorpicker").color;cal.data("colorpicker").origColor=col;setCurrentColor(col,cal.get(0));var cal2=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").onSubmit(col,HSBToHex(col),HSBToRGB(col),cal)},clickNone=function(ev){var cal=$(this).parent();cal.data("colorpicker").onNone(cal);cal.hide()},show=function(ev){var cal=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").onBeforeShow.apply(this,[cal.get(0)]);var pos=$(this).offset();var viewPort=getViewport();var top=pos.top+this.offsetHeight;var left=pos.left;if(top+176>viewPort.t+viewPort.h){top-=this.offsetHeight+176}if(left+356>viewPort.l+viewPort.w){left-=356}cal.css({left:left+"px",top:top+"px"});if(cal.data("colorpicker").onShow.apply(this,[cal.get(0)])!=false){cal.show()}$(document).bind("mousedown",{cal:cal},hide);return false},hide=function(ev){if(!isChildOf(ev.data.cal.get(0),ev.target,ev.data.cal.get(0))){if(ev.data.cal.data("colorpicker").onHide.apply(this,[ev.data.cal.get(0)])!=false){ev.data.cal.hide()}$(document).unbind("mousedown",hide)}},isChildOf=function(parentEl,el,container){if(parentEl==el){return true}if(parentEl.contains){return parentEl.contains(el)}if(parentEl.compareDocumentPosition){return!!(parentEl.compareDocumentPosition(el)&16)}var prEl=el.parentNode;while(prEl&&prEl!=container){if(prEl==parentEl)return true;prEl=prEl.parentNode}return false},getViewport=function(){var m=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(m?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(m?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(m?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(m?document.documentElement.clientHeight:document.body.clientHeight)}},fixHSB=function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))}},fixRGB=function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))}},fixHex=function(hex){var len=6-hex.length;if(len>0){var o=[];for(var i=0;i<len;i++){o.push("0")}o.push(hex);hex=o.join("")}return hex},HexToRGB=function(hex){var hex=parseInt(hex.indexOf("#")>-1?hex.substring(1):hex,16);return{r:hex>>16,g:(hex&65280)>>8,b:hex&255}},HexToHSB=function(hex){return RGBToHSB(HexToRGB(hex))},RGBToHSB=function(rgb){var hsb={};hsb.b=Math.max(Math.max(rgb.r,rgb.g),rgb.b);hsb.s=hsb.b<=0?0:Math.round(100*(hsb.b-Math.min(Math.min(rgb.r,rgb.g),rgb.b))/hsb.b);hsb.b=Math.round(hsb.b/255*100);if(rgb.r==rgb.g&&rgb.g==rgb.b)hsb.h=0;else if(rgb.r>=rgb.g&&rgb.g>=rgb.b)hsb.h=60*(rgb.g-rgb.b)/(rgb.r-rgb.b);else if(rgb.g>=rgb.r&&rgb.r>=rgb.b)hsb.h=60+60*(rgb.g-rgb.r)/(rgb.g-rgb.b);else if(rgb.g>=rgb.b&&rgb.b>=rgb.r)hsb.h=120+60*(rgb.b-rgb.r)/(rgb.g-rgb.r);else if(rgb.b>=rgb.g&&rgb.g>=rgb.r)hsb.h=180+60*(rgb.b-rgb.g)/(rgb.b-rgb.r);else if(rgb.b>=rgb.r&&rgb.r>=rgb.g)hsb.h=240+60*(rgb.r-rgb.g)/(rgb.b-rgb.g);else if(rgb.r>=rgb.b&&rgb.b>=rgb.g)hsb.h=300+60*(rgb.r-rgb.b)/(rgb.r-rgb.g);else hsb.h=0;hsb.h=Math.round(hsb.h);return hsb},HSBToRGB=function(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s==0){rgb.r=rgb.g=rgb.b=v}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h==360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}else{rgb.r=0;rgb.g=0;rgb.b=0}}return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)}},RGBToHex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length==1){hex[nr]="0"+val}});return hex.join("")},HSBToHex=function(hsb){return RGBToHex(HSBToRGB(hsb))};return{init:function(options){options=$.extend({},defaults,options||{});if(typeof options.color=="string"){options.color=HexToHSB(options.color)}else if(options.color.r!=undefined&&options.color.g!=undefined&&options.color.b!=undefined){options.color=RGBToHSB(options.color)}else if(options.color.h!=undefined&&options.color.s!=undefined&&options.color.b!=undefined){options.color=fixHSB(options.color)}else{return this}options.change=change;options.origColor=options.color;return this.each(function(){if(!$(this).data("colorpickerId")){var id="collorpicker_"+parseInt(Math.random()*1e3);$(this).data("colorpickerId",id);var cal=$(tpl).attr("id",id);if(options.flat){cal.appendTo(this).show()}else{cal.appendTo(document.body)}options.fields=cal.find("input").bind("keydown",keyDown).bind("change",change).bind("blur",blur).bind("focus",focus);cal.find("span").bind("mousedown",downIncrement);options.selector=cal.find("div.colorpicker_color").bind("mousedown",downSelector);options.selectorIndic=options.selector.find("div div");options.hue=cal.find("div.colorpicker_hue div");cal.find("div.colorpicker_hue").bind("mousedown",downHue);options.newColor=cal.find("div.colorpicker_new_color");options.currentColor=cal.find("div.colorpicker_current_color");cal.data("colorpicker",options);cal.find("input.colorpicker_none").bind("click",clickNone);cal.find("input.colorpicker_submit").bind("click",clickSubmit);fillRGBFields(options.color,cal.get(0));fillHSBFields(options.color,cal.get(0));fillHexFields(options.color,cal.get(0));setHue(options.color,cal.get(0));setSelector(options.color,cal.get(0));setCurrentColor(options.color,cal.get(0));setNewColor(options.color,cal.get(0));if(options.flat){cal.css({position:"relative",display:"block"})}else{$(this).bind(options.eventName,show)}}})},showPicker:function(){return this.each(function(){if($(this).data("colorpickerId")){show.apply(this)}})},hidePicker:function(){return this.each(function(){if($(this).data("colorpickerId")){$("#"+$(this).data("colorpickerId")).hide()}})},setColor:function(col){if(typeof col=="string"){col=HexToHSB(col)}else if(col.r!=undefined&&col.g!=undefined&&col.b!=undefined){col=RGBToHSB(col)}else if(col.h!=undefined&&col.s!=undefined&&col.b!=undefined){col=fixHSB(col)}else{return this}return this.each(function(){if($(this).data("colorpickerId")){var cal=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").color=col;cal.data("colorpicker").origColor=col;fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));fillHexFields(col,cal.get(0));setHue(col,cal.get(0));setSelector(col,cal.get(0));setCurrentColor(col,cal.get(0));setNewColor(col,cal.get(0))}})}}}();$.fn.extend({ColorPicker:ColorPicker.init,ColorPickerHide:ColorPicker.hide,ColorPickerShow:ColorPicker.show,ColorPickerSetColor:ColorPicker.setColor})})(jQuery);(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if(Math.abs(pX-cX)+Math.abs(pY-cY)<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind("mouseenter",handleHover).bind("mouseleave",handleHover)}})(jQuery);(function($){var self=null;var lutype="blocktypes";var searchValue=null;$.fn.liveUpdate=function(list,type){return this.each(function(){new $.liveUpdate(this,list,type)})};$.liveUpdate=function(e,list,type){this.field=$(e);$(e).data("liveUpdate",this);this.list=$("#"+list);this.lutype="blocktypes";if(typeof type!="undefined"){this.lutype=type}if(this.list.length>0){this.init()}};$.liveUpdate.prototype={init:function(){var self=this;this.setupCache();this.field.parents("form").submit(function(){return false});this.field.keyup(function(){self.filter()});self.filter()},filter:function(){if(this.field.val()!=searchValue){if($.trim(this.field.val())==""){if(this.lutype=="blocktypes"){}else if(this.lutype=="attributes"){this.list.children("li").addClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected")}else if(this.lutype=="stacks"){this.list.children("li").addClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected")}else if(this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}else{this.list.children("li").show()}return}if(this.lutype!="intelligent-search"||this.field.val().length>2){this.displayResults(this.getScores(this.field.val().toLowerCase()))}else if(this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}}searchValue=this.field.val();if(searchValue==""&&this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}},setupCache:function(){var self=this;this.cache=[];this.rows=[];var lutype=this.lutype;this.list.find("li").each(function(){if(lutype=="blocktypes"){self.cache.push($(this).find("span").html().toLowerCase())}else if(lutype=="attributes"){var val=$(this).find("a,span").html().toLowerCase();self.cache.push(val)}else if(lutype=="stacks"){var val=$(this).find("a,span").html().toLowerCase();self.cache.push(val)}else if(lutype=="fileset"){self.cache.push($(this).find("span").html().toLowerCase())}else if(lutype=="intelligent-search"){var s=$(this).find("span").html();if(s){self.cache.push(s.toLowerCase())}}self.rows.push($(this))});this.cache_length=this.cache.length},displayResults:function(scores){var self=this;if(this.lutype=="blocktypes"){this.list.children("li").hide();$.each(scores,function(i,score){self.rows[score[1]].show()})}else if(this.lutype=="attributes"){this.list.children("li").removeClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected");this.list.children("li").removeClass("ccm-item-selected");$.each(scores,function(i,score){self.rows[score[1]].addClass("ccm-attribute-available")});this.list.children("li.item-select-list-header").removeClass("ccm-attribute-available");$(this.list.find("li.ccm-attribute-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="stacks"){this.list.children("li").removeClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected");this.list.children("li").removeClass("ccm-item-selected");$.each(scores,function(i,score){self.rows[score[1]].addClass("ccm-stack-available")});this.list.children("li.item-select-list-header").removeClass("ccm-stack-available");$(this.list.find("li.ccm-stack-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="intelligent-search"){if(!this.list.is(":visible")){this.list.fadeIn(160,"easeOutExpo")}this.list.find(".ccm-intelligent-search-results-module-onsite").hide();this.list.find("li").hide();var shown=0;$.each(scores,function(i,score){$li=self.rows[score[1]];if(score[0]>.7){shown++;if(!$li.parent().parent().is(":visible")){$li.parent().parent().show()}$li.show()}});this.list.find("li a").removeClass("ccm-intelligent-search-result-selected");this.list.find("li:visible a:first").addClass("ccm-intelligent-search-result-selected")}else{this.list.children("li").hide();$.each(scores,function(i,score){self.rows[score[1]].show()})}},getScores:function(term){var scores=[];for(var i=0;i<this.cache_length;i++){var score=this.cache[i].score(term);if(score>0){scores.push([score,i])}}return scores.sort(function(a,b){return b[0]-a[0]})}}})(jQuery);(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length)settings.single="metadata";var data=$.data(elem,settings.single);if(data)return data;data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m)data=m[1]}else if(settings.type=="elem"){if(!elem.getElementsByTagName)return;var e=elem.getElementsByTagName(settings.name);if(e.length)data=$.trim(e[0].innerHTML)}else if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr)data=attr}if(data.indexOf("{")<0)data="{"+data+"}";data=eval("("+data+")");$.data(elem,settings.single,data);return data}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);(function(){var $,Chosen,get_side_border_padding,root;var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};root=this;$=jQuery;$.fn.extend({chosen:function(options){if($.browser==="msie"&&($.browser.version==="6.0"||$.browser.version==="7.0")){return this}return $(this).each(function(input_field){if(!$(this).hasClass("chzn-done")){return new Chosen(this,options)}})}});Chosen=function(){function Chosen(form_field,options){this.form_field=form_field;this.options=options!=null?options:{};this.set_default_values();this.form_field_jq=$(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done")}Chosen.prototype.set_default_values=function(){this.click_test_action=__bind(function(evt){return this.test_active_click(evt)},this);this.activate_action=__bind(function(evt){return this.activate_field(evt)},this);this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.choices=0;return this.results_none_found=this.options.no_results_text||"No results match"};Chosen.prototype.set_up_html=function(){var container_div,dd_top,dd_width,sf_width;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.outerWidth();this.default_text=this.form_field_jq.data("placeholder")?this.form_field_jq.data("placeholder"):this.default_text_default;container_div=$("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"});if(this.is_multiple){container_div.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>')}else{container_div.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>')}this.form_field_jq.hide().after(container_div);this.container=$("#"+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));if(!this.is_multiple&&this.form_field.options.length<=this.disable_search_threshold){this.container.addClass("chzn-container-single-nosearch")}this.dropdown=this.container.find("div.chzn-drop").first();dd_top=this.container.height();dd_width=this.f_width-get_side_border_padding(this.dropdown);this.dropdown.css({width:dd_width+"px",top:dd_top+"px"});this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chzn-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chzn-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chzn-search").first();this.selected_item=this.container.find(".chzn-single").first();sf_width=dd_width-get_side_border_padding(this.search_container)-get_side_border_padding(this.search_field);this.search_field.css({width:sf_width+"px"})}this.results_build();return this.set_tab_index()};Chosen.prototype.register_observers=function(){this.container.mousedown(__bind(function(evt){return this.container_mousedown(evt)},this));this.container.mouseup(__bind(function(evt){return this.container_mouseup(evt)},this));this.container.mouseenter(__bind(function(evt){return this.mouse_enter(evt)},this));this.container.mouseleave(__bind(function(evt){return this.mouse_leave(evt)},this));this.search_results.mouseup(__bind(function(evt){return this.search_results_mouseup(evt)},this));this.search_results.mouseover(__bind(function(evt){return this.search_results_mouseover(evt)},this));this.search_results.mouseout(__bind(function(evt){return this.search_results_mouseout(evt)},this));this.form_field_jq.bind("liszt:updated",__bind(function(evt){return this.results_update_field(evt)},this));this.search_field.blur(__bind(function(evt){return this.input_blur(evt)},this));this.search_field.keyup(__bind(function(evt){return this.keyup_checker(evt)},this));this.search_field.keydown(__bind(function(evt){return this.keydown_checker(evt)},this));if(this.is_multiple){this.search_choices.click(__bind(function(evt){return this.choices_click(evt)},this));return this.search_field.focus(__bind(function(evt){return this.input_focus(evt)},this))}};Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq.attr("disabled");if(this.is_disabled){this.container.addClass("chzn-disabled");this.search_field.attr("disabled",true);if(!this.is_multiple){this.selected_item.unbind("focus",this.activate_action)}return this.close_field()}else{this.container.removeClass("chzn-disabled");this.search_field.attr("disabled",false);if(!this.is_multiple){return this.selected_item.bind("focus",this.activate_action)}}};Chosen.prototype.container_mousedown=function(evt){var target_closelink;if(!this.is_disabled){target_closelink=evt!=null?$(evt.target).hasClass("search-choice-close"):false;if(evt&&evt.type==="mousedown"){evt.stopPropagation()}if(!this.pending_destroy_click&&!target_closelink){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}$(document).click(this.click_test_action);this.results_show()}else if(!this.is_multiple&&evt&&($(evt.target)===this.selected_item||$(evt.target).parents("a.chzn-single").length)){evt.preventDefault();this.results_toggle()}return this.activate_field()}else{return this.pending_destroy_click=false}}};Chosen.prototype.container_mouseup=function(evt){if(evt.target.nodeName==="ABBR"){return this.results_reset(evt)}};Chosen.prototype.mouse_enter=function(){return this.mouse_on_container=true};Chosen.prototype.mouse_leave=function(){return this.mouse_on_container=false};Chosen.prototype.input_focus=function(evt){if(!this.active_field){return setTimeout(__bind(function(){return this.container_mousedown()},this),50)}};Chosen.prototype.input_blur=function(evt){if(!this.mouse_on_container){this.active_field=false;return setTimeout(__bind(function(){return this.blur_test()},this),100)}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chzn-container-active")){return this.close_field()}};Chosen.prototype.close_field=function(){$(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1)}this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};Chosen.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1)}this.container.addClass("chzn-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};Chosen.prototype.test_active_click=function(evt){if($(evt.target).parents("#"+this.container_id).length){return this.active_field=true}else{return this.close_field()}};Chosen.prototype.results_build=function(){var content,data,startTime,_i,_len,_ref;startTime=new Date;this.parsing=true;this.results_data=root.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0}else if(!this.is_multiple){this.selected_item.find("span").text(this.default_text)}content="";_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){content+=this.result_add_group(data)}else if(!data.empty){content+=this.result_add_option(data);if(data.selected&&this.is_multiple){this.choice_build(data)}else if(data.selected&&!this.is_multiple){this.selected_item.find("span").text(data.text);if(this.allow_single_deselect){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}}}}this.search_field_disabled();this.show_search_field_default();this.search_field_scale();this.search_results.html(content);return this.parsing=false};Chosen.prototype.result_add_group=function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+group.array_index;return'<li id="'+group.dom_id+'" class="group-result">'+$("<div />").text(group.label).html()+"</li>"}else{return""}};Chosen.prototype.result_add_option=function(option){var classes,style;if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected){classes.push("result-selected")}if(option.group_array_index!=null){classes.push("group-option")}if(option.classes!==""){classes.push(option.classes)}style=option.style.cssText!==""?' style="'+option.style+'"':"";return'<li id="'+option.dom_id+'" class="'+classes.join(" ")+'"'+style+">"+option.html+"</li>"}else{return""}};Chosen.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build()};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop(high_bottom-maxHeight>0?high_bottom-maxHeight:0)}else if(high_top<visible_top){return this.search_results.scrollTop(high_top)}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};Chosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};Chosen.prototype.results_show=function(){var dd_top;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected){this.result_do_highlight(this.result_single_selected)}}dd_top=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({top:dd_top+"px",left:0});this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};Chosen.prototype.results_hide=function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop")}this.result_clear_highlight();this.dropdown.css({left:"-9000px"});return this.results_showing=false};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field_jq.attr("tabindex")){ti=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple){return this.search_field.attr("tabindex",ti)}else{this.selected_item.attr("tabindex",ti);return this.search_field.attr("tabindex",-1)}}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;return this.result_select(evt)
}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target)}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents(".active-result").first())){return this.result_clear_highlight()}};Chosen.prototype.choices_click=function(evt){evt.preventDefault();if(this.active_field&&!$(evt.target).hasClass("search-choice"||$(evt.target).parents(".search-choice").first)&&!this.results_showing){return this.results_show()}};Chosen.prototype.choice_build=function(item){var choice_id,link;choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+choice_id+'"><span>'+item.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+item.array_index+'"></a></li>');link=$("#"+choice_id).find("a").first();return link.click(__bind(function(evt){return this.choice_destroy_link_click(evt)},this))};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();if(!this.is_disabled){this.pending_destroy_click=true;return this.choice_destroy($(evt.target))}else{return evt.stopPropagation}};Chosen.prototype.choice_destroy=function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1){this.results_hide()}this.result_deselect(link.attr("rel"));return link.parents("li").first().remove()};Chosen.prototype.results_reset=function(evt){this.form_field.options[0].selected=true;this.selected_item.find("span").text(this.default_text);this.show_search_field_default();$(evt.target).remove();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};Chosen.prototype.result_select=function(evt){var high,high_id,item,position;if(this.result_highlight){high=this.result_highlight;high_id=high.attr("id");this.result_clear_highlight();if(this.is_multiple){this.result_deactivate(high)}else{this.search_results.find(".result-selected").removeClass("result-selected");this.result_single_selected=high}high.addClass("result-selected");position=high_id.substr(high_id.lastIndexOf("_")+1);item=this.results_data[position];item.selected=true;this.form_field.options[item.options_index].selected=true;if(this.is_multiple){this.choice_build(item)}else{this.selected_item.find("span").first().text(item.text);if(this.allow_single_deselect){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}}if(!(evt.metaKey&&this.is_multiple)){this.results_hide()}this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale()}};Chosen.prototype.result_activate=function(el){return el.addClass("active-result")};Chosen.prototype.result_deactivate=function(el){return el.removeClass("active-result")};Chosen.prototype.result_deselect=function(pos){var result,result_data;result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;result=$("#"+this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale()};Chosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};Chosen.prototype.winnow_results=function(){var found,option,part,parts,regex,result_id,results,searchText,startTime,startpos,text,zregex,_i,_j,_len,_len2,_ref;startTime=new Date;this.no_results_clear();results=0;searchText=this.search_field.val()===this.default_text?"":$("<div/>").text($.trim(this.search_field.val())).html();regex=new RegExp("^"+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.disabled&&!option.empty){if(option.group){$("#"+option.dom_id).hide()}else if(!(this.is_multiple&&option.selected)){found=false;result_id=option.dom_id;if(regex.test(option.html)){found=true;results+=1}else if(option.html.indexOf(" ")>=0||option.html.indexOf("[")===0){parts=option.html.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_j=0,_len2=parts.length;_j<_len2;_j++){part=parts[_j];if(regex.test(part)){found=true;results+=1}}}}if(found){if(searchText.length){startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+"</em>"+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+"<em>"+text.substr(startpos)}else{text=option.html}if($("#"+result_id).html!==text){$("#"+result_id).html(text)}this.result_activate($("#"+result_id));if(option.group_array_index!=null){$("#"+this.results_data[option.group_array_index].dom_id).show()}}else{if(this.result_highlight&&result_id===this.result_highlight.attr("id")){this.result_clear_highlight()}this.result_deactivate($("#"+result_id))}}}}if(results<1&&searchText.length){return this.no_results(searchText)}else{return this.winnow_results_set_highlight()}};Chosen.prototype.winnow_results_clear=function(){var li,lis,_i,_len,_results;this.search_field.val("");lis=this.search_results.find("li");_results=[];for(_i=0,_len=lis.length;_i<_len;_i++){li=lis[_i];li=$(li);_results.push(li.hasClass("group-result")?li.show():!this.is_multiple||!li.hasClass("result-selected")?this.result_activate(li):void 0)}return _results};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;if(!this.result_highlight){selected_results=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high)}}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');no_results_html.find("span").first().html(terms);return this.search_results.append(no_results_html)};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};Chosen.prototype.keydown_arrow=function(){var first_active,next_sib;if(!this.result_highlight){first_active=this.search_results.find("li.active-result").first();if(first_active){this.result_do_highlight($(first_active))}}else if(this.results_showing){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){this.result_do_highlight(next_sib)}}if(!this.results_showing){return this.results_show()}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first())}else{if(this.choices>0){this.results_hide()}return this.result_clear_highlight()}}};Chosen.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{this.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus")}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};Chosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0){return this.keydown_backstroke()}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt)}break;case 27:if(this.results_showing){return this.results_hide()}break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke()}switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break}};Chosen.prototype.search_field_scale=function(){var dd_top,div,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";"}div=$("<div />",{style:style_block});div.text(this.search_field.val());$("body").append(div);w=div.width()+25;div.remove();if(w>this.f_width-10){w=this.f_width-10}this.search_field.css({width:w+"px"});dd_top=this.container.height();return this.dropdown.css({top:dd_top+"px"})}};Chosen.prototype.generate_field_id=function(){var new_id;new_id=this.generate_random_id();this.form_field.id=new_id;return new_id};Chosen.prototype.generate_random_id=function(){var string;string="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while($("#"+string).length>0){string+=this.generate_random_char()}return string};Chosen.prototype.generate_random_char=function(){var chars,newchar,rand;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";rand=Math.floor(Math.random()*chars.length);return newchar=chars.substring(rand,rand+1)};return Chosen}();get_side_border_padding=function(elmt){var side_border_padding;return side_border_padding=elmt.outerWidth()-elmt.width()};root.get_side_border_padding=get_side_border_padding}).call(this);(function(){var SelectParser;SelectParser=function(){function SelectParser(){this.options_index=0;this.parsed=[]}SelectParser.prototype.add_node=function(child){if(child.nodeName==="OPTGROUP"){return this.add_group(child)}else{return this.add_option(child)}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled))}return _results};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};return SelectParser}();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser;_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child)}return parser.parsed};this.SelectParser=SelectParser}).call(this);ccm_t=function(key){return $("input[name=ccm-string-"+key+"]").val()};ccm_parseJSON=function(resp,onNoError){if(resp.error){alert(resp.message)}else{onNoError()}};ccm_addHeaderItem=function(item,type){var qschar=item.indexOf("?")!=-1?"":"?ts=";if(type=="CSS"){if(navigator.userAgent.indexOf("MSIE")!=-1){var ss=document.createElement("link"),hd=document.getElementsByTagName("head")[0];ss.type="text/css";ss.rel="stylesheet";ss.href=item;ss.media="screen";hd.appendChild(ss)}else{if(!$("head").children('link[href*="'+item+'"]').length){$("head").append('<link rel="stylesheet" media="screen" type="text/css" href="'+item+qschar+(new Date).getTime()+'" />')}}}else if(type=="JAVASCRIPT"){if(!$('script[src*="'+item+'"]').length){$("head").append('<script type="text/javascript" src="'+item+qschar+(new Date).getTime()+'"></script>')}}else{if(!$("head").children(item).length){$("head").append(item)}}};var ccm_isBlockError=false;var ccm_blockError=false;ccm_addError=function(err){if(!ccm_isBlockError){ccm_blockError="";ccm_blockError+="<ul>"}ccm_isBlockError=true;ccm_blockError+="<li>"+err+"</li>"};ccm_resetBlockErrors=function(){ccm_isBlockError=false;ccm_blockError=""};ccm_fadeInMenu=function(bobj,e){var mwidth=bobj.find("div.popover div.inner").width();var mheight=bobj.find("div.popover").height();bobj.hide();bobj.css("visibility","visible");var posX=e.pageX+2;var posY=e.pageY+2;if($(window).height()<e.clientY+mheight){posY=posY-mheight-10;posX=posX-mwidth/2;bobj.find("div.popover").removeClass("below");bobj.find("div.popover").addClass("above")}else{posX=posX-mwidth/2;posY=posY+10;bobj.find("div.popover").removeClass("above");bobj.find("div.popover").addClass("below")}bobj.css("top",posY+"px");bobj.css("left",posX+"px");bobj.fadeIn(60)};ccm_hideMenus=function(){ccm_activeMenu=false;$("div.ccm-menu").hide();$("div.ccm-menu").css("visibility","hidden");$("div.ccm-menu").show()};ccm_paneToggleOptions=function(obj){var pane=$(obj).parent().find("div.ccm-pane-options-content");if($(obj).hasClass("ccm-icon-option-closed")){$(obj).removeClass("ccm-icon-option-closed").addClass("ccm-icon-option-open");pane.slideDown("fast","easeOutExpo")}else{$(obj).removeClass("ccm-icon-option-open").addClass("ccm-icon-option-closed");pane.slideUp("fast","easeOutExpo")}};ccm_setupGridStriping=function(tbl){$("#"+tbl+" tr").removeClass();var j=0;$("#"+tbl+" tr").each(function(){if($(this).css("display")!="none"){if(j%2==0){$(this).addClass("ccm-row-alt")}j++}})};var CCMEditMode=function(){var blockTypeDropSuccessful=false;setupMenus=function(){$(".ccm-area").each(function(){var totalblocks=parseInt($(this).attr("data-total-blocks"));var maxblocks=parseInt($(this).attr("data-maximum-blocks"));if(maxblocks>-1&&(totalblocks==maxblocks||totalblocks>maxblocks)){$(this).find("div.ccm-area-footer li[data-list-item=block_limit_row]").hide()}else{$(this).find("div.ccm-area-footer li[data-list-item=block_limit_row]").show()}});$(".ccm-block-edit").each(function(){var $b=$(this);var bID=$b.attr("data-block-id");var aID=$b.attr("data-area-id");var arHandle=$b.closest("div.ccm-area").attr("data-area-handle");$b.find("a[data-menu-action=edit_inline]").unbind().on("click",function(){CCMInlineEditMode.editBlock(CCM_CID,aID,arHandle,bID,$(this).attr("data-menu-action-params"));return false});$b.find("a[data-menu-action=block_dialog]").each(function(){var href=$(this).attr("data-menu-href");if(href.indexOf("?")!==-1){href+="&cID="+CCM_CID}else{href+="?cID="+CCM_CID}href+="&arHandle="+encodeURIComponent(arHandle)+"&bID="+bID;$(this).attr("href",href);$(this).dialog()});$b.find("a[data-menu-action=block_scrapbook]").unbind().on("click",function(){CCMEditMode.addBlockToScrapbook(CCM_CID,bID,arHandle);return false});$b.find("a[data-menu-action=delete_block]").unbind().on("click",function(){CCMEditMode.deleteBlock(CCM_CID,bID,aID,arHandle,$(this).attr("data-menu-delete-message"));return false})});$(".ccm-area").ccmmenu();$(".ccm-block-edit").ccmmenu()};saveArrangement=function(sourceBlockID,sourceBlockAreaID,destinationBlockAreaID,sourceBlockTypeHandle){var cID=CCM_CID;jQuery.fn.dialog.showLoader();if(!sourceBlockTypeHandle){var sourceBlockTypeHandle=""}var serial="&sourceBlockID="+sourceBlockID+"&sourceBlockTypeHandle="+sourceBlockTypeHandle+"&sourceBlockAreaID="+sourceBlockAreaID+"&destinationBlockAreaID="+destinationBlockAreaID;var source=$("div.ccm-area[data-area-id="+sourceBlockAreaID+"]");if(sourceBlockAreaID==destinationBlockAreaID){var areaArray=[source]}else{var destination=$("div.ccm-area[data-area-id="+destinationBlockAreaID+"]");var areaArray=[source,destination]}$.each(areaArray,function(idx,area){var $area=$(area);areaStr="&area["+$area.attr("data-area-id")+"][]=";$area.find("> div.ccm-area-block-list > div.ccm-block-edit").each(function(){var bID=$(this).attr("data-block-id");if($(this).attr("custom-style")){bID+="-"+$(this).attr("custom-style")}serial+=areaStr+bID})});$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,dataType:"json",data:"cID="+cID+"&ccm_token="+CCM_SECURITY_TOKEN+"&btask=ajax_do_arrange"+serial,complete:function(){CCMEditMode.start()},success:function(r){ccm_parseJSON(r,function(){jQuery.fn.dialog.hideLoader();if(sourceBlockTypeHandle=="core_gathering_item"){destination.find("div[data-gathering-item-id="+sourceBlockID+"]").remove();CCMEditMode.parseBlockResponse(r,r.bID,"add")}else{if(source&&destination){var stb=parseInt(source.attr("data-total-blocks"));var dtb=parseInt(destination.attr("data-total-blocks"));source.attr("data-total-blocks",stb-1);destination.attr("data-total-blocks",dtb+1);destination.find("div[data-block-id="+sourceBlockID+"]").attr("data-area-id",destinationBlockAreaID)}}CCMToolbar.disableDirectExit()})}})};addBlockType=function(cID,aID,arHandle,$link,fromdrag){var btID=$link.attr("data-btID");var inline=parseInt($link.attr("data-supports-inline-add"));var hasadd=parseInt($link.attr("data-has-add-template"));if(!hasadd){var action=CCM_DISPATCHER_FILENAME+"?cID="+cID+"&arHandle="+encodeURIComponent(arHandle)+"&btID="+btID+"&mode=edit&processBlock=1&add=1&ccm_token="+CCM_SECURITY_TOKEN;$.get(action,function(r){CCMEditMode.parseBlockResponse(r,false,"add")})}else if(inline){CCMInlineEditMode.loadAdd(cID,arHandle,aID,btID)}else{jQuery.fn.dialog.open({onClose:function(){$(document).trigger("blockWindowClose");if(fromdrag){jQuery.fn.dialog.closeAll()}},width:parseInt($link.attr("data-dialog-width")),height:parseInt($link.attr("data-dialog-height"))+20,title:$link.attr("data-dialog-title"),href:CCM_TOOLS_PATH+"/add_block_popup?cID="+cID+"&btID="+btID+"&arHandle="+encodeURIComponent(arHandle)})}};setupSortablesAndDroppables=function(){$("div.ccm-area-block-dropzone").remove();$(".ui-droppable").droppable("destroy");$emptyareas=$("div.ccm-area[data-total-blocks=0]");$emptyareas.droppable({hoverClass:"ccm-area-drag-block-type-over",tolerance:"pointer",accept:function($item){var totalblocks=parseInt($(this).attr("data-total-blocks"));var maxblocks=parseInt($(this).attr("data-maximum-blocks"));if(maxblocks==-1||totalblocks<maxblocks){var btHandle=$item.attr("data-block-type-handle");return $(this).attr("data-accepts-block-types").indexOf(btHandle)!==-1}return false},greedy:true,drop:function(e,ui){$(".ccm-area-drag-block-type-over").removeClass("ccm-area-drag-block-type-over");if(ui.helper.is(".ccm-overlay-draggable-block-type")){CCMEditMode.blockTypeDropSuccessful=true;addBlockType($(this).attr("data-cID"),$(this).attr("data-area-id"),$(this).attr("data-area-handle"),ui.helper,true)}else{ui.draggable.appendTo($(this).find(".ccm-area-block-list"));var itemID=ui.draggable.attr("data-block-id");var btHandle=ui.draggable.attr("data-block-type-handle");if(btHandle=="core_gathering_item"){var itemID=ui.draggable.attr("data-gathering-item-id")}saveArrangement(itemID,ui.draggable.attr("data-area-id"),$(this).attr("data-area-id"),btHandle)}}});var $dropzone=$("<div />").addClass("ccm-area-block-dropzone").append($("<div />").addClass("ccm-area-block-dropzone-inner"));$dropzone.clone().insertBefore($(".ccm-block-edit"));$nonemptyareas=$("div.ccm-area[data-total-blocks!=0] > div.ccm-area-block-list");$nonemptyareas.append($dropzone.clone());$(".ccm-area-block-dropzone").droppable({hoverClass:"ccm-area-block-dropzone-over",tolerance:"pointer",accept:function($item){var btHandle=$item.attr("data-block-type-handle");if(btHandle=="core_gathering_item"){return false}var $area=$(this).closest(".ccm-area");var totalblocks=parseInt($area.attr("data-total-blocks"));var maxblocks=parseInt($area.attr("data-maximum-blocks"));if(maxblocks==-1||totalblocks<maxblocks){var btHandles=$area.attr("data-accepts-block-types");if(btHandles){return btHandles.indexOf(btHandle)!==-1}}return false},drop:function(e,ui){$(".ccm-area-drag-block-type-over").removeClass("ccm-area-drag-block-type-over");if(ui.helper.is(".ccm-overlay-draggable-block-type")){CCMEditMode.blockTypeDropSuccessful=true;$(this).replaceWith($("<div />",{id:"ccm-add-new-block-placeholder"}));var $area=$("#ccm-add-new-block-placeholder").closest(".ccm-area");addBlockType($area.attr("data-cID"),$area.attr("data-area-id"),$area.attr("data-area-handle"),ui.helper,true)}else{var itemID=ui.draggable.attr("data-block-id");var btHandle=ui.draggable.attr("data-block-type-handle");var arID=ui.draggable.attr("data-area-id");var $area=$(this).closest(".ccm-area");$(this).replaceWith(ui.draggable.clone());ui.draggable.remove();setTimeout(function(){saveArrangement(itemID,arID,$area.attr("data-area-id"),btHandle)},100)}}});$("[data-inline-command=move-block]").on("mousedown",function(){$(".ccm-area-block-dropzone").addClass("ccm-area-block-dropzone-active")});$("[data-inline-command=move-block]").on("mouseup",function(){$(".ccm-area-block-dropzone-active").removeClass("ccm-area-block-dropzone-active")});$(".ccm-block-edit").draggable({cursor:"move",cursorAt:{right:10,top:10},handle:"[data-inline-command=move-block]",opacity:.5,helper:function(){var w=$(this).width();var h=$(this).height();if(h>300){h=300}var $d=$("<div />",{"class":"ccm-block-type-sorting"}).css("width",w).css("height",h);$d.append($(this).clone());return $d},stop:function(){$.fn.ccmmenu.enable()},start:function(e,ui){$.fn.ccmmenu.disable()}})};return{start:function(){setupMenus();setupSortablesAndDroppables()},setupBlockForm:function(form,bID,task){form.ajaxForm({type:"POST",iframe:true,beforeSubmit:function(){$("input[name=ccm-block-form-method]").val("AJAX");jQuery.fn.dialog.showLoader();if(typeof window.ccmValidateBlockForm=="function"){r=window.ccmValidateBlockForm();if(ccm_isBlockError){jQuery.fn.dialog.hideLoader();if(ccm_blockError){ccmAlert.notice(ccmi18n.error,ccm_blockError+"</ul>")}ccm_resetBlockErrors();return false}}},success:function(r){CCMEditMode.parseBlockResponse(r,bID,task)}})},addBlockToScrapbook:function(cID,bID,arHandle){CCMToolbar.disableDirectExit();$.ajax({type:"POST",url:CCM_TOOLS_PATH+"/pile_manager.php",data:"cID="+cID+"&bID="+bID+"&arHandle="+encodeURIComponent(arHandle)+"&btask=add&scrapbookName=userScrapbook",success:function(resp){ccmAlert.hud(ccmi18n.copyBlockToScrapbookMsg,2e3,"add",ccmi18n.copyBlockToScrapbook)}})},deleteBlock:function(cID,bID,aID,arHandle,msg,callback){if(confirm(msg)){CCMToolbar.disableDirectExit();$d=$("[data-block-id="+bID+"][data-area-id="+aID+"]");$d.hide().remove();$.fn.ccmmenu.reset();ccmAlert.hud(ccmi18n.deleteBlockMsg,2e3,"delete_small",ccmi18n.deleteBlock);var tb=parseInt($("[data-area-id="+aID+"]").attr("data-total-blocks"));$("[data-area-id="+aID+"]").attr("data-total-blocks",tb-1);CCMEditMode.start();$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+cID+"&ccm_token="+CCM_SECURITY_TOKEN+"&isAjax=true&btask=remove&bID="+bID+"&arHandle="+encodeURIComponent(arHandle)});if(typeof callback=="function"){callback()}}},parseBlockResponse:function(r,currentBlockID,task){try{if(typeof r=="string"){r=r.replace(/(<([^>]+)>)/gi,"");resp=eval("("+r+")")}else{resp=r}if(resp.error==true){var message="<ul>";for(i=0;i<resp.response.length;i++){message+="<li>"+resp.response[i]+"</li>"}message+="</ul>";ccmAlert.notice(ccmi18n.error,message)}else{jQuery.fn.dialog.closeTop();$(document).trigger("blockWindowAfterClose");if(resp.cID){cID=resp.cID}else{cID=CCM_CID}var action=CCM_TOOLS_PATH+"/edit_block_popup?cID="+cID+"&bID="+resp.bID+"&arHandle="+encodeURIComponent(resp.arHandle)+"&btask=view_edit_mode";$.get(action,function(r){if(task=="add"){if($("#ccm-add-new-block-placeholder").length>0){$("#ccm-add-new-block-placeholder").before(r).remove();saveArrangement(resp.bID,resp.aID,resp.aID)}else{$("#a"+resp.aID+" > div.ccm-area-block-list").append(r)}}else{$("[data-block-id="+currentBlockID+"][data-area-id="+resp.aID+"]").before(r).remove()}CCMInlineEditMode.exit();CCMToolbar.disableDirectExit();jQuery.fn.dialog.hideLoader();if(task=="add"){var tb=parseInt($("div.ccm-area[data-area-id="+resp.aID+"]").attr("data-total-blocks"));$("div.ccm-area[data-area-id="+resp.aID+"]").attr("data-total-blocks",tb+1);ccmAlert.hud(ccmi18n.addBlockMsg,2e3,"add",ccmi18n.addBlock);jQuery.fn.dialog.closeAll()}else{ccmAlert.hud(ccmi18n.updateBlockMsg,2e3,"success",ccmi18n.updateBlock)}CCMEditMode.start();$.fn.ccmmenu.reset();if(typeof window.ccm_parseBlockResponsePost=="function"){ccm_parseBlockResponsePost(resp)}})}}catch(e){ccmAlert.notice(ccmi18n.error,r)}},launchLayoutPresets:function(arLayoutID,token,task){var url=CCM_TOOLS_PATH+"/area/layout_presets?arLayoutID="+arLayoutID+"&ccm_token="+token;if(task){url+="&task="+task}jQuery.fn.dialog.open({width:280,height:200,href:url,title:ccmi18n.areaLayoutPresets,onOpen:function(){$("#ccm-layout-save-preset-form select").on("change",function(r){if($(this).val()=="-1"){$("#ccm-layout-save-preset-name").show().focus();$("#ccm-layout-save-preset-override").hide()}else{$("#ccm-layout-save-preset-name").hide();$("#ccm-layout-save-preset-override").show()}}).trigger("change");$("#ccm-layout-save-preset-form").on("submit",function(){$.fn.dialog.showLoader();var formdata=$("#ccm-layout-save-preset-form").serializeArray();formdata.push({name:"submit",value:1});$.ajax({url:url,type:"POST",data:formdata,dataType:"json",success:function(r){$.fn.dialog.hideLoader();$.fn.dialog.closeAll()}});return false})}})},activateBlockTypesOverlay:function(){$("#ccm-dialog-block-types .ccm-dialog-icon-item-grid-sets ul a").on("click",function(){$("#ccm-overlay-block-types li").hide();$("#ccm-overlay-block-types li[data-block-type-sets~="+$(this).attr("data-tab")+"]").show();$("#ccm-dialog-block-types .ccm-dialog-icon-item-grid-sets ul a").removeClass("active");$(this).addClass("active");return false});$($("#ccm-dialog-block-types ul a").get(0)).trigger("click");$("#ccm-dialog-block-types").closest(".ui-dialog-content").addClass("ui-dialog-content-icon-item-grid");$("#ccm-dialog-block-types .ccm-icon-item-grid-search input").focus();if($("#ccm-block-types-dragging").length==0){$('<div id="ccm-block-types-dragging" />').appendTo(document.body)}$("#ccm-add-new-block-placeholder").remove();$("#ccm-dialog-block-types .ccm-icon-item-grid-search input").liveUpdate("ccm-overlay-block-types .ccm-overlay-icon-item-grid-list");$("#ccm-dialog-block-types .ccm-icon-item-grid-search input").on("keyup",function(){if($(this).val()==""){$("#ccm-block-types-wrapper ul.nav-tabs").css("visibility","visible");$("#ccm-block-types-wrapper ul.nav-tabs li[class=active] a").click()}else{$("#ccm-block-types-wrapper ul.nav-tabs").css("visibility","hidden")}});$("#ccm-overlay-block-types a.ccm-overlay-draggable-block-type").each(function(){var $li=$(this);$li.css("cursor","move");$li.draggable({helper:"clone",appendTo:$("#ccm-block-types-dragging"),revert:false,start:function(e,ui){CCMEditMode.blockTypeDropSuccessful=false;$(".ccm-area-block-dropzone").addClass("ccm-area-block-dropzone-active");$("#ccm-block-types-wrapper").parent().jqdialog("option","closeOnEscape",false);$("#ccm-overlay-block-types").closest(".ui-dialog").fadeOut(100);$(".ui-widget-overlay").remove();$.fn.ccmmenu.disable()},stop:function(){$.fn.ccmmenu.enable();if(!CCMEditMode.blockTypeDropSuccessful){jQuery.fn.dialog.closeAll()}}})});$("a.ccm-overlay-clickable-block-type").on("click",function(){addBlockType($(this).attr("data-cID"),$(this).attr("data-area-id"),$(this).attr("data-area-handle"),$(this));return false})}}}();var ccm_totalAdvancedSearchFields=0;var ccm_alLaunchType=new Array;var ccm_alActiveAssetField="";var ccm_alProcessorTarget="";var ccm_alDebug=false;ccm_triggerSelectFile=function(fID,af){if(af==null){var af=ccm_alActiveAssetField}var obj=$("#"+af+"-fm-selected");var dobj=$("#"+af+"-fm-display");dobj.hide();obj.show();obj.load(CCM_TOOLS_PATH+"/files/selector_data?fID="+fID+"&ccm_file_selected_field="+af,function(){obj.attr("fID",fID);obj.attr("ccm-file-manager-can-view",obj.children("div").attr("ccm-file-manager-can-view"));obj.attr("ccm-file-manager-can-edit",obj.children("div").attr("ccm-file-manager-can-edit"));obj.attr("ccm-file-manager-can-admin",obj.children("div").attr("ccm-file-manager-can-admin"));obj.attr("ccm-file-manager-can-replace",obj.children("div").attr("ccm-file-manager-can-replace"));obj.attr("ccm-file-manager-instance",af);obj.click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});if(typeof ccm_triggerSelectFileComplete=="function"){ccm_triggerSelectFileComplete(fID,af)}ccm_event.publish("FileManagerFileSelected",{fID:fID,af:af})});var vobj=$("#"+af+"-fm-value");vobj.attr("value",fID);ccm_alSetupFileProcessor()};ccm_alGetFileData=function(fID,onComplete){$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?fID="+fID,onComplete)};ccm_clearFile=function(e,af){e.stopPropagation();var obj=$("#"+af+"-fm-selected");var dobj=$("#"+af+"-fm-display");var vobj=$("#"+af+"-fm-value");vobj.attr("value",0);obj.hide();dobj.show()};ccm_activateFileManager=function(altype,searchInstance){ccm_alLaunchType[searchInstance]=altype;ccm_alSetupSelectFiles(searchInstance);$(document).click(function(e){e.stopPropagation();ccm_alSelectNone()});ccm_setupAdvancedSearch(searchInstance);if(altype=="DASHBOARD"){$(".dialog-launch").dialog()}ccm_alSetupCheckboxes(searchInstance);ccm_alSetupFileProcessor();ccm_alSetupSingleUploadForm();$("form#ccm-"+searchInstance+"-advanced-search select[name=fssID]").change(function(){if(altype=="DASHBOARD"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/files/search?fssID="+$(this).val()}else{jQuery.fn.dialog.showLoader();var url=$("div#ccm-"+searchInstance+"-overlay-wrapper input[name=dialogAction]").val()+"&refreshDialog=1&fssID="+$(this).val();$.get(url,function(resp){jQuery.fn.dialog.hideLoader();$("div#ccm-"+searchInstance+"-overlay-wrapper").html(resp);$("div#ccm-"+searchInstance+"-overlay-wrapper a.dialog-launch").dialog()})}});ccm_searchActivatePostFunction[searchInstance]=function(){ccm_alSetupCheckboxes(searchInstance);ccm_alSetupSelectFiles(searchInstance);ccm_alSetupSingleUploadForm()}};ccm_alSetupSingleUploadForm=function(){$(".ccm-file-manager-submit-single").submit(function(){$(this).attr("target",ccm_alProcessorTarget);ccm_alSubmitSingle($(this).get(0))})};ccm_activateFileSelectors=function(){$(".ccm-file-manager-launch").unbind();$(".ccm-file-manager-launch").click(function(){ccm_alLaunchSelectorFileManager($(this).parent().attr("ccm-file-manager-field"))})};ccm_alLaunchSelectorFileManager=function(selector){ccm_alActiveAssetField=selector;var filterStr="";var types=$("#"+selector+"-fm-display input.ccm-file-manager-filter");if(types.length){for(i=0;i<types.length;i++){filterStr+="&"+$(types[i]).attr("name")+"="+$(types[i]).attr("value")}}ccm_launchFileManager(filterStr)};ccm_launchFileManager=function(filters){$.fn.dialog.open({width:"90%",height:"70%",appendButtons:true,onOpen:function(){ccm_event.publish("launchFileManager",ccm_alActiveAssetField)},modal:false,href:CCM_TOOLS_PATH+"/files/search_dialog?ocID="+CCM_CID+"&search=1"+filters,title:ccmi18n_filemanager.title})};ccm_launchFileSetPicker=function(fsID){$.fn.dialog.open({width:500,height:160,modal:false,href:CCM_TOOLS_PATH+"/files/pick_set?oldFSID="+fsID,title:ccmi18n_filemanager.sets})};ccm_alSubmitSetsForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-add-to-set-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();
jQuery.fn.dialog.hideLoader();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){$(".chosen-select").chosen();ccm_parseAdvancedSearchResponse(resp,searchInstance)})})})};ccm_alSubmitPasswordForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-password-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})};ccm_alSubmitStorageForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-storage-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})};ccm_alSubmitPermissionsForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-permissions-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})};ccm_alSetupSetsForm=function(searchInstance){$("#fsAddToSearchName").liveUpdate("ccm-file-search-add-to-sets-list","fileset");$(".ccm-file-set-add-cb a").each(function(){var cb=$(this);var startingState=cb.attr("ccm-tri-state-startup");$(this).click(function(){var selectedState=$(this).attr("ccm-tri-state-selected");var toSetState=0;switch(selectedState){case"0":if(startingState=="1"){toSetState="1"}else{toSetState="2"}break;case"1":toSetState="2";break;case"2":toSetState="0";break}$(this).attr("ccm-tri-state-selected",toSetState);$(this).parent().find("input").val(toSetState);$(this).find("img").attr("src",CCM_IMAGE_PATH+"/checkbox_state_"+toSetState+".png")})});$("#ccm-"+searchInstance+"-add-to-set-form input[name=fsNew]").click(function(){if(!$(this).prop("checked")){$("#ccm-"+searchInstance+"-add-to-set-form input[name=fsNewText]").val("")}});$("#ccm-"+searchInstance+"-add-to-set-form").submit(function(){ccm_alSubmitSetsForm(searchInstance);return false})};ccm_alSetupPasswordForm=function(){$("#ccm-file-password-form").submit(function(){ccm_alSubmitPasswordForm();return false})};ccm_alRescanFiles=function(){var turl=CCM_TOOLS_PATH+"/files/rescan?";var files=arguments;for(i=0;i<files.length;i++){turl+="fID[]="+files[i]+"&"}$.fn.dialog.open({title:ccmi18n_filemanager.rescan,href:turl,width:350,modal:false,height:200,onClose:function(){if(files.length==1){$("#ccm-file-properties-wrapper").html("");jQuery.fn.dialog.showLoader();$("#ccm-file-properties-wrapper").load(CCM_TOOLS_PATH+"/files/properties?fID="+files[0]+"&reload=1",false,function(){jQuery.fn.dialog.hideLoader();$(this).find(".dialog-launch").dialog()})}}})};ccm_alSelectPermissionsEntity=function(selector,id,name){var html=$("#ccm-file-permissions-entity-base").html();$("#ccm-file-permissions-entities-wrapper").append('<div class="ccm-file-permissions-entity">'+html+"</div>");var p=$(".ccm-file-permissions-entity");var ap=p[p.length-1];$(ap).find("h3 span").html(name);$(ap).find("input[type=hidden]").val(selector+"_"+id);$(ap).find("select").each(function(){$(this).attr("name",$(this).attr("name")+"_"+selector+"_"+id)});$(ap).find("div.ccm-file-access-extensions input[type=checkbox]").each(function(){$(this).attr("name",$(this).attr("name")+"_"+selector+"_"+id+"[]")});ccm_alActivateFilePermissionsSelector()};ccm_alActivateFilePermissionsSelector=function(){$(".ccm-file-access-add select").unbind();$(".ccm-file-access-add select").change(function(){var p=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()==ccmi18n_filemanager.PTYPE_CUSTOM){$(p).find("div.ccm-file-access-add-extensions").show()}else{$(p).find("div.ccm-file-access-add-extensions").hide()}});$(".ccm-file-access-file-manager select").change(function(){var p=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()!=ccmi18n_filemanager.PTYPE_NONE){$(p).find(".ccm-file-access-add").show();$(p).find(".ccm-file-access-edit").show();$(p).find(".ccm-file-access-admin").show()}else{$(p).find(".ccm-file-access-add").hide();$(p).find(".ccm-file-access-edit").hide();$(p).find(".ccm-file-access-admin").hide();$(p).find("div.ccm-file-access-add-extensions").hide()}});$("a.ccm-file-permissions-remove").click(function(){$(this).parent().parent().fadeOut(100,function(){$(this).remove()})});$("input[name=toggleCanAddExtension]").unbind();$("input[name=toggleCanAddExtension]").click(function(){var ext=$(this).parent().parent().find("div.ccm-file-access-extensions");if($(this).prop("checked")==1){ext.find("input").attr("checked",true)}else{ext.find("input").attr("checked",false)}})};ccm_alSetupVersionSelector=function(){$("#ccm-file-versions-grid input[type=radio]").click(function(){$("#ccm-file-versions-grid tr").removeClass("ccm-file-versions-grid-active");var trow=$(this).parent().parent();var fID=trow.attr("fID");var fvID=trow.attr("fvID");var postStr="task=approve_version&fID="+fID+"&fvID="+fvID;$.post(CCM_TOOLS_PATH+"/files/properties",postStr,function(resp){trow.addClass("ccm-file-versions-grid-active");trow.find("td").show("highlight",{color:"#FFF9BB"})})});$(".ccm-file-versions-remove").click(function(){var trow=$(this).parent().parent();var fID=trow.attr("fID");var fvID=trow.attr("fvID");var postStr="task=delete_version&fID="+fID+"&fvID="+fvID;$.post(CCM_TOOLS_PATH+"/files/properties",postStr,function(resp){trow.fadeOut(200,function(){trow.remove()})});return false})};ccm_alDeleteFiles=function(searchInstance){$("#ccm-"+searchInstance+"-delete-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})})};ccm_alDuplicateFiles=function(searchInstance){$("#ccm-"+searchInstance+"-duplicate-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);var r=eval("("+resp+")");$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance);var highlight=new Array;for(i=0;i<r.fID.length;i++){fID=r.fID[i];ccm_uploadedFiles.push(fID);highlight.push(fID)}ccm_alRefresh(highlight,searchInstance);ccm_filesUploadedDialog(searchInstance)})})})};ccm_alSetupSelectFiles=function(searchInstance){$(".ccm-file-list").unbind();$(".ccm-file-list tr.ccm-list-record").click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});$(".ccm-file-list img.ccm-star").click(function(e){e.stopPropagation();var fID=$(e.target).parents("tr.ccm-list-record")[0].id;fID=fID.substring(3);ccm_starFile(e.target,fID)});if(ccm_alLaunchType[searchInstance]=="DASHBOARD"){$(".ccm-file-list-thumbnail").hover(function(e){var fID=$(this).attr("fID");var obj=$("#fID"+fID+"hoverThumbnail");if(obj.length>0){var tdiv=obj.find("div");var pos=obj.position();tdiv.css("top",pos.top);tdiv.css("left",pos.left);tdiv.show()}},function(){var fID=$(this).attr("fID");var obj=$("#fID"+fID+"hoverThumbnail");var tdiv=obj.find("div");tdiv.hide()})}};ccm_alSetupCheckboxes=function(searchInstance){$("#ccm-"+searchInstance+"-list-cb-all").unbind();$("#ccm-"+searchInstance+"-list-cb-all").click(function(){ccm_hideMenus();if($(this).prop("checked")==true){$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",true)}});$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]").click(function(e){e.stopPropagation();ccm_hideMenus();ccm_alRescanMultiFileMenu(searchInstance)});$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb").click(function(e){e.stopPropagation();ccm_hideMenus();$(this).find("input[type=checkbox]").click();ccm_alRescanMultiFileMenu(searchInstance)});if(ccm_alLaunchType[searchInstance]!="DASHBOARD"&&ccm_alLaunchType[searchInstance]!="BROWSE"){var chooseText=ccmi18n_filemanager.select;$("#ccm-"+searchInstance+"-list-multiple-operations option:eq(0)").after('<option value="choose">'+chooseText+"</option>")}$("#ccm-"+searchInstance+"-list-multiple-operations").change(function(){var action=$(this).val();var fIDstring=ccm_alGetSelectedFileIDs(searchInstance);switch(action){case"choose":var fIDs=new Array;$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){fIDs.push($(this).val())});ccm_alSelectFile(fIDs,true);break;case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/files/delete?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.deleteFile});break;case"duplicate":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/duplicate?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.duplicateFile});break;case"sets":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/add_to?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.sets});break;case"properties":jQuery.fn.dialog.open({width:690,height:440,modal:false,href:CCM_TOOLS_PATH+"/files/bulk_properties?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n.properties});break;case"rescan":jQuery.fn.dialog.open({width:350,height:200,modal:false,href:CCM_TOOLS_PATH+"/files/rescan?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.rescan,onClose:function(){$("#ccm-"+searchInstance+"-advanced-search").submit()}});break;case"download":window.frames[ccm_alProcessorTarget].location=CCM_TOOLS_PATH+"/files/download?"+fIDstring;break}$(this).get(0).selectedIndex=0});ccm_alSetupFileSetSearch(searchInstance)};ccm_alSetupFileSetSearch=function(searchInstance){$("#ccm-"+searchInstance+"-sets-search-wrapper select").chosen().unbind();$("#ccm-"+searchInstance+"-sets-search-wrapper select").chosen().change(function(){var sel=$("#ccm-"+searchInstance+"-sets-search-wrapper option:selected");$("#ccm-"+searchInstance+"-advanced-search").submit()})};ccm_alGetSelectedFileIDs=function(searchInstance){var fidstr="";$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){fidstr+="fID[]="+$(this).val()+"&"});return fidstr};ccm_alRescanMultiFileMenu=function(searchInstance){if($("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").length>0){$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",true)}};ccm_alSetupFileProcessor=function(){if(ccm_alProcessorTarget!=""){return false}var ts=parseInt((new Date).getTime().toString().substring(0,10));var ifr;try{ifr=document.createElement('<iframe name="ccm-al-upload-processor'+ts+'">')}catch(ex){ifr=document.createElement("iframe")}ifr.id="ccm-al-upload-processor"+ts;ifr.name="ccm-al-upload-processor"+ts;ifr.style.border="0px";ifr.style.width="0px";ifr.style.height="0px";ifr.style.display="none";document.body.appendChild(ifr);if(ccm_alDebug){ccm_alProcessorTarget="_blank"}else{ccm_alProcessorTarget="ccm-al-upload-processor"+ts}};ccm_alSubmitSingle=function(form){if($(form).find(".ccm-al-upload-single-file").val()==""){return false}else{$(form).find(".ccm-al-upload-single-submit").hide();$(form).find(".ccm-al-upload-single-loader").show()}};ccm_alResetSingle=function(){$(".ccm-al-upload-single-file").val("");$(".ccm-al-upload-single-loader").hide();$(".ccm-al-upload-single-submit").show()};var ccm_uploadedFiles=[];ccm_filesUploadedDialog=function(searchInstance){if(document.getElementById("ccm-file-upload-multiple-tab"))jQuery.fn.dialog.closeTop();var fIDstring="";for(var i=0;i<ccm_uploadedFiles.length;i++)fIDstring=fIDstring+"&fID[]="+ccm_uploadedFiles[i];jQuery.fn.dialog.open({width:690,height:440,modal:false,href:CCM_TOOLS_PATH+"/files/bulk_properties/?"+fIDstring+"&uploaded=true&searchInstance="+searchInstance,onClose:function(){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})},title:ccmi18n_filemanager.uploadComplete});ccm_uploadedFiles=[]};ccm_alSetupUploadDetailsForm=function(searchInstance){$("#ccm-"+searchInstance+"-update-uploaded-details-form").submit(function(){ccm_alSubmitUploadDetailsForm(searchInstance);return false})};ccm_alSubmitUploadDetailsForm=function(searchInstance){jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-update-uploaded-details-form").ajaxSubmit(function(r1){var r1a=eval("("+r1+")");var form=$("#ccm-"+searchInstance+"-advanced-search");if(form.length>0){form.ajaxSubmit(function(resp){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop();ccm_parseAdvancedSearchResponse(resp,searchInstance);ccm_alHighlightFileIDArray(r1a)})})}else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop()}})};ccm_alRefresh=function(highlightFIDs,searchInstance,fileSelector){var ids=highlightFIDs;ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-search-results").load(CCM_TOOLS_PATH+"/files/search_results",{ccm_order_by:"fvDateAdded",ccm_order_dir:"desc",fileSelector:fileSelector,searchType:ccm_alLaunchType[searchInstance],searchInstance:searchInstance},function(){ccm_activateSearchResults(searchInstance);if(ids!=false){ccm_alHighlightFileIDArray(ids)}ccm_alSetupSelectFiles(searchInstance)})};ccm_alHighlightFileIDArray=function(ids){for(i=0;i<ids.length;i++){var td=$("tr[fID="+ids[i]+"] td");var oldBG=td.css("backgroundColor");td.animate({backgroundColor:"#FFF9BB"},{queue:true,duration:1e3}).animate({backgroundColor:oldBG},500)}};ccm_alSelectFile=function(fID){if(typeof ccm_chooseAsset=="function"){var qstring="";if(typeof fID=="object"){for(i=0;i<fID.length;i++){qstring+="fID[]="+fID[i]+"&"}}else{qstring+="fID="+fID}$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?"+qstring,function(resp){ccm_parseJSON(resp,function(){for(i=0;i<resp.length;i++){ccm_chooseAsset(resp[i])}jQuery.fn.dialog.closeTop()})})}else{if(typeof fID=="object"){for(i=0;i<fID.length;i++){ccm_triggerSelectFile(fID[i])}}else{ccm_triggerSelectFile(fID)}jQuery.fn.dialog.closeTop()}};ccm_alActivateMenu=function(obj,e){var selectedFile=$(obj).find("div[ccm-file-manager-field]");var selector="";if(selectedFile.length>0){selector=selectedFile.attr("ccm-file-manager-field")}if(!selector){selector=ccm_alActiveAssetField}ccm_hideMenus();var fID=$(obj).attr("fID");var searchInstance=$(obj).attr("ccm-file-manager-instance");var bobj=document.getElementById("ccm-al-menu"+fID+searchInstance+selector);if(!bobj){el=document.createElement("DIV");el.id="ccm-al-menu"+fID+searchInstance+selector;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);var passedFilters=$("div[ccm-file-manager-field="+selector+"] input.ccm-file-manager-filter");var filterStr="";if(passedFilters.length>0){passedFilters.each(function(){filterStr+="&"+$(this).attr("name")+"="+$(this).attr("value")})}var filepath=$(obj).attr("al-filepath");bobj=$("#ccm-al-menu"+fID+searchInstance+selector);bobj.css("position","absolute");var html='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';html+="<ul>";if(ccm_alLaunchType[searchInstance]!="DASHBOARD"&&ccm_alLaunchType[searchInstance]!="BROWSE"){var onclick=selectedFile.length>0?"ccm_alLaunchSelectorFileManager('"+selector+"')":"ccm_alSelectFile("+fID+")";var chooseText=selectedFile.length>0?ccmi18n_filemanager.chooseNew:ccmi18n_filemanager.select;html+='<li><a class="ccm-menu-icon ccm-icon-choose-file-menu" dialog-modal="false" dialog-width="90%" dialog-height="70%" dialog-title="'+ccmi18n_filemanager.select+'" id="menuSelectFile'+fID+'" href="javascript:void(0)" onclick="'+onclick+'">'+chooseText+"</a></li>"}if(selectedFile.length>0){html+='<li><a class="ccm-menu-icon ccm-icon-clear-file-menu" href="javascript:void(0)" id="menuClearFile'+fID+searchInstance+selector+'">'+ccmi18n_filemanager.clear+"</a></li>"}if(ccm_alLaunchType[searchInstance]!="DASHBOARD"&&ccm_alLaunchType[searchInstance]!="BROWSE"&&selectedFile.length>0){html+='<li class="ccm-menu-separator"></li>'}if($(obj).attr("ccm-file-manager-can-view")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-view dialog-launch" dialog-modal="false" dialog-append-buttons="true" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.view+'" id="menuView'+fID+'" href="'+CCM_TOOLS_PATH+"/files/view?fID="+fID+'">'+ccmi18n_filemanager.view+"</a></li>"}else{html+='<li><a class="ccm-menu-icon ccm-icon-download-menu" href="javascript:void(0)" id="menuDownload'+fID+'" onclick="window.frames[\''+ccm_alProcessorTarget+"'].location='"+CCM_TOOLS_PATH+"/files/download?fID="+fID+"'\">"+ccmi18n_filemanager.download+"</a></li>"}if($(obj).attr("ccm-file-manager-can-edit")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-edit-menu dialog-launch" dialog-modal="false" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.edit+'" id="menuEdit'+fID+'" href="'+CCM_TOOLS_PATH+"/files/edit?searchInstance="+searchInstance+"&fID="+fID+filterStr+'">'+ccmi18n_filemanager.edit+"</a></li>"}html+='<li><a class="ccm-menu-icon ccm-icon-properties-menu dialog-launch" dialog-modal="false" dialog-width="680" dialog-height="450" dialog-title="'+ccmi18n_filemanager.properties+'" id="menuProperties'+fID+'" href="'+CCM_TOOLS_PATH+"/files/properties?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.properties+"</a></li>";if($(obj).attr("ccm-file-manager-can-replace")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-replace dialog-launch" dialog-modal="false" dialog-width="300" dialog-height="260" dialog-title="'+ccmi18n_filemanager.replace+'" id="menuFileReplace'+fID+'" href="'+CCM_TOOLS_PATH+"/files/replace?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.replace+"</a></li>"}if($(obj).attr("ccm-file-manager-can-duplicate")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-copy-menu" id="menuFileDuplicate'+fID+'" href="javascript:void(0)" onclick="ccm_alDuplicateFile('+fID+",'"+searchInstance+"')\">"+ccmi18n_filemanager.duplicate+"</a></li>"}html+='<li><a class="ccm-menu-icon ccm-icon-sets dialog-launch" dialog-modal="false" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.sets+'" id="menuFileSets'+fID+'" href="'+CCM_TOOLS_PATH+"/files/add_to?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.sets+"</a></li>";if($(obj).attr("ccm-file-manager-can-admin")=="1"||$(obj).attr("ccm-file-manager-can-delete")=="1"){html+='<li class="ccm-menu-separator"></li>'}if($(obj).attr("ccm-file-manager-can-admin")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-access-permissions dialog-launch" dialog-modal="false" dialog-width="400" dialog-height="450" dialog-title="'+ccmi18n_filemanager.permissions+'" id="menuFilePermissions'+fID+'" href="'+CCM_TOOLS_PATH+"/files/permissions?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.permissions+"</a></li>"}if($(obj).attr("ccm-file-manager-can-delete")=="1"){html+='<li><a class="ccm-icon-delete-menu ccm-menu-icon dialog-launch" dialog-append-buttons="true" dialog-modal="false" dialog-width="500" dialog-height="200" dialog-title="'+ccmi18n_filemanager.deleteFile+'" id="menuDeleteFile'+fID+'" href="'+CCM_TOOLS_PATH+"/files/delete?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.deleteFile+"</a></li>"}html+="</ul>";html+="</div></div></div>";bobj.append(html);$(bobj).find("a").bind("click.hide-menu",function(e){ccm_hideMenus();return false});$("#ccm-al-menu"+fID+searchInstance+selector+" a.dialog-launch").dialog();$("a#menuClearFile"+fID+searchInstance+selector).click(function(e){ccm_clearFile(e,selector);ccm_hideMenus()})}else{bobj=$("#ccm-al-menu"+fID+searchInstance+selector)}ccm_fadeInMenu(bobj,e)};ccm_alSelectNone=function(){ccm_hideMenus()};var checkbox_status=false;toggleCheckboxStatus=function(form){if(checkbox_status){for(i=0;i<form.elements.length;i++){if(form.elements[i].type=="checkbox"){form.elements[i].checked=false}}checkbox_status=false}else{for(i=0;i<form.elements.length;i++){if(form.elements[i].type=="checkbox"){form.elements[i].checked=true}}checkbox_status=true}};ccm_alDuplicateFile=function(fID,searchInstance){var postStr="fID="+fID+"&searchInstance="+searchInstance;$.post(CCM_TOOLS_PATH+"/files/duplicate",postStr,function(resp){var r=eval("("+resp+")");if(r.error==1){ccmAlert.notice(ccmi18n.error,r.message);return false}var highlight=new Array;if(r.fID){highlight.push(r.fID);ccm_alRefresh(highlight,searchInstance);ccm_uploadedFiles.push(r.fID);ccm_filesUploadedDialog(searchInstance)}})};ccm_alSelectMultipleIncomingFiles=function(obj){if($(obj).prop("checked")){$("input.ccm-file-select-incoming").attr("checked",true)}else{$("input.ccm-file-select-incoming").attr("checked",false)}};ccm_starFile=function(img,fID){var action="";if($(img).attr("src").indexOf(CCM_STAR_STATES.unstarred)!=-1){$(img).attr("src",$(img).attr("src").replace(CCM_STAR_STATES.unstarred,CCM_STAR_STATES.starred));action="star"}else{$(img).attr("src",$(img).attr("src").replace(CCM_STAR_STATES.starred,CCM_STAR_STATES.unstarred));action="unstar"}$.post(CCM_TOOLS_PATH+"/"+CCM_STAR_ACTION,{action:action,"file-id":fID},function(data,textStatus){})};jQuery.cookie=function(name,value,options){if(typeof value!="undefined"){options=options||{};if(value===null){value="";options=$.extend({},options);options.expires=-1}var expires="";if(options.expires&&(typeof options.expires=="number"||options.expires.toUTCString)){var date;if(typeof options.expires=="number"){date=new Date;date.setTime(date.getTime()+options.expires*24*60*60*1e3)}else{date=options.expires}expires="; expires="+date.toUTCString()}var path=options.path?"; path="+options.path:"";var domain=options.domain?"; domain="+options.domain:"";var secure=options.secure?"; secure":"";document.cookie=[name,"=",encodeURIComponent(value),expires,path,domain,secure].join("")}else{var cookieValue=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}};$.widget.bridge("jqdialog",$.ui.dialog);jQuery.fn.dialog=function(){if(arguments.length>0){$(this).jqdialog(arguments[0],arguments[1],arguments[2]);return}else if($(this).is("div")){$(this).jqdialog();return}return $(this).each(function(){$(this).unbind("click.make-dialog").bind("click.make-dialog",function(e){var href=$(this).attr("href");var width=$(this).attr("dialog-width");var height=$(this).attr("dialog-height");var title=$(this).attr("dialog-title");var onOpen=$(this).attr("dialog-on-open");var onDestroy=$(this).attr("dialog-on-destroy");var onClose=$(this).attr("dialog-on-close");var onDirectClose=$(this).attr("dialog-on-direct-close");obj={modal:true,href:href,width:width,height:height,title:title,onOpen:onOpen,onDestroy:onDestroy,onClose:onClose,onDirectClose:onDirectClose};jQuery.fn.dialog.open(obj);return false})})};jQuery.fn.dialog.close=function(num){num++;$("#ccm-dialog-content"+num).jqdialog("close")};jQuery.fn.dialog.open=function(options){if(typeof $.fn.ccmmenu!="undefined"){$.fn.ccmmenu.hide()}if(typeof options.width=="string"){if(options.width=="auto"){w="auto"}else{if(options.width.indexOf("%",0)>0){w=options.width.replace("%","");w=$(window).width()*(w/100);w=w+50}else{w=parseInt(options.width)+50}}}else if(options.width){w=parseInt(options.width)+50}else{w=550}if(typeof options.height=="string"){if(options.height=="auto"){h="auto"}else{if(options.height.indexOf("%",0)>0){h=options.height.replace("%","");h=$(window).height()*(h/100);h=h+100}else{h=parseInt(options.height)+100}}}else if(options.height){h=parseInt(options.height)+100}else{h=400}if(h!=="auto"&&h>$(window).height()){h=$(window).height()}options.width=w;options.height=h;var defaults={modal:true,escapeClose:true,width:w,height:h,create:function(){$(this).parent().addClass("ccm-dialog-opening")},open:function(){var $dialog=$(this);$dialog.parent().addClass("ccm-dialog-open");var nd=$(".ui-dialog").length;if(nd==1){$("body").attr("data-last-overflow",$("body").css("overflow"));$("body").css("overflow","hidden")}var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(i,obj){if(i+1<overlays){$(this).css("opacity",0)}});jQuery.fn.dialog.activateDialogContents($dialog);if(typeof options.onOpen!="undefined"){if(typeof options.onOpen=="function"){options.onOpen($dialog)}else{$.proxy(options.onOpen,$dialog)}}},beforeClose:function(){var nd=$(".ui-dialog").length;if(nd==1){$("body").css("overflow",$("body").attr("data-last-overflow"))}},close:function(ev,u){$(this).jqdialog("destroy").remove();if(typeof options.onClose!="undefined"){if(typeof options.onClose=="function"){options.onClose()}else{eval(options.onClose)}}if(typeof options.onDirectClose!="undefined"&&ev.handleObj&&(ev.handleObj.type=="keydown"||ev.handleObj.type=="click")){if(typeof options.onDirectClose=="function"){options.onDirectClose()}else{eval(options.onDirectClose)}}if(typeof options.onDestroy!="undefined"){if(typeof options.onDestroy=="function"){options.onDestroy()}else{eval(options.onDestroy)}}var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(i,obj){if(i+1<overlays){$(this).css("opacity",0)}else{$(this).css("opacity",1)}})}};var finalSettings={autoOpen:false};$.extend(finalSettings,defaults,options);if(finalSettings.element){finalSettings.element.jqdialog(finalSettings).jqdialog("open")}else{jQuery.fn.dialog.showLoader();$.ajax({type:"GET",url:finalSettings.href,success:function(r){jQuery.fn.dialog.hideLoader();$("<div />").jqdialog(finalSettings).html(r).jqdialog("open")}})}};jQuery.fn.dialog.activateDialogContents=function($dialog){if($dialog.find(".dialog-buttons").length>0){$dialog.jqdialog("option","buttons",[{}]);$dialog.parent().find(".ui-dialog-buttonset").remove();$dialog.parent().find(".ui-dialog-buttonpane").html("");$dialog.find(".dialog-buttons").appendTo($dialog.parent().find(".ui-dialog-buttonpane").addClass("ccm-ui"))}$dialog.find(".dialog-launch").dialog();$dialog.find(".ccm-dialog-close").on("click",function(){$dialog.dialog("close")});if($("#tooltip-holder").length==0){$("<div />").attr("id","tooltip-holder").attr("class","ccm-ui").prependTo(document.body)}if($dialog.find(".dialog-help").length>0){$dialog.find(".dialog-help").hide();var helpContent=$dialog.find(".dialog-help").html();if(ccmi18n.helpPopup){var helpText=ccmi18n.helpPopup}else{var helpText="Help"}$dialog.parent().find(".ui-dialog-titlebar").addClass("ccm-ui").append('<button class="ui-dialog-titlebar-help ccm-menu-help-trigger"><i class="icon-info-sign"></i></button>');$dialog.parent().find(".ui-dialog-titlebar .ccm-menu-help-trigger").popover({content:function(){return helpContent},placement:"bottom",html:true,container:"#tooltip-holder",trigger:"click"})}};jQuery.fn.dialog.getTop=function(){var nd=$(".ui-dialog").length;return $($(".ui-dialog-content")[nd-1])};jQuery.fn.dialog.replaceTop=function(html){$dialog=jQuery.fn.dialog.getTop();$dialog.html(html);jQuery.fn.dialog.activateDialogContents($dialog)};jQuery.fn.dialog.showLoader=function(text){if($("#ccm-dialog-loader").length<1){$("body").append("<div id='ccm-dialog-loader-wrapper' class='ccm-ui'><div class='progress progress-striped active' style='width: 300px'><div class='bar' style='width: 100%;'></div></div></div>")}if(text!=null){$("#ccm-dialog-loader-text",$("#ccm-dialog-loader-wrapper")).remove();$("<div />").attr("id","ccm-dialog-loader-text").html(text).prependTo($("#ccm-dialog-loader-wrapper"))}var w=$("#ccm-dialog-loader-wrapper").width();var h=$("#ccm-dialog-loader-wrapper").height();var tw=$(window).width();var th=$(window).height();var _left=(tw-w)/2;var _top=(th-h)/2;$("#ccm-dialog-loader-wrapper").css("left",_left+"px").css("top",_top+"px");$("#ccm-dialog-loader-wrapper").show()};jQuery.fn.dialog.hideLoader=function(){$("#ccm-dialog-loader-wrapper").hide();$("#ccm-dialog-loader-text").remove()};jQuery.fn.dialog.closeTop=function(){$dialog=jQuery.fn.dialog.getTop();$dialog.jqdialog("close")};jQuery.fn.dialog.closeAll=function(){$($(".ui-dialog-content").get().reverse()).jqdialog("close")};var ccmAlert={notice:function(title,message,onCloseFn){$.fn.dialog.open({href:CCM_TOOLS_PATH+"/alert",title:title,width:320,height:160,modal:false,onOpen:function(){$("#ccm-popup-alert-message").html(message)},onDestroy:onCloseFn})},hud:function(message,time,icon,title){if($("#ccm-notification-inner").length==0){$(document.body).append('<div id="ccm-notification" class="ccm-ui"><div id="ccm-notification-inner"></div></div>')}if(icon==null){icon="edit_small"}if(title==null){var messageText=message}else{var messageText="<h3>"+title+"</h3>"+message}$("#ccm-notification-inner").html('<img id="ccm-notification-icon" src="'+CCM_IMAGE_PATH+"/icons/"+icon+'.png" width="16" height="16" /><div id="ccm-notification-message">'+messageText+"</div>");$("#ccm-notification").show();if(time>0){setTimeout(function(){$("#ccm-notification").fadeOut({easing:"easeOutExpo",duration:300})},time)}}};ccm_closeNewsflow=function(r){$ovl=ccm_getNewsflowOverlayWindow();$ovl.fadeOut(300,"easeOutExpo");$(".ui-widget-overlay").fadeOut(300,"easeOutExpo",function(){$(this).remove()})};ccm_setNewsflowPagingArrowHeight=function(){if($("#ccm-marketplace-detail").length>0){var $ovl=$("#ccm-marketplace-detail")}else{var $ovl=$("#newsflow-main")}var h=$ovl.height();$(".newsflow-paging-previous a, .newsflow-paging-next a").css("height",h+"px");$(".newsflow-paging-previous, .newsflow-paging-next").css("height",h+"px");$(".newsflow-paging-next").show();$(".newsflow-paging-previous").show()};ccm_setNewsflowOverlayDimensions=function(){if($("#newsflow-overlay").length>0){var w=$("#newsflow-overlay").width();var tw=$(window).width();var th=$(window).height();var optimalHeight=650;var availableSpace=th-80;if(availableSpace>optimalHeight){h=optimalHeight}else{h=availableSpace}$("#newsflow-overlay").css("height",optimalHeight);var _left=(tw-w)/2;var _top=(th-h)/2;_top=_top+29;_left=_left+"px";_top=_top+"px";$("#newsflow-overlay").css("left",_left).css("top",_top)}};ccm_getNewsflowOverlayWindow=function(){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0&&$("#newsflow-overlay").length==0){var $ovl=$("#newsflow-main").parent()}else{if($("#newsflow-overlay").length>0){var $ovl=$("#newsflow-overlay")}else{var $ovl=$("<div />").attr("id","newsflow-overlay").attr("class","ccm-ui").css("display","none").appendTo(document.body)}}return $ovl};ccm_showNewsflowOverlayWindow=function(url,callback){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0){}else{if($(".ui-widget-overlay").length<1){var $overlay=$('<div class="ui-widget-overlay"></div>').hide().appendTo("body")}$(".ui-widget-overlay").show()}$(window).resize(function(){ccm_setNewsflowOverlayDimensions()});$ovl=ccm_getNewsflowOverlayWindow();$ovl.load(url,function(){$ovl.hide();$(".newsflow-paging-next").hide();$(".newsflow-paging-previous").hide();$ovl.html($(this).html());if(callback){callback()}ccm_setNewsflowOverlayDimensions();
ccm_setupTrickleUpNewsflowStyles();$ovl.fadeIn("300","easeOutExpo",function(){ccm_setNewsflowPagingArrowHeight()})})};ccm_setupTrickleUpNewsflowStyles=function(){ovl=ccm_getNewsflowOverlayWindow();ovl.find(".newsflow-em1").each(function(){$(this).parent().addClass("newsflow-em1")})};ccm_showDashboardNewsflowWelcome=function(){jQuery.fn.dialog.showLoader(ccmi18n.newsflowLoading);ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/home?_ccm_dashboard_external=1",function(){jQuery.fn.dialog.hideLoader()})};ccm_showNewsflowOffsite=function(id){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cID="+id,function(){jQuery.fn.dialog.hideLoader()})};ccm_showAppIntroduction=function(){ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/welcome?_ccm_dashboard_external=1")};ccm_getNewsflowByPath=function(path){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cPath="+path,function(){jQuery.fn.dialog.hideLoader()})};ccm_doPageReindexing=function(){$.get(CCM_TOOLS_PATH+"/reindex_pending_pages?ccm_token="+CCM_SECURITY_TOKEN)};$.fn.ccmmenu=function(){$.fn.ccmmenu.enable();return $.each($(this),function(i,obj){var $this=$(obj),$menulauncher;if(!$this.prop("has-menu")){$this.prop("has-menu",true);if(!$this.attr("data-menu-handle")){$menulauncher=$this}else{$menulauncher=$($this.attr("data-menu-handle"))}var $menu=$("#"+$this.attr("data-menu"));$this.$menu=$menu;$this.highlightClass=$this.attr("data-menu-highlight-class");$this.highlightOffset=9;if($this.attr("data-menu-highlight-offset")){$this.highlightOffset=$this.attr("data-menu-highlight-offset")}$menulauncher.on("mousemove.ccmmenu",function(e){e.stopPropagation();$.fn.ccmmenu.over(e,$this,$(this))})}})};$.fn.ccmmenu.resetHighlight=function(){$.fn.ccmmenu.$highlighter.hide();$("[data-menu-highlight-class]").each(function(){var className=$(this).attr("data-menu-highlight-class");$("."+className).removeClass(className)})};$.fn.ccmmenu.highlight=function($obj){var offset=$obj.offset();var t=offset.top-$.fn.ccmmenu.$overmenu.highlightOffset;var l=offset.left-$.fn.ccmmenu.$overmenu.highlightOffset;var w=$obj.outerWidth()+$.fn.ccmmenu.$overmenu.highlightOffset*2;var h=$obj.outerHeight()+$.fn.ccmmenu.$overmenu.highlightOffset*2;$.fn.ccmmenu.$highlighter.css("width",w).css("height",h).css("top",t).css("left",l).css("border-top-left-radius",$obj.css("border-top-left-radius")).css("border-bottom-left-radius",$obj.css("border-bottom-left-radius")).css("border-top-right-radius",$obj.css("border-top-right-radius")).css("border-bottom-right-radius",$obj.css("border-bottom-right-radius")).removeClass().addClass($.fn.ccmmenu.$overmenu.highlightClass);$.fn.ccmmenu.$highlighter.show()};$.fn.ccmmenu.out=function(e){if(!$.fn.ccmmenu.isactive){$.fn.ccmmenu.$proxy.css("opacity",0);$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$(".ccm-menu-item-active").removeClass("ccm-menu-item-active")}};$.fn.ccmmenu.reset=function(){$.fn.ccmmenu.disable();$.fn.ccmmenu.enable()};$.fn.ccmmenu.enable=function(){$.fn.ccmmenu.isenabled=true;if($("#ccm-menu-click-proxy").length==0){$(document.body).append($("<div />",{id:"ccm-menu-click-proxy"}))}if($("#ccm-menu-highlighter").length==0){$(document.body).append($("<div />",{id:"ccm-menu-highlighter"}))}if($("#ccm-popover-menu-container").length==0){$(document.body).append($("<div />",{id:"ccm-popover-menu-container","class":"ccm-ui"}))}$.fn.ccmmenu.$proxy=$("#ccm-menu-click-proxy");$.fn.ccmmenu.$highlighter=$("#ccm-menu-highlighter");$.fn.ccmmenu.$holder=$("#ccm-popover-menu-container");$.fn.ccmmenu.$proxy.on("mouseout.clickproxy",function(e){$.fn.ccmmenu.out(e)});$.fn.ccmmenu.$proxy.on("mouseover.clickproxy",function(e){$.fn.ccmmenu.over(e)});$.fn.ccmmenu.$proxy.unbind("click.clickproxy").on("click.clickproxy",function(e){$.fn.ccmmenu.showmenu(e,$.fn.ccmmenu.$overmenu.$menu);$.fn.ccmmenu.highlight($.fn.ccmmenu.$overmenu);$.fn.ccmmenu.$overmenu.addClass($.fn.ccmmenu.$overmenu.highlightClass)})};$.fn.ccmmenu.disable=function(){$.fn.ccmmenu.out();$.fn.ccmmenu.isenabled=false;$.fn.ccmmenu.$proxy.remove();$.fn.ccmmenu.resetHighlight()};$.fn.ccmmenu.over=function(e,$this,$menulauncher){if($.fn.ccmmenu.isenabled&&!$.fn.ccmmenu.isactive){$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");if($menulauncher){var offset=$menulauncher.offset();var t=offset.top-5;var l=offset.left-5;var w=$menulauncher.outerWidth()+10;var h=$menulauncher.outerHeight()+10;$.fn.ccmmenu.$proxy.css("width",w).css("height",h).css("top",t).css("left",l).css("border-top-left-radius",$menulauncher.css("border-top-left-radius")).css("border-bottom-left-radius",$menulauncher.css("border-bottom-left-radius")).css("border-top-right-radius",$menulauncher.css("border-top-right-radius")).css("border-bottom-right-radius",$menulauncher.css("border-bottom-right-radius"));$.fn.ccmmenu.$overmenu=$this}$.fn.ccmmenu.$overmenu.addClass("ccm-menu-item-active");$.fn.ccmmenu.$overmenu.parent().addClass("ccm-parent-menu-item-active")}};$.fn.ccmmenu.hide=function(e){if(e){e.stopPropagation()}if($.fn.ccmmenu.$proxy){$.fn.ccmmenu.isactive=false;$.fn.ccmmenu.$proxy.css("opacity",0);$.fn.ccmmenu.resetHighlight();$.fn.ccmmenu.$holder.html("");$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$(document).unbind("click.disableccmmenu");$("div.popover").css("opacity",0).hide()}};$.fn.ccmmenu.showmenu=function(e,$menu){e.stopPropagation();if($.fn.ccmmenu.isactive){$("div.popover").css("opacity",0).hide()}$.fn.ccmmenu.isactive=true;var $pp=$menu.clone(true,true);$pp.appendTo($.fn.ccmmenu.$holder);$pp.find(".dialog-launch").dialog();var posX=e.pageX+2;var posY=e.pageY+2;$pp.css("opacity",0).show();var mheight=$pp.height(),mwidth=$pp.width();if($(window).height()<e.clientY+mheight+30){posY=posY-mheight-10;posX=posX-mwidth/2;$pp.removeClass("bottom");$pp.addClass("top")}else{posX=posX-mwidth/2;posY=posY+10;$pp.removeClass("top");$pp.addClass("bottom")}$pp.css("top",posY+"px");$pp.css("left",posX+"px");$pp.show().css("opacity",1);$pp.find("a").click(function(e){$.fn.ccmmenu.hide(e)});$(document).on("click.disableccmmenu",function(e){$.fn.ccmmenu.hide(e)})};String.prototype.score=function(abbreviation,offset){offset=offset||0;if(abbreviation.length==0)return.9;if(abbreviation.length>this.length)return 0;for(var i=abbreviation.length;i>0;i--){var sub_abbreviation=abbreviation.substring(0,i);var index=this.indexOf(sub_abbreviation);if(index<0)continue;if(index+abbreviation.length>this.length+offset)continue;var next_string=this.substring(index+sub_abbreviation.length);var next_abbreviation=null;if(i>=abbreviation.length)next_abbreviation="";else next_abbreviation=abbreviation.substring(i);var remaining_score=next_string.score(next_abbreviation,offset+index);if(remaining_score>0){var score=this.length-next_string.length;if(index!=0){var j=0;var c=this.charCodeAt(index-1);if(c==32||c==9){for(var j=index-2;j>=0;j--){c=this.charCodeAt(j);score-=c==32||c==9?1:.15}}else{score-=index}}score+=remaining_score*next_string.length;score/=this.length;return score}}return 0};ccm_openThemeLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/themes",width:"905",modal:false,height:"410"})},"open_theme_launcher")};ccm_testMarketplaceConnection=function(onComplete,task,mpID){if(mpID){mpIDStr="&mpID="+mpID}else{mpIDStr=""}if(!task){task=""}params={mpID:mpID};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(resp){if(resp.isConnected){onComplete()}else{$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task="+task+mpIDStr,width:"90%",modal:false,height:"70%"});return false}})};ccm_openAddonLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/add-ons",width:"905",modal:false,height:"410"})},"open_addon_launcher")};ccm_setupMarketplaceDialogForm=function(){$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))});$(".ccm-pane-dialog-pagination a").click(function(){jQuery.fn.dialog.showLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").load($(this).attr("href"),function(){jQuery.fn.dialog.hideLoader()});return false});ccm_marketplaceBrowserInit();$("#ccm-marketplace-browser-form").ajaxForm({beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(resp){jQuery.fn.dialog.hideLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").html(resp)}})};ccm_marketplaceBrowserInit=function(){$(".ccm-marketplace-item").click(function(){ccm_getMarketplaceItemDetails($(this).attr("mpID"))});$(".ccm-marketplace-item-thumbnail").mouseover(function(){var img=$(this).parent().find("div.ccm-marketplace-results-image-hover").clone().addClass("ccm-marketplace-results-image-hover-displayed").appendTo(document.body);var t=$(this).offset().top;var l=$(this).offset().left;l=l+60;img.css("top",t).css("left",l);img.show()});$(".ccm-marketplace-item-thumbnail").mouseout(function(){$(".ccm-marketplace-results-image-hover-displayed").hide().remove()})};ccm_getMarketplaceItemDetails=function(mpID){jQuery.fn.dialog.showLoader();$("#ccm-intelligent-search-results").hide();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/details?mpID="+mpID,width:820,appendButtons:true,modal:false,height:640})},"get_item_details",mpID)};ccm_getMarketplaceItem=function(args){var mpID=args.mpID;var closeTop=args.closeTop;this.onComplete=function(){};if(args.onComplete){ccm_getMarketplaceItem.onComplete=args.onComplete}if(closeTop){jQuery.fn.dialog.closeTop()}jQuery.fn.dialog.showLoader();params={mpID:mpID};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(resp){jQuery.fn.dialog.hideLoader();if(resp.isConnected){if(!resp.purchaseRequired){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/download?install=1&mpID="+mpID,width:500,appendButtons:true,modal:false,height:400})}else{$.fn.dialog.open({title:ccmi18n.communityCheckout,iframe:true,href:CCM_TOOLS_PATH+"/marketplace/checkout?mpID="+mpID,width:"560px",modal:false,height:"400px"})}}else{$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task=get&mpID="+mpID,width:"90%",modal:false,height:"70%"})}})};ccm_triggerProgressiveOperation=function(url,params,dialogTitle,onComplete,onError){jQuery.fn.dialog.showLoader();$("#ccm-dialog-progress-bar").remove();$.ajax({url:url,type:"POST",data:params,success:function(r){jQuery.fn.dialog.hideLoader();$('<div id="ccm-dialog-progress-bar" />').appendTo(document.body).html(r).jqdialog({autoOpen:false,height:200,width:400,modal:true,title:dialogTitle,closeOnEscape:false,open:function(e,ui){$(".ui-dialog-titlebar-close",this.parentNode).hide();var totalItems=$("#ccm-progressive-operation-progress-bar").attr("data-total-items");ccm_doProgressiveOperation(url,params,totalItems,onComplete,onError)}});$("#ccm-dialog-progress-bar").jqdialog("open")}})};ccm_doProgressiveOperation=function(url,params,totalItems,onComplete,onError){params.push({name:"process",value:"1"});params["process"]=true;$.ajax({url:url,dataType:"json",type:"POST",data:params,error:function(xhr,status,r){switch(status){case"timeout":var text=ccmi18n.requestTimeout;break;default:var text=xhr.responseText;break}$("#ccm-dialog-progress-bar").dialog("option","height",200);$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",true);$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+text+"</div>");$(".ui-dialog-titlebar-close").show()},success:function(r){if(r.error){var text=r.message;$("#ccm-dialog-progress-bar").dialog("option","height",200);$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",true);$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+text+"</div>");$(".ui-dialog-titlebar-close").show();if(typeof onError=="function"){onError(r)}}else{var totalItemsLeft=r.totalItems;var pct=Math.round((totalItems-totalItemsLeft)/totalItems*100);$("#ccm-progressive-operation-status").html(1);if(totalItems-totalItemsLeft>0){$("#ccm-progressive-operation-status").html(totalItems-totalItemsLeft)}$("#ccm-progressive-operation-progress-bar div.bar").width(pct+"%");if(totalItemsLeft>0){setTimeout(function(){ccm_doProgressiveOperation(url,params,totalItems,onComplete,onError)},250)}else{setTimeout(function(){$("#ccm-progressive-operation-progress-bar div.bar").width("0%");$("#ccm-dialog-progress-bar").dialog("close");if(typeof onComplete=="function"){onComplete(r)}},1e3)}}}})};var CCMInlineEditMode=function(){enterInlineEditMode=function(activeObj){$.fn.ccmmenu.disable();$("#ccm-toolbar-disabled").remove();$("<div />",{id:"ccm-toolbar-disabled"}).appendTo(document.body);setTimeout(function(){$("#ccm-toolbar-disabled").css("opacity",1)},10);$("div.ccm-area").addClass("ccm-area-inline-edit-disabled");if(activeObj){activeObj.addClass("ccm-block-edit-inline-active")}};completeInlineEditMode=function($block){$("#ccm-inline-toolbar-container").remove();var $toolbar=$block.find(".ccm-inline-toolbar"),$holder=$("<div />",{id:"ccm-inline-toolbar-container"}).appendTo(document.body),$window=$(window),pos=$block.offset(),l=pos.left;$toolbar.appendTo($holder);var tw=l+parseInt($toolbar.width());if(tw>$window.width()){var overage=tw-(l+$block.width());$toolbar.css("left",l-overage)}else{$toolbar.css("left",l)}$toolbar.css("opacity",1);$toolbar.find(".dialog-launch").dialog();var t=pos.top-$holder.outerHeight()-5;$holder.css("top",t).css("opacity",1);if($window.scrollTop()>t){$("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",0);$holder.addClass("ccm-inline-toolbar-affixed")}$window.on("scroll.inline-toolbar",function(){$holder.toggleClass("ccm-inline-toolbar-affixed",$window.scrollTop()>t);if($window.scrollTop()>t){$("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",0)}else{$("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",1)}})};return{exit:function(onComplete){$(document).trigger("inlineEditCancel",[onComplete])},finishExit:function(){$("div.ccm-area-edit-inline-active").removeClass("ccm-area-edit-inline-active");$.fn.ccmmenu.enable();$("div.ccm-block-edit-inline-active").remove();$(window).unbind("scroll.inline-toolbar");$("div.ccm-area").removeClass("ccm-area-inline-edit-disabled");$("#ccm-toolbar-disabled").remove();$("#ccm-toolbar").css("opacity",1);$("#ccm-inline-toolbar-container").remove();jQuery.fn.dialog.hideLoader();CCMEditMode.start()},editBlock:function(cID,aID,arHandle,bID,params){var postData=[{name:"btask",value:"edit"},{name:"cID",value:cID},{name:"arHandle",value:arHandle},{name:"aID",value:aID},{name:"bID",value:bID}];if(params){for(var prop in params){postData.push({name:prop,value:params[prop]})}}jQuery.fn.dialog.showLoader();enterInlineEditMode($("[data-block-id="+bID+"][data-area-id="+aID+"]"));$.ajax({type:"GET",url:CCM_TOOLS_PATH+"/edit_block_popup",data:postData,success:function(r){var $container=$("[data-block-id="+bID+"][data-area-id="+aID+"]");$container.html(r);completeInlineEditMode($container);jQuery.fn.dialog.hideLoader()}})},loadAdd:function(cID,arHandle,aID,btID,params){var postData=[{name:"btask",value:"edit"},{name:"cID",value:cID},{name:"arHandle",value:arHandle},{name:"btID",value:btID}];if(params){for(var prop in params){postData.push({name:prop,value:params[prop]})}}jQuery.fn.dialog.showLoader();enterInlineEditMode();$.ajax({type:"GET",url:CCM_TOOLS_PATH+"/add_block_popup",data:postData,success:function(r){jQuery.fn.dialog.closeAll();if($("#ccm-add-new-block-placeholder").length>0){var obj=$("#ccm-add-new-block-placeholder")}else{var obj=$("#a"+aID)}obj.addClass("ccm-area-edit-inline-active");obj.append($('<div id="a'+aID+"-bt"+btID+'" class="ccm-block-edit-inline-active">'+r+"</div>"));var $container=$("#a"+aID+"-bt"+btID);completeInlineEditMode($container);jQuery.fn.dialog.hideLoader()}})}}}();var ccm_searchActivatePostFunction=new Array;ccm_setupAdvancedSearchFields=function(searchType){ccm_totalAdvancedSearchFields=$(".ccm-search-request-field-set").length;$("#ccm-"+searchType+"-search-add-option").unbind();$("#ccm-"+searchType+"-search-add-option").click(function(){ccm_totalAdvancedSearchFields++;if($("#ccm-search-fields-wrapper").length>0){$("#ccm-search-fields-wrapper").append('<div class="ccm-search-field" id="ccm-'+searchType+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</div>")}else{$("#ccm-"+searchType+"-search-advanced-fields").append('<tr class="ccm-search-field" id="ccm-'+searchType+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</tr>")}ccm_activateAdvancedSearchFields(searchType,ccm_totalAdvancedSearchFields)});var i=1;$(".ccm-search-request-field-set").each(function(){ccm_activateAdvancedSearchFields(searchType,i);i++})};ccm_setupAdvancedSearch=function(searchType){ccm_setupAdvancedSearchFields(searchType);$("#ccm-"+searchType+"-advanced-search").ajaxForm({beforeSubmit:function(){ccm_deactivateSearchResults(searchType)},success:function(resp){ccm_parseAdvancedSearchResponse(resp,searchType)}});ccm_setupInPagePaginationAndSorting(searchType);ccm_setupSortableColumnSelection(searchType)};ccm_parseAdvancedSearchResponse=function(resp,searchType){var obj=$("#ccm-"+searchType+"-search-results");if(obj.length==0||searchType==null){obj=$("#ccm-search-results")}obj.html(resp);ccm_activateSearchResults(searchType)};ccm_deactivateSearchResults=function(searchType){var obj=$("#ccm-"+searchType+"-search-fields-submit");if(obj.length==0||searchType==null){obj=$("#ccm-search-fields-submit")}obj.attr("disabled",true);var obj=$("#ccm-"+searchType+"-search-results table.ccm-results-list");if(obj.length==0||searchType==null){obj=$("#ccm-search-results")}obj.css("opacity",.4);jQuery.fn.dialog.showLoader()};ccm_activateSearchResults=function(searchType){if($(".ui-dialog-content").length==0){window.scrollTo(0,0)}else{$(".ui-dialog-content").each(function(i){$(this).get(0).scrollTop=0})}$(".dialog-launch").dialog();var obj=$("#ccm-"+searchType+"-search-results table.ccm-results-list");if(obj.length==0||searchType==null){obj=$("#ccm-search-results")}obj.css("opacity",1);jQuery.fn.dialog.hideLoader();var obj=$("#ccm-"+searchType+"-search-fields-submit");if(obj.length==0||searchType==null){obj=$("#ccm-search-fields-submit")}obj.attr("disabled",false);ccm_setupInPagePaginationAndSorting(searchType);ccm_setupSortableColumnSelection(searchType);if(typeof ccm_searchActivatePostFunction[searchType]=="function"){ccm_searchActivatePostFunction[searchType]()}};ccm_setupInPagePaginationAndSorting=function(searchType){$(".ccm-results-list th a").click(function(){ccm_deactivateSearchResults(searchType);var obj=$("#ccm-"+searchType+"-search-results");if(obj.length==0){obj=$("#ccm-search-results")}obj.load($(this).attr("href"),false,function(){ccm_activateSearchResults(searchType)});return false});$("div.ccm-pagination a").click(function(){if(!$(this).parent().hasClass("disabled")){ccm_deactivateSearchResults(searchType);var obj=$("#ccm-"+searchType+"-search-results");if(obj.length==0){obj=$("#ccm-search-results")}obj.load($(this).attr("href"),false,function(){ccm_activateSearchResults(searchType);$("div.ccm-dialog-content").attr("scrollTop",0)})}return false});$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupSortableColumnSelection=function(searchType){$("#ccm-list-view-customize").unbind();$("#ccm-list-view-customize").click(function(){jQuery.fn.dialog.open({width:550,height:350,appendButtons:true,modal:false,href:$(this).attr("href"),title:ccmi18n.customizeSearch});return false})};ccm_checkSelectedAdvancedSearchField=function(searchType,fieldset){$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-option-type-date_time input").each(function(){$(this).attr("id",$(this).attr("id")+fieldset)});$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-option-type-date_time input").datepicker({showAnim:"fadeIn"});$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-option-type-rating input").rating()};ccm_activateAdvancedSearchFields=function(searchType,fieldset){var selTag=$("#ccm-"+searchType+"-search-field-set"+fieldset+" select:first");selTag.unbind();selTag.change(function(){var selected=$(this).find(":selected").val();$(this).parent().parent().find("input.ccm-"+searchType+"-selected-field").val(selected);var itemToCopy=$("#ccm-"+searchType+"-search-field-base-elements span[search-field="+selected+"]");$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-selected-field-content").html("");itemToCopy.clone().appendTo("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-selected-field-content");$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-selected-field-content .ccm-search-option").show();ccm_checkSelectedAdvancedSearchField(searchType,fieldset)});$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-remove-option").unbind();$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-remove-option").click(function(){$(this).parents("div.ccm-search-field").remove();$(this).parents("tr.ccm-search-field").remove()});ccm_checkSelectedAdvancedSearchField(searchType,fieldset)};ccm_activateEditablePropertiesGrid=function(){$("tr.ccm-attribute-editable-field").each(function(){var trow=$(this);$(this).find("a").click(function(){trow.find(".ccm-attribute-editable-field-text").hide();trow.find(".ccm-attribute-editable-field-clear-button").hide();trow.find(".ccm-attribute-editable-field-form").show();trow.find(".ccm-attribute-editable-field-save-button").show()});trow.find("form").submit(function(){return false});trow.find(".ccm-attribute-editable-field-save-button").parent().click(function(){var task=trow.find("form input[name=task]");if(task.val()=="clear_extended_attribute"){task.val(task.attr("data-original-task"));task.attr("data-original-task","")}ccm_submitEditablePropertiesGrid(trow)});trow.find(".ccm-attribute-editable-field-clear-button").parent().unbind();trow.find(".ccm-attribute-editable-field-clear-button").parent().click(function(){var task=trow.find("form input[name=task]");task.attr("data-original-task",task.val());task.val("clear_extended_attribute");ccm_submitEditablePropertiesGrid(trow);return false})})};ccm_submitEditablePropertiesGrid=function(trow){trow.find(".ccm-attribute-editable-field-save-button").hide();trow.find(".ccm-attribute-editable-field-clear-button").hide();trow.find(".ccm-attribute-editable-field-loading").show();try{tinyMCE.triggerSave(true,true)}catch(e){}trow.find("form").ajaxSubmit(function(resp){trow.find(".ccm-attribute-editable-field-loading").hide();trow.find(".ccm-attribute-editable-field-save-button").show();trow.find(".ccm-attribute-editable-field-text").html(resp);trow.find(".ccm-attribute-editable-field-form").hide();trow.find(".ccm-attribute-editable-field-save-button").hide();trow.find(".ccm-attribute-editable-field-text").show();trow.find(".ccm-attribute-editable-field-clear-button").show();trow.find("td").show("highlight",{color:"#FFF9BB"})})};ccm_triggerSelectUser=function(uID,uName,uEmail){alert(uID);alert(uName);alert(uEmail)};ccm_triggerSelectGroup=function(gID,gName){alert(gID);alert(gName)};ccm_setupUserSearch=function(searchInstance){$(".chosen-select").chosen();$("#ccm-user-list-cb-all").click(function(){if($(this).prop("checked")==true){$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-user-list-multiple-operations").attr("disabled",false)}else{$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-user-list-multiple-operations").attr("disabled",true)}});$("td.ccm-user-list-cb input[type=checkbox]").click(function(e){if($("td.ccm-user-list-cb input[type=checkbox]:checked").length>0){$("#ccm-user-list-multiple-operations").attr("disabled",false)}else{$("#ccm-user-list-multiple-operations").attr("disabled",true)}});$("#ccm-user-list-multiple-operations").change(function(){var action=$(this).val();switch(action){case"choose":var idstr="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){ccm_triggerSelectUser($(this).val(),$(this).attr("user-name"),$(this).attr("user-email"))});jQuery.fn.dialog.closeTop();break;case"properties":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_properties?"+uIDstring,title:ccmi18n.properties});break;case"activate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_activate?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_activate});break;case"deactivate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_deactivate?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_deactivate});break;case"group_add":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_group_add?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_group_add});break;case"group_remove":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_group_remove?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_group_remove});break;case"delete":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_delete?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_delete});break}$(this).get(0).selectedIndex=0})};ccm_setupGroupSearchPaging=function(){$("div#ccm-group-paging").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupGroupSearch=function(callback){$("div.ccm-group a").unbind();if(callback){func=window[callback]}else{func=ccm_triggerSelectGroup}$("div.ccm-group a").each(function(i){var gla=$(this);$(this).click(function(){func(gla.attr("group-id"),gla.attr("group-name"));$.fn.dialog.closeTop();return false})});$("#ccm-group-search").ajaxForm({beforeSubmit:function(){$("#ccm-group-search-wrapper").html("")},success:function(resp){$("#ccm-group-search-wrapper").html(resp)}});ccm_setupGroupSearchPaging();$("div#ccm-group-paging a").click(function(){$("#ccm-group-search-wrapper").html("");$.ajax({type:"GET",url:$(this).attr("href"),success:function(resp){$("#ccm-group-search-wrapper").html(resp)}});return false})};if(typeof ccm_selectSitemapNode!="function"){ccm_selectSitemapNode=function(cID,cName){alert(cID);alert(cName)}}var _canLog=true;function _log(mode,msg){if(!_canLog){return}var args=Array.prototype.slice.apply(arguments,[1]);var dt=new Date;var tag=dt.getHours()+":"+dt.getMinutes()+":"+dt.getSeconds()+"."+dt.getMilliseconds();args[0]=tag+" - "+args[0];try{switch(mode){case"info":window.console.info.apply(window.console,args);break;case"warn":window.console.warn.apply(window.console,args);break;default:window.console.log.apply(window.console,args);break}}catch(e){if(!window.console){_canLog=false}else if(e.number===-2146827850){window.console.log(args.join(", "))}}}function _checkBrowser(){var matched,browser;function uaMatch(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}}matched=uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else if(browser.webkit){browser.safari=true}return browser}var BROWSER=jQuery.browser||_checkBrowser();function logMsg(msg){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}var getDynaTreePersistData=null;var DTNodeStatus_Error=-1;var DTNodeStatus_Loading=1;var DTNodeStatus_Ok=0;(function($){var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};function getDtNodeFromElement(el){alert("getDtNodeFromElement is deprecated");return $.ui.dynatree.getNode(el)}function noop(){}function versionCompare(v1,v2){var v1parts=(""+v1).split("."),v2parts=(""+v2).split("."),minLength=Math.min(v1parts.length,v2parts.length),p1,p2,i;for(i=0;i<minLength;i++){p1=parseInt(v1parts[i],10);p2=parseInt(v2parts[i],10);if(isNaN(p1)){p1=v1parts[i]}if(isNaN(p2)){p2=v2parts[i]}if(p1==p2){continue}else if(p1>p2){return 1}else if(p1<p2){return-1}return NaN}if(v1parts.length===v2parts.length){return 0}return v1parts.length<v2parts.length?-1:1}var DynaTreeNode=Class.create();DynaTreeNode.prototype={initialize:function(parent,tree,data){this.parent=parent;this.tree=tree;if(typeof data==="string"){data={title:data}}if(!data.key){data.key="_"+tree._nodeCount++}else{data.key=""+data.key}this.data=$.extend({},$.ui.dynatree.nodedatadefaults,data);this.li=null;this.span=null;this.ul=null;this.childList=null;this._isLoading=false;this.hasSubSel=false;this.bExpanded=false;this.bSelected=false},toString:function(){return"DynaTreeNode<"+this.data.key+">: '"+this.data.title+"'"},toDict:function(recursive,callback){var dict=$.extend({},this.data);dict.activate=this.tree.activeNode===this;dict.focus=this.tree.focusNode===this;dict.expand=this.bExpanded;dict.select=this.bSelected;if(callback){callback(dict)}if(recursive&&this.childList){dict.children=[];for(var i=0,l=this.childList.length;i<l;i++){dict.children.push(this.childList[i].toDict(true,callback))}}else{delete dict.children}return dict},fromDict:function(dict){var children=dict.children;if(children===undefined){this.data=$.extend(this.data,dict);this.render();return}dict=$.extend({},dict);dict.children=undefined;this.data=$.extend(this.data,dict);this.removeChildren();this.addChild(children)},_getInnerHtml:function(){var tree=this.tree,opts=tree.options,cache=tree.cache,level=this.getLevel(),data=this.data,res="",imageSrc;if(level<opts.minExpandLevel){if(level>1){res+=cache.tagConnector}}else if(this.hasChildren()!==false){res+=cache.tagExpander}else{res+=cache.tagConnector}if(opts.checkbox&&data.hideCheckbox!==true&&!data.isStatusNode){res+=cache.tagCheckbox}if(data.icon){if(data.icon.charAt(0)==="/"){imageSrc=data.icon
}else{imageSrc=opts.imagePath+data.icon}res+="<img src='"+imageSrc+"' alt='' />"}else if(data.icon===false){}else if(data.iconClass){res+="<span class='"+" "+data.iconClass+"'></span>"}else{res+=cache.tagNodeIcon}var nodeTitle="";if(opts.onCustomRender){nodeTitle=opts.onCustomRender.call(tree,this)||""}if(!nodeTitle){var tooltip=data.tooltip?' title="'+data.tooltip.replace(/\"/g,"&quot;")+'"':"",href=data.href||"#";if(opts.noLink||data.noLink){nodeTitle='<span style="display:inline-block;" class="'+opts.classNames.title+'"'+tooltip+">"+data.title+"</span>"}else{nodeTitle='<a href="'+href+'" class="'+opts.classNames.title+'"'+tooltip+">"+data.title+"</a>"}}res+=nodeTitle;return res},_fixOrder:function(){var cl=this.childList;if(!cl||!this.ul){return}var childLI=this.ul.firstChild;for(var i=0,l=cl.length-1;i<l;i++){var childNode1=cl[i];var childNode2=childLI.dtnode;if(childNode1!==childNode2){this.tree.logDebug("_fixOrder: mismatch at index "+i+": "+childNode1+" != "+childNode2);this.ul.insertBefore(childNode1.li,childNode2.li)}else{childLI=childLI.nextSibling}}},render:function(useEffects,includeInvisible){var tree=this.tree,parent=this.parent,data=this.data,opts=tree.options,cn=opts.classNames,isLastSib=this.isLastSibling(),firstTime=false;if(!parent&&!this.ul){this.li=this.span=null;this.ul=document.createElement("ul");if(opts.minExpandLevel>1){this.ul.className=cn.container+" "+cn.noConnector}else{this.ul.className=cn.container}}else if(parent){if(!this.li){firstTime=true;this.li=document.createElement("li");this.li.dtnode=this;if(data.key&&opts.generateIds){this.li.id=opts.idPrefix+data.key}this.span=document.createElement("span");this.span.className=cn.title;this.li.appendChild(this.span);if(!parent.ul){parent.ul=document.createElement("ul");parent.ul.style.display="none";parent.li.appendChild(parent.ul)}parent.ul.appendChild(this.li)}this.span.innerHTML=this._getInnerHtml();var cnList=[];cnList.push(cn.node);if(data.isFolder){cnList.push(cn.folder)}if(this.bExpanded){cnList.push(cn.expanded)}if(this.hasChildren()!==false){cnList.push(cn.hasChildren)}if(data.isLazy&&this.childList===null){cnList.push(cn.lazy)}if(isLastSib){cnList.push(cn.lastsib)}if(this.bSelected){cnList.push(cn.selected)}if(this.hasSubSel){cnList.push(cn.partsel)}if(tree.activeNode===this){cnList.push(cn.active)}if(data.addClass){cnList.push(data.addClass)}cnList.push(cn.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(data.isLazy&&this.childList===null?"d":"")+(isLastSib?"l":""));cnList.push(cn.combinedIconPrefix+(this.bExpanded?"e":"c")+(data.isFolder?"f":""));this.span.className=cnList.join(" ");this.li.className=isLastSib?cn.lastsib:"";if(firstTime&&opts.onCreate){opts.onCreate.call(tree,this,this.span)}if(opts.onRender){opts.onRender.call(tree,this,this.span)}}if((this.bExpanded||includeInvisible===true)&&this.childList){for(var i=0,l=this.childList.length;i<l;i++){this.childList[i].render(false,includeInvisible)}this._fixOrder()}if(this.ul){var isHidden=this.ul.style.display==="none";var isExpanded=!!this.bExpanded;if(useEffects&&opts.fx&&isHidden===isExpanded){var duration=opts.fx.duration||200;$(this.ul).animate(opts.fx,duration)}else{this.ul.style.display=this.bExpanded||!parent?"":"none"}}},getKeyPath:function(excludeSelf){var path=[];this.visitParents(function(node){if(node.parent){path.unshift(node.data.key)}},!excludeSelf);return"/"+path.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){if(this.hasChildren()===undefined){return undefined}return this.childList},hasChildren:function(){if(this.data.isLazy){if(this.childList===null||this.childList===undefined){return undefined}else if(this.childList.length===0){return false}else if(this.childList.length===1&&this.childList[0].isStatusNode()){return undefined}return true}return!!this.childList},isFirstSibling:function(){var p=this.parent;return!p||p.childList[0]===this},isLastSibling:function(){var p=this.parent;return!p||p.childList[p.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent){return null}var ac=this.parent.childList;for(var i=1,l=ac.length;i<l;i++){if(ac[i]===this){return ac[i-1]}}return null},getNextSibling:function(){if(!this.parent){return null}var ac=this.parent.childList;for(var i=0,l=ac.length-1;i<l;i++){if(ac[i]===this){return ac[i+1]}}return null},isStatusNode:function(){return this.data.isStatusNode===true},isChildOf:function(otherNode){return this.parent&&this.parent===otherNode},isDescendantOf:function(otherNode){if(!otherNode){return false}var p=this.parent;while(p){if(p===otherNode){return true}p=p.parent}return false},countChildren:function(){var cl=this.childList;if(!cl){return 0}var n=cl.length;for(var i=0,l=n;i<l;i++){var child=cl[i];n+=child.countChildren()}return n},sortChildren:function(cmp,deep){var cl=this.childList;if(!cl){return}cmp=cmp||function(a,b){var x=a.data.title.toLowerCase(),y=b.data.title.toLowerCase();return x===y?0:x>y?1:-1};cl.sort(cmp);if(deep){for(var i=0,l=cl.length;i<l;i++){if(cl[i].childList){cl[i].sortChildren(cmp,"$norender$")}}}if(deep!=="$norender$"){this.render()}},_setStatusNode:function(data){var firstChild=this.childList?this.childList[0]:null;if(!data){if(firstChild&&firstChild.isStatusNode()){try{if(this.ul){this.ul.removeChild(firstChild.li);firstChild.li=null}}catch(e){}if(this.childList.length===1){this.childList=[]}else{this.childList.shift()}}}else if(firstChild){data.isStatusNode=true;data.key="_statusNode";firstChild.data=data;firstChild.render()}else{data.isStatusNode=true;data.key="_statusNode";firstChild=this.addChild(data)}},setLazyNodeStatus:function(lts,opts){var tooltip=opts&&opts.tooltip?opts.tooltip:null,info=opts&&opts.info?" ("+opts.info+")":"";switch(lts){case DTNodeStatus_Ok:this._setStatusNode(null);$(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=false;if(this.tree.options.autoFocus){if(this===this.tree.tnRoot&&this.childList&&this.childList.length>0){this.childList[0].focus()}else{this.focus()}}break;case DTNodeStatus_Loading:this._isLoading=true;$(this.span).addClass(this.tree.options.classNames.nodeLoading);if(!this.parent){this._setStatusNode({title:this.tree.options.strings.loading+info,tooltip:tooltip,addClass:this.tree.options.classNames.nodeWait})}break;case DTNodeStatus_Error:this._isLoading=false;this._setStatusNode({title:this.tree.options.strings.loadError+info,tooltip:tooltip,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+lts+"'."}},_parentList:function(includeRoot,includeSelf){var l=[];var dtn=includeSelf?this:this.parent;while(dtn){if(includeRoot||dtn.parent){l.unshift(dtn)}dtn=dtn.parent}return l},getLevel:function(){var level=0;var dtn=this.parent;while(dtn){level++;dtn=dtn.parent}return level},_getTypeForOuterNodeEvent:function(event){var cns=this.tree.options.classNames;var target=event.target;if(target.className.indexOf(cns.node)<0){return null}var eventX=event.pageX-target.offsetLeft;var eventY=event.pageY-target.offsetTop;for(var i=0,l=target.childNodes.length;i<l;i++){var cn=target.childNodes[i];var x=cn.offsetLeft-target.offsetLeft;var y=cn.offsetTop-target.offsetTop;var nx=cn.clientWidth,ny=cn.clientHeight;if(eventX>=x&&eventX<=x+nx&&eventY>=y&&eventY<=y+ny){if(cn.className==cns.title){return"title"}else if(cn.className==cns.expander){return"expander"}else if(cn.className==cns.checkbox){return"checkbox"}else if(cn.className==cns.nodeIcon){return"icon"}}}return"prefix"},getEventTargetType:function(event){var tcn=event&&event.target?event.target.className:"",cns=this.tree.options.classNames;if(tcn===cns.title){return"title"}else if(tcn===cns.expander){return"expander"}else if(tcn===cns.checkbox){return"checkbox"}else if(tcn===cns.nodeIcon){return"icon"}else if(tcn===cns.empty||tcn===cns.vline||tcn===cns.connector){return"prefix"}else if(tcn.indexOf(cns.node)>=0){return this._getTypeForOuterNodeEvent(event)}return null},isVisible:function(){var parents=this._parentList(true,false);for(var i=0,l=parents.length;i<l;i++){if(!parents[i].bExpanded){return false}}return true},makeVisible:function(){var parents=this._parentList(true,false);for(var i=0,l=parents.length;i<l;i++){parents[i]._expand(true)}},focus:function(){this.makeVisible();try{$(this.span).find(">a").focus()}catch(e){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(flag,fireEvents){this.tree.logDebug("dtnode._activate(%o, fireEvents=%o) - %o",flag,fireEvents,this);var opts=this.tree.options;if(this.data.isStatusNode){return}if(fireEvents&&opts.onQueryActivate&&opts.onQueryActivate.call(this.tree,flag,this)===false){return}if(flag){if(this.tree.activeNode){if(this.tree.activeNode===this){return}this.tree.activeNode.deactivate()}if(opts.activeVisible){this.makeVisible()}this.tree.activeNode=this;if(opts.persist){$.cookie(opts.cookieId+"-active",this.data.key,opts.cookie)}this.tree.persistence.activeKey=this.data.key;$(this.span).addClass(opts.classNames.active);if(fireEvents&&opts.onActivate){opts.onActivate.call(this.tree,this)}}else{if(this.tree.activeNode===this){if(opts.onQueryActivate&&opts.onQueryActivate.call(this.tree,false,this)===false){return}$(this.span).removeClass(opts.classNames.active);if(opts.persist){$.cookie(opts.cookieId+"-active","",opts.cookie)}this.tree.persistence.activeKey=null;this.tree.activeNode=null;if(fireEvents&&opts.onDeactivate){opts.onDeactivate.call(this.tree,this)}}}},activate:function(){this._activate(true,true)},activateSilently:function(){this._activate(true,false)},deactivate:function(){this._activate(false,true)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var activate=true;var expand=false;if(this.data.isFolder){switch(this.tree.options.clickFolderMode){case 2:activate=false;expand=true;break;case 3:activate=expand=true;break}}if(this.parent===null){expand=false}if(expand){this.toggleExpand();this.focus()}if(activate){this.activate()}},_setSubSel:function(hasSubSel){if(hasSubSel){this.hasSubSel=true;$(this.span).addClass(this.tree.options.classNames.partsel)}else{this.hasSubSel=false;$(this.span).removeClass(this.tree.options.classNames.partsel)}},_updatePartSelectionState:function(){var sel;if(!this.hasChildren()){sel=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode;this._setSubSel(false);return sel}var i,l,cl=this.childList,allSelected=true,allDeselected=true;for(i=0,l=cl.length;i<l;i++){var n=cl[i],s=n._updatePartSelectionState();if(s!==false){allDeselected=false}if(s!==true){allSelected=false}}if(allSelected){sel=true}else if(allDeselected){sel=false}else{sel=undefined}this._setSubSel(sel===undefined);this.bSelected=sel===true;return sel},_fixSelectionState:function(){var p,i,l;if(this.bSelected){this.visit(function(node){node.parent._setSubSel(true);if(!node.data.unselectable){node._select(true,false,false)}});p=this.parent;while(p){p._setSubSel(true);var allChildsSelected=true;for(i=0,l=p.childList.length;i<l;i++){var n=p.childList[i];if(!n.bSelected&&!n.data.isStatusNode&&!n.data.unselectable){allChildsSelected=false;break}}if(allChildsSelected){p._select(true,false,false)}p=p.parent}}else{this._setSubSel(false);this.visit(function(node){node._setSubSel(false);node._select(false,false,false)});p=this.parent;while(p){p._select(false,false,false);var isPartSel=false;for(i=0,l=p.childList.length;i<l;i++){if(p.childList[i].bSelected||p.childList[i].hasSubSel){isPartSel=true;break}}p._setSubSel(isPartSel);p=p.parent}}},_select:function(sel,fireEvents,deep){var opts=this.tree.options;if(this.data.isStatusNode){return}if(this.bSelected===sel){return}if(fireEvents&&opts.onQuerySelect&&opts.onQuerySelect.call(this.tree,sel,this)===false){return}if(opts.selectMode==1&&sel){this.tree.visit(function(node){if(node.bSelected){node._select(false,false,false);return false}})}this.bSelected=sel;if(sel){if(opts.persist){this.tree.persistence.addSelect(this.data.key)}$(this.span).addClass(opts.classNames.selected);if(deep&&opts.selectMode===3){this._fixSelectionState()}if(fireEvents&&opts.onSelect){opts.onSelect.call(this.tree,true,this)}}else{if(opts.persist){this.tree.persistence.clearSelect(this.data.key)}$(this.span).removeClass(opts.classNames.selected);if(deep&&opts.selectMode===3){this._fixSelectionState()}if(fireEvents&&opts.onSelect){opts.onSelect.call(this.tree,false,this)}}},select:function(sel){if(this.data.unselectable){return this.bSelected}return this._select(sel!==false,true,true)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var opts=this.tree.options;this.tree.logDebug("_loadContent: start - %o",this);this.setLazyNodeStatus(DTNodeStatus_Loading);if(true===opts.onLazyRead.call(this.tree,this)){this.setLazyNodeStatus(DTNodeStatus_Ok);this.tree.logDebug("_loadContent: succeeded - %o",this)}}catch(e){this.tree.logWarning("_loadContent: failed - %o",e);this.setLazyNodeStatus(DTNodeStatus_Error,{tooltip:""+e})}},_expand:function(bExpand,forceSync){if(this.bExpanded===bExpand){this.tree.logDebug("dtnode._expand(%o) IGNORED - %o",bExpand,this);return}this.tree.logDebug("dtnode._expand(%o) - %o",bExpand,this);var opts=this.tree.options;if(!bExpand&&this.getLevel()<opts.minExpandLevel){this.tree.logDebug("dtnode._expand(%o) prevented collapse - %o",bExpand,this);return}if(opts.onQueryExpand&&opts.onQueryExpand.call(this.tree,bExpand,this)===false){return}this.bExpanded=bExpand;if(opts.persist){if(bExpand){this.tree.persistence.addExpand(this.data.key)}else{this.tree.persistence.clearExpand(this.data.key)}}var allowEffects=!(this.data.isLazy&&this.childList===null)&&!this._isLoading&&!forceSync;this.render(allowEffects);if(this.bExpanded&&this.parent&&opts.autoCollapse){var parents=this._parentList(false,true);for(var i=0,l=parents.length;i<l;i++){parents[i].collapseSiblings()}}if(opts.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()){this.tree.activeNode.deactivate()}if(bExpand&&this.data.isLazy&&this.childList===null&&!this._isLoading){this._loadContent();return}if(opts.onExpand){opts.onExpand.call(this.tree,bExpand,this)}},isExpanded:function(){return this.bExpanded},expand:function(flag){flag=flag!==false;if(!this.childList&&!this.data.isLazy&&flag){return}else if(this.parent===null&&!flag){return}this._expand(flag)},scheduleAction:function(mode,ms){if(this.tree.timer){clearTimeout(this.tree.timer);this.tree.logDebug("clearTimeout(%o)",this.tree.timer)}var self=this;switch(mode){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){self.tree.logDebug("setTimeout: trigger expand");self.expand(true)},ms);break;case"activate":this.tree.timer=setTimeout(function(){self.tree.logDebug("setTimeout: trigger activate");self.activate()},ms);break;default:throw"Invalid mode "+mode}this.tree.logDebug("setTimeout(%s, %s): %s",mode,ms,this.tree.timer)},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(this.parent===null){return}var ac=this.parent.childList;for(var i=0,l=ac.length;i<l;i++){if(ac[i]!==this&&ac[i].bExpanded){ac[i]._expand(false)}}},_onClick:function(event){var targetType=this.getEventTargetType(event);if(targetType==="expander"){this.toggleExpand();this.focus()}else if(targetType==="checkbox"){this.toggleSelect();this.focus()}else{this._userActivate();var aTag=this.span.getElementsByTagName("a");if(aTag[0]){if(!(BROWSER.msie&&parseInt(BROWSER.version,10)<9)){aTag[0].focus()}}else{return true}}event.preventDefault()},_onDblClick:function(event){},_onKeydown:function(event){var handled=true,sib;switch(event.which){case 107:case 187:if(!this.bExpanded){this.toggleExpand()}break;case 109:case 189:if(this.bExpanded){this.toggleExpand()}break;case 32:this._userActivate();break;case 8:if(this.parent){this.parent.focus()}break;case 37:if(this.bExpanded){this.toggleExpand();this.focus()}else if(this.parent&&this.parent.parent){this.parent.focus()}break;case 39:if(!this.bExpanded&&(this.childList||this.data.isLazy)){this.toggleExpand();this.focus()}else if(this.childList){this.childList[0].focus()}break;case 38:sib=this.getPrevSibling();while(sib&&sib.bExpanded&&sib.childList){sib=sib.childList[sib.childList.length-1]}if(!sib&&this.parent&&this.parent.parent){sib=this.parent}if(sib){sib.focus()}break;case 40:if(this.bExpanded&&this.childList){sib=this.childList[0]}else{var parents=this._parentList(false,true);for(var i=parents.length-1;i>=0;i--){sib=parents[i].getNextSibling();if(sib){break}}}if(sib){sib.focus()}break;default:handled=false}if(handled){event.preventDefault()}},_onKeypress:function(event){},_onFocus:function(event){var opts=this.tree.options;if(event.type=="blur"||event.type=="focusout"){if(opts.onBlur){opts.onBlur.call(this.tree,this)}if(this.tree.tnFocused){$(this.tree.tnFocused.span).removeClass(opts.classNames.focused)}this.tree.tnFocused=null;if(opts.persist){$.cookie(opts.cookieId+"-focus","",opts.cookie)}}else if(event.type=="focus"||event.type=="focusin"){if(this.tree.tnFocused&&this.tree.tnFocused!==this){this.tree.logDebug("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused);$(this.tree.tnFocused.span).removeClass(opts.classNames.focused)}this.tree.tnFocused=this;if(opts.onFocus){opts.onFocus.call(this.tree,this)}$(this.tree.tnFocused.span).addClass(opts.classNames.focused);if(opts.persist){$.cookie(opts.cookieId+"-focus",this.data.key,opts.cookie)}}},visit:function(fn,includeSelf){var res=true;if(includeSelf===true){res=fn(this);if(res===false||res=="skip"){return res}}if(this.childList){for(var i=0,l=this.childList.length;i<l;i++){res=this.childList[i].visit(fn,true);if(res===false){break}}}return res},visitParents:function(fn,includeSelf){if(includeSelf&&fn(this)===false){return false}var p=this.parent;while(p){if(fn(p)===false){return false}p=p.parent}return true},remove:function(){if(this===this.tree.root){throw"Cannot remove system root"}return this.parent.removeChild(this)},removeChild:function(tn){var ac=this.childList;if(ac.length==1){if(tn!==ac[0]){throw"removeChild: invalid child"}return this.removeChildren()}if(tn===this.tree.activeNode){tn.deactivate()}if(this.tree.options.persist){if(tn.bSelected){this.tree.persistence.clearSelect(tn.data.key)}if(tn.bExpanded){this.tree.persistence.clearExpand(tn.data.key)}}tn.removeChildren(true);if(this.ul){this.ul.removeChild(tn.li)}for(var i=0,l=ac.length;i<l;i++){if(ac[i]===tn){this.childList.splice(i,1);break}}},removeChildren:function(isRecursiveCall,retainPersistence){this.tree.logDebug("%s.removeChildren(%o)",this,isRecursiveCall);var tree=this.tree;var ac=this.childList;if(ac){for(var i=0,l=ac.length;i<l;i++){var tn=ac[i];if(tn===tree.activeNode&&!retainPersistence){tn.deactivate()}if(this.tree.options.persist&&!retainPersistence){if(tn.bSelected){this.tree.persistence.clearSelect(tn.data.key)}if(tn.bExpanded){this.tree.persistence.clearExpand(tn.data.key)}}tn.removeChildren(true,retainPersistence);if(this.ul){$("li",$(this.ul)).remove()}}this.childList=null}if(!isRecursiveCall){this._isLoading=false;this.render()}},setTitle:function(title){this.fromDict({title:title})},reload:function(force){throw"Use reloadChildren() instead"},reloadChildren:function(callback){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.reloadChildren() requires lazy nodes."}if(callback){var self=this;var eventType="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(eventType,function(e,node,isOk){self.tree.$tree.unbind(eventType);self.tree.logDebug("loaded %o, %o, %o",e,node,isOk);if(node!==self){throw"got invalid load event"}callback.call(self.tree,node,isOk)})}this.removeChildren();this._loadContent()},_loadKeyPath:function(keyPath,callback){var tree=this.tree;tree.logDebug("%s._loadKeyPath(%s)",this,keyPath);if(keyPath===""){throw"Key path must not be empty"}var segList=keyPath.split(tree.options.keyPathSeparator);if(segList[0]===""){throw"Key path must be relative (don't start with '/')"}var seg=segList.shift();if(this.childList){for(var i=0,l=this.childList.length;i<l;i++){var child=this.childList[i];if(child.data.key===seg){if(segList.length===0){callback.call(tree,child,"ok")}else if(child.data.isLazy&&(child.childList===null||child.childList===undefined)){tree.logDebug("%s._loadKeyPath(%s) -> reloading %s...",this,keyPath,child);var self=this;child.reloadChildren(function(node,isOk){if(isOk){tree.logDebug("%s._loadKeyPath(%s) -> reloaded %s.",node,keyPath,node);callback.call(tree,child,"loaded");node._loadKeyPath(segList.join(tree.options.keyPathSeparator),callback)}else{tree.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",self,keyPath);callback.call(tree,child,"error")}})}else{callback.call(tree,child,"loaded");child._loadKeyPath(segList.join(tree.options.keyPathSeparator),callback)}return}}}callback.call(tree,undefined,"notfound",seg,segList.length===0);tree.logWarning("Node not found: "+seg);return},resetLazy:function(){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.resetLazy() requires lazy nodes."}this.expand(false);this.removeChildren()},_addChildNode:function(dtnode,beforeNode){var tree=this.tree,opts=tree.options,pers=tree.persistence;dtnode.parent=this;if(this.childList===null){this.childList=[]}else if(!beforeNode){if(this.childList.length>0){$(this.childList[this.childList.length-1].span).removeClass(opts.classNames.lastsib)}}if(beforeNode){var iBefore=$.inArray(beforeNode,this.childList);if(iBefore<0){throw"<beforeNode> must be a child of <this>"}this.childList.splice(iBefore,0,dtnode)}else{this.childList.push(dtnode)}var isInitializing=tree.isInitializing();if(opts.persist&&pers.cookiesFound&&isInitializing){if(pers.activeKey===dtnode.data.key){tree.activeNode=dtnode}if(pers.focusedKey===dtnode.data.key){tree.focusNode=dtnode}dtnode.bExpanded=$.inArray(dtnode.data.key,pers.expandedKeyList)>=0;dtnode.bSelected=$.inArray(dtnode.data.key,pers.selectedKeyList)>=0}else{if(dtnode.data.activate){tree.activeNode=dtnode;if(opts.persist){pers.activeKey=dtnode.data.key}}if(dtnode.data.focus){tree.focusNode=dtnode;if(opts.persist){pers.focusedKey=dtnode.data.key}}dtnode.bExpanded=dtnode.data.expand===true;if(dtnode.bExpanded&&opts.persist){pers.addExpand(dtnode.data.key)}dtnode.bSelected=dtnode.data.select===true;if(dtnode.bSelected&&opts.persist){pers.addSelect(dtnode.data.key)}}if(opts.minExpandLevel>=dtnode.getLevel()){this.bExpanded=true}if(dtnode.bSelected&&opts.selectMode==3){var p=this;while(p){if(!p.hasSubSel){p._setSubSel(true)}p=p.parent}}if(tree.bEnableUpdate){this.render()}return dtnode},addChild:function(obj,beforeNode){if(typeof obj=="string"){throw"Invalid data type for "+obj}else if(!obj||obj.length===0){return}else if(obj instanceof DynaTreeNode){return this._addChildNode(obj,beforeNode)}if(!obj.length){obj=[obj]}var prevFlag=this.tree.enableUpdate(false);var tnFirst=null;for(var i=0,l=obj.length;i<l;i++){var data=obj[i];var dtnode=this._addChildNode(new DynaTreeNode(this,this.tree,data),beforeNode);if(!tnFirst){tnFirst=dtnode}if(data.children){dtnode.addChild(data.children,null)}}this.tree.enableUpdate(prevFlag);return tnFirst},append:function(obj){this.tree.logWarning("node.append() is deprecated (use node.addChild() instead).");return this.addChild(obj,null)},appendAjax:function(ajaxOptions){var self=this;this.removeChildren(false,true);this.setLazyNodeStatus(DTNodeStatus_Loading);if(ajaxOptions.debugLazyDelay){var ms=ajaxOptions.debugLazyDelay;ajaxOptions.debugLazyDelay=0;this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+ms);setTimeout(function(){self.appendAjax(ajaxOptions)},ms);return}var orgSuccess=ajaxOptions.success,orgError=ajaxOptions.error,eventType="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;var options=$.extend({},this.tree.options.ajaxDefaults,ajaxOptions,{success:function(data,textStatus,jqXHR){var prevPhase=self.tree.phase;self.tree.phase="init";if(options.postProcess){data=options.postProcess.call(this,data,this.dataType)}else if(data&&data.hasOwnProperty("d")){data=typeof data.d=="string"?$.parseJSON(data.d):data.d}if(!$.isArray(data)||data.length!==0){self.addChild(data,null)}self.tree.phase="postInit";if(orgSuccess){orgSuccess.call(options,self,data,textStatus)}self.tree.logDebug("trigger "+eventType);self.tree.$tree.trigger(eventType,[self,true]);self.tree.phase=prevPhase;self.setLazyNodeStatus(DTNodeStatus_Ok);if($.isArray(data)&&data.length===0){self.childList=[];self.render()}},error:function(jqXHR,textStatus,errorThrown){self.tree.logWarning("appendAjax failed:",textStatus,":\n",jqXHR,"\n",errorThrown);if(orgError){orgError.call(options,self,jqXHR,textStatus,errorThrown)}self.tree.$tree.trigger(eventType,[self,false]);self.setLazyNodeStatus(DTNodeStatus_Error,{info:textStatus,tooltip:""+errorThrown})}});$.ajax(options)},move:function(targetNode,mode){var pos;if(this===targetNode){return}if(!this.parent){throw"Cannot move system root"}if(mode===undefined||mode=="over"){mode="child"}var prevParent=this.parent;var targetParent=mode==="child"?targetNode:targetNode.parent;if(targetParent.isDescendantOf(this)){throw"Cannot move a node to it's own descendant"}if(this.parent.childList.length==1){this.parent.childList=this.parent.data.isLazy?[]:null;this.parent.bExpanded=false}else{pos=$.inArray(this,this.parent.childList);if(pos<0){throw"Internal error"}this.parent.childList.splice(pos,1)}if(this.parent.ul){this.parent.ul.removeChild(this.li)}this.parent=targetParent;if(targetParent.hasChildren()){switch(mode){case"child":targetParent.childList.push(this);break;case"before":pos=$.inArray(targetNode,targetParent.childList);if(pos<0){throw"Internal error"}targetParent.childList.splice(pos,0,this);break;case"after":pos=$.inArray(targetNode,targetParent.childList);if(pos<0){throw"Internal error"}targetParent.childList.splice(pos+1,0,this);break;default:throw"Invalid mode "+mode}}else{targetParent.childList=[this]}if(!targetParent.ul){targetParent.ul=document.createElement("ul");targetParent.ul.style.display="none";targetParent.li.appendChild(targetParent.ul)}if(this.li){targetParent.ul.appendChild(this.li)}if(this.tree!==targetNode.tree){this.visit(function(node){node.tree=targetNode.tree},null,true);throw"Not yet implemented."}if(!prevParent.isDescendantOf(targetParent)){prevParent.render()}if(!targetParent.isDescendantOf(prevParent)){targetParent.render()}},lastentry:undefined};var DynaTreeStatus=Class.create();DynaTreeStatus._getTreePersistData=function(cookieId,cookieOpts){var ts=new DynaTreeStatus(cookieId,cookieOpts);ts.read();return ts.toDict()};getDynaTreePersistData=DynaTreeStatus._getTreePersistData;DynaTreeStatus.prototype={initialize:function(cookieId,cookieOpts){if(cookieId===undefined){cookieId=$.ui.dynatree.prototype.options.cookieId}cookieOpts=$.extend({},$.ui.dynatree.prototype.options.cookie,cookieOpts);this.cookieId=cookieId;this.cookieOpts=cookieOpts;this.cookiesFound=undefined;this.activeKey=null;this.focusedKey=null;this.expandedKeyList=null;this.selectedKeyList=null},_log:function(msg){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)},read:function(){this.cookiesFound=false;var cookie=$.cookie(this.cookieId+"-active");this.activeKey=cookie===null?"":cookie;if(cookie!==null){this.cookiesFound=true}cookie=$.cookie(this.cookieId+"-focus");this.focusedKey=cookie===null?"":cookie;if(cookie!==null){this.cookiesFound=true}cookie=$.cookie(this.cookieId+"-expand");this.expandedKeyList=cookie===null?[]:cookie.split(",");if(cookie!==null){this.cookiesFound=true}cookie=$.cookie(this.cookieId+"-select");this.selectedKeyList=cookie===null?[]:cookie.split(",");if(cookie!==null){this.cookiesFound=true}},write:function(){$.cookie(this.cookieId+"-active",this.activeKey===null?"":this.activeKey,this.cookieOpts);$.cookie(this.cookieId+"-focus",this.focusedKey===null?"":this.focusedKey,this.cookieOpts);$.cookie(this.cookieId+"-expand",this.expandedKeyList===null?"":this.expandedKeyList.join(","),this.cookieOpts);$.cookie(this.cookieId+"-select",this.selectedKeyList===null?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(key){if($.inArray(key,this.expandedKeyList)<0){this.expandedKeyList.push(key);$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},clearExpand:function(key){var idx=$.inArray(key,this.expandedKeyList);if(idx>=0){this.expandedKeyList.splice(idx,1);$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},addSelect:function(key){if($.inArray(key,this.selectedKeyList)<0){this.selectedKeyList.push(key);$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},clearSelect:function(key){var idx=$.inArray(key,this.selectedKeyList);if(idx>=0){this.selectedKeyList.splice(idx,1);$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},isReloading:function(){return this.cookiesFound===true},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:undefined};var DynaTree=Class.create();DynaTree.version="$Version:$";DynaTree.prototype={initialize:function($widget){this.phase="init";this.$widget=$widget;this.options=$widget.options;this.$tree=$widget.element;this.timer=null;this.divTree=this.$tree.get(0);_initDragAndDrop(this)},_load:function(callback){var $widget=this.$widget;var opts=this.options,self=this;this.bEnableUpdate=true;this._nodeCount=1;this.activeNode=null;this.focusNode=null;if(opts.rootVisible!==undefined){this.logWarning("Option 'rootVisible' is no longer supported.")}if(opts.minExpandLevel<1){this.logWarning("Option 'minExpandLevel' must be >= 1.");opts.minExpandLevel=1}if(opts.classNames!==$.ui.dynatree.prototype.options.classNames){opts.classNames=$.extend({},$.ui.dynatree.prototype.options.classNames,opts.classNames)}if(opts.ajaxDefaults!==$.ui.dynatree.prototype.options.ajaxDefaults){opts.ajaxDefaults=$.extend({},$.ui.dynatree.prototype.options.ajaxDefaults,opts.ajaxDefaults)}if(opts.dnd!==$.ui.dynatree.prototype.options.dnd){opts.dnd=$.extend({},$.ui.dynatree.prototype.options.dnd,opts.dnd)}if(!opts.imagePath){$("script").each(function(){var _rexDtLibName=/.*dynatree[^\/]*\.js$/i;if(this.src.search(_rexDtLibName)>=0){if(this.src.indexOf("/")>=0){opts.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/"}else{opts.imagePath="skin/"}self.logDebug("Guessing imagePath from '%s': '%s'",this.src,opts.imagePath);return false}})}this.persistence=new DynaTreeStatus(opts.cookieId,opts.cookie);if(opts.persist){if(!$.cookie){_log("warn","Please include jquery.cookie.js to use persistence.")}this.persistence.read()}this.logDebug("DynaTree.persistence: %o",this.persistence.toDict());this.cache={tagEmpty:"<span class='"+opts.classNames.empty+"'></span>",tagVline:"<span class='"+opts.classNames.vline+"'></span>",tagExpander:"<span class='"+opts.classNames.expander+"'></span>",tagConnector:"<span class='"+opts.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+opts.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+opts.classNames.checkbox+"'></span>",lastentry:undefined};if(opts.children||opts.initAjax&&opts.initAjax.url||opts.initId){$(this.divTree).empty()}var $ulInitialize=this.$tree.find(">ul:first").hide();this.tnRoot=new DynaTreeNode(null,this,{});this.tnRoot.bExpanded=true;this.tnRoot.render();this.divTree.appendChild(this.tnRoot.ul);var root=this.tnRoot,isReloading=opts.persist&&this.persistence.isReloading(),isLazy=false,prevFlag=this.enableUpdate(false);this.logDebug("Dynatree._load(): read tree structure...");if(opts.children){root.addChild(opts.children)}else if(opts.initAjax&&opts.initAjax.url){isLazy=true;root.data.isLazy=true;this._reloadAjax(callback)}else if(opts.initId){this._createFromTag(root,$("#"+opts.initId))
}else{this._createFromTag(root,$ulInitialize);$ulInitialize.remove()}this._checkConsistency();if(!isLazy&&opts.selectMode==3){root._updatePartSelectionState()}this.logDebug("Dynatree._load(): render nodes...");this.enableUpdate(prevFlag);this.logDebug("Dynatree._load(): bind events...");this.$widget.bind();this.logDebug("Dynatree._load(): postInit...");this.phase="postInit";if(opts.persist){this.persistence.write()}if(this.focusNode&&this.focusNode.isVisible()){this.logDebug("Focus on init: %o",this.focusNode);this.focusNode.focus()}if(!isLazy){if(opts.onPostInit){opts.onPostInit.call(this,isReloading,false)}if(callback){callback.call(this,"ok")}}this.phase="idle"},_reloadAjax:function(callback){var opts=this.options;if(!opts.initAjax||!opts.initAjax.url){throw"tree.reload() requires 'initAjax' mode."}var pers=this.persistence;var ajaxOpts=$.extend({},opts.initAjax);if(ajaxOpts.addActiveKey){ajaxOpts.data.activeKey=pers.activeKey}if(ajaxOpts.addFocusedKey){ajaxOpts.data.focusedKey=pers.focusedKey}if(ajaxOpts.addExpandedKeyList){ajaxOpts.data.expandedKeyList=pers.expandedKeyList.join(",")}if(ajaxOpts.addSelectedKeyList){ajaxOpts.data.selectedKeyList=pers.selectedKeyList.join(",")}if(ajaxOpts.success){this.logWarning("initAjax: success callback is ignored; use onPostInit instead.")}if(ajaxOpts.error){this.logWarning("initAjax: error callback is ignored; use onPostInit instead.")}var isReloading=pers.isReloading();ajaxOpts.success=function(dtnode,data,textStatus){if(opts.selectMode==3){dtnode.tree.tnRoot._updatePartSelectionState()}if(opts.onPostInit){opts.onPostInit.call(dtnode.tree,isReloading,false)}if(callback){callback.call(dtnode.tree,"ok")}};ajaxOpts.error=function(dtnode,XMLHttpRequest,textStatus,errorThrown){if(opts.onPostInit){opts.onPostInit.call(dtnode.tree,isReloading,true,XMLHttpRequest,textStatus,errorThrown)}if(callback){callback.call(dtnode.tree,"error",XMLHttpRequest,textStatus,errorThrown)}};this.logDebug("Dynatree._init(): send Ajax request...");this.tnRoot.appendAjax(ajaxOpts)},toString:function(){return"Dynatree '"+this.$tree.attr("id")+"'"},toDict:function(){return this.tnRoot.toDict(true)},serializeArray:function(stopOnParents){var nodeList=this.getSelectedNodes(stopOnParents),name=this.$tree.attr("name")||this.$tree.attr("id"),arr=[];for(var i=0,l=nodeList.length;i<l;i++){arr.push({name:name,value:nodeList[i].data.key})}return arr},getPersistData:function(){return this.persistence.toDict()},logDebug:function(msg){if(this.options.debugLevel>=2){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}},logInfo:function(msg){if(this.options.debugLevel>=1){Array.prototype.unshift.apply(arguments,["info"]);_log.apply(this,arguments)}},logWarning:function(msg){Array.prototype.unshift.apply(arguments,["warn"]);_log.apply(this,arguments)},isInitializing:function(){return this.phase=="init"||this.phase=="postInit"},isReloading:function(){return(this.phase=="init"||this.phase=="postInit")&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return this.phase=="userEvent"},redraw:function(){this.tnRoot.render(false,false)},renderInvisibleNodes:function(){this.tnRoot.render(false,true)},reload:function(callback){this._load(callback)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(key){var el=document.getElementById(this.options.idPrefix+key);if(el){return el.dtnode?el.dtnode:null}var match=null;this.visit(function(node){if(node.data.key===key){match=node;return false}},true);return match},getActiveNode:function(){return this.activeNode},reactivate:function(setFocus){var node=this.activeNode;if(node){this.activeNode=null;node.activate();if(setFocus){node.focus()}}},getSelectedNodes:function(stopOnParents){var nodeList=[];this.tnRoot.visit(function(node){if(node.bSelected){nodeList.push(node);if(stopOnParents===true){return"skip"}}});return nodeList},activateKey:function(key){var dtnode=key===null?null:this.getNodeByKey(key);if(!dtnode){if(this.activeNode){this.activeNode.deactivate()}this.activeNode=null;return null}dtnode.focus();dtnode.activate();return dtnode},loadKeyPath:function(keyPath,callback){var segList=keyPath.split(this.options.keyPathSeparator);if(segList[0]===""){segList.shift()}if(segList[0]==this.tnRoot.data.key){this.logDebug("Removed leading root key.");segList.shift()}keyPath=segList.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(keyPath,callback)},selectKey:function(key,select){var dtnode=this.getNodeByKey(key);if(!dtnode){return null}dtnode.select(select);return dtnode},enableUpdate:function(bEnable){if(this.bEnableUpdate==bEnable){return bEnable}this.bEnableUpdate=bEnable;if(bEnable){this.redraw()}return!bEnable},count:function(){return this.tnRoot.countChildren()},visit:function(fn,includeRoot){return this.tnRoot.visit(fn,includeRoot)},_createFromTag:function(parentTreeNode,$ulParent){var self=this;$ulParent.find(">li").each(function(){var $li=$(this),$liSpan=$li.find(">span:first"),$liA=$li.find(">a:first"),title,href=null,target=null,tooltip;if($liSpan.length){title=$liSpan.html()}else if($liA.length){title=$liA.html();href=$liA.attr("href");target=$liA.attr("target");tooltip=$liA.attr("title")}else{title=$li.html();var iPos=title.search(/<ul/i);if(iPos>=0){title=$.trim(title.substring(0,iPos))}else{title=$.trim(title)}}var data={title:title,tooltip:tooltip,isFolder:$li.hasClass("folder"),isLazy:$li.hasClass("lazy"),expand:$li.hasClass("expanded"),select:$li.hasClass("selected"),activate:$li.hasClass("active"),focus:$li.hasClass("focused"),noLink:$li.hasClass("noLink")};if(href){data.href=href;data.target=target}if($li.attr("title")){data.tooltip=$li.attr("title")}if($li.attr("id")){data.key=""+$li.attr("id")}if($li.attr("data")){var dataAttr=$.trim($li.attr("data"));if(dataAttr){if(dataAttr.charAt(0)!="{"){dataAttr="{"+dataAttr+"}"}try{$.extend(data,eval("("+dataAttr+")"))}catch(e){throw"Error parsing node data: "+e+"\ndata:\n'"+dataAttr+"'"}}}var childNode=parentTreeNode.addChild(data);var $ul=$li.find(">ul:first");if($ul.length){self._createFromTag(childNode,$ul)}})},_checkConsistency:function(){},_setDndStatus:function(sourceNode,targetNode,helper,hitMode,accept){var $source=sourceNode?$(sourceNode.span):null,$target=$(targetNode.span);if(!this.$dndMarker){this.$dndMarker=$("<div id='dynatree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo($(this.divTree).parent())}if(hitMode==="after"||hitMode==="before"||hitMode==="over"){var markerOffset="0 0";var my="left center";var at="left center";switch(hitMode){case"before":this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-before");markerOffset="0 -8";my="left bottom";at="left center";break;case"after":this.$dndMarker.removeClass("dynatree-drop-before dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-after");markerOffset="0 8";my="left center";at="left bottom";break;default:this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-before");this.$dndMarker.addClass("dynatree-drop-over");$target.addClass("dynatree-drop-target");markerOffset="8 0"}this.$dndMarker.show().position({my:my,at:at,of:$target,offset:markerOffset})}else{$target.removeClass("dynatree-drop-target");this.$dndMarker.hide()}if(hitMode==="after"){$target.addClass("dynatree-drop-after")}else{$target.removeClass("dynatree-drop-after")}if(hitMode==="before"){$target.addClass("dynatree-drop-before")}else{$target.removeClass("dynatree-drop-before")}if(accept===true){if($source){$source.addClass("dynatree-drop-accept")}$target.addClass("dynatree-drop-accept");helper.addClass("dynatree-drop-accept")}else{if($source){$source.removeClass("dynatree-drop-accept")}$target.removeClass("dynatree-drop-accept");helper.removeClass("dynatree-drop-accept")}if(accept===false){if($source){$source.addClass("dynatree-drop-reject")}$target.addClass("dynatree-drop-reject");helper.addClass("dynatree-drop-reject")}else{if($source){$source.removeClass("dynatree-drop-reject")}$target.removeClass("dynatree-drop-reject");helper.removeClass("dynatree-drop-reject")}},_onDragEvent:function(eventName,node,otherNode,event,ui,draggable){var opts=this.options,dnd=this.options.dnd,res=null,nodeTag=$(node.span),hitMode,enterResponse;switch(eventName){case"helper":var $helper=$("<div class='dynatree-drag-helper'><span class='dynatree-drag-helper-img' /></div>").append($(event.target).closest(".dynatree-title").clone());$("ul.dynatree-container",node.tree.divTree).append($helper);$helper.data("dtSourceNode",node);res=$helper;break;case"start":if(node.isStatusNode()){res=false}else if(dnd.onDragStart){res=dnd.onDragStart(node)}if(res===false){this.logDebug("tree.onDragStart() cancelled");ui.helper.trigger("mouseup");ui.helper.hide()}else{nodeTag.addClass("dynatree-drag-source")}break;case"enter":res=dnd.onDragEnter?dnd.onDragEnter(node,otherNode):null;if(!res){res=false}else{res={over:res===true||res==="over"||$.inArray("over",res)>=0,before:res===true||res==="before"||$.inArray("before",res)>=0,after:res===true||res==="after"||$.inArray("after",res)>=0}}ui.helper.data("enterResponse",res);break;case"over":enterResponse=ui.helper.data("enterResponse");hitMode=null;if(enterResponse===false){}else if(typeof enterResponse==="string"){hitMode=enterResponse}else{var nodeOfs=nodeTag.offset();var relPos={x:event.pageX-nodeOfs.left,y:event.pageY-nodeOfs.top};var relPos2={x:relPos.x/nodeTag.width(),y:relPos.y/nodeTag.height()};if(enterResponse.after&&relPos2.y>.75){hitMode="after"}else if(!enterResponse.over&&enterResponse.after&&relPos2.y>.5){hitMode="after"}else if(enterResponse.before&&relPos2.y<=.25){hitMode="before"}else if(!enterResponse.over&&enterResponse.before&&relPos2.y<=.5){hitMode="before"}else if(enterResponse.over){hitMode="over"}if(dnd.preventVoidMoves){if(node===otherNode){hitMode=null}else if(hitMode==="before"&&otherNode&&node===otherNode.getNextSibling()){hitMode=null}else if(hitMode==="after"&&otherNode&&node===otherNode.getPrevSibling()){hitMode=null}else if(hitMode==="over"&&otherNode&&otherNode.parent===node&&otherNode.isLastSibling()){hitMode=null}}ui.helper.data("hitMode",hitMode)}if(hitMode==="over"&&dnd.autoExpandMS&&node.hasChildren()!==false&&!node.bExpanded){node.scheduleAction("expand",dnd.autoExpandMS)}if(hitMode&&dnd.onDragOver){res=dnd.onDragOver(node,otherNode,hitMode);if(res==="over"||res==="before"||res==="after"){hitMode=res}}this._setDndStatus(otherNode,node,ui.helper,hitMode,res!==false&&hitMode!==null);break;case"drop":var isForbidden=ui.helper.hasClass("dynatree-drop-reject");hitMode=ui.helper.data("hitMode");if(hitMode&&dnd.onDrop&&!isForbidden){dnd.onDrop(node,otherNode,hitMode,ui,draggable)}break;case"leave":node.scheduleAction("cancel");ui.helper.data("enterResponse",null);ui.helper.data("hitMode",null);this._setDndStatus(otherNode,node,ui.helper,"out",undefined);if(dnd.onDragLeave){dnd.onDragLeave(node,otherNode)}break;case"stop":nodeTag.removeClass("dynatree-drag-source");if(dnd.onDragStop){dnd.onDragStop(node)}break;default:throw"Unsupported drag event: "+eventName}return res},cancelDrag:function(){var dd=$.ui.ddmanager.current;if(dd){dd.cancel()}},lastentry:undefined};$.widget("ui.dynatree",{_init:function(){if(versionCompare($.ui.version,"1.8")<0){if(this.options.debugLevel>=0){_log("warn","ui.dynatree._init() was called; you should upgrade to jquery.ui.core.js v1.8 or higher.")}return this._create()}if(this.options.debugLevel>=2){_log("debug","ui.dynatree._init() was called; no current default functionality.")}},_create:function(){var opts=this.options;if(opts.debugLevel>=1){logMsg("Dynatree._create(): version='%s', debugLevel=%o.",$.ui.dynatree.version,this.options.debugLevel)}this.options.event+=".dynatree";var divTree=this.element.get(0);this.tree=new DynaTree(this);this.tree._load();this.tree.logDebug("Dynatree._init(): done.")},bind:function(){this.unbind();var eventNames="click.dynatree dblclick.dynatree";if(this.options.keyboard){eventNames+=" keypress.dynatree keydown.dynatree"}this.element.bind(eventNames,function(event){var dtnode=$.ui.dynatree.getNode(event.target);if(!dtnode){return true}var tree=dtnode.tree;var o=tree.options;tree.logDebug("event(%s): dtnode: %s",event.type,dtnode);var prevPhase=tree.phase;tree.phase="userEvent";try{switch(event.type){case"click":return o.onClick&&o.onClick.call(tree,dtnode,event)===false?false:dtnode._onClick(event);case"dblclick":return o.onDblClick&&o.onDblClick.call(tree,dtnode,event)===false?false:dtnode._onDblClick(event);case"keydown":return o.onKeydown&&o.onKeydown.call(tree,dtnode,event)===false?false:dtnode._onKeydown(event);case"keypress":return o.onKeypress&&o.onKeypress.call(tree,dtnode,event)===false?false:dtnode._onKeypress(event)}}catch(e){var _=null;tree.logWarning("bind(%o): dtnode: %o, error: %o",event,dtnode,e)}finally{tree.phase=prevPhase}});function __focusHandler(event){event=$.event.fix(event||window.event);var dtnode=$.ui.dynatree.getNode(event.target);return dtnode?dtnode._onFocus(event):false}var div=this.tree.divTree;if(div.addEventListener){div.addEventListener("focus",__focusHandler,true);div.addEventListener("blur",__focusHandler,true)}else{div.onfocusin=div.onfocusout=__focusHandler}},unbind:function(){this.element.unbind(".dynatree")},enable:function(){this.bind();$.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind();$.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:undefined});if(versionCompare($.ui.version,"1.8")<0){$.ui.dynatree.getter="getTree getRoot getActiveNode getSelectedNodes"}$.ui.dynatree.version="$Version:$";$.ui.dynatree.getNode=function(el){if(el instanceof DynaTreeNode){return el}if(el.selector!==undefined){el=el[0]}while(el){if(el.dtnode){return el.dtnode}el=el.parentNode}return null};$.ui.dynatree.getPersistData=DynaTreeStatus._getTreePersistData;$.ui.dynatree.prototype.options={title:"Dynatree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:true,keyboard:true,persist:false,autoCollapse:false,clickFolderMode:3,activeVisible:true,checkbox:false,selectMode:2,fx:null,noLink:false,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,autoExpandMS:1e3,preventVoidMoves:true,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:false,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:false,idPrefix:"dynatree-id-",keyPathSeparator:"/",cookieId:"dynatree",cookie:{expires:null},classNames:{container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",nodeLoading:"dynatree-loading",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},debugLevel:2,lastentry:undefined};if(versionCompare($.ui.version,"1.8")<0){$.ui.dynatree.defaults=$.ui.dynatree.prototype.options}$.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:false,isLazy:false,tooltip:null,href:null,icon:null,addClass:null,noLink:false,activate:false,focus:false,expand:false,select:false,hideCheckbox:false,unselectable:false,children:null,lastentry:undefined};function _initDragAndDrop(tree){var dnd=tree.options.dnd||null;if(dnd&&(dnd.onDragStart||dnd.onDrop)){_registerDnd()}if(dnd&&dnd.onDragStart){tree.$tree.draggable({addClasses:false,appendTo:"body",containment:false,delay:0,distance:4,revert:false,scroll:true,scrollSpeed:7,scrollSensitivity:10,connectToDynatree:true,helper:function(event){var sourceNode=$.ui.dynatree.getNode(event.target);if(!sourceNode){return"<div></div>"}return sourceNode.tree._onDragEvent("helper",sourceNode,null,event,null,null)},start:function(event,ui){var sourceNode=ui.helper.data("dtSourceNode");return!!sourceNode},_last:null})}if(dnd&&dnd.onDrop){tree.$tree.droppable({addClasses:false,tolerance:"intersect",greedy:false,_last:null})}}var didRegisterDnd=false;var _registerDnd=function(){if(didRegisterDnd){return}$.ui.plugin.add("draggable","connectToDynatree",{start:function(event,ui){var draggable=$(this).data("ui-draggable")||$(this).data("draggable"),sourceNode=ui.helper.data("dtSourceNode")||null;if(sourceNode){draggable.offset.click.top=-2;draggable.offset.click.left=+16;return sourceNode.tree._onDragEvent("start",sourceNode,null,event,ui,draggable)}},drag:function(event,ui){var draggable=$(this).data("ui-draggable")||$(this).data("draggable"),sourceNode=ui.helper.data("dtSourceNode")||null,prevTargetNode=ui.helper.data("dtTargetNode")||null,targetNode=$.ui.dynatree.getNode(event.target);if(event.target&&!targetNode){var isHelper=$(event.target).closest("div.dynatree-drag-helper,#dynatree-drop-marker").length>0;if(isHelper){return}}ui.helper.data("dtTargetNode",targetNode);if(prevTargetNode&&prevTargetNode!==targetNode){prevTargetNode.tree._onDragEvent("leave",prevTargetNode,sourceNode,event,ui,draggable)}if(targetNode){if(!targetNode.tree.options.dnd.onDrop){}else if(targetNode===prevTargetNode){targetNode.tree._onDragEvent("over",targetNode,sourceNode,event,ui,draggable)}else{targetNode.tree._onDragEvent("enter",targetNode,sourceNode,event,ui,draggable)}}},stop:function(event,ui){var draggable=$(this).data("ui-draggable")||$(this).data("draggable"),sourceNode=ui.helper.data("dtSourceNode")||null,targetNode=ui.helper.data("dtTargetNode")||null,mouseDownEvent=draggable._mouseDownEvent,eventType=event.type,dropped=eventType=="mouseup"&&event.which==1;logMsg("draggable-connectToDynatree.stop: targetNode(from event): %s, dtTargetNode: %s",targetNode,ui.helper.data("dtTargetNode"));if(!dropped){logMsg("Drag was cancelled")}if(targetNode){if(dropped){targetNode.tree._onDragEvent("drop",targetNode,sourceNode,event,ui,draggable)}targetNode.tree._onDragEvent("leave",targetNode,sourceNode,event,ui,draggable)}if(sourceNode){sourceNode.tree._onDragEvent("stop",sourceNode,null,event,ui,draggable)}}});didRegisterDnd=true}})(jQuery);(function($,window){var methods={"private":{customEvents:[],reloadNode:function(node,options,onComplete){var obj=this;var params={url:CCM_TOOLS_PATH+"/dashboard/sitemap_data",data:{cParentID:node.data.cID,displayNodePagination:options.displayNodePagination?1:0},success:function(){if(onComplete){onComplete()}}};node.appendAjax(params)},eventListenerExists:function(eventName,requestID){for(i=0;i<this.customEvents.length;i++){var eobj=this.customEvents[i];if(eobj.requestID==requestID&&eobj.eventName==eventName){return true}}return false},setupNodePagination:function($tree,nodeKey){var pg=$tree.find("span.ccm-sitemap-explore-paging");$tree.find("div.ccm-pagination-bound").remove();if(pg.length){pg.find("a").on("click",function(){var href=$(this).attr("href");$tree.dynatree("option","initAjax",{url:href});$tree.dynatree("getTree").reload();return false});pg.find("div.ccm-pagination").addClass("ccm-pagination-bound").appendTo($tree);var node=$.ui.dynatree.getNode(pg);node.remove()}},displaySingleLevel:function(node,options){if(node.data.cID==1){var minExpandLevel=2}else{var minExpandLevel=3}var root=$(node.li).closest("[data-sitemap=container]").dynatree("getRoot");$(node.li).closest("[data-sitemap=container]").dynatree("option","minExpandLevel",minExpandLevel);root.removeChildren();root.appendAjax({url:CCM_TOOLS_PATH+"/dashboard/sitemap_data",data:{displayNodePagination:options.displayNodePagination?1:0,cParentID:node.data.cID,displaySingleLevel:true},success:function(){methods.private.setupNodePagination(root.tree.$tree,node.data.key)}})},rescanDisplayOrder:function(node){node.setLazyNodeStatus(DTNodeStatus_Loading);var childNodes=node.getChildren();var params=[];for(i=0;i<childNodes.length;i++){var childNode=childNodes[i];params.push({name:"cID[]",value:childNode.data.cID})}$.ajax({dataType:"json",type:"POST",data:params,url:CCM_TOOLS_PATH+"/dashboard/sitemap_update",success:function(r){ccm_parseJSON(r,function(){});node.setLazyNodeStatus(DTNodeStatus_Ok)}})},selectMoveCopyTarget:function(node,destNode,dragMode){var dialog_title=ccmi18n_sitemap.moveCopyPage;if(!dragMode){var dragMode=""}var dialog_url=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?origCID="+node.data.cID+"&destCID="+destNode.data.cID+"&dragMode="+dragMode;var dialog_height=350;var dialog_width=350;$.fn.dialog.open({title:dialog_title,href:dialog_url,width:dialog_width,modal:false,height:dialog_height,onOpen:function(){$("#ctaskMove").on("click",function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=true;$("#copyChildren").get(0).disabled=true;$("#saveOldPagePath").attr("disabled",false)}});$("#ctaskAlias").on("click",function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=true;$("#copyChildren").get(0).disabled=true;$("#saveOldPagePath").attr("checked",false);$("#saveOldPagePath").attr("disabled","disabled")}});$("#ctaskCopy").on("click",function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=false;$("#copyThisPage").get(0).checked=true;$("#copyChildren").get(0).disabled=false;$("#saveOldPagePath").attr("checked",false);$("#saveOldPagePath").attr("disabled","disabled")}})}});$("[data-sitemap=container]").on("dragRequestComplete",function(e,mode){if(mode=="MOVE"){node.remove()}var reloadNode=destNode.parent;if(dragMode=="over"){reloadNode=destNode}reloadNode.removeChildren();methods.private.reloadNode(reloadNode,$(this).data("options"),function(){if(!destNode.bExpanded){destNode.expand(true)}});$(this).unbind("dragRequestComplete")})}},getMenu:function(data){var menu='<div class="ccm-sitemap-menu popover fade"><div class="arrow"></div><div class="popover-inner">';menu+='<ul class="dropdown-menu">';if(data.isTrash&&data.numSubpages){menu+="<li><a onclick=\"$.fn.ccmsitemap('deleteForever', this, "+data.cID+')" href="javascript:void(0)">'+ccmi18n_sitemap.emptyTrash+"</a></li>"}else if(data.isInTrash){menu+='<li><a onclick="ccm_previewInternalTheme('+data.cID+", false, '"+ccmi18n_sitemap.previewPage+'\')" href="javascript:void(0)">'+ccmi18n_sitemap.previewPage+"</a></li>";menu+='<li class="divider"></li>';menu+="<li><a onclick=\"$.fn.ccmsitemap('deleteForever', this, "+data.cID+')" href="javascript:void(0)">'+ccmi18n_sitemap.deletePageForever+"</a></li>"}else if(data.cAlias=="LINK"||data.cAlias=="POINTER"){menu+="<li><a onclick=\"window.location.href='"+CCM_DISPATCHER_FILENAME+"?cID="+data.cID+'\'" href="javascript:void(0)">'+ccmi18n_sitemap.visitExternalLink+"</a></li>";if(data.cAlias=="LINK"&&data.canEditProperties){menu+='<li><a dialog-width="350" dialog-height="170" dialog-title="'+ccmi18n_sitemap.editExternalLink+'" dialog-modal="false" dialog-append-buttons="true" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+'&ctask=edit_external">'+ccmi18n_sitemap.editExternalLink+"</a></li>"}if(data.canDelete){menu+='<li><a dialog-width="360" dialog-height="150" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.deleteExternalLink+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+"&display_mode="+data.display_mode+"&select_mode="+data.select_mode+'&ctask=delete_external">'+ccmi18n_sitemap.deleteExternalLink+"</a></li>"}menu+="<li><a onclick=\"$.fn.ccmsitemap('deleteForever', this, "+data.cID+')" href="javascript:void(0)">'+ccmi18n_sitemap.deletePageForever+"</a></li>"}else{menu+='<li><a href="'+CCM_DISPATCHER_FILENAME+"?cID="+data.cID+'">'+ccmi18n_sitemap.visitPage+"</a></li>";if(data.canEditPageProperties||data.canEditPageSpeedSettings||data.canEditPagePermissions||data.canEditPageDesign||data.canViewPageVersions||data.canDeletePage){menu+='<li class="divider"></li>'}if(data.canEditPageProperties){menu+='<li><a class="dialog-launch" dialog-on-close="$.fn.ccmsitemap(\'exitEditMode\', '+data.cID+')" dialog-width="850" dialog-height="360" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pagePropertiesTitle+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+'&ctask=edit_metadata">'+ccmi18n_sitemap.pageProperties+"</a></li>"}if(data.canEditPageSpeedSettings){menu+='<li><a class="dialog-launch" dialog-on-close="$.fn.ccmsitemap(\'exitEditMode\', '+data.cID+')" dialog-width="550" dialog-height="280" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.speedSettingsTitle+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+'&ctask=edit_speed_settings">'+ccmi18n_sitemap.speedSettings+"</a></li>"}if(data.canEditPagePermissions){menu+='<li><a class="dialog-launch" dialog-on-close="$.fn.ccmsitemap(\'exitEditMode\', '+data.cID+')" dialog-width="420" dialog-height="630" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.setPagePermissions+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+'&ctask=edit_permissions">'+ccmi18n_sitemap.setPagePermissions+"</a></li>"}if(data.canEditPageDesign){menu+='<li><a class="dialog-launch" dialog-on-close="$.fn.ccmsitemap(\'exitEditMode\', '+data.cID+')" dialog-width="610" dialog-height="405" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageDesign+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+'&ctask=set_theme">'+ccmi18n_sitemap.pageDesign+"</a></li>"}if(data.canViewPageVersions){menu+='<li><a class="dialog-launch" dialog-on-close="$.fn.ccmsitemap(\'exitEditMode\', '+data.cID+')" dialog-width="640" dialog-height="340" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageVersions+'" href="'+CCM_TOOLS_PATH+"/versions.php?rel=SITEMAP&cID="+data.cID+'">'+ccmi18n_sitemap.pageVersions+"</a></li>"}if(data.canDeletePage){menu+='<li><a class="dialog-launch" dialog-on-close="$.fn.ccmsitemap(\'exitEditMode\', '+data.cID+')" dialog-width="360" dialog-height="150" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.deletePage+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+"&display_mode="+data.display_mode+"&select_mode="+data.select_mode+'&ctask=delete">'+ccmi18n_sitemap.deletePage+"</a></li>"}if(data.display_mode=="explore"||data.display_mode=="search"){menu+='<li class="divide"></li>';menu+='<li><a class="dialog-launch" dialog-width="90%" dialog-height="70%" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.moveCopyPage+'" href="'+CCM_TOOLS_PATH+"/sitemap_search_selector?sitemap_select_mode=move_copy_delete&cID="+data.cID+'" id="menuMoveCopy'+data.cID+'">'+ccmi18n_sitemap.moveCopyPage+"</a></li>";if(data.display_mode=="explore"){menu+='<li><a href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+data.cID+'&task=send_to_top">'+ccmi18n_sitemap.sendToTop+"</a></li>";menu+='<li><a href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+data.cID+'&task=send_to_bottom">'+ccmi18n_sitemap.sendToBottom+"</a></li>"}}if(data.numSubpages>0){menu+='<li class="divider"></li>';var searchURL=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/search/?selectedSearchField[]=parent&cParentAll=1&cParentIDSearchField="+data.cID;if(data.display_mode=="full"||data.display_mode==""||data.display_mode=="explore"){menu+='<li><a class="ccm-menu-icon ccm-icon-search-pages" href="'+searchURL+'">'+ccmi18n_sitemap.searchPages+"</a></li>"}if(data.display_mode!="explore"){menu+='<li><a href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+data.cID+'">'+ccmi18n_sitemap.explorePages+"</a></li>"}}if(data.canAddSubpages||data.canAddExternalLinks){menu+='<li class="divider"></li>'}if(data.canAddExternalLinks){menu+='<li><a class="dialog-launch" dialog-width="350" dialog-modal="false" dialog-height="170" dialog-title="'+ccmi18n_sitemap.addExternalLink+'" dialog-modal="false" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+data.cID+'&ctask=add_external">'+ccmi18n_sitemap.addExternalLink+"</a></li>"}}menu+="</ul></div></div>";var $menu=$(menu);if($menu.find("li").length==0){return false}return $menu},exitEditMode:function(cID){$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_check_in?cID="+cID+"&ccm_token="+CCM_SECURITY_TOKEN)},highlight:function(cID){var tree=$("[data-sitemap=container]").dynatree("getTree");var node=tree.getNodeByKey(cID);$(node.span).find("a").hide().show("highlight")},deleteForever:function(link,cID,isTrash){var node=$("[data-sitemap=container]").dynatree("getActiveNode");var isTrash=node.data.isTrash;if(isTrash){var trash=node;var numSubpages=trash.data.numSubpages-1}else{var trash=node.parent}var dialogTitle=isTrash?ccmi18n_sitemap.emptyTrash:ccmi18n_sitemap.deletePages;var params=[];ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_delete_forever",[{name:"cID",value:cID}],dialogTitle,function(){trash.reloadChildren();if(isTrash){trash.data.numSubpages=numSubpages}ccmAlert.hud(ccmi18n_sitemap.deletePageSuccessMsg,2e3)})},refreshCopyOperations:function(){var dialogTitle=ccmi18n_sitemap.copyProgressTitle;ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_copy_all",[],dialogTitle,function(){$(".ui-dialog-content").dialog("close");window.location.reload()})},triggerEvent:function(eventName,args,requestID){if(requestID){return $("[data-sitemap-request-id="+requestID+"]").trigger(eventName,args)}else{return $("[data-sitemap=container]").trigger(eventName,args)}},submitDragRequest:function(){var origCID=$("#origCID").val();var destParentID=$("#destParentID").val();var destCID=$("#destCID").val();var dragMode=$("#dragMode").val();var destSibling=$("#destSibling").val();var ctask=$("input[name=ctask]:checked").val();var display_mode=$("input[name=display_mode]").val();var select_mode=$("input[name=select_mode]").val();var copyAll=$("input[name=copyAll]:checked").val();var saveOldPagePath=$("input[name=saveOldPagePath]:checked").val();params={origCID:origCID,destCID:destCID,ctask:ctask,ccm_token:CCM_SECURITY_TOKEN,copyAll:copyAll,destSibling:destSibling,dragMode:dragMode,saveOldPagePath:saveOldPagePath};if(copyAll==1){var dialogTitle=ccmi18n_sitemap.copyProgressTitle;ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_copy_all",[{name:"origCID",value:origCID},{name:"destCID",value:destCID}],dialogTitle,function(){$(".ui-dialog-content").dialog("close");$.fn.ccmsitemap("triggerEvent","dragRequestComplete",[ctask])})}else{jQuery.fn.dialog.showLoader();$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php",params,function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeAll();jQuery.fn.dialog.hideLoader();ccmAlert.hud(resp.message,2e3);$.fn.ccmsitemap("triggerEvent","dragRequestComplete",[ctask]);jQuery.fn.dialog.closeTop();jQuery.fn.dialog.closeTop()})})}},onNodeSelected:function(requestID,onComplete){methods.private.customEvents.push({eventName:"selectNode",requestID:requestID,onComplete:onComplete})},init:function(options){$("#ccm-show-all-pages-cb").on("click",function(){var showSystemPages=$(this).get(0).checked==true?1:0;$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?show_system="+showSystemPages,function(resp){location.reload()})});var settings=$.extend({displayNodePagination:false,cParentID:0,requestID:(new Date).getTime(),displaySingleLevel:false},options);
var doPersist=true;if(settings.displaySingleLevel){if(settings.cParentID==1){var minExpandLevel=2}else{var minExpandLevel=3}var doPersist=false}else{var minExpandLevel=1}$.fn.ccmmenu.enable();return this.each(function(){$(this).attr("data-sitemap","container").attr("data-sitemap-request-id",settings.requestID);for(i=0;i<methods.private.customEvents.length;i++){var eobj=methods.private.customEvents[i];$("[data-sitemap-request-id="+eobj.requestID+"]").on("selectNode",function(sitemapEvent,mouseEvent,node){eobj.onComplete(node);return true})}var $obj=$(this);$(this).data("options",settings);$(this).dynatree({autoFocus:false,cookieId:"ccmsitemap",cookie:{path:CCM_REL+"/"},persist:doPersist,initAjax:{url:CCM_TOOLS_PATH+"/dashboard/sitemap_data",data:{displayNodePagination:settings.displayNodePagination?1:0,cParentID:settings.cParentID,displaySingleLevel:settings.displaySingleLevel?1:0}},onPostInit:function(){if(settings.displayNodePagination){methods.private.setupNodePagination($obj,settings.cParentID)}},selectMode:1,minExpandLevel:minExpandLevel,clickFolderMode:2,onLazyRead:function(node){if(settings.displaySingleLevel){methods.private.displaySingleLevel(node,settings)}else{methods.private.reloadNode(node,settings)}},onExpand:function(expand,node){if(expand&&settings.displaySingleLevel){methods.private.displaySingleLevel(node,settings)}},onClick:function(node,e){if(node.getEventTargetType(e)=="title"&&node.data.cID){$.fn.ccmsitemap("triggerEvent","startSelectNode",[e,node,settings.requestID])}else if(node.data.href){window.location.href=node.data.href}},fx:{height:"toggle",duration:200},dnd:{onDragStart:function(node){if(node.data.cID){return true}return false},onDragStop:function(node){},autoExpandMS:1e3,preventVoidMoves:true,onDragEnter:function(node,sourceNode){return true},onDragOver:function(node,sourceNode,hitMode){if(!node.parent.data.cID){return false}if(!node.data.cID&&hitMode=="after"){return false}if(node.isDescendantOf(sourceNode)){return false}return true},onDrop:function(node,sourceNode,hitMode,ui,draggable){if(node.parent.data.cID==sourceNode.parent.data.cID&&hitMode!="over"){sourceNode.move(node,hitMode);methods.private.rescanDisplayOrder(sourceNode.parent)}else{methods.private.selectMoveCopyTarget(sourceNode,node,hitMode)}}}});if(settings.displayNodePagination){$(this).dynatree("option","onActivate",function(node){if($(node.span).hasClass("ccm-sitemap-explore-paging")){node.deactivate()}})}$(this).on("startSelectNode",function(sitemapEvent,mouseEvent,node,requestID){if(methods.private.eventListenerExists("selectNode",requestID)){var r=$.fn.ccmsitemap("triggerEvent","selectNode",[mouseEvent,node],requestID)}else{var $menu=methods.getMenu(node.data);if($menu){$.fn.ccmmenu.showmenu(mouseEvent,$menu)}}});$(this).on("deleteRequestComplete",function(e,response){if(response.deferred){ccmAlert.hud(ccmi18n_sitemap.deletePageSuccessDeferredMsg,2e3,"delete_small",ccmi18n_sitemap.deletePage)}else{ccmAlert.hud(ccmi18n_sitemap.deletePageSuccessMsg,2e3,"delete_small",ccmi18n_sitemap.deletePage);if(response.display_mode=="explore"){ccmSitemapExploreNode(response.instance_id,"explore",response.select_mode,response.cParentID)}else{var node=$("[data-sitemap=container]").dynatree("getActiveNode");var parent=node.parent;methods.private.reloadNode(parent,$(this).data("options"))}}});$(this).on("updateRequestComplete",function(e,cID,name){var tree=$("[data-sitemap=container]").dynatree("getTree");var node=tree.getNodeByKey(cID);node.setTitle(name)})})}};$.fn.ccmsitemap=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ccmsitemap")}}})(jQuery,window);ccm_sitemapSetupSearch=function(instance_id){$.fn.ccmmenu.enable();ccm_setupAdvancedSearch(instance_id);ccm_sitemapSetupSearchPages(instance_id);ccm_searchActivatePostFunction[instance_id]=function(){ccm_sitemapSetupSearchPages(instance_id);ccm_sitemapSearchSetupCheckboxes(instance_id)};ccm_sitemapSearchSetupCheckboxes(instance_id)};ccm_sitemapSearchSetupCheckboxes=function(instance_id){$("#ccm-"+instance_id+"-list-cb-all").click(function(e){e.stopPropagation();if($(this).prop("checked")==true){$(".ccm-list-record td.ccm-"+instance_id+"-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",false)}else{$(".ccm-list-record td.ccm-"+instance_id+"-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",true)}});$("td.ccm-"+instance_id+"-list-cb input[type=checkbox]").click(function(e){e.stopPropagation();if($("td.ccm-"+instance_id+"-list-cb input[type=checkbox]:checked").length>0){$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",true)}});$("#ccm-"+instance_id+"-list-multiple-operations").change(function(){var action=$(this).val();cIDstring="";$("td.ccm-"+instance_id+"-list-cb input[type=checkbox]:checked").each(function(){cIDstring=cIDstring+"&cID[]="+$(this).val()});switch(action){case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/delete?"+cIDstring+"&searchInstance="+instance_id,title:ccmi18n_sitemap.deletePages});break;case"design":jQuery.fn.dialog.open({width:610,height:405,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/design?"+cIDstring+"&searchInstance="+instance_id,title:ccmi18n_sitemap.pageDesign});break;case"move_copy":jQuery.fn.dialog.open({width:640,height:340,modal:false,href:CCM_TOOLS_PATH+"/sitemap_overlay?instance_id="+instance_id+"&select_mode=move_copy_delete&"+cIDstring,title:ccmi18n_sitemap.moveCopyPage});break;case"speed_settings":jQuery.fn.dialog.open({width:610,height:340,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/speed_settings?"+cIDstring,title:ccmi18n_sitemap.speedSettingsTitle});break;case"permissions":jQuery.fn.dialog.open({width:430,height:630,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/permissions?"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"permissions_add_access":jQuery.fn.dialog.open({width:440,height:200,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/permissions_access?task=add&"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"permissions_remove_access":jQuery.fn.dialog.open({width:440,height:300,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/permissions_access?task=remove&"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"properties":jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/pages/bulk_metadata_update?"+cIDstring,title:ccmi18n_sitemap.pagePropertiesTitle});break}$(this).get(0).selectedIndex=0})};ccm_sitemapSetupSearchPages=function(instance_id){$("#ccm-"+instance_id+"-list tr").click(function(e){var node=$(this);if(node.hasClass("ccm-results-list-header")){return false}var $menu=$.fn.ccmsitemap("getMenu",jQuery.parseJSON($(this).attr("data-page-menu")));if($menu){$.fn.ccmmenu.showmenu(e,$menu)}})};var ccmCustomStyle={tabs:function(aLink,tab){$(".ccm-styleEditPane").hide();$("#ccm-styleEditPane-"+tab).show();$(aLink.parentNode.parentNode).find("li").removeClass("ccm-nav-active");$(aLink.parentNode).addClass("ccm-nav-active");return false},resetAll:function(){if(!confirm(ccmi18n.confirmCssReset)){return false}jQuery.fn.dialog.showLoader();$("#ccm-reset-style").val(1);$("#ccmCustomCssForm").get(0).submit();return true},showPresetDeleteIcon:function(){if($("select[name=cspID]").val()>0){$("#ccm-style-delete-preset").show()}else{$("#ccm-style-delete-preset").hide()}},deletePreset:function(){var cspID=$("select[name=cspID]").val();if(cspID>0){if(!confirm(ccmi18n.confirmCssPresetDelete))return false;var action=$("#ccm-custom-style-refresh-action").val()+"&deleteCspID="+cspID+"&subtask=delete_custom_style_preset";jQuery.fn.dialog.showLoader();$.get(action,function(r){$("#ccm-custom-style-wrapper").html(r);jQuery.fn.dialog.hideLoader()})}},initForm:function(){if($("#cspFooterPreset").length>0){$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select, #ccmCustomCssFormTabs textarea").bind("change click",function(){$("#cspFooterPreset").show();$("#cspFooterNoPreset").remove();$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select").unbind("change click")})}$("input[name=cspPresetAction]").click(function(){if($(this).val()=="create_new_preset"&&$(this).prop("checked")){$("input[name=cspName]").attr("disabled",false).focus()}else{$("input[name=cspName]").val("").attr("disabled",true)}});ccmCustomStyle.showPresetDeleteIcon();ccmCustomStyle.lastPresetID=parseInt($("select[name=cspID]").val());$("select[name=cspID]").change(function(){var cspID=parseInt($(this).val());var selectedCsrID=parseInt($("input[name=selectedCsrID]").val());if(ccmCustomStyle.lastPresetID==cspID)return false;ccmCustomStyle.lastPresetID=cspID;jQuery.fn.dialog.showLoader();if(cspID>0){var action=$("#ccm-custom-style-refresh-action").val()+"&cspID="+cspID}else{var action=$("#ccm-custom-style-refresh-action").val()+"&csrID="+selectedCsrID}$.get(action,function(r){$("#ccm-custom-style-wrapper").html(r);jQuery.fn.dialog.hideLoader()})});$("#ccmCustomCssForm").submit(function(){if($("input[name=cspCreateNew]").prop("checked")==true){if($("input[name=cspName]").val()==""){$("input[name=cspName]").focus();alert(ccmi18n.errorCustomStylePresetNoName);return false}}jQuery.fn.dialog.showLoader();return true});if(!parseInt(ccmCustomStyle.lastPresetID))setTimeout('$("#ccmCustomCssFormTabs input").attr("disabled", false).get(0).focus()',500)},validIdCheck:function(el,prevID){var selEl=$("#"+el.value);if(selEl&&selEl.get(0)&&selEl.get(0).id!=prevID){$("#ccm-styles-invalid-id").css("display","block")}else{$("#ccm-styles-invalid-id").css("display","none")}}};ccm_activateTabBar=function(selector){$("#ccm-tab-content-"+selector.find("li[class=active] a").attr("data-tab")).show();selector.find("a").unbind().click(function(){selector.find("li").removeClass("active");$(this).parent().addClass("active");selector.find("a").each(function(){$("#ccm-tab-content-"+$(this).attr("data-tab")).hide()});var tab=$(this).attr("data-tab");$("#ccm-tab-content-"+tab).show();return false})};var CCMToolbar=function(){var $toolbar=$("#ccm-toolbar");var $searchInput=$("#ccm-nav-intelligent-search");var $searchResults=$("#ccm-intelligent-search-results");var remotesearchquery,ajaxtimer;setupToolbarMenus=function(){$("a[data-toggle=ccm-toolbar-hover-menu]").hoverIntent(function(){$(".ccm-toolbar-hover-menu").hide();$($(this).attr("data-toggle-menu")).show()},function(){});$(document).on("click.ccm-toolbar",function(){$(".ccm-toolbar-hover-menu").hide()});$toolbar.find("#ccm-toolbar").on("click",function(e){e.stopPropagation()});$toolbar.find("#ccm-exit-edit-mode-comment form").on("click",function(e){e.stopPropagation()});$($toolbar.find(".ccm-toolbar-hover-menu a")).on("click",function(){$(".ccm-toolbar-hover-menu").hide()});$toolbar.find("li.pull-left").last().addClass("ccm-toolbar-last-left-child");$toolbar.find("#ccm-exit-edit-mode-publish-menu a").on("click",function(){switch($(this).data("publish-action")){case"approve":$("#ccm-approve-field").val("APPROVE");break;case"discard":$("#ccm-approve-field").val("DISCARD");break}$("#ccm-exit-edit-mode-comment form").submit()})};setupStatusBar=function(){$("#ccm-page-status-bar .alert").bind("closed",function(){$(this).remove();var visi=$("#ccm-page-status-bar .alert:visible").length;if(visi==0){$("#ccm-page-status-bar").remove()}});$("#ccm-page-status-bar .ccm-status-bar-ajax-form").ajaxForm({dataType:"json",beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(r){if(r.redirect){window.location.href=r.redirect}}})};setupIntelligentSearch=function(){$searchInput.bind("keydown.ccm-intelligent-search",function(e){if(e.keyCode==13||e.keyCode==40||e.keyCode==38){e.preventDefault();e.stopPropagation();if(e.keyCode==13&&$("a.ccm-intelligent-search-result-selected").length>0){var href=$("a.ccm-intelligent-search-result-selected").attr("href");if(!href||href=="#"||href=="javascript:void(0)"){$("a.ccm-intelligent-search-result-selected").click()}else{window.location.href=href}}var visibleitems=$("#ccm-intelligent-search-results li:visible");var sel;if(e.keyCode==40||e.keyCode==38){$.each(visibleitems,function(i,item){if($(item).children("a").hasClass("ccm-intelligent-search-result-selected")){if(e.keyCode==38){io=visibleitems[i-1]}else{io=visibleitems[i+1]}sel=$(io).find("a")}});if(sel&&sel.length>0){$("a.ccm-intelligent-search-result-selected").removeClass();$(sel).addClass("ccm-intelligent-search-result-selected")}}}});$searchInput.liveUpdate("ccm-intelligent-search-results","intelligent-search");$searchInput.bind("keyup.ccm-intelligent-search",function(e){doRemoteSearchCall($(this).val())});$searchInput.bind("click",function(e){if(this.value==""){$searchResults.hide()}})};activateIntelligentSearchResults=function(){if($("#ccm-intelligent-search-results div:visible").length==0){$("#ccm-intelligent-search-results").hide()}$("#ccm-intelligent-search-results a").hover(function(){$("a.ccm-intelligent-search-result-selected").removeClass();$(this).addClass("ccm-intelligent-search-result-selected")},function(){$(this).removeClass("ccm-intelligent-search-result-selected")})};doRemoteSearchCall=function(query){query=jQuery.trim(query);if(!query){return}if(query.length>2){if(query==remotesearchquery){return}if(ajaxtimer){window.clearTimeout(ajaxtimer)}remotesearchquery=query;ajaxtimer=window.setTimeout(function(){ajaxtimer=null;$("#ccm-intelligent-search-results-list-marketplace").parent().show();$("#ccm-intelligent-search-results-list-help").parent().show();$("#ccm-intelligent-search-results-list-your-site").parent().show();$("#ccm-intelligent-search-results-list-marketplace").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").parent().addClass("ccm-intelligent-search-results-module-loading");$.getJSON(CCM_TOOLS_PATH+"/marketplace/intelligent_search",{q:remotesearchquery},function(r){$("#ccm-intelligent-search-results-list-marketplace").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-marketplace").html("");for(i=0;i<r.length;i++){var rr=r[i];var _onclick="ccm_getMarketplaceItemDetails("+rr.mpID+")";$("#ccm-intelligent-search-results-list-marketplace").append('<li><a href="javascript:void(0)" onclick="'+_onclick+'"><img src="'+rr.img+'" />'+rr.name+"</a></li>")}if(r.length==0){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/get_remote_help",{q:remotesearchquery},function(r){$("#ccm-intelligent-search-results-list-help").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").html("");for(i=0;i<r.length;i++){var rr=r[i];$("#ccm-intelligent-search-results-list-help").append('<li><a href="'+rr.href+'">'+rr.name+"</a></li>")}if(r.length==0){$("#ccm-intelligent-search-results-list-help").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-help").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/pages/intelligent_search",{q:remotesearchquery},function(r){$("#ccm-intelligent-search-results-list-your-site").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").html("");for(i=0;i<r.length;i++){var rr=r[i];$("#ccm-intelligent-search-results-list-your-site").append('<li><a href="'+rr.href+'">'+rr.name+"</a></li>")}if(r.length==0){$("#ccm-intelligent-search-results-list-your-site").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-your-site").parent().hide()})},500)}};return{start:function(){if($toolbar.length>0){$toolbar.find(".dialog-launch").dialog();setupToolbarMenus();setupStatusBar();setupIntelligentSearch();$("#ccm-toolbar-menu-dashboard").on("click",function(e){e.stopPropagation()})}},disableDirectExit:function(){$("li.ccm-toolbar-page-edit a").attr("data-toggle-menu","#ccm-exit-edit-mode-comment");setupToolbarMenus()}}}();function ccm_previewInternalTheme(cID,themeID,themeName){var ctID=$("input[name=ctID]").val();$.fn.dialog.open({title:themeName,href:CCM_TOOLS_PATH+"/themes/preview?themeID="+themeID+"&previewCID="+cID+"&ctID="+ctID,width:"85%",modal:false,height:"75%"})}function ccm_previewMarketplaceTheme(cID,themeCID,themeName,themeHandle){var ctID=$("input[name=ctID]").val();$.fn.dialog.open({title:themeName,href:CCM_TOOLS_PATH+"/themes/preview?themeCID="+themeCID+"&previewCID="+cID+"&themeHandle="+encodeURIComponent(themeHandle)+"&ctID="+ctID,width:"85%",modal:false,height:"75%"})}ccm_marketplaceDetailShowMore=function(){$(".ccm-marketplace-item-information-more").hide();$(".ccm-marketplace-item-information-inner").css("max-height","none")};ccm_marketplaceUpdatesShowMore=function(obj){$(obj).parent().hide();$(obj).parent().parent().find(".ccm-marketplace-update-changelog").css("max-height","none")};ccm_enableDesignScrollers=function(){$("a.ccm-scroller-l").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l.png")});$("a.ccm-scroller-r").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r.png")});var numThumbs=4;var thumbWidth=132;$("a.ccm-scroller-r").unbind("click");$("a.ccm-scroller-l").unbind("click");$("a.ccm-scroller-r").click(function(){var item=$(this).parent().children("div.ccm-scroller-inner").children("ul");var currentPage=$(this).parent().attr("current-page");var currentPos=$(this).parent().attr("current-pos");var numPages=$(this).parent().attr("num-pages");var migratePos=numThumbs*thumbWidth;currentPos=parseInt(currentPos)-migratePos;currentPage++;$(this).parent().attr("current-page",currentPage);$(this).parent().attr("current-pos",currentPos);if(currentPage==numPages){$(this).hide()}if(currentPage>1){$(this).siblings("a.ccm-scroller-l").show()}$(item).css("left",currentPos+"px")});$("a.ccm-scroller-l").click(function(){var item=$(this).parent().children("div.ccm-scroller-inner").children("ul");var currentPage=$(this).parent().attr("current-page");var currentPos=$(this).parent().attr("current-pos");var numPages=$(this).parent().attr("num-pages");var migratePos=numThumbs*thumbWidth;currentPos=parseInt(currentPos)+migratePos;currentPage--;$(this).parent().attr("current-page",currentPage);$(this).parent().attr("current-pos",currentPos);if(currentPage==1){$(this).hide()}if(currentPage<numPages){$(this).siblings("a.ccm-scroller-r").show()}$(item).css("left",currentPos+"px")});$("a.ccm-scroller-l").hide();$("a.ccm-scroller-r").each(function(){if(parseInt($(this).parent().attr("num-pages"))==1){$(this).hide()}});$("#ccm-select-page-type a").click(function(){$("#ccm-select-page-type li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=ctID]").val($(this).attr("ccm-page-type-id"))});$("#ccm-select-theme a").click(function(){$("#ccm-select-theme li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=plID]").val($(this).attr("ccm-theme-id"))})};