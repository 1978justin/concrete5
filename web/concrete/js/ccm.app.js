(function($){var ColorPicker=function(){var ids={},inAction,charMin=65,visible,tpl='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" class="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><input type="button" class="colorpicker_none" name="none" value="x" /><input type="button" class="colorpicker_submit" name="save" value="Ok" /></div>',defaults={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onNone:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},fillRGBFields=function(hsb,cal){var rgb=HSBToRGB(hsb);$(cal).data("colorpicker").fields.eq(1).val(rgb.r).end().eq(2).val(rgb.g).end().eq(3).val(rgb.b).end()},fillHSBFields=function(hsb,cal){$(cal).data("colorpicker").fields.eq(4).val(hsb.h).end().eq(5).val(hsb.s).end().eq(6).val(hsb.b).end()},fillHexFields=function(hsb,cal){$(cal).data("colorpicker").fields.eq(0).val(HSBToHex(hsb)).end()},setSelector=function(hsb,cal){$(cal).data("colorpicker").selector.css("backgroundColor","#"+HSBToHex({h:hsb.h,s:100,b:100}));$(cal).data("colorpicker").selectorIndic.css({left:parseInt(150*hsb.s/100,10),top:parseInt(150*(100-hsb.b)/100,10)})},setHue=function(hsb,cal){$(cal).data("colorpicker").hue.css("top",parseInt(150-150*hsb.h/360,10))},setCurrentColor=function(hsb,cal){$(cal).data("colorpicker").currentColor.css("backgroundColor","#"+HSBToHex(hsb))},setNewColor=function(hsb,cal){$(cal).data("colorpicker").newColor.css("backgroundColor","#"+HSBToHex(hsb))},keyDown=function(ev){var pressedKey=ev.charCode||ev.keyCode||-1;if(pressedKey>charMin&&pressedKey<=90||pressedKey==32){return false}var cal=$(this).parent().parent();if(cal.data("colorpicker").livePreview===true){change.apply(this)}},change=function(ev){var cal=$(this).parent().parent(),col;if(!cal.data("colorpicker")||!cal.data("colorpicker").fields)return;if(this.parentNode.className.indexOf("_hex")>0){cal.data("colorpicker").color=col=HexToHSB(fixHex(this.value))}else if(this.parentNode.className.indexOf("_hsb")>0){cal.data("colorpicker").color=col=fixHSB({h:parseInt(cal.data("colorpicker").fields.eq(4).val(),10),s:parseInt(cal.data("colorpicker").fields.eq(5).val(),10),b:parseInt(cal.data("colorpicker").fields.eq(6).val(),10)})}else{cal.data("colorpicker").color=col=RGBToHSB(fixRGB({r:parseInt(cal.data("colorpicker").fields.eq(1).val(),10),g:parseInt(cal.data("colorpicker").fields.eq(2).val(),10),b:parseInt(cal.data("colorpicker").fields.eq(3).val(),10)}))}if(ev){fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0))}setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data("colorpicker").onChange.apply(cal,[col,HSBToHex(col),HSBToRGB(col)])},blur=function(ev){var cal=$(this).parent().parent();var colorpicker=cal.data("colorpicker");if(colorpicker&&colorpicker.fields)colorpicker.fields.parent().removeClass("colorpicker_focus")},focus=function(){charMin=this.parentNode.className.indexOf("_hex")>0?70:65;var colorpicker=$(this).parent().parent().data("colorpicker");if(colorpicker&&colorpicker.fields)colorpicker.fields.parent().removeClass("colorpicker_focus");$(this).parent().addClass("colorpicker_focus")},downIncrement=function(ev){var field=$(this).parent().find("input").focus();var current={el:$(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:ev.pageY,field:field,val:parseInt(field.val(),10),preview:$(this).parent().parent().data("colorpicker").livePreview};$(document).bind("mouseup",current,upIncrement);$(document).bind("mousemove",current,moveIncrement)},moveIncrement=function(ev){ev.data.field.val(Math.max(0,Math.min(ev.data.max,parseInt(ev.data.val+ev.pageY-ev.data.y,10))));if(ev.data.preview){change.apply(ev.data.field.get(0),[true])}return false},upIncrement=function(ev){change.apply(ev.data.field.get(0),[true]);ev.data.el.removeClass("colorpicker_slider").find("input").focus();$(document).unbind("mouseup",upIncrement);$(document).unbind("mousemove",moveIncrement);return false},downHue=function(ev){var current={cal:$(this).parent(),y:$(this).offset().top};current.preview=current.cal.data("colorpicker").livePreview;$(document).bind("mouseup",current,upHue);$(document).bind("mousemove",current,moveHue)},moveHue=function(ev){change.apply(ev.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,ev.pageY-ev.data.y)))/150,10)).get(0),[ev.data.preview]);return false},upHue=function(ev){fillRGBFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));$(document).unbind("mouseup",upHue);$(document).unbind("mousemove",moveHue);return false},downSelector=function(ev){var current={cal:$(this).parent(),pos:$(this).offset()};current.preview=current.cal.data("colorpicker").livePreview;$(document).bind("mouseup",current,upSelector);$(document).bind("mousemove",current,moveSelector)},moveSelector=function(ev){change.apply(ev.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,ev.pageY-ev.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,ev.pageX-ev.data.pos.left))/150,10)).get(0),[ev.data.preview]);return false},upSelector=function(ev){fillRGBFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data("colorpicker").color,ev.data.cal.get(0));$(document).unbind("mouseup",upSelector);$(document).unbind("mousemove",moveSelector);return false},enterSubmit=function(ev){$(this).addClass("colorpicker_focus")},leaveSubmit=function(ev){$(this).removeClass("colorpicker_focus")},clickSubmit=function(ev){var cal=$(this).parent();var col=cal.data("colorpicker").color;cal.data("colorpicker").origColor=col;setCurrentColor(col,cal.get(0));var cal2=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").onSubmit(col,HSBToHex(col),HSBToRGB(col),cal)},clickNone=function(ev){var cal=$(this).parent();cal.data("colorpicker").onNone(cal);cal.hide()},show=function(ev){var cal=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").onBeforeShow.apply(this,[cal.get(0)]);var pos=$(this).offset();var viewPort=getViewport();var top=pos.top+this.offsetHeight;var left=pos.left;if(top+176>viewPort.t+viewPort.h){top-=this.offsetHeight+176}if(left+356>viewPort.l+viewPort.w){left-=356}cal.css({left:left+"px",top:top+"px"});if(cal.data("colorpicker").onShow.apply(this,[cal.get(0)])!=false){cal.show()}$(document).bind("mousedown",{cal:cal},hide);return false},hide=function(ev){if(!isChildOf(ev.data.cal.get(0),ev.target,ev.data.cal.get(0))){if(ev.data.cal.data("colorpicker").onHide.apply(this,[ev.data.cal.get(0)])!=false){ev.data.cal.hide()}$(document).unbind("mousedown",hide)}},isChildOf=function(parentEl,el,container){if(parentEl==el){return true}if(parentEl.contains){return parentEl.contains(el)}if(parentEl.compareDocumentPosition){return!!(parentEl.compareDocumentPosition(el)&16)}var prEl=el.parentNode;while(prEl&&prEl!=container){if(prEl==parentEl)return true;prEl=prEl.parentNode}return false},getViewport=function(){var m=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(m?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(m?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(m?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(m?document.documentElement.clientHeight:document.body.clientHeight)}},fixHSB=function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))}},fixRGB=function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))}},fixHex=function(hex){var len=6-hex.length;if(len>0){var o=[];for(var i=0;i<len;i++){o.push("0")}o.push(hex);hex=o.join("")}return hex},HexToRGB=function(hex){var hex=parseInt(hex.indexOf("#")>-1?hex.substring(1):hex,16);return{r:hex>>16,g:(hex&65280)>>8,b:hex&255}},HexToHSB=function(hex){return RGBToHSB(HexToRGB(hex))},RGBToHSB=function(rgb){var hsb={};hsb.b=Math.max(Math.max(rgb.r,rgb.g),rgb.b);hsb.s=hsb.b<=0?0:Math.round(100*(hsb.b-Math.min(Math.min(rgb.r,rgb.g),rgb.b))/hsb.b);hsb.b=Math.round(hsb.b/255*100);if(rgb.r==rgb.g&&rgb.g==rgb.b)hsb.h=0;else if(rgb.r>=rgb.g&&rgb.g>=rgb.b)hsb.h=60*(rgb.g-rgb.b)/(rgb.r-rgb.b);else if(rgb.g>=rgb.r&&rgb.r>=rgb.b)hsb.h=60+60*(rgb.g-rgb.r)/(rgb.g-rgb.b);else if(rgb.g>=rgb.b&&rgb.b>=rgb.r)hsb.h=120+60*(rgb.b-rgb.r)/(rgb.g-rgb.r);else if(rgb.b>=rgb.g&&rgb.g>=rgb.r)hsb.h=180+60*(rgb.b-rgb.g)/(rgb.b-rgb.r);else if(rgb.b>=rgb.r&&rgb.r>=rgb.g)hsb.h=240+60*(rgb.r-rgb.g)/(rgb.b-rgb.g);else if(rgb.r>=rgb.b&&rgb.b>=rgb.g)hsb.h=300+60*(rgb.r-rgb.b)/(rgb.r-rgb.g);else hsb.h=0;hsb.h=Math.round(hsb.h);return hsb},HSBToRGB=function(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s==0){rgb.r=rgb.g=rgb.b=v}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h==360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}else{rgb.r=0;rgb.g=0;rgb.b=0}}return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)}},RGBToHex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length==1){hex[nr]="0"+val}});return hex.join("")},HSBToHex=function(hsb){return RGBToHex(HSBToRGB(hsb))};return{init:function(options){options=$.extend({},defaults,options||{});if(typeof options.color=="string"){options.color=HexToHSB(options.color)}else if(options.color.r!=undefined&&options.color.g!=undefined&&options.color.b!=undefined){options.color=RGBToHSB(options.color)}else if(options.color.h!=undefined&&options.color.s!=undefined&&options.color.b!=undefined){options.color=fixHSB(options.color)}else{return this}options.change=change;options.origColor=options.color;return this.each(function(){if(!$(this).data("colorpickerId")){var id="collorpicker_"+parseInt(Math.random()*1e3);$(this).data("colorpickerId",id);var cal=$(tpl).attr("id",id);if(options.flat){cal.appendTo(this).show()}else{cal.appendTo(document.body)}options.fields=cal.find("input").bind("keydown",keyDown).bind("change",change).bind("blur",blur).bind("focus",focus);cal.find("span").bind("mousedown",downIncrement);options.selector=cal.find("div.colorpicker_color").bind("mousedown",downSelector);options.selectorIndic=options.selector.find("div div");options.hue=cal.find("div.colorpicker_hue div");cal.find("div.colorpicker_hue").bind("mousedown",downHue);options.newColor=cal.find("div.colorpicker_new_color");options.currentColor=cal.find("div.colorpicker_current_color");cal.data("colorpicker",options);cal.find("input.colorpicker_none").bind("click",clickNone);cal.find("input.colorpicker_submit").bind("click",clickSubmit);fillRGBFields(options.color,cal.get(0));fillHSBFields(options.color,cal.get(0));fillHexFields(options.color,cal.get(0));setHue(options.color,cal.get(0));setSelector(options.color,cal.get(0));setCurrentColor(options.color,cal.get(0));setNewColor(options.color,cal.get(0));if(options.flat){cal.css({position:"relative",display:"block"})}else{$(this).bind(options.eventName,show)}}})},showPicker:function(){return this.each(function(){if($(this).data("colorpickerId")){show.apply(this)}})},hidePicker:function(){return this.each(function(){if($(this).data("colorpickerId")){$("#"+$(this).data("colorpickerId")).hide()}})},setColor:function(col){if(typeof col=="string"){col=HexToHSB(col)}else if(col.r!=undefined&&col.g!=undefined&&col.b!=undefined){col=RGBToHSB(col)}else if(col.h!=undefined&&col.s!=undefined&&col.b!=undefined){col=fixHSB(col)}else{return this}return this.each(function(){if($(this).data("colorpickerId")){var cal=$("#"+$(this).data("colorpickerId"));cal.data("colorpicker").color=col;cal.data("colorpicker").origColor=col;fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));fillHexFields(col,cal.get(0));setHue(col,cal.get(0));setSelector(col,cal.get(0));setCurrentColor(col,cal.get(0));setNewColor(col,cal.get(0))}})}}}();$.fn.extend({ColorPicker:ColorPicker.init,ColorPickerHide:ColorPicker.hide,ColorPickerShow:ColorPicker.show,ColorPickerSetColor:ColorPicker.setColor})})(jQuery);(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if(Math.abs(pX-cX)+Math.abs(pY-cY)<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind("mouseenter",handleHover).bind("mouseleave",handleHover)}})(jQuery);(function($){var self=null;var lutype="blocktypes";var searchValue=null;$.fn.liveUpdate=function(list,type){return this.each(function(){new $.liveUpdate(this,list,type)})};$.liveUpdate=function(e,list,type){this.field=$(e);this.list=$("#"+list);this.lutype="blocktypes";if(typeof type!="undefined"){this.lutype=type}if(this.list.length>0){this.init()}};$.liveUpdate.prototype={init:function(){var self=this;this.setupCache();this.field.parents("form").submit(function(){return false});this.field.keyup(function(){self.filter()});self.filter()},filter:function(){if(this.field.val()!=searchValue){if($.trim(this.field.val())==""){if(this.lutype=="blocktypes"){}else if(this.lutype=="attributes"){this.list.children("li").addClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected")}else if(this.lutype=="stacks"){this.list.children("li").addClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected")}else if(this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}else{this.list.children("li").show()}return}if(this.lutype!="intelligent-search"||this.field.val().length>2){this.displayResults(this.getScores(this.field.val().toLowerCase()))}else if(this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}}searchValue=this.field.val();if(searchValue==""&&this.lutype=="intelligent-search"){if(this.list.is(":visible")){this.list.hide()}}},setupCache:function(){var self=this;this.cache=[];this.rows=[];var lutype=this.lutype;this.list.find("li").each(function(){if(lutype=="blocktypes"){self.cache.push($(this).find("span").html().toLowerCase())}else if(lutype=="attributes"){var val=$(this).find("a,span").html().toLowerCase();self.cache.push(val)}else if(lutype=="stacks"){var val=$(this).find("a,span").html().toLowerCase();self.cache.push(val)}else if(lutype=="fileset"){self.cache.push($(this).find("span").html().toLowerCase())}else if(lutype=="intelligent-search"){var s=$(this).find("span").html();if(s){self.cache.push(s.toLowerCase())}}self.rows.push($(this))});this.cache_length=this.cache.length},displayResults:function(scores){var self=this;if(this.lutype=="blocktypes"){this.list.children("li").hide();$.each(scores,function(i,score){self.rows[score[1]].show()})}else if(this.lutype=="attributes"){this.list.children("li").removeClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected");this.list.children("li").removeClass("ccm-item-selected");$.each(scores,function(i,score){self.rows[score[1]].addClass("ccm-attribute-available")});this.list.children("li.item-select-list-header").removeClass("ccm-attribute-available");$(this.list.find("li.ccm-attribute-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="stacks"){this.list.children("li").removeClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected");this.list.children("li").removeClass("ccm-item-selected");$.each(scores,function(i,score){self.rows[score[1]].addClass("ccm-stack-available")});this.list.children("li.item-select-list-header").removeClass("ccm-stack-available");$(this.list.find("li.ccm-stack-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="intelligent-search"){if(!this.list.is(":visible")){this.list.fadeIn(160,"easeOutExpo")}this.list.find(".ccm-intelligent-search-results-module-onsite").hide();this.list.find("li").hide();var shown=0;$.each(scores,function(i,score){$li=self.rows[score[1]];if(score[0]>.7){shown++;if(!$li.parent().parent().is(":visible")){$li.parent().parent().show()}$li.show()}});this.list.find("li a").removeClass("ccm-intelligent-search-result-selected");this.list.find("li:visible a:first").addClass("ccm-intelligent-search-result-selected")}else{this.list.children("li").hide();$.each(scores,function(i,score){self.rows[score[1]].show()})}},getScores:function(term){var scores=[];for(var i=0;i<this.cache_length;i++){var score=this.cache[i].score(term);if(score>0){scores.push([score,i])}}return scores.sort(function(a,b){return b[0]-a[0]})}}})(jQuery);(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length)settings.single="metadata";var data=$.data(elem,settings.single);if(data)return data;data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m)data=m[1]}else if(settings.type=="elem"){if(!elem.getElementsByTagName)return;var e=elem.getElementsByTagName(settings.name);if(e.length)data=$.trim(e[0].innerHTML)}else if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr)data=attr}if(data.indexOf("{")<0)data="{"+data+"}";data=eval("("+data+")");$.data(elem,settings.single,data);return data}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);(function(){var $,Chosen,get_side_border_padding,root;var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};root=this;$=jQuery;$.fn.extend({chosen:function(options){if($.browser==="msie"&&($.browser.version==="6.0"||$.browser.version==="7.0")){return this}return $(this).each(function(input_field){if(!$(this).hasClass("chzn-done")){return new Chosen(this,options)}})}});Chosen=function(){function Chosen(form_field,options){this.form_field=form_field;this.options=options!=null?options:{};this.set_default_values();this.form_field_jq=$(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done")}Chosen.prototype.set_default_values=function(){this.click_test_action=__bind(function(evt){return this.test_active_click(evt)},this);this.activate_action=__bind(function(evt){return this.activate_field(evt)},this);this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.choices=0;return this.results_none_found=this.options.no_results_text||"No results match"};Chosen.prototype.set_up_html=function(){var container_div,dd_top,dd_width,sf_width;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.outerWidth();this.default_text=this.form_field_jq.data("placeholder")?this.form_field_jq.data("placeholder"):this.default_text_default;container_div=$("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"});if(this.is_multiple){container_div.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>')}else{container_div.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>')}this.form_field_jq.hide().after(container_div);this.container=$("#"+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));if(!this.is_multiple&&this.form_field.options.length<=this.disable_search_threshold){this.container.addClass("chzn-container-single-nosearch")}this.dropdown=this.container.find("div.chzn-drop").first();dd_top=this.container.height();dd_width=this.f_width-get_side_border_padding(this.dropdown);this.dropdown.css({width:dd_width+"px",top:dd_top+"px"});this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chzn-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chzn-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chzn-search").first();this.selected_item=this.container.find(".chzn-single").first();sf_width=dd_width-get_side_border_padding(this.search_container)-get_side_border_padding(this.search_field);this.search_field.css({width:sf_width+"px"})}this.results_build();return this.set_tab_index()};Chosen.prototype.register_observers=function(){this.container.mousedown(__bind(function(evt){return this.container_mousedown(evt)},this));this.container.mouseup(__bind(function(evt){return this.container_mouseup(evt)},this));this.container.mouseenter(__bind(function(evt){return this.mouse_enter(evt)},this));this.container.mouseleave(__bind(function(evt){return this.mouse_leave(evt)},this));this.search_results.mouseup(__bind(function(evt){return this.search_results_mouseup(evt)},this));this.search_results.mouseover(__bind(function(evt){return this.search_results_mouseover(evt)},this));this.search_results.mouseout(__bind(function(evt){return this.search_results_mouseout(evt)},this));this.form_field_jq.bind("liszt:updated",__bind(function(evt){return this.results_update_field(evt)},this));this.search_field.blur(__bind(function(evt){return this.input_blur(evt)},this));this.search_field.keyup(__bind(function(evt){return this.keyup_checker(evt)},this));this.search_field.keydown(__bind(function(evt){return this.keydown_checker(evt)},this));if(this.is_multiple){this.search_choices.click(__bind(function(evt){return this.choices_click(evt)},this));return this.search_field.focus(__bind(function(evt){return this.input_focus(evt)},this))}};Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq.attr("disabled");if(this.is_disabled){this.container.addClass("chzn-disabled");this.search_field.attr("disabled",true);if(!this.is_multiple){this.selected_item.unbind("focus",this.activate_action)}return this.close_field()}else{this.container.removeClass("chzn-disabled");this.search_field.attr("disabled",false);if(!this.is_multiple){return this.selected_item.bind("focus",this.activate_action)}}};Chosen.prototype.container_mousedown=function(evt){var target_closelink;if(!this.is_disabled){target_closelink=evt!=null?$(evt.target).hasClass("search-choice-close"):false;if(evt&&evt.type==="mousedown"){evt.stopPropagation()}if(!this.pending_destroy_click&&!target_closelink){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}$(document).click(this.click_test_action);this.results_show()}else if(!this.is_multiple&&evt&&($(evt.target)===this.selected_item||$(evt.target).parents("a.chzn-single").length)){evt.preventDefault();this.results_toggle()}return this.activate_field()}else{return this.pending_destroy_click=false}}};Chosen.prototype.container_mouseup=function(evt){if(evt.target.nodeName==="ABBR"){return this.results_reset(evt)}};Chosen.prototype.mouse_enter=function(){return this.mouse_on_container=true};Chosen.prototype.mouse_leave=function(){return this.mouse_on_container=false};Chosen.prototype.input_focus=function(evt){if(!this.active_field){return setTimeout(__bind(function(){return this.container_mousedown()},this),50)}};Chosen.prototype.input_blur=function(evt){if(!this.mouse_on_container){this.active_field=false;return setTimeout(__bind(function(){return this.blur_test()},this),100)}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chzn-container-active")){return this.close_field()}};Chosen.prototype.close_field=function(){$(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1)}this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};Chosen.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1)}this.container.addClass("chzn-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};Chosen.prototype.test_active_click=function(evt){if($(evt.target).parents("#"+this.container_id).length){return this.active_field=true}else{return this.close_field()}};Chosen.prototype.results_build=function(){var content,data,startTime,_i,_len,_ref;startTime=new Date;this.parsing=true;this.results_data=root.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0}else if(!this.is_multiple){this.selected_item.find("span").text(this.default_text)}content="";_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){content+=this.result_add_group(data)}else if(!data.empty){content+=this.result_add_option(data);if(data.selected&&this.is_multiple){this.choice_build(data)}else if(data.selected&&!this.is_multiple){this.selected_item.find("span").text(data.text);if(this.allow_single_deselect){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}}}}this.search_field_disabled();this.show_search_field_default();this.search_field_scale();this.search_results.html(content);return this.parsing=false};Chosen.prototype.result_add_group=function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+group.array_index;return'<li id="'+group.dom_id+'" class="group-result">'+$("<div />").text(group.label).html()+"</li>"}else{return""}};Chosen.prototype.result_add_option=function(option){var classes,style;if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected){classes.push("result-selected")}if(option.group_array_index!=null){classes.push("group-option")}if(option.classes!==""){classes.push(option.classes)}style=option.style.cssText!==""?' style="'+option.style+'"':"";return'<li id="'+option.dom_id+'" class="'+classes.join(" ")+'"'+style+">"+option.html+"</li>"}else{return""}};Chosen.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build()};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop(high_bottom-maxHeight>0?high_bottom-maxHeight:0)}else if(high_top<visible_top){return this.search_results.scrollTop(high_top)}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};Chosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};Chosen.prototype.results_show=function(){var dd_top;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected){this.result_do_highlight(this.result_single_selected)}}dd_top=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({top:dd_top+"px",left:0});this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};Chosen.prototype.results_hide=function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop")}this.result_clear_highlight();this.dropdown.css({left:"-9000px"});return this.results_showing=false};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field_jq.attr("tabindex")){ti=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple){return this.search_field.attr("tabindex",ti)}else{this.selected_item.attr("tabindex",ti);return this.search_field.attr("tabindex",-1)}}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;return this.result_select(evt)}};Chosen.prototype.search_results_mouseover=function(evt){var target;
target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target)}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents(".active-result").first())){return this.result_clear_highlight()}};Chosen.prototype.choices_click=function(evt){evt.preventDefault();if(this.active_field&&!$(evt.target).hasClass("search-choice"||$(evt.target).parents(".search-choice").first)&&!this.results_showing){return this.results_show()}};Chosen.prototype.choice_build=function(item){var choice_id,link;choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+choice_id+'"><span>'+item.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+item.array_index+'"></a></li>');link=$("#"+choice_id).find("a").first();return link.click(__bind(function(evt){return this.choice_destroy_link_click(evt)},this))};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();if(!this.is_disabled){this.pending_destroy_click=true;return this.choice_destroy($(evt.target))}else{return evt.stopPropagation}};Chosen.prototype.choice_destroy=function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1){this.results_hide()}this.result_deselect(link.attr("rel"));return link.parents("li").first().remove()};Chosen.prototype.results_reset=function(evt){this.form_field.options[0].selected=true;this.selected_item.find("span").text(this.default_text);this.show_search_field_default();$(evt.target).remove();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};Chosen.prototype.result_select=function(evt){var high,high_id,item,position;if(this.result_highlight){high=this.result_highlight;high_id=high.attr("id");this.result_clear_highlight();if(this.is_multiple){this.result_deactivate(high)}else{this.search_results.find(".result-selected").removeClass("result-selected");this.result_single_selected=high}high.addClass("result-selected");position=high_id.substr(high_id.lastIndexOf("_")+1);item=this.results_data[position];item.selected=true;this.form_field.options[item.options_index].selected=true;if(this.is_multiple){this.choice_build(item)}else{this.selected_item.find("span").first().text(item.text);if(this.allow_single_deselect){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}}if(!(evt.metaKey&&this.is_multiple)){this.results_hide()}this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale()}};Chosen.prototype.result_activate=function(el){return el.addClass("active-result")};Chosen.prototype.result_deactivate=function(el){return el.removeClass("active-result")};Chosen.prototype.result_deselect=function(pos){var result,result_data;result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;result=$("#"+this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale()};Chosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};Chosen.prototype.winnow_results=function(){var found,option,part,parts,regex,result_id,results,searchText,startTime,startpos,text,zregex,_i,_j,_len,_len2,_ref;startTime=new Date;this.no_results_clear();results=0;searchText=this.search_field.val()===this.default_text?"":$("<div/>").text($.trim(this.search_field.val())).html();regex=new RegExp("^"+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.disabled&&!option.empty){if(option.group){$("#"+option.dom_id).hide()}else if(!(this.is_multiple&&option.selected)){found=false;result_id=option.dom_id;if(regex.test(option.html)){found=true;results+=1}else if(option.html.indexOf(" ")>=0||option.html.indexOf("[")===0){parts=option.html.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_j=0,_len2=parts.length;_j<_len2;_j++){part=parts[_j];if(regex.test(part)){found=true;results+=1}}}}if(found){if(searchText.length){startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+"</em>"+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+"<em>"+text.substr(startpos)}else{text=option.html}if($("#"+result_id).html!==text){$("#"+result_id).html(text)}this.result_activate($("#"+result_id));if(option.group_array_index!=null){$("#"+this.results_data[option.group_array_index].dom_id).show()}}else{if(this.result_highlight&&result_id===this.result_highlight.attr("id")){this.result_clear_highlight()}this.result_deactivate($("#"+result_id))}}}}if(results<1&&searchText.length){return this.no_results(searchText)}else{return this.winnow_results_set_highlight()}};Chosen.prototype.winnow_results_clear=function(){var li,lis,_i,_len,_results;this.search_field.val("");lis=this.search_results.find("li");_results=[];for(_i=0,_len=lis.length;_i<_len;_i++){li=lis[_i];li=$(li);_results.push(li.hasClass("group-result")?li.show():!this.is_multiple||!li.hasClass("result-selected")?this.result_activate(li):void 0)}return _results};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;if(!this.result_highlight){selected_results=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high)}}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');no_results_html.find("span").first().html(terms);return this.search_results.append(no_results_html)};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};Chosen.prototype.keydown_arrow=function(){var first_active,next_sib;if(!this.result_highlight){first_active=this.search_results.find("li.active-result").first();if(first_active){this.result_do_highlight($(first_active))}}else if(this.results_showing){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){this.result_do_highlight(next_sib)}}if(!this.results_showing){return this.results_show()}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first())}else{if(this.choices>0){this.results_hide()}return this.result_clear_highlight()}}};Chosen.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{this.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus")}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};Chosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0){return this.keydown_backstroke()}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt)}break;case 27:if(this.results_showing){return this.results_hide()}break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke()}switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break}};Chosen.prototype.search_field_scale=function(){var dd_top,div,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";"}div=$("<div />",{style:style_block});div.text(this.search_field.val());$("body").append(div);w=div.width()+25;div.remove();if(w>this.f_width-10){w=this.f_width-10}this.search_field.css({width:w+"px"});dd_top=this.container.height();return this.dropdown.css({top:dd_top+"px"})}};Chosen.prototype.generate_field_id=function(){var new_id;new_id=this.generate_random_id();this.form_field.id=new_id;return new_id};Chosen.prototype.generate_random_id=function(){var string;string="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while($("#"+string).length>0){string+=this.generate_random_char()}return string};Chosen.prototype.generate_random_char=function(){var chars,newchar,rand;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";rand=Math.floor(Math.random()*chars.length);return newchar=chars.substring(rand,rand+1)};return Chosen}();get_side_border_padding=function(elmt){var side_border_padding;return side_border_padding=elmt.outerWidth()-elmt.width()};root.get_side_border_padding=get_side_border_padding}).call(this);(function(){var SelectParser;SelectParser=function(){function SelectParser(){this.options_index=0;this.parsed=[]}SelectParser.prototype.add_node=function(child){if(child.nodeName==="OPTGROUP"){return this.add_group(child)}else{return this.add_option(child)}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled))}return _results};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};return SelectParser}();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser;_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child)}return parser.parsed};this.SelectParser=SelectParser}).call(this);ccm_t=function(key){return $("input[name=ccm-string-"+key+"]").val()};ccm_parseJSON=function(resp,onNoError){if(resp.error){alert(resp.message)}else{onNoError()}};ccm_addHeaderItem=function(item,type){var qschar=item.indexOf("?")!=-1?"":"?ts=";if(type=="CSS"){if(navigator.userAgent.indexOf("MSIE")!=-1){var ss=document.createElement("link"),hd=document.getElementsByTagName("head")[0];ss.type="text/css";ss.rel="stylesheet";ss.href=item;ss.media="screen";hd.appendChild(ss)}else{if(!$("head").children('link[href*="'+item+'"]').length){$("head").append('<link rel="stylesheet" media="screen" type="text/css" href="'+item+qschar+(new Date).getTime()+'" />')}}}else if(type=="JAVASCRIPT"){if(!$('script[src*="'+item+'"]').length){$("head").append('<script type="text/javascript" src="'+item+qschar+(new Date).getTime()+'"></script>')}}else{if(!$("head").children(item).length){$("head").append(item)}}};var ccm_isBlockError=false;ccm_hideMenus=function(){ccm_activeMenu=false;$("div.ccm-menu").hide();$("div.ccm-menu").css("visibility","hidden");$("div.ccm-menu").show()};ccm_fadeInMenu=function(bobj,e){var mwidth=bobj.find("div.popover div.inner").width();var mheight=bobj.find("div.popover").height();bobj.hide();bobj.css("visibility","visible");var posX=e.pageX+2;var posY=e.pageY+2;if($(window).height()<e.clientY+mheight){posY=posY-mheight-10;posX=posX-mwidth/2;bobj.find("div.popover").removeClass("below");bobj.find("div.popover").addClass("above")}else{posX=posX-mwidth/2;posY=posY+10;bobj.find("div.popover").removeClass("above");bobj.find("div.popover").addClass("below")}bobj.css("top",posY+"px");bobj.css("left",posX+"px");bobj.fadeIn(60)};ccm_paneToggleOptions=function(obj){var pane=$(obj).parent().find("div.ccm-pane-options-content");if($(obj).hasClass("ccm-icon-option-closed")){$(obj).removeClass("ccm-icon-option-closed").addClass("ccm-icon-option-open");pane.slideDown("fast","easeOutExpo")}else{$(obj).removeClass("ccm-icon-option-open").addClass("ccm-icon-option-closed");pane.slideUp("fast","easeOutExpo")}};ccm_setupGridStriping=function(tbl){$("#"+tbl+" tr").removeClass();var j=0;$("#"+tbl+" tr").each(function(){if($(this).css("display")!="none"){if(j%2==0){$(this).addClass("ccm-row-alt")}j++}})};var CCMEditMode=function(){var blockTypeDropSuccessful=false;var $sortableAreas;var $sortableDropElement=false;var $draggableElement=false;setupMenus=function(){$(".ccm-area").ccmmenu();$(".ccm-block-edit").ccmmenu();$(".ccm-block-edit-layout").ccmmenu()};saveAreaArrangement=function(cID,arHandle){if(!cID){cID=CCM_CID}var serial="";var $area=$("div.ccm-area[data-area-handle="+arHandle+"]");areaStr="&area["+$area.attr("id").substring(1)+"][]=";$area.find("div.ccm-block-edit").each(function(){serial+=areaStr+$(this).attr("data-block-id")});$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+cID+"&ccm_token="+CCM_SECURITY_TOKEN+"&btask=ajax_do_arrange"+serial})};parseBlockResponse=function(r,currentBlockID,task){try{r=r.replace(/(<([^>]+)>)/gi,"");resp=eval("("+r+")");if(resp.error==true){var message="<ul>";for(i=0;i<resp.response.length;i++){message+="<li>"+resp.response[i]+"</li>"}message+="</ul>";ccmAlert.notice(ccmi18n.error,message)}else{jQuery.fn.dialog.closeTop();$(document).trigger("blockWindowAfterClose");if(resp.cID){cID=resp.cID}else{cID=CCM_CID}var action=CCM_TOOLS_PATH+"/edit_block_popup?cID="+cID+"&bID="+resp.bID+"&arHandle="+encodeURIComponent(resp.arHandle)+"&btask=view_edit_mode";$.get(action,function(r){if(task=="add"){if($("#ccm-add-new-block-placeholder").length>0){$("#ccm-add-new-block-placeholder").before(r).remove();saveAreaArrangement(cID,resp.arHandle)}else{$("#a"+resp.aID+" div.ccm-area-footer").before(r)}}else{$("[data-block-id="+currentBlockID+"][data-area-id="+resp.aID+"]").before(r).remove()}CCMInlineEditMode.exit();CCMToolbar.disableDirectExit();jQuery.fn.dialog.hideLoader();if(task=="add"){var tb=parseInt($("div.ccm-area[data-area-id="+resp.aID+"]").attr("data-total-blocks"));$("div.ccm-area[data-area-id="+resp.aID+"]").attr("data-total-blocks",tb+1);ccmAlert.hud(ccmi18n.addBlockMsg,2e3,"add",ccmi18n.addBlock);jQuery.fn.dialog.closeAll();CCMEditMode.start()}else{ccmAlert.hud(ccmi18n.updateBlockMsg,2e3,"success",ccmi18n.updateBlock)}if(typeof window.ccm_parseBlockResponsePost=="function"){ccm_parseBlockResponsePost(resp)}})}}catch(e){ccmAlert.notice(ccmi18n.error,r)}};addBlockType=function(cID,aID,arHandle,$link,fromdrag){var btID=$link.attr("data-btID");var inline=parseInt($link.attr("data-supports-inline-editing"));var hasadd=parseInt($link.attr("data-has-add-template"));if(!hasadd){var action=CCM_DISPATCHER_FILENAME+"?cID="+cID+"&arHandle="+encodeURIComponent(arHandle)+"&btID="+btID+"&mode=edit&processBlock=1&add=1&ccm_token="+CCM_SECURITY_TOKEN;$.get(action,function(r){parseBlockResponse(r,false,"add")})}else if(inline){CCMInlineEditMode.loadAdd(cID,arHandle,aID,btID)}else{jQuery.fn.dialog.open({onClose:function(){$(document).trigger("blockWindowClose");if(fromdrag){jQuery.fn.dialog.closeAll();var ccm_blockTypeDropped=false}},modal:false,width:parseInt($link.attr("data-dialog-width")),height:parseInt($link.attr("data-dialog-height"))+20,title:$link.attr("data-dialog-title"),href:CCM_TOOLS_PATH+"/add_block_popup?cID="+cID+"&btID="+btID+"&arHandle="+encodeURIComponent(arHandle)})}};setupSortablesAndDroppables=function(){$emptyareas=$("div.ccm-area[data-total-blocks=0]");$emptyareas.droppable({hoverClass:"ccm-area-drag-block-type-over",tolerance:"pointer",accept:function($item){var btHandle=$item.attr("data-block-type-handle");return $(this).attr("data-accepts-block-types").indexOf(btHandle)!==-1},greedy:true,drop:function(e,ui){$(".ccm-area-drag-block-type-over").removeClass("ccm-area-drag-block-type-over");if(ui.helper.is(".ccm-overlay-draggable-block-type")){CCMEditMode.blockTypeDropSuccessful=true;addBlockType($(this).attr("data-cID"),$(this).attr("data-area-id"),$(this).attr("data-area-handle"),ui.helper,true)}else{ui.draggable.appendTo($(this));if(CCMEditMode.$draggableElement){CCMEditMode.$sortableDropElement=CCMEditMode.$draggableElement}}}});$sortableAreas=$("div.ccm-area[data-total-blocks!=0]");$sortableAreas.sortable({items:"div.ccm-block-edit",tolerance:"pointer",placeholder:"ui-state-highlight",opacity:.4,handle:"[data-inline-command=move-block]",out:function(){},receive:function(e,ui){$(".ccm-area-drag-block-type-over").removeClass("ccm-area-drag-block-type-over");if(ui.item.is(".ccm-overlay-draggable-block-type")){CCMEditMode.blockTypeDropSuccessful=true;$(this).find(".ccm-overlay-draggable-block-type").replaceWith($("<div />",{id:"ccm-add-new-block-placeholder"}));addBlockType($(this).attr("data-cID"),$(this).attr("data-area-id"),$(this).attr("data-area-handle"),ui.helper,true)}else{CCMEditMode.$sortableDropElement=ui.item}}});$sortableAreas.find("div.ccm-block-edit").each(function(){var $block=$(this);$block.draggable({cursor:"move",cursorAt:{right:10,top:10},handle:"[data-inline-command=move-block]",helper:function(){var w="100px";var h="100px";var $d=$("<div />",{"class":"ccm-block-type-dragging"}).css("width",w).css("height",h);return $d},connectToSortable:$sortableAreas.filter("[data-accepts-block-types~="+$block.attr("data-block-type-handle")+"]"),stop:function(){$.fn.ccmmenu.enable();if(CCMEditMode.$sortableDropElement){CCMEditMode.$sortableDropElement.remove();CCMEditMode.$sortableDropElement=false}CCMToolbar.disableDirectExit();var _serial="";$("div.ccm-area").each(function(){var $_area=$(this);$_area.find("div.ccm-block-edit").each(function(){var $_block=$(this);_serial+="&area["+$_area.attr("data-area-id")+"][]="+$_block.attr("data-block-id")})});$.ajax({type:"POST",dataType:"json",url:CCM_DISPATCHER_FILENAME,data:"cID="+CCM_CID+"&ccm_token="+CCM_SECURITY_TOKEN+"&btask=ajax_do_arrange"+_serial,success:function(r){ccm_parseJSON(r,function(){$("div.ccm-area").each(function(){var _arID=$(this).attr("data-area-id");var tb=0;if(r.areas[_arID]){var tb=r.areas[_arID]}$("div.ccm-area[data-area-id="+_arID+"]").attr("data-total-blocks",tb)});CCMEditMode.start()})}})},start:function(e,ui){$.fn.ccmmenu.disable();CCMEditMode.$draggableElement=$(this)}})})};return{start:function(){setupMenus();setupSortablesAndDroppables()},setupBlockForm:function(form,bID,task){form.ajaxForm({type:"POST",iframe:true,beforeSubmit:function(){$("input[name=ccm-block-form-method]").val("AJAX");jQuery.fn.dialog.showLoader();if(typeof window.ccmValidateBlockForm=="function"){r=window.ccmValidateBlockForm();if(ccm_isBlockError){jQuery.fn.dialog.hideLoader();if(ccm_blockError){ccmAlert.notice(ccmi18n.error,ccm_blockError+"</ul>")}ccm_resetBlockErrors();return false}}},success:function(r){parseBlockResponse(r,bID,task)}})},deleteBlock:function(cID,bID,aID,arHandle,msg){if(confirm(msg)){CCMToolbar.disableDirectExit();$d=$("[data-block-id="+bID+"][data-area-id="+aID+"]");$d.hide().remove();$.fn.ccmmenu.resethighlighter();ccmAlert.hud(ccmi18n.deleteBlockMsg,2e3,"delete_small",ccmi18n.deleteBlock);var tb=parseInt($("[data-area-id="+aID+"]").attr("data-total-blocks"));$("[data-area-id="+aID+"]").attr("data-total-blocks",tb-1);CCMEditMode.start();$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+cID+"&ccm_token="+CCM_SECURITY_TOKEN+"&isAjax=true&btask=remove&bID="+bID+"&arHandle="+arHandle});if(typeof window.ccm_parseBlockResponsePost=="function"){ccm_parseBlockResponsePost({})}}},activateBlockTypesOverlay:function(){$("#ccm-dialog-block-types-sets ul a").on("click",function(){$("#ccm-overlay-block-types li").hide();$("#ccm-overlay-block-types li[data-block-type-sets~="+$(this).attr("data-tab")+"]").show();$("#ccm-dialog-block-types-sets ul a").removeClass("active");$(this).addClass("active")});$($("#ccm-dialog-block-types ul a").get(0)).trigger("click");$("#ccm-dialog-block-types").closest(".ui-dialog-content").addClass("ui-dialog-content-block-types");$("#ccm-block-type-search input").focus();if($("#ccm-block-types-dragging").length==0){$('<div id="ccm-block-types-dragging" />').appendTo(document.body)}$("#ccm-add-new-block-placeholder").remove();$("#ccm-block-type-search input").liveUpdate("ccm-overlay-block-types");$("#ccm-block-type-search input").on("keyup",function(){if($(this).val()==""){$("#ccm-block-types-wrapper ul.nav-tabs").css("visibility","visible");$("#ccm-block-types-wrapper ul.nav-tabs li[class=active] a").click()}else{$("#ccm-block-types-wrapper ul.nav-tabs").css("visibility","hidden")}});$("#ccm-overlay-block-types a.ccm-overlay-draggable-block-type").each(function(){var $li=$(this);$li.css("cursor","move");$li.draggable({helper:"clone",appendTo:$("#ccm-block-types-dragging"),revert:false,connectToSortable:$sortableAreas.filter("[data-accepts-block-types~="+$li.attr("data-block-type-handle")+"]"),start:function(e,ui){CCMEditMode.blockTypeDropSuccessful=false;$("#ccm-block-types-wrapper").parent().jqdialog("option","closeOnEscape",false);$("#ccm-overlay-block-types").closest(".ui-dialog").fadeOut(100);$(".ui-widget-overlay").remove();$.fn.ccmmenu.disable()},stop:function(){$.fn.ccmmenu.enable();if(!CCMEditMode.blockTypeDropSuccessful){jQuery.fn.dialog.closeAll()}}})});$("a.ccm-overlay-clickable-block-type").on("click",function(){addBlockType($(this).attr("data-cID"),$(this).attr("data-area-id"),$(this).attr("data-area-handle"),$(this));return false})}}}();var ccm_totalAdvancedSearchFields=0;var ccm_alLaunchType=new Array;var ccm_alActiveAssetField="";var ccm_alProcessorTarget="";var ccm_alDebug=false;ccm_triggerSelectFile=function(fID,af){if(af==null){var af=ccm_alActiveAssetField}var obj=$("#"+af+"-fm-selected");var dobj=$("#"+af+"-fm-display");dobj.hide();obj.show();obj.load(CCM_TOOLS_PATH+"/files/selector_data?fID="+fID+"&ccm_file_selected_field="+af,function(){obj.attr("fID",fID);obj.attr("ccm-file-manager-can-view",obj.children("div").attr("ccm-file-manager-can-view"));obj.attr("ccm-file-manager-can-edit",obj.children("div").attr("ccm-file-manager-can-edit"));obj.attr("ccm-file-manager-can-admin",obj.children("div").attr("ccm-file-manager-can-admin"));obj.attr("ccm-file-manager-can-replace",obj.children("div").attr("ccm-file-manager-can-replace"));obj.attr("ccm-file-manager-instance",af);obj.click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});if(typeof ccm_triggerSelectFileComplete=="function"){ccm_triggerSelectFileComplete(fID,af)}ccm_event.publish("FileManagerFileSelected",{fID:fID,af:af})});var vobj=$("#"+af+"-fm-value");vobj.attr("value",fID);ccm_alSetupFileProcessor()};ccm_alGetFileData=function(fID,onComplete){$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?fID="+fID,onComplete)};ccm_clearFile=function(e,af){e.stopPropagation();var obj=$("#"+af+"-fm-selected");var dobj=$("#"+af+"-fm-display");var vobj=$("#"+af+"-fm-value");vobj.attr("value",0);obj.hide();dobj.show()};ccm_activateFileManager=function(altype,searchInstance){ccm_alLaunchType[searchInstance]=altype;ccm_alSetupSelectFiles(searchInstance);$(document).click(function(e){e.stopPropagation();ccm_alSelectNone()});ccm_setupAdvancedSearch(searchInstance);if(altype=="DASHBOARD"){$(".dialog-launch").dialog()}ccm_alSetupCheckboxes(searchInstance);ccm_alSetupFileProcessor();ccm_alSetupSingleUploadForm();$("form#ccm-"+searchInstance+"-advanced-search select[name=fssID]").change(function(){if(altype=="DASHBOARD"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/files/search?fssID="+$(this).val()}else{jQuery.fn.dialog.showLoader();var url=$("div#ccm-"+searchInstance+"-overlay-wrapper input[name=dialogAction]").val()+"&refreshDialog=1&fssID="+$(this).val();$.get(url,function(resp){jQuery.fn.dialog.hideLoader();$("div#ccm-"+searchInstance+"-overlay-wrapper").html(resp);$("div#ccm-"+searchInstance+"-overlay-wrapper a.dialog-launch").dialog()})}});ccm_searchActivatePostFunction[searchInstance]=function(){ccm_alSetupCheckboxes(searchInstance);ccm_alSetupSelectFiles(searchInstance);ccm_alSetupSingleUploadForm()}};ccm_alSetupSingleUploadForm=function(){$(".ccm-file-manager-submit-single").submit(function(){$(this).attr("target",ccm_alProcessorTarget);ccm_alSubmitSingle($(this).get(0))})};ccm_activateFileSelectors=function(){$(".ccm-file-manager-launch").unbind();$(".ccm-file-manager-launch").click(function(){ccm_alLaunchSelectorFileManager($(this).parent().attr("ccm-file-manager-field"))})};ccm_alLaunchSelectorFileManager=function(selector){ccm_alActiveAssetField=selector;var filterStr="";var types=$("#"+selector+"-fm-display input.ccm-file-manager-filter");if(types.length){for(i=0;i<types.length;i++){filterStr+="&"+$(types[i]).attr("name")+"="+$(types[i]).attr("value")}}ccm_launchFileManager(filterStr)};ccm_launchFileManager=function(filters){$.fn.dialog.open({width:"90%",height:"70%",appendButtons:true,onOpen:function(){ccm_event.publish("launchFileManager",ccm_alActiveAssetField)},modal:false,href:CCM_TOOLS_PATH+"/files/search_dialog?ocID="+CCM_CID+"&search=1"+filters,title:ccmi18n_filemanager.title})};ccm_launchFileSetPicker=function(fsID){$.fn.dialog.open({width:500,height:160,modal:false,href:CCM_TOOLS_PATH+"/files/pick_set?oldFSID="+fsID,title:ccmi18n_filemanager.sets})};ccm_alSubmitSetsForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-add-to-set-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.hideLoader();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){$(".chosen-select").chosen();ccm_parseAdvancedSearchResponse(resp,searchInstance)})})})};ccm_alSubmitPasswordForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-password-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})};ccm_alSubmitStorageForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-storage-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})};ccm_alSubmitPermissionsForm=function(searchInstance){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-permissions-form").ajaxSubmit(function(resp){jQuery.fn.dialog.closeTop();$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})};ccm_alSetupSetsForm=function(searchInstance){$("#fsAddToSearchName").liveUpdate("ccm-file-search-add-to-sets-list","fileset");$(".ccm-file-set-add-cb a").each(function(){var cb=$(this);var startingState=cb.attr("ccm-tri-state-startup");$(this).click(function(){var selectedState=$(this).attr("ccm-tri-state-selected");var toSetState=0;switch(selectedState){case"0":if(startingState=="1"){toSetState="1"}else{toSetState="2"}break;case"1":toSetState="2";break;case"2":toSetState="0";break}$(this).attr("ccm-tri-state-selected",toSetState);$(this).parent().find("input").val(toSetState);$(this).find("img").attr("src",CCM_IMAGE_PATH+"/checkbox_state_"+toSetState+".png")})});$("#ccm-"+searchInstance+"-add-to-set-form input[name=fsNew]").click(function(){if(!$(this).prop("checked")){$("#ccm-"+searchInstance+"-add-to-set-form input[name=fsNewText]").val("")}});$("#ccm-"+searchInstance+"-add-to-set-form").submit(function(){ccm_alSubmitSetsForm(searchInstance);return false})};ccm_alSetupPasswordForm=function(){$("#ccm-file-password-form").submit(function(){ccm_alSubmitPasswordForm();return false})};ccm_alRescanFiles=function(){var turl=CCM_TOOLS_PATH+"/files/rescan?";var files=arguments;for(i=0;i<files.length;i++){turl+="fID[]="+files[i]+"&"}$.fn.dialog.open({title:ccmi18n_filemanager.rescan,href:turl,width:350,modal:false,height:200,onClose:function(){if(files.length==1){$("#ccm-file-properties-wrapper").html("");jQuery.fn.dialog.showLoader();$("#ccm-file-properties-wrapper").load(CCM_TOOLS_PATH+"/files/properties?fID="+files[0]+"&reload=1",false,function(){jQuery.fn.dialog.hideLoader();$(this).find(".dialog-launch").dialog()})}}})};ccm_alSelectPermissionsEntity=function(selector,id,name){var html=$("#ccm-file-permissions-entity-base").html();$("#ccm-file-permissions-entities-wrapper").append('<div class="ccm-file-permissions-entity">'+html+"</div>");var p=$(".ccm-file-permissions-entity");var ap=p[p.length-1];$(ap).find("h3 span").html(name);$(ap).find("input[type=hidden]").val(selector+"_"+id);$(ap).find("select").each(function(){$(this).attr("name",$(this).attr("name")+"_"+selector+"_"+id)});$(ap).find("div.ccm-file-access-extensions input[type=checkbox]").each(function(){$(this).attr("name",$(this).attr("name")+"_"+selector+"_"+id+"[]")});ccm_alActivateFilePermissionsSelector()};ccm_alActivateFilePermissionsSelector=function(){$(".ccm-file-access-add select").unbind();$(".ccm-file-access-add select").change(function(){var p=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()==ccmi18n_filemanager.PTYPE_CUSTOM){$(p).find("div.ccm-file-access-add-extensions").show()}else{$(p).find("div.ccm-file-access-add-extensions").hide()}});$(".ccm-file-access-file-manager select").change(function(){var p=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()!=ccmi18n_filemanager.PTYPE_NONE){$(p).find(".ccm-file-access-add").show();$(p).find(".ccm-file-access-edit").show();$(p).find(".ccm-file-access-admin").show()}else{$(p).find(".ccm-file-access-add").hide();$(p).find(".ccm-file-access-edit").hide();$(p).find(".ccm-file-access-admin").hide();$(p).find("div.ccm-file-access-add-extensions").hide()}});$("a.ccm-file-permissions-remove").click(function(){$(this).parent().parent().fadeOut(100,function(){$(this).remove()})});$("input[name=toggleCanAddExtension]").unbind();$("input[name=toggleCanAddExtension]").click(function(){var ext=$(this).parent().parent().find("div.ccm-file-access-extensions");if($(this).prop("checked")==1){ext.find("input").attr("checked",true)}else{ext.find("input").attr("checked",false)}})};ccm_alSetupVersionSelector=function(){$("#ccm-file-versions-grid input[type=radio]").click(function(){$("#ccm-file-versions-grid tr").removeClass("ccm-file-versions-grid-active");
var trow=$(this).parent().parent();var fID=trow.attr("fID");var fvID=trow.attr("fvID");var postStr="task=approve_version&fID="+fID+"&fvID="+fvID;$.post(CCM_TOOLS_PATH+"/files/properties",postStr,function(resp){trow.addClass("ccm-file-versions-grid-active");trow.find("td").show("highlight",{color:"#FFF9BB"})})});$(".ccm-file-versions-remove").click(function(){var trow=$(this).parent().parent();var fID=trow.attr("fID");var fvID=trow.attr("fvID");var postStr="task=delete_version&fID="+fID+"&fvID="+fvID;$.post(CCM_TOOLS_PATH+"/files/properties",postStr,function(resp){trow.fadeOut(200,function(){trow.remove()})});return false})};ccm_alDeleteFiles=function(searchInstance){$("#ccm-"+searchInstance+"-delete-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})})};ccm_alDuplicateFiles=function(searchInstance){$("#ccm-"+searchInstance+"-duplicate-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);var r=eval("("+resp+")");$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance);var highlight=new Array;for(i=0;i<r.fID.length;i++){fID=r.fID[i];ccm_uploadedFiles.push(fID);highlight.push(fID)}ccm_alRefresh(highlight,searchInstance);ccm_filesUploadedDialog(searchInstance)})})})};ccm_alSetupSelectFiles=function(searchInstance){$(".ccm-file-list").unbind();$(".ccm-file-list tr.ccm-list-record").click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});$(".ccm-file-list img.ccm-star").click(function(e){e.stopPropagation();var fID=$(e.target).parents("tr.ccm-list-record")[0].id;fID=fID.substring(3);ccm_starFile(e.target,fID)});if(ccm_alLaunchType[searchInstance]=="DASHBOARD"){$(".ccm-file-list-thumbnail").hover(function(e){var fID=$(this).attr("fID");var obj=$("#fID"+fID+"hoverThumbnail");if(obj.length>0){var tdiv=obj.find("div");var pos=obj.position();tdiv.css("top",pos.top);tdiv.css("left",pos.left);tdiv.show()}},function(){var fID=$(this).attr("fID");var obj=$("#fID"+fID+"hoverThumbnail");var tdiv=obj.find("div");tdiv.hide()})}};ccm_alSetupCheckboxes=function(searchInstance){$("#ccm-"+searchInstance+"-list-cb-all").unbind();$("#ccm-"+searchInstance+"-list-cb-all").click(function(){ccm_hideMenus();if($(this).prop("checked")==true){$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",true)}});$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]").click(function(e){e.stopPropagation();ccm_hideMenus();ccm_alRescanMultiFileMenu(searchInstance)});$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb").click(function(e){e.stopPropagation();ccm_hideMenus();$(this).find("input[type=checkbox]").click();ccm_alRescanMultiFileMenu(searchInstance)});if(ccm_alLaunchType[searchInstance]!="DASHBOARD"&&ccm_alLaunchType[searchInstance]!="BROWSE"){var chooseText=ccmi18n_filemanager.select;$("#ccm-"+searchInstance+"-list-multiple-operations option:eq(0)").after('<option value="choose">'+chooseText+"</option>")}$("#ccm-"+searchInstance+"-list-multiple-operations").change(function(){var action=$(this).val();var fIDstring=ccm_alGetSelectedFileIDs(searchInstance);switch(action){case"choose":var fIDs=new Array;$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){fIDs.push($(this).val())});ccm_alSelectFile(fIDs,true);break;case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/files/delete?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.deleteFile});break;case"duplicate":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/duplicate?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.duplicateFile});break;case"sets":jQuery.fn.dialog.open({width:500,height:400,modal:false,href:CCM_TOOLS_PATH+"/files/add_to?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.sets});break;case"properties":jQuery.fn.dialog.open({width:690,height:440,modal:false,href:CCM_TOOLS_PATH+"/files/bulk_properties?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n.properties});break;case"rescan":jQuery.fn.dialog.open({width:350,height:200,modal:false,href:CCM_TOOLS_PATH+"/files/rescan?"+fIDstring+"&searchInstance="+searchInstance,title:ccmi18n_filemanager.rescan,onClose:function(){$("#ccm-"+searchInstance+"-advanced-search").submit()}});break;case"download":window.frames[ccm_alProcessorTarget].location=CCM_TOOLS_PATH+"/files/download?"+fIDstring;break}$(this).get(0).selectedIndex=0});ccm_alSetupFileSetSearch(searchInstance)};ccm_alSetupFileSetSearch=function(searchInstance){$("#ccm-"+searchInstance+"-sets-search-wrapper select").chosen().unbind();$("#ccm-"+searchInstance+"-sets-search-wrapper select").chosen().change(function(){var sel=$("#ccm-"+searchInstance+"-sets-search-wrapper option:selected");$("#ccm-"+searchInstance+"-advanced-search").submit()})};ccm_alGetSelectedFileIDs=function(searchInstance){var fidstr="";$("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){fidstr+="fID[]="+$(this).val()+"&"});return fidstr};ccm_alRescanMultiFileMenu=function(searchInstance){if($("#ccm-"+searchInstance+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").length>0){$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+searchInstance+"-list-multiple-operations").attr("disabled",true)}};ccm_alSetupFileProcessor=function(){if(ccm_alProcessorTarget!=""){return false}var ts=parseInt((new Date).getTime().toString().substring(0,10));var ifr;try{ifr=document.createElement('<iframe name="ccm-al-upload-processor'+ts+'">')}catch(ex){ifr=document.createElement("iframe")}ifr.id="ccm-al-upload-processor"+ts;ifr.name="ccm-al-upload-processor"+ts;ifr.style.border="0px";ifr.style.width="0px";ifr.style.height="0px";ifr.style.display="none";document.body.appendChild(ifr);if(ccm_alDebug){ccm_alProcessorTarget="_blank"}else{ccm_alProcessorTarget="ccm-al-upload-processor"+ts}};ccm_alSubmitSingle=function(form){if($(form).find(".ccm-al-upload-single-file").val()==""){return false}else{$(form).find(".ccm-al-upload-single-submit").hide();$(form).find(".ccm-al-upload-single-loader").show()}};ccm_alResetSingle=function(){$(".ccm-al-upload-single-file").val("");$(".ccm-al-upload-single-loader").hide();$(".ccm-al-upload-single-submit").show()};var ccm_uploadedFiles=[];ccm_filesUploadedDialog=function(searchInstance){if(document.getElementById("ccm-file-upload-multiple-tab"))jQuery.fn.dialog.closeTop();var fIDstring="";for(var i=0;i<ccm_uploadedFiles.length;i++)fIDstring=fIDstring+"&fID[]="+ccm_uploadedFiles[i];jQuery.fn.dialog.open({width:690,height:440,modal:false,href:CCM_TOOLS_PATH+"/files/bulk_properties/?"+fIDstring+"&uploaded=true&searchInstance="+searchInstance,onClose:function(){ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})},title:ccmi18n_filemanager.uploadComplete});ccm_uploadedFiles=[]};ccm_alSetupUploadDetailsForm=function(searchInstance){$("#ccm-"+searchInstance+"-update-uploaded-details-form").submit(function(){ccm_alSubmitUploadDetailsForm(searchInstance);return false})};ccm_alSubmitUploadDetailsForm=function(searchInstance){jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-update-uploaded-details-form").ajaxSubmit(function(r1){var r1a=eval("("+r1+")");var form=$("#ccm-"+searchInstance+"-advanced-search");if(form.length>0){form.ajaxSubmit(function(resp){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop();ccm_parseAdvancedSearchResponse(resp,searchInstance);ccm_alHighlightFileIDArray(r1a)})})}else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop()}})};ccm_alRefresh=function(highlightFIDs,searchInstance,fileSelector){var ids=highlightFIDs;ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-search-results").load(CCM_TOOLS_PATH+"/files/search_results",{ccm_order_by:"fvDateAdded",ccm_order_dir:"desc",fileSelector:fileSelector,searchType:ccm_alLaunchType[searchInstance],searchInstance:searchInstance},function(){ccm_activateSearchResults(searchInstance);if(ids!=false){ccm_alHighlightFileIDArray(ids)}ccm_alSetupSelectFiles(searchInstance)})};ccm_alHighlightFileIDArray=function(ids){for(i=0;i<ids.length;i++){var td=$("tr[fID="+ids[i]+"] td");var oldBG=td.css("backgroundColor");td.animate({backgroundColor:"#FFF9BB"},{queue:true,duration:1e3}).animate({backgroundColor:oldBG},500)}};ccm_alSelectFile=function(fID){if(typeof ccm_chooseAsset=="function"){var qstring="";if(typeof fID=="object"){for(i=0;i<fID.length;i++){qstring+="fID[]="+fID[i]+"&"}}else{qstring+="fID="+fID}$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?"+qstring,function(resp){ccm_parseJSON(resp,function(){for(i=0;i<resp.length;i++){ccm_chooseAsset(resp[i])}jQuery.fn.dialog.closeTop()})})}else{if(typeof fID=="object"){for(i=0;i<fID.length;i++){ccm_triggerSelectFile(fID[i])}}else{ccm_triggerSelectFile(fID)}jQuery.fn.dialog.closeTop()}};ccm_alActivateMenu=function(obj,e){var selectedFile=$(obj).find("div[ccm-file-manager-field]");var selector="";if(selectedFile.length>0){selector=selectedFile.attr("ccm-file-manager-field")}if(!selector){selector=ccm_alActiveAssetField}ccm_hideMenus();var fID=$(obj).attr("fID");var searchInstance=$(obj).attr("ccm-file-manager-instance");var bobj=document.getElementById("ccm-al-menu"+fID+searchInstance+selector);if(!bobj){el=document.createElement("DIV");el.id="ccm-al-menu"+fID+searchInstance+selector;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);var passedFilters=$("div[ccm-file-manager-field="+selector+"] input.ccm-file-manager-filter");var filterStr="";if(passedFilters.length>0){passedFilters.each(function(){filterStr+="&"+$(this).attr("name")+"="+$(this).attr("value")})}var filepath=$(obj).attr("al-filepath");bobj=$("#ccm-al-menu"+fID+searchInstance+selector);bobj.css("position","absolute");var html='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';html+="<ul>";if(ccm_alLaunchType[searchInstance]!="DASHBOARD"&&ccm_alLaunchType[searchInstance]!="BROWSE"){var onclick=selectedFile.length>0?"ccm_alLaunchSelectorFileManager('"+selector+"')":"ccm_alSelectFile("+fID+")";var chooseText=selectedFile.length>0?ccmi18n_filemanager.chooseNew:ccmi18n_filemanager.select;html+='<li><a class="ccm-menu-icon ccm-icon-choose-file-menu" dialog-modal="false" dialog-width="90%" dialog-height="70%" dialog-title="'+ccmi18n_filemanager.select+'" id="menuSelectFile'+fID+'" href="javascript:void(0)" onclick="'+onclick+'">'+chooseText+"</a></li>"}if(selectedFile.length>0){html+='<li><a class="ccm-menu-icon ccm-icon-clear-file-menu" href="javascript:void(0)" id="menuClearFile'+fID+searchInstance+selector+'">'+ccmi18n_filemanager.clear+"</a></li>"}if(ccm_alLaunchType[searchInstance]!="DASHBOARD"&&ccm_alLaunchType[searchInstance]!="BROWSE"&&selectedFile.length>0){html+='<li class="ccm-menu-separator"></li>'}if($(obj).attr("ccm-file-manager-can-view")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-view dialog-launch" dialog-modal="false" dialog-append-buttons="true" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.view+'" id="menuView'+fID+'" href="'+CCM_TOOLS_PATH+"/files/view?fID="+fID+'">'+ccmi18n_filemanager.view+"</a></li>"}else{html+='<li><a class="ccm-menu-icon ccm-icon-download-menu" href="javascript:void(0)" id="menuDownload'+fID+'" onclick="window.frames[\''+ccm_alProcessorTarget+"'].location='"+CCM_TOOLS_PATH+"/files/download?fID="+fID+"'\">"+ccmi18n_filemanager.download+"</a></li>"}if($(obj).attr("ccm-file-manager-can-edit")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-edit-menu dialog-launch" dialog-modal="false" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.edit+'" id="menuEdit'+fID+'" href="'+CCM_TOOLS_PATH+"/files/edit?searchInstance="+searchInstance+"&fID="+fID+filterStr+'">'+ccmi18n_filemanager.edit+"</a></li>"}html+='<li><a class="ccm-menu-icon ccm-icon-properties-menu dialog-launch" dialog-modal="false" dialog-width="680" dialog-height="450" dialog-title="'+ccmi18n_filemanager.properties+'" id="menuProperties'+fID+'" href="'+CCM_TOOLS_PATH+"/files/properties?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.properties+"</a></li>";if($(obj).attr("ccm-file-manager-can-replace")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-replace dialog-launch" dialog-modal="false" dialog-width="300" dialog-height="260" dialog-title="'+ccmi18n_filemanager.replace+'" id="menuFileReplace'+fID+'" href="'+CCM_TOOLS_PATH+"/files/replace?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.replace+"</a></li>"}if($(obj).attr("ccm-file-manager-can-duplicate")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-copy-menu" id="menuFileDuplicate'+fID+'" href="javascript:void(0)" onclick="ccm_alDuplicateFile('+fID+",'"+searchInstance+"')\">"+ccmi18n_filemanager.duplicate+"</a></li>"}html+='<li><a class="ccm-menu-icon ccm-icon-sets dialog-launch" dialog-modal="false" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.sets+'" id="menuFileSets'+fID+'" href="'+CCM_TOOLS_PATH+"/files/add_to?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.sets+"</a></li>";if($(obj).attr("ccm-file-manager-can-admin")=="1"||$(obj).attr("ccm-file-manager-can-delete")=="1"){html+='<li class="ccm-menu-separator"></li>'}if($(obj).attr("ccm-file-manager-can-admin")=="1"){html+='<li><a class="ccm-menu-icon ccm-icon-access-permissions dialog-launch" dialog-modal="false" dialog-width="400" dialog-height="450" dialog-title="'+ccmi18n_filemanager.permissions+'" id="menuFilePermissions'+fID+'" href="'+CCM_TOOLS_PATH+"/files/permissions?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.permissions+"</a></li>"}if($(obj).attr("ccm-file-manager-can-delete")=="1"){html+='<li><a class="ccm-icon-delete-menu ccm-menu-icon dialog-launch" dialog-append-buttons="true" dialog-modal="false" dialog-width="500" dialog-height="200" dialog-title="'+ccmi18n_filemanager.deleteFile+'" id="menuDeleteFile'+fID+'" href="'+CCM_TOOLS_PATH+"/files/delete?searchInstance="+searchInstance+"&fID="+fID+'">'+ccmi18n_filemanager.deleteFile+"</a></li>"}html+="</ul>";html+="</div></div></div>";bobj.append(html);$(bobj).find("a").bind("click.hide-menu",function(e){ccm_hideMenus();return false});$("#ccm-al-menu"+fID+searchInstance+selector+" a.dialog-launch").dialog();$("a#menuClearFile"+fID+searchInstance+selector).click(function(e){ccm_clearFile(e,selector);ccm_hideMenus()})}else{bobj=$("#ccm-al-menu"+fID+searchInstance+selector)}ccm_fadeInMenu(bobj,e)};ccm_alSelectNone=function(){ccm_hideMenus()};var checkbox_status=false;toggleCheckboxStatus=function(form){if(checkbox_status){for(i=0;i<form.elements.length;i++){if(form.elements[i].type=="checkbox"){form.elements[i].checked=false}}checkbox_status=false}else{for(i=0;i<form.elements.length;i++){if(form.elements[i].type=="checkbox"){form.elements[i].checked=true}}checkbox_status=true}};ccm_alDuplicateFile=function(fID,searchInstance){var postStr="fID="+fID+"&searchInstance="+searchInstance;$.post(CCM_TOOLS_PATH+"/files/duplicate",postStr,function(resp){var r=eval("("+resp+")");if(r.error==1){ccmAlert.notice(ccmi18n.error,r.message);return false}var highlight=new Array;if(r.fID){highlight.push(r.fID);ccm_alRefresh(highlight,searchInstance);ccm_uploadedFiles.push(r.fID);ccm_filesUploadedDialog(searchInstance)}})};ccm_alSelectMultipleIncomingFiles=function(obj){if($(obj).prop("checked")){$("input.ccm-file-select-incoming").attr("checked",true)}else{$("input.ccm-file-select-incoming").attr("checked",false)}};ccm_starFile=function(img,fID){var action="";if($(img).attr("src").indexOf(CCM_STAR_STATES.unstarred)!=-1){$(img).attr("src",$(img).attr("src").replace(CCM_STAR_STATES.unstarred,CCM_STAR_STATES.starred));action="star"}else{$(img).attr("src",$(img).attr("src").replace(CCM_STAR_STATES.starred,CCM_STAR_STATES.unstarred));action="unstar"}$.post(CCM_TOOLS_PATH+"/"+CCM_STAR_ACTION,{action:action,"file-id":fID},function(data,textStatus){})};jQuery.cookie=function(name,value,options){if(typeof value!="undefined"){options=options||{};if(value===null){value="";options=$.extend({},options);options.expires=-1}var expires="";if(options.expires&&(typeof options.expires=="number"||options.expires.toUTCString)){var date;if(typeof options.expires=="number"){date=new Date;date.setTime(date.getTime()+options.expires*24*60*60*1e3)}else{date=options.expires}expires="; expires="+date.toUTCString()}var path=options.path?"; path="+options.path:"";var domain=options.domain?"; domain="+options.domain:"";var secure=options.secure?"; secure":"";document.cookie=[name,"=",encodeURIComponent(value),expires,path,domain,secure].join("")}else{var cookieValue=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}};$.widget.bridge("jqdialog",$.ui.dialog);jQuery.fn.dialog=function(){if(arguments.length>0){$(this).jqdialog(arguments[0],arguments[1],arguments[2]);return}else if($(this).is("div")){$(this).jqdialog();return}return $(this).each(function(){$(this).unbind("click.make-dialog").bind("click.make-dialog",function(e){var href=$(this).attr("href");var width=$(this).attr("dialog-width");var height=$(this).attr("dialog-height");var title=$(this).attr("dialog-title");var onOpen=$(this).attr("dialog-on-open");var onDestroy=$(this).attr("dialog-on-destroy");var onClose=$(this).attr("dialog-on-close");obj={modal:true,href:href,width:width,height:height,title:title,onOpen:onOpen,onDestroy:onDestroy,onClose:onClose};jQuery.fn.dialog.open(obj);return false})})};jQuery.fn.dialog.close=function(num){num++;$("#ccm-dialog-content"+num).jqdialog("close")};jQuery.fn.dialog.open=function(obj){jQuery.fn.dialog.showLoader();if(typeof $.fn.ccmmenu!="undefined"){$.fn.ccmmenu.hide()}var nd=$(".ui-dialog").length;nd++;$("body").append('<div id="ccm-dialog-content'+nd+'" style="display: none"></div>');if(typeof obj.width=="string"){if(obj.width=="auto"){w="auto"}else{if(obj.width.indexOf("%",0)>0){w=obj.width.replace("%","");w=$(window).width()*(w/100);w=w+50}else{w=parseInt(obj.width)+50}}}else if(obj.width){w=parseInt(obj.width)+50}else{w=550}if(typeof obj.height=="string"){if(obj.height=="auto"){h="auto"}else{if(obj.height.indexOf("%",0)>0){h=obj.height.replace("%","");h=$(window).height()*(h/100);h=h+100}else{h=parseInt(obj.height)+100}}}else if(obj.height){h=parseInt(obj.height)+100}else{h=400}if(h!=="auto"&&h>$(window).height()){h=$(window).height()}$("#ccm-dialog-content"+nd).jqdialog({modal:true,height:h,width:w,show:{effect:"fade",duration:150,easing:"easeInExpo"},escapeClose:true,title:obj.title,open:function(){$("body").css("overflow","hidden");var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(i,obj){if(i+1<overlays){$(this).css("opacity",0)}})},beforeClose:function(){var nd=$(".ui-dialog").length;if(nd==1){$("body").css("overflow","auto")}},close:function(ev,u){$(this).jqdialog("destroy").remove();$("#ccm-dialog-content"+nd).remove();if(typeof obj.onClose!="undefined"){if(typeof obj.onClose=="function"){obj.onClose()}else{eval(obj.onClose)}}if(typeof obj.onDestroy!="undefined"){if(typeof obj.onDestroy=="function"){obj.onDestroy()}else{eval(obj.onDestroy)}}var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(i,obj){if(i+1<overlays){$(this).css("opacity",0)}else{$(this).css("opacity",1)}});nd--}});if(!obj.element){$.ajax({type:"GET",url:obj.href,success:function(r){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.replaceTop(r);if(typeof obj.onOpen!="undefined"){if(typeof obj.onOpen=="function"){obj.onOpen()}else{eval(obj.onOpen)}}}})}else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.replaceTop($(obj.element));if(typeof obj.onOpen!="undefined"){if(typeof obj.onOpen=="function"){obj.onOpen()}else{eval(obj.onOpen)}}}};jQuery.fn.dialog.replaceTop=function(r){var nd=$(".ui-dialog").length;if(typeof r=="string"){$("#ccm-dialog-content"+nd).html(r)}else{var r2=r.clone(true,true).appendTo("#ccm-dialog-content"+nd);if(r2.css("display")=="none"){r2.show()}}$("#ccm-dialog-content"+nd+" .dialog-launch").dialog();$("#ccm-dialog-content"+nd+" .ccm-dialog-close").click(function(){jQuery.fn.dialog.closeTop()});if($("#ccm-dialog-content"+nd+" .dialog-buttons").length>0){$("#ccm-dialog-content"+nd).jqdialog("option","buttons",[{}]);$("#ccm-dialog-content"+nd).parent().find(".ui-dialog-buttonset").remove();$("#ccm-dialog-content"+nd).parent().find(".ui-dialog-buttonpane").html("");$("#ccm-dialog-content"+nd+" .dialog-buttons").appendTo($("#ccm-dialog-content"+nd).parent().find(".ui-dialog-buttonpane").addClass("ccm-ui"))}if($("#tooltip-holder").length==0){$("<div />").attr("id","tooltip-holder").attr("class","ccm-ui").prependTo(document.body)}if($("#ccm-dialog-content"+nd+" .dialog-help").length>0){$("#ccm-dialog-content"+nd+" .dialog-help").hide();var helpContent=$("#ccm-dialog-content"+nd+" .dialog-help").html();if(ccmi18n.helpPopup){var helpText=ccmi18n.helpPopup}else{var helpText="Help"}$("#ccm-dialog-content"+nd).parent().find(".ui-dialog-titlebar").addClass("ccm-ui").append('<button class="ui-dialog-titlebar-help ccm-menu-help-trigger"><i class="icon-info-sign"></i></button>');$("#ccm-dialog-content"+nd).parent().find(".ui-dialog-titlebar .ccm-menu-help-trigger").popover({content:function(){return helpContent},placement:"bottom",html:true,container:"#tooltip-holder",trigger:"click"})}};jQuery.fn.dialog.showLoader=function(text){if(typeof imgLoader=="undefined"||!imgLoader||!imgLoader.src)return false;if($("#ccm-dialog-loader").length<1){$("body").append("<div id='ccm-dialog-loader-wrapper' class='ccm-ui'><div class='progress progress-striped active' style='width: 300px'><div class='progress-bar progress-bar-info' style='width: 100%;'></div></div></div>")}if(text!=null){$("#ccm-dialog-loader-text",$("#ccm-dialog-loader-wrapper")).remove();$("<div />").attr("id","ccm-dialog-loader-text").html(text).prependTo($("#ccm-dialog-loader-wrapper"))}var w=$("#ccm-dialog-loader-wrapper").width();var h=$("#ccm-dialog-loader-wrapper").height();var tw=$(window).width();var th=$(window).height();var _left=(tw-w)/2;var _top=(th-h)/2;$("#ccm-dialog-loader-wrapper").css("left",_left+"px").css("top",_top+"px");$("#ccm-dialog-loader-wrapper").show()};jQuery.fn.dialog.hideLoader=function(){$("#ccm-dialog-loader-wrapper").hide();$("#ccm-dialog-loader-text").remove()};jQuery.fn.dialog.closeTop=function(){var nd=$(".ui-dialog").length;$("#ccm-dialog-content"+nd).jqdialog("close")};jQuery.fn.dialog.closeAll=function(){$($(".ui-dialog-content").get().reverse()).jqdialog("close")};var imgLoader;var ccm_dialogOpen=0;jQuery.fn.dialog.loaderImage=CCM_IMAGE_PATH+"/throbber_white_32.gif";var ccmAlert={notice:function(title,message,onCloseFn){$.fn.dialog.open({href:CCM_TOOLS_PATH+"/alert",title:title,width:320,height:160,modal:false,onOpen:function(){$("#ccm-popup-alert-message").html(message)},onDestroy:onCloseFn})},hud:function(message,time,icon,title){if($("#ccm-notification-inner").length==0){$(document.body).append('<div id="ccm-notification" class="ccm-ui"><div id="ccm-notification-inner"></div></div>')}if(icon==null){icon="edit_small"}if(title==null){var messageText=message}else{var messageText="<h3>"+title+"</h3>"+message}$("#ccm-notification-inner").html('<img id="ccm-notification-icon" src="'+CCM_IMAGE_PATH+"/icons/"+icon+'.png" width="16" height="16" /><div id="ccm-notification-message">'+messageText+"</div>");$("#ccm-notification").show();if(time>0){setTimeout(function(){$("#ccm-notification").fadeOut({easing:"easeOutExpo",duration:300})},time)}}};$(document).ready(function(){imgLoader=new Image;imgLoader.src=jQuery.fn.dialog.loaderImage});ccm_closeNewsflow=function(r){$ovl=ccm_getNewsflowOverlayWindow();$ovl.fadeOut(300,"easeOutExpo");$(".ui-widget-overlay").fadeOut(300,"easeOutExpo",function(){$(this).remove()})};ccm_setNewsflowPagingArrowHeight=function(){if($("#ccm-marketplace-detail").length>0){var $ovl=$("#ccm-marketplace-detail")}else{var $ovl=$("#newsflow-main")}var h=$ovl.height();$(".newsflow-paging-previous a, .newsflow-paging-next a").css("height",h+"px");$(".newsflow-paging-previous, .newsflow-paging-next").css("height",h+"px");$(".newsflow-paging-next").show();$(".newsflow-paging-previous").show()};ccm_setNewsflowOverlayDimensions=function(){if($("#newsflow-overlay").length>0){var w=$("#newsflow-overlay").width();var tw=$(window).width();var th=$(window).height();var optimalHeight=650;var availableSpace=th-80;if(availableSpace>optimalHeight){h=optimalHeight}else{h=availableSpace}$("#newsflow-overlay").css("height",optimalHeight);var _left=(tw-w)/2;var _top=(th-h)/2;_top=_top+29;_left=_left+"px";_top=_top+"px";$("#newsflow-overlay").css("left",_left).css("top",_top)}};ccm_getNewsflowOverlayWindow=function(){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0&&$("#newsflow-overlay").length==0){var $ovl=$("#newsflow-main").parent()}else{if($("#newsflow-overlay").length>0){var $ovl=$("#newsflow-overlay")}else{var $ovl=$("<div />").attr("id","newsflow-overlay").attr("class","ccm-ui").css("display","none").appendTo(document.body)}}return $ovl};ccm_showNewsflowOverlayWindow=function(url,callback){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0){}else{if($(".ui-widget-overlay").length<1){var $overlay=$('<div class="ui-widget-overlay"></div>').hide().appendTo("body")}$(".ui-widget-overlay").show()}$(window).resize(function(){ccm_setNewsflowOverlayDimensions()});$ovl=ccm_getNewsflowOverlayWindow();$ovl.load(url,function(){$ovl.hide();$(".newsflow-paging-next").hide();$(".newsflow-paging-previous").hide();$ovl.html($(this).html());if(callback){callback()}ccm_setNewsflowOverlayDimensions();ccm_setupTrickleUpNewsflowStyles();$ovl.fadeIn("300","easeOutExpo",function(){ccm_setNewsflowPagingArrowHeight()})})};ccm_setupTrickleUpNewsflowStyles=function(){ovl=ccm_getNewsflowOverlayWindow();ovl.find(".newsflow-em1").each(function(){$(this).parent().addClass("newsflow-em1")})};ccm_showDashboardNewsflowWelcome=function(){jQuery.fn.dialog.showLoader(ccmi18n.newsflowLoading);ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/home?_ccm_dashboard_external=1",function(){jQuery.fn.dialog.hideLoader()})};ccm_showNewsflowOffsite=function(id){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cID="+id,function(){jQuery.fn.dialog.hideLoader()})};ccm_showAppIntroduction=function(){ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/welcome?_ccm_dashboard_external=1")};ccm_getNewsflowByPath=function(path){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cPath="+path,function(){jQuery.fn.dialog.hideLoader()})};ccm_doPageReindexing=function(){$.get(CCM_TOOLS_PATH+"/reindex_pending_pages?ccm_token="+CCM_SECURITY_TOKEN)};$.fn.ccmmenu=function(){$.fn.ccmmenu.enable();return $.each($(this),function(i,obj){var $this=$(obj),$menulauncher;if(!$this.prop("has-menu")){$this.find(".dialog-launch").dialog();$this.prop("has-menu",true);$this.prop("disable-highlight",$this.attr("data-menu-disable-highlight"));if(!$this.attr("data-menu-handle")){$menulauncher=$this}else{$menulauncher=$("#"+$this.attr("data-menu-handle"))}var $menu=$("#"+$this.attr("data-menu"));$this.$menu=$menu;$menulauncher.mousemove(function(e){$.fn.ccmmenu.over(e,$this,$menulauncher)})}})};$.fn.ccmmenu.out=function(e){if(!$.fn.ccmmenu.isactive){$.fn.ccmmenu.$highlighter.css("opacity",0);$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$.fn.ccmmenu.$highlighter.removeClass("ccm-highlighter-clicked")}};$.fn.ccmmenu.resethighlighter=function(){$.fn.ccmmenu.disable();$.fn.ccmmenu.enable()};$.fn.ccmmenu.enable=function(){$.fn.ccmmenu.isenabled=true;if($("#ccm-highlighter").length==0){$(document.body).append($("<div />",{id:"ccm-highlighter"}))}if($("#ccm-popover-menu-container").length==0){$(document.body).append($("<div />",{id:"ccm-popover-menu-container","class":"ccm-ui"}))}$.fn.ccmmenu.$highlighter=$("#ccm-highlighter");$.fn.ccmmenu.$holder=$("#ccm-popover-menu-container");$.fn.ccmmenu.$highlighter.on("mouseout.highlighter",function(e){$.fn.ccmmenu.out(e)});$.fn.ccmmenu.$highlighter.on("mouseover.highlighter",function(e){$.fn.ccmmenu.over(e)});$.fn.ccmmenu.$highlighter.unbind("click.highlighter").on("click.highlighter",function(e){$.fn.ccmmenu.$highlighter.addClass("ccm-highlighter-clicked");$.fn.ccmmenu.showmenu(e,$.fn.ccmmenu.$overmenu)})};$.fn.ccmmenu.disable=function(){$.fn.ccmmenu.out();$.fn.ccmmenu.isenabled=false;$.fn.ccmmenu.$highlighter.remove()};$.fn.ccmmenu.over=function(e,$this,$menulauncher){if($.fn.ccmmenu.isenabled&&!$.fn.ccmmenu.isactive){$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$.fn.ccmmenu.$highlighter.removeClass("ccm-highlighter-clicked");if($menulauncher){var offset=$menulauncher.offset();var t=offset.top-5;var l=offset.left-5;var w=$menulauncher.outerWidth()+10;var h=$menulauncher.outerHeight()+10;$.fn.ccmmenu.$highlighter.css("width",w).css("height",h).css("top",t).css("left",l).css("border-top-left-radius",$menulauncher.css("border-top-left-radius")).css("border-bottom-left-radius",$menulauncher.css("border-bottom-left-radius")).css("border-top-right-radius",$menulauncher.css("border-top-right-radius")).css("border-bottom-right-radius",$menulauncher.css("border-bottom-right-radius"));$.fn.ccmmenu.$overmenu=$this}$.fn.ccmmenu.$overmenu.addClass("ccm-menu-item-active");$.fn.ccmmenu.$overmenu.parent().addClass("ccm-parent-menu-item-active");if($.fn.ccmmenu.$overmenu.prop("disable-highlight")){$.fn.ccmmenu.$highlighter.css("opacity",0)}else{$.fn.ccmmenu.$highlighter.css("opacity","0.2")}}};$.fn.ccmmenu.hide=function(e){if(e){e.stopPropagation()}if($.fn.ccmmenu.$highlighter){$.fn.ccmmenu.isactive=false;$.fn.ccmmenu.$highlighter.css("opacity",0);$.fn.ccmmenu.$holder.html("");$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$.fn.ccmmenu.$highlighter.removeClass("ccm-highlighter-clicked");$(document).unbind("click.disableccmmenu");$("div.popover").css("opacity",0).hide()}};$.fn.ccmmenu.showmenu=function(e,$this){e.stopPropagation();if($.fn.ccmmenu.isactive){$("div.popover").css("opacity",0).hide()}$.fn.ccmmenu.isactive=true;var $pp=$this.$menu.clone(true,true);$pp.appendTo($.fn.ccmmenu.$holder);var posX=e.pageX+2;var posY=e.pageY+2;$pp.css("opacity",0).show();var mheight=$pp.height(),mwidth=$pp.width();if($(window).height()<e.clientY+mheight+30){posY=posY-mheight-10;posX=posX-mwidth/2;$pp.removeClass("bottom");$pp.addClass("top")}else{posX=posX-mwidth/2;posY=posY+10;$pp.removeClass("top");
$pp.addClass("bottom")}$pp.css("top",posY+"px");$pp.css("left",posX+"px");$pp.show().css("opacity",1);$pp.find("a").click(function(e){$.fn.ccmmenu.hide(e)});$(document).on("click.disableccmmenu",function(e){$.fn.ccmmenu.hide(e)})};String.prototype.score=function(abbreviation,offset){offset=offset||0;if(abbreviation.length==0)return.9;if(abbreviation.length>this.length)return 0;for(var i=abbreviation.length;i>0;i--){var sub_abbreviation=abbreviation.substring(0,i);var index=this.indexOf(sub_abbreviation);if(index<0)continue;if(index+abbreviation.length>this.length+offset)continue;var next_string=this.substring(index+sub_abbreviation.length);var next_abbreviation=null;if(i>=abbreviation.length)next_abbreviation="";else next_abbreviation=abbreviation.substring(i);var remaining_score=next_string.score(next_abbreviation,offset+index);if(remaining_score>0){var score=this.length-next_string.length;if(index!=0){var j=0;var c=this.charCodeAt(index-1);if(c==32||c==9){for(var j=index-2;j>=0;j--){c=this.charCodeAt(j);score-=c==32||c==9?1:.15}}else{score-=index}}score+=remaining_score*next_string.length;score/=this.length;return score}}return 0};ccm_openThemeLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/themes",width:"905",modal:false,height:"410"})},"open_theme_launcher")};ccm_testMarketplaceConnection=function(onComplete,task,mpID){if(mpID){mpIDStr="&mpID="+mpID}else{mpIDStr=""}if(!task){task=""}params={mpID:mpID};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(resp){if(resp.isConnected){onComplete()}else{$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task="+task+mpIDStr,width:"90%",modal:false,height:"70%"});return false}})};ccm_openAddonLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/add-ons",width:"905",modal:false,height:"410"})},"open_addon_launcher")};ccm_setupMarketplaceDialogForm=function(){$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))});$(".ccm-pane-dialog-pagination a").click(function(){jQuery.fn.dialog.showLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").load($(this).attr("href"),function(){jQuery.fn.dialog.hideLoader()});return false});ccm_marketplaceBrowserInit();$("#ccm-marketplace-browser-form").ajaxForm({beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(resp){jQuery.fn.dialog.hideLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").html(resp)}})};ccm_marketplaceBrowserInit=function(){$(".ccm-marketplace-item").click(function(){ccm_getMarketplaceItemDetails($(this).attr("mpID"))});$(".ccm-marketplace-item-thumbnail").mouseover(function(){var img=$(this).parent().find("div.ccm-marketplace-results-image-hover").clone().addClass("ccm-marketplace-results-image-hover-displayed").appendTo(document.body);var t=$(this).offset().top;var l=$(this).offset().left;l=l+60;img.css("top",t).css("left",l);img.show()});$(".ccm-marketplace-item-thumbnail").mouseout(function(){$(".ccm-marketplace-results-image-hover-displayed").hide().remove()})};ccm_getMarketplaceItemDetails=function(mpID){jQuery.fn.dialog.showLoader();$("#ccm-intelligent-search-results").hide();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/details?mpID="+mpID,width:820,appendButtons:true,modal:false,height:640})},"get_item_details",mpID)};ccm_getMarketplaceItem=function(args){var mpID=args.mpID;var closeTop=args.closeTop;this.onComplete=function(){};if(args.onComplete){ccm_getMarketplaceItem.onComplete=args.onComplete}if(closeTop){jQuery.fn.dialog.closeTop()}jQuery.fn.dialog.showLoader();params={mpID:mpID};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(resp){jQuery.fn.dialog.hideLoader();if(resp.isConnected){if(!resp.purchaseRequired){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/download?install=1&mpID="+mpID,width:500,appendButtons:true,modal:false,height:400})}else{$.fn.dialog.open({title:ccmi18n.communityCheckout,iframe:true,href:CCM_TOOLS_PATH+"/marketplace/checkout?mpID="+mpID,width:"560px",modal:false,height:"400px"})}}else{$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task=get&mpID="+mpID,width:"90%",modal:false,height:"70%"})}})};var CCMInlineEditMode=function(){enterInlineEditMode=function(activeObj){$.fn.ccmmenu.disable();$("div.ccm-block-edit").addClass("ccm-block-edit-disabled");$("div.ccm-area-footer-handle").addClass("ccm-block-edit-disabled");$("div.ccm-area-layout-control-bar").addClass("ccm-block-edit-disabled");if(activeObj){activeObj.removeClass("ccm-block-edit-disabled").addClass("ccm-block-edit-inline-active")}};return{exit:function(onComplete){$(document).trigger("inlineEditCancel",[onComplete])},finishExit:function(){$("div.ccm-area-edit-inline-active").removeClass("ccm-area-edit-inline-active");$.fn.ccmmenu.enable();$("div.ccm-block-edit-inline-active").remove();$("div.ccm-block-edit").removeClass("ccm-block-edit-disabled");$("div.ccm-area-footer-handle").removeClass("ccm-block-edit-disabled");$("div.ccm-area-layout-control-bar").removeClass("ccm-block-edit-disabled");jQuery.fn.dialog.hideLoader();CCMEditMode.start()},loadEditFromLink:function(link,params){var cID=$(link).attr("data-cID");var aID=$(link).attr("data-area-id");var arHandle=$(link).attr("data-area-handle");var bID=$(link).attr("data-bID");var postData=[{name:"btask",value:"edit"},{name:"cID",value:cID},{name:"arHandle",value:arHandle},{name:"aID",value:aID},{name:"bID",value:bID}];if(params){for(var prop in params){postData.push({name:prop,value:params[prop]})}}jQuery.fn.dialog.showLoader();enterInlineEditMode($("[data-block-id="+bID+"][data-area-id="+aID+"]"));$.ajax({type:"GET",url:CCM_TOOLS_PATH+"/edit_block_popup",data:postData,success:function(r){$("[data-block-id="+bID+"][data-area-id="+aID+"]").html(r);jQuery.fn.dialog.hideLoader()}})},loadAdd:function(cID,arHandle,aID,btID,params){var postData=[{name:"btask",value:"edit"},{name:"cID",value:cID},{name:"arHandle",value:arHandle},{name:"btID",value:btID}];if(params){for(var prop in params){postData.push({name:prop,value:params[prop]})}}jQuery.fn.dialog.showLoader();enterInlineEditMode();$.ajax({type:"GET",url:CCM_TOOLS_PATH+"/add_block_popup",data:postData,success:function(r){jQuery.fn.dialog.closeAll();if($("#ccm-add-new-block-placeholder").length>0){var obj=$("#ccm-add-new-block-placeholder")}else{var obj=$("#a"+aID)}obj.addClass("ccm-area-edit-inline-active");obj.append($('<div id="a'+aID+"-bt"+btID+'" class="ccm-block-edit-inline-active">'+r+"</div>"));jQuery.fn.dialog.hideLoader()}})}}}();var ccm_searchActivatePostFunction=new Array;ccm_setupAdvancedSearchFields=function(searchType){ccm_totalAdvancedSearchFields=$(".ccm-search-request-field-set").length;$("#ccm-"+searchType+"-search-add-option").unbind();$("#ccm-"+searchType+"-search-add-option").click(function(){ccm_totalAdvancedSearchFields++;if($("#ccm-search-fields-wrapper").length>0){$("#ccm-search-fields-wrapper").append('<div class="ccm-search-field" id="ccm-'+searchType+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</div>")}else{$("#ccm-"+searchType+"-search-advanced-fields").append('<tr class="ccm-search-field" id="ccm-'+searchType+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</tr>")}ccm_activateAdvancedSearchFields(searchType,ccm_totalAdvancedSearchFields)});var i=1;$(".ccm-search-request-field-set").each(function(){ccm_activateAdvancedSearchFields(searchType,i);i++})};ccm_setupAdvancedSearch=function(searchType){ccm_setupAdvancedSearchFields(searchType);$("#ccm-"+searchType+"-advanced-search").ajaxForm({beforeSubmit:function(){ccm_deactivateSearchResults(searchType)},success:function(resp){ccm_parseAdvancedSearchResponse(resp,searchType)}});ccm_setupInPagePaginationAndSorting(searchType);ccm_setupSortableColumnSelection(searchType)};ccm_parseAdvancedSearchResponse=function(resp,searchType){var obj=$("#ccm-"+searchType+"-search-results");if(obj.length==0||searchType==null){obj=$("#ccm-search-results")}obj.html(resp);ccm_activateSearchResults(searchType)};ccm_deactivateSearchResults=function(searchType){var obj=$("#ccm-"+searchType+"-search-fields-submit");if(obj.length==0||searchType==null){obj=$("#ccm-search-fields-submit")}obj.attr("disabled",true);var obj=$("#ccm-"+searchType+"-search-results table.ccm-results-list");if(obj.length==0||searchType==null){obj=$("#ccm-search-results")}obj.css("opacity",.4);jQuery.fn.dialog.showLoader()};ccm_activateSearchResults=function(searchType){if($(".ui-dialog-content").length==0){window.scrollTo(0,0)}else{$(".ui-dialog-content").each(function(i){$(this).get(0).scrollTop=0})}$(".dialog-launch").dialog();var obj=$("#ccm-"+searchType+"-search-results table.ccm-results-list");if(obj.length==0||searchType==null){obj=$("#ccm-search-results")}obj.css("opacity",1);jQuery.fn.dialog.hideLoader();var obj=$("#ccm-"+searchType+"-search-fields-submit");if(obj.length==0||searchType==null){obj=$("#ccm-search-fields-submit")}obj.attr("disabled",false);ccm_setupInPagePaginationAndSorting(searchType);ccm_setupSortableColumnSelection(searchType);if(typeof ccm_searchActivatePostFunction[searchType]=="function"){ccm_searchActivatePostFunction[searchType]()}};ccm_setupInPagePaginationAndSorting=function(searchType){$(".ccm-results-list th a").click(function(){ccm_deactivateSearchResults(searchType);var obj=$("#ccm-"+searchType+"-search-results");if(obj.length==0){obj=$("#ccm-search-results")}obj.load($(this).attr("href"),false,function(){ccm_activateSearchResults(searchType)});return false});$("div.ccm-pagination a").click(function(){if(!$(this).parent().hasClass("disabled")){ccm_deactivateSearchResults(searchType);var obj=$("#ccm-"+searchType+"-search-results");if(obj.length==0){obj=$("#ccm-search-results")}obj.load($(this).attr("href"),false,function(){ccm_activateSearchResults(searchType);$("div.ccm-dialog-content").attr("scrollTop",0)})}return false});$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupSortableColumnSelection=function(searchType){$("#ccm-list-view-customize").unbind();$("#ccm-list-view-customize").click(function(){jQuery.fn.dialog.open({width:550,height:350,appendButtons:true,modal:false,href:$(this).attr("href"),title:ccmi18n.customizeSearch});return false})};ccm_checkSelectedAdvancedSearchField=function(searchType,fieldset){$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-option-type-date_time input").each(function(){$(this).attr("id",$(this).attr("id")+fieldset)});$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-option-type-date_time input").datepicker({showAnim:"fadeIn"});$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-option-type-rating input").rating()};ccm_activateAdvancedSearchFields=function(searchType,fieldset){var selTag=$("#ccm-"+searchType+"-search-field-set"+fieldset+" select:first");selTag.unbind();selTag.change(function(){var selected=$(this).find(":selected").val();$(this).parent().parent().find("input.ccm-"+searchType+"-selected-field").val(selected);var itemToCopy=$("#ccm-"+searchType+"-search-field-base-elements span[search-field="+selected+"]");$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-selected-field-content").html("");itemToCopy.clone().appendTo("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-selected-field-content");$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-selected-field-content .ccm-search-option").show();ccm_checkSelectedAdvancedSearchField(searchType,fieldset)});$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-remove-option").unbind();$("#ccm-"+searchType+"-search-field-set"+fieldset+" .ccm-search-remove-option").click(function(){$(this).parents("div.ccm-search-field").remove();$(this).parents("tr.ccm-search-field").remove()});ccm_checkSelectedAdvancedSearchField(searchType,fieldset)};ccm_activateEditablePropertiesGrid=function(){$("tr.ccm-attribute-editable-field").each(function(){var trow=$(this);$(this).find("a").click(function(){trow.find(".ccm-attribute-editable-field-text").hide();trow.find(".ccm-attribute-editable-field-clear-button").hide();trow.find(".ccm-attribute-editable-field-form").show();trow.find(".ccm-attribute-editable-field-save-button").show()});trow.find("form").submit(function(){return false});trow.find(".ccm-attribute-editable-field-save-button").parent().click(function(){var task=trow.find("form input[name=task]");if(task.val()=="clear_extended_attribute"){task.val(task.attr("data-original-task"));task.attr("data-original-task","")}ccm_submitEditablePropertiesGrid(trow)});trow.find(".ccm-attribute-editable-field-clear-button").parent().unbind();trow.find(".ccm-attribute-editable-field-clear-button").parent().click(function(){var task=trow.find("form input[name=task]");task.attr("data-original-task",task.val());task.val("clear_extended_attribute");ccm_submitEditablePropertiesGrid(trow);return false})})};ccm_submitEditablePropertiesGrid=function(trow){trow.find(".ccm-attribute-editable-field-save-button").hide();trow.find(".ccm-attribute-editable-field-clear-button").hide();trow.find(".ccm-attribute-editable-field-loading").show();try{tinyMCE.triggerSave(true,true)}catch(e){}trow.find("form").ajaxSubmit(function(resp){trow.find(".ccm-attribute-editable-field-loading").hide();trow.find(".ccm-attribute-editable-field-save-button").show();trow.find(".ccm-attribute-editable-field-text").text(resp);trow.find(".ccm-attribute-editable-field-form").hide();trow.find(".ccm-attribute-editable-field-save-button").hide();trow.find(".ccm-attribute-editable-field-text").show();trow.find(".ccm-attribute-editable-field-clear-button").show();trow.find("td").show("highlight",{color:"#FFF9BB"})})};ccm_triggerSelectUser=function(uID,uName,uEmail){alert(uID);alert(uName);alert(uEmail)};ccm_triggerSelectGroup=function(gID,gName){alert(gID);alert(gName)};ccm_setupUserSearch=function(searchInstance){$(".chosen-select").chosen();$("#ccm-user-list-cb-all").click(function(){if($(this).prop("checked")==true){$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-user-list-multiple-operations").attr("disabled",false)}else{$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-user-list-multiple-operations").attr("disabled",true)}});$("td.ccm-user-list-cb input[type=checkbox]").click(function(e){if($("td.ccm-user-list-cb input[type=checkbox]:checked").length>0){$("#ccm-user-list-multiple-operations").attr("disabled",false)}else{$("#ccm-user-list-multiple-operations").attr("disabled",true)}});$("#ccm-user-list-multiple-operations").change(function(){var action=$(this).val();switch(action){case"choose":var idstr="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){ccm_triggerSelectUser($(this).val(),$(this).attr("user-name"),$(this).attr("user-email"))});jQuery.fn.dialog.closeTop();break;case"properties":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_properties?"+uIDstring,title:ccmi18n.properties});break;case"activate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_activate?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_activate});break;case"deactivate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_deactivate?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_deactivate});break;case"group_add":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_group_add?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_group_add});break;case"group_remove":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_group_remove?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_group_remove});break;case"delete":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/users/bulk_delete?searchInstance="+searchInstance+"&"+uIDstring,title:ccmi18n.user_delete});break}$(this).get(0).selectedIndex=0})};ccm_setupGroupSearchPaging=function(){$("div#ccm-group-paging").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupGroupSearch=function(callback){$("div.ccm-group a").unbind();if(callback){func=window[callback]}else{func=ccm_triggerSelectGroup}$("div.ccm-group a").each(function(i){var gla=$(this);$(this).click(function(){func(gla.attr("group-id"),gla.attr("group-name"));$.fn.dialog.closeTop();return false})});$("#ccm-group-search").ajaxForm({beforeSubmit:function(){$("#ccm-group-search-wrapper").html("")},success:function(resp){$("#ccm-group-search-wrapper").html(resp)}});ccm_setupGroupSearchPaging();$("div#ccm-group-paging a").click(function(){$("#ccm-group-search-wrapper").html("");$.ajax({type:"GET",url:$(this).attr("href"),success:function(resp){$("#ccm-group-search-wrapper").html(resp)}});return false})};if(typeof ccm_selectSitemapNode!="function"){ccm_selectSitemapNode=function(cID,cName){alert(cID);alert(cName)}}var tr_activeNode=false;if(typeof tr_doAnim=="undefined"){var tr_doAnim=false}var tr_parseSubnodes=true;var tr_reorderMode=false;var tr_moveCopyMode=false;showPageMenu=function(obj,e){ccm_hideMenus();e.stopPropagation();var bobj=$("#ccm-page-menu"+obj.cID);if(!bobj.get(0)){el=document.createElement("DIV");el.id="ccm-page-menu"+obj.cID;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);bobj=$("#ccm-page-menu"+obj.cID);bobj.css("position","absolute");var html='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';html+="<ul>";if(obj.isTrash){html+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" onclick="ccm_sitemapDeleteForever('+obj.instance_id+","+obj.cID+', true)" href="javascript:void(0)">'+ccmi18n_sitemap.emptyTrash+"</a></li>"}else if(obj.inTrash){html+='<li><a class="ccm-menu-icon ccm-icon-search-pages" onclick="ccm_previewInternalTheme('+obj.cID+", false, '"+ccmi18n_sitemap.previewPage+'\')" href="javascript:void(0)">'+ccmi18n_sitemap.previewPage+"</a></li>";html+='<li class="ccm-menu-separator"></li>';html+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" onclick="ccm_sitemapDeleteForever('+obj.instance_id+","+obj.cID+', false)" href="javascript:void(0)">'+ccmi18n_sitemap.deletePageForever+"</a></li>"}else if(obj.cAlias=="LINK"||obj.cAlias=="POINTER"){html+='<li><a class="ccm-menu-icon ccm-icon-visit" id="menuVisit'+obj.cID+'" href="javascript:void(0)" onclick="window.location.href=\''+CCM_DISPATCHER_FILENAME+"?cID="+obj.cID+"'\">"+ccmi18n_sitemap.visitExternalLink+"</a></li>";if(obj.cAlias=="LINK"&&obj.canEditProperties){html+='<li><a class="ccm-menu-icon ccm-icon-edit-external-link" dialog-width="350" dialog-height="170" dialog-title="'+ccmi18n_sitemap.editExternalLink+'" dialog-modal="false" dialog-append-buttons="true" id="menuLink'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+'&ctask=edit_external">'+ccmi18n_sitemap.editExternalLink+"</a></li>"}if(obj.canDelete){html+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" dialog-append-buttons="true" id="menuDelete'+obj.cID+'" dialog-width="360" dialog-height="150" dialog-modal="false" dialog-append-buttons="true" dialog-title="'+ccmi18n_sitemap.deleteExternalLink+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+"&display_mode="+obj.display_mode+"&instance_id="+obj.instance_id+"&select_mode="+obj.select_mode+'&ctask=delete_external">'+ccmi18n_sitemap.deleteExternalLink+"</a></li>"}}else{html+='<li><a class="ccm-menu-icon ccm-icon-visit" id="menuVisit'+obj.cID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+obj.cID+'">'+ccmi18n_sitemap.visitPage+"</a></li>";if(obj.canCompose){html+='<li><a class="ccm-menu-icon ccm-icon-edit-in-composer-menu" id="menuComposer'+obj.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/composer/write/-/edit/"+obj.cID+'">'+ccmi18n_sitemap.editInComposer+"</a></li>"}if(obj.canEditProperties||obj.canEditSpeedSettings||obj.canEditPermissions||obj.canEditDesign||obj.canViewVersions||obj.canDelete){html+='<li class="ccm-menu-separator"></li>'}if(obj.canEditProperties){html+='<li><a class="ccm-menu-icon ccm-icon-properties-menu" dialog-on-close="ccm_sitemapExitEditMode('+obj.cID+')" dialog-width="850" dialog-height="360" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pagePropertiesTitle+'" id="menuProperties'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+'&ctask=edit_metadata">'+ccmi18n_sitemap.pageProperties+"</a></li>"}if(obj.canEditSpeedSettings){html+='<li><a class="ccm-menu-icon ccm-icon-speed-settings-menu" dialog-on-close="ccm_sitemapExitEditMode('+obj.cID+')" dialog-width="550" dialog-height="280" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.speedSettingsTitle+'" id="menuSpeedSettings'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+'&ctask=edit_speed_settings">'+ccmi18n_sitemap.speedSettings+"</a></li>"}if(obj.canEditPermissions){html+='<li><a class="ccm-menu-icon ccm-icon-permissions-menu" dialog-on-close="ccm_sitemapExitEditMode('+obj.cID+')" dialog-width="420" dialog-height="630" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.setPagePermissions+'" id="menuPermissions'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+'&ctask=edit_permissions">'+ccmi18n_sitemap.setPagePermissions+"</a></li>"}if(obj.canEditDesign){html+='<li><a class="ccm-menu-icon ccm-icon-design-menu" dialog-on-close="ccm_sitemapExitEditMode('+obj.cID+')" dialog-width="610" dialog-append-buttons="true" dialog-height="405" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageDesign+'" id="menuDesign'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+'&ctask=set_theme">'+ccmi18n_sitemap.pageDesign+"</a></li>"}if(obj.canViewVersions){html+='<li><a class="ccm-menu-icon ccm-icon-versions-menu" dialog-on-close="ccm_sitemapExitEditMode('+obj.cID+')" dialog-width="640" dialog-height="340" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageVersions+'" id="menuVersions'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/versions.php?rel=SITEMAP&cID="+obj.cID+'">'+ccmi18n_sitemap.pageVersions+"</a></li>"}if(obj.canDelete){html+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" dialog-on-close="ccm_sitemapExitEditMode('+obj.cID+')" dialog-append-buttons="true" id="menuDelete'+obj.cID+'" dialog-width="360" dialog-height="150" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.deletePage+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+"&display_mode="+obj.display_mode+"&instance_id="+obj.instance_id+"&select_mode="+obj.select_mode+'&ctask=delete">'+ccmi18n_sitemap.deletePage+"</a></li>"}if(obj.display_mode=="explore"||obj.display_mode=="search"){html+='<li class="ccm-menu-separator"></li>';html+='<li><a class="ccm-menu-icon ccm-icon-move-copy-menu" dialog-width="90%" dialog-height="70%" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.moveCopyPage+'" id="menuMoveCopy'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/sitemap_search_selector?sitemap_select_mode=move_copy_delete&cID="+obj.cID+'" id="menuMoveCopy'+obj.cID+'">'+ccmi18n_sitemap.moveCopyPage+"</a></li>";if(obj.display_mode=="explore"){html+='<li><a class="ccm-menu-icon ccm-icon-move-up" id="menuSendToStop'+obj.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+obj.cID+'&task=send_to_top">'+ccmi18n_sitemap.sendToTop+"</a></li>";html+='<li><a class="ccm-menu-icon ccm-icon-move-down" id="menuSendToBottom'+obj.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+obj.cID+'&task=send_to_bottom">'+ccmi18n_sitemap.sendToBottom+"</a></li>"}}if(obj.cNumChildren>0){html+='<li class="ccm-menu-separator"></li>';var searchURL=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/search/?selectedSearchField[]=parent&cParentAll=1&cParentIDSearchField="+obj.cID;if(obj.display_mode=="full"||obj.display_mode==""||obj.display_mode=="explore"){html+='<li><a class="ccm-menu-icon ccm-icon-search-pages" id="menuSearch'+obj.cID+'" href="'+searchURL+'">'+ccmi18n_sitemap.searchPages+"</a></li>"}if(obj.display_mode!="explore"){html+='<li><a class="ccm-menu-icon ccm-icon-flat-view" id="menuExplore'+obj.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+obj.cID+'">'+ccmi18n_sitemap.explorePages+"</a></li>"}}if(obj.canAddSubpages||obj.canAddExternalLinks){html+='<li class="ccm-menu-separator"></li>'}if(obj.canAddSubpages){html+='<li><a class="ccm-menu-icon ccm-icon-add-page-menu" dialog-append-buttons="true" dialog-width="645" dialog-modal="false" dialog-height="345" dialog-title="'+ccmi18n_sitemap.addPage+'" id="menuSubPage'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&mode="+obj.display_mode+"&cID="+obj.cID+'&ctask=add">'+ccmi18n_sitemap.addPage+"</a></li>"}if(obj.display_mode!="search"&&obj.canAddExternalLinks){html+='<li><a class="ccm-menu-icon ccm-icon-add-external-link-menu" dialog-width="350" dialog-modal="false" dialog-height="170" dialog-title="'+ccmi18n_sitemap.addExternalLink+'" dialog-modal="false" dialog-append-buttons="true" id="menuLink'+obj.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+obj.cID+'&ctask=add_external">'+ccmi18n_sitemap.addExternalLink+"</a></li>"}}html+="</ul>";html+="</div></div></div>";bobj.append(html);$(bobj).find("a").bind("click.hide-menu",function(e){ccm_hideMenus()});$("#menuProperties"+obj.cID).dialog();$("#menuSpeedSettings"+obj.cID).dialog();$("#menuSubPage"+obj.cID).dialog();$("#menuDesign"+obj.cID).dialog();$("#menuLink"+obj.cID).dialog();$("#menuVersions"+obj.cID).dialog();$("#menuPermissions"+obj.cID).dialog();$("#menuMoveCopy"+obj.cID).dialog();$("#menuDelete"+obj.cID).dialog()}else{bobj=$("#ccm-page-menu"+obj.cID)}ccm_fadeInMenu(bobj,e)};hideBranch=function(nodeID){$("#tree-node"+nodeID).hide();$("#tree-dz"+nodeID).hide()};cancelReorder=function(){if(tr_reorderMode){tr_reorderMode=false;$("li.tree-node[draggable=true]").draggable("destroy");if(!tr_moveCopyMode){hideSitemapMessage()}}};ccm_sitemapExitEditMode=function(cID){$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_check_in?cID="+cID+"&ccm_token="+CCM_SECURITY_TOKEN)};searchSubPages=function(cID){$("#ccm-tree-search-trigger"+cID).hide();$("#ccm-tree-search"+cID).fadeIn(200,function(){$("#ccm-tree-search"+cID+" input").get(0).focus()})};activateReorder=function(){tr_reorderMode=true;$("li.tree-node[draggable=true]").draggable({handle:"img.handle",opacity:.5,revert:false,helper:"clone",start:function(){$(document.body).css("overflowX","hidden")},stop:function(){$(document.body).css("overflowX","auto")}});fixResortingDroppables()};deleteBranchFade=function(nodeID){$("#tree-node"+nodeID).fadeOut(300,function(){$("#tree-node"+nodeID).remove()});$("#tree-dz"+nodeID).fadeOut(300,function(){$("#tree-dz"+nodeID).remove()})};deleteBranchDirect=function(nodeID){$("#tree-node"+nodeID).remove();$("#tree-dz"+nodeID).remove()};showBranch=function(nodeID){var orig=$("#tree-node"+nodeID);$("#tree-node"+nodeID).show();$("#tree-dz"+nodeID).show()};rescanDisplayOrder=function(nodeID){setLoading(nodeID);var queryString="?foo=1";var nodes=$("#tree-root"+nodeID).children("li.tree-node");for(i=0;i<nodes.length;i++){if($(nodes[i]).hasClass("ui-draggable-dragging"))continue;queryString+="&cID[]="+$(nodes[i]).attr("id").substring(9)}$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_update.php",queryString,function(resp){ccm_parseJSON(resp,function(){});removeLoading(nodeID)})};var SITEMAP_LAST_DIALOGUE_URL="";var ccm_sitemap_html="";parseSitemapResponse=function(instanceID,display_mode,select_mode,nodeID,resp){var container=$("ul[tree-root-node-id="+nodeID+"][sitemap-instance-id="+instanceID+"]");container.html(resp);container.slideDown(150,"easeOutExpo")};selectMoveCopyTarget=function(instanceID,display_mode,select_mode,destCID,origCID){if(!origCID){var origCID=CCM_CID}var dialog_title=ccmi18n_sitemap.moveCopyPage;var dialog_url=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?instance_id="+instanceID+"&display_mode="+display_mode+"&select_mode="+select_mode+"&origCID="+origCID+"&destCID="+destCID;var dialog_height=350;var dialog_width=350;try{if(CCM_NODE_ACTION=="<none>"){if(CCM_TARGET_ID!=""){$("#"+CCM_TARGET_ID).val(destCID)}$.fn.dialog.closeTop();return}if(CCM_NODE_ACTION!="")dialog_url=CCM_NODE_ACTION+"?destCID="+destCID;if(CCM_DIALOG_TITLE!="")dialog_title=CCM_DIALOG_TITLE;if(CCM_DIALOG_HEIGHT!="")dialog_height=CCM_DIALOG_HEIGHT;if(CCM_DIALOG_WIDTH!="")dialog_width=CCM_DIALOG_WIDTH}catch(e){}$.fn.dialog.open({title:dialog_title,href:dialog_url,width:dialog_width,appendButtons:true,modal:false,height:dialog_height,onClose:function(){if(typeof CCM_TARGET_ID!="undefined"&&CCM_TARGET_ID!=""){$("#"+CCM_TARGET_ID).val(destCID)}if(tr_moveCopyMode==true){deactivateMoveCopy()}}})};selectLabel=function(e,node){var cNumChildren=node.attr("tree-node-children");if(node.attr("sitemap-select-mode")=="move_copy_delete"||tr_moveCopyMode==true){var destCID=node.attr("id").substring(10);var origCID=node.attr("selected-page-id");selectMoveCopyTarget(node.attr("sitemap-instance-id"),node.attr("sitemap-display-mode"),node.attr("sitemap-select-mode"),destCID,origCID)}else if(node.attr("sitemap-select-mode")=="select_page"){var callback=node.parents("[sitemap-wrapper=1]").attr("sitemap-select-callback");if(callback==null||callback==""||typeof callback=="undefined"){callback="ccm_selectSitemapNode"}eval(callback+"(node.attr('id').substring(10), unescape(node.attr('tree-node-title')));");jQuery.fn.dialog.closeTop()}else{node.addClass("tree-label-selected");if(tr_activeNode!=false){if(tr_activeNode.attr("id")!=node.attr("id")){tr_activeNode.removeClass("tree-label-selected")}}params={cID:node.attr("id").substring(10),display_mode:node.attr("sitemap-display-mode"),isTrash:node.attr("tree-node-istrash"),inTrash:node.attr("tree-node-intrash"),select_mode:node.attr("sitemap-select-mode"),instance_id:node.attr("sitemap-instance-id"),canCompose:node.attr("tree-node-cancompose"),canEditProperties:node.attr("tree-node-can-edit-properties"),canEditSpeedSettings:node.attr("tree-node-can-edit-speed-settings"),canEditPermissions:node.attr("tree-node-can-edit-permissions"),canEditDesign:node.attr("tree-node-can-edit-design"),canViewVersions:node.attr("tree-node-can-view-versions"),canDelete:node.attr("tree-node-can-delete"),canAddSubpages:node.attr("tree-node-can-add-subpages"),canAddExternalLinks:node.attr("tree-node-can-add-external-links"),cNumChildren:node.attr("tree-node-children"),cAlias:node.attr("tree-node-alias")};
showPageMenu(params,e);tr_activeNode=node}};ccmSitemapHighlightPageLabel=function(cID,name){var sp=$("#tree-label"+cID+" > span");if(sp.length==0){var sp=$("tr.ccm-list-record[cID="+cID+"]");if(sp.length>0){$("#ccm-page-advanced-search").submit()}}else{if(name!=null){sp.html(name)}}sp.show("highlight")};activateLabels=function(instance_id,display_mode,select_mode){var smwrapper=$("ul[sitemap-instance-id="+instance_id+"]");smwrapper.find("div.tree-label span").unbind();smwrapper.find("div.tree-label span").click(function(e){selectLabel(e,$(this).parent())});smwrapper.find("ul[tree-root-state=closed]").each(function(){var container=$(this);var nodeID=$(this).attr("tree-root-node-id");if($(this).find("li").length>0){container.attr("tree-root-state","open");$("#tree-collapse"+nodeID).attr("src",CCM_IMAGE_PATH+"/dashboard/minus.jpg")}});if(select_mode=="select_page"||select_mode=="move_copy_delete"){smwrapper.find("li.ccm-sitemap-explore-paging a").each(function(){$(this).click(function(){var treeRootNode=$(this).parentsUntil("ul").parent().parentsUntil("ul").parent().attr("tree-root-node-id");jQuery.fn.dialog.showLoader();$.get($(this).attr("href"),function(r){parseSitemapResponse(instance_id,display_mode,select_mode,treeRootNode,r);activateLabels(instance_id,display_mode,select_mode);jQuery.fn.dialog.hideLoader()});return false})})}if((display_mode=="explore"||display_mode=="full")&&!select_mode){smwrapper.find("img.handle").addClass("moveable")}if(display_mode=="full"&&!select_mode){smwrapper.find("div.tree-label").droppable({accept:".tree-node",hoverClass:"on-drop",drop:function(e,ui){var orig=ui.draggable;var destCID=$(this).attr("id").substring(10);var origCID=$(orig).attr("id").substring(9);if(destCID==origCID)return false;var dialog_url=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?instance_id="+instance_id+"&origCID="+origCID+"&destCID="+destCID;if(SITEMAP_LAST_DIALOGUE_URL==dialog_url)return false;else SITEMAP_LAST_DIALOGUE_URL=dialog_url;$.fn.dialog.open({title:ccmi18n_sitemap.moveCopyPage,href:dialog_url,width:350,modal:false,height:350,appendButtons:true,onClose:function(){showBranch(origCID)}})}});smwrapper.find("li.tree-node[draggable=true]").draggable({handle:"img.handle",opacity:.5,revert:false,helper:"clone",start:function(){$(document.body).css("overflowX","hidden")},stop:function(){$(document.body).css("overflowX","auto")}})}};ccm_triggerProgressiveOperation=function(url,params,dialogTitle,onComplete,onError){jQuery.fn.dialog.showLoader();$("#ccm-dialog-progress-bar").remove();$.ajax({url:url,type:"POST",data:params,success:function(r){jQuery.fn.dialog.hideLoader();$('<div id="ccm-dialog-progress-bar" />').appendTo(document.body).html(r).jqdialog({autoOpen:false,height:200,width:400,modal:true,title:dialogTitle,closeOnEscape:false,open:function(e,ui){$(".ui-dialog-titlebar-close",this.parentNode).hide();var totalItems=$("#ccm-progressive-operation-progress-bar").attr("data-total-items");ccm_doProgressiveOperation(url,params,totalItems,onComplete,onError)}});$("#ccm-dialog-progress-bar").jqdialog("open")}})};ccm_doProgressiveOperation=function(url,params,totalItems,onComplete,onError){params.push({name:"process",value:"1"});params["process"]=true;$.ajax({url:url,dataType:"json",type:"POST",data:params,error:function(xhr,status,r){switch(status){case"timeout":var text=ccmi18n.requestTimeout;break;default:var text=xhr.responseText;break}$("#ccm-dialog-progress-bar").dialog("option","height",200);$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",true);$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+text+"</div>");$(".ui-dialog-titlebar-close").show()},success:function(r){if(r.error){var text=r.message;$("#ccm-dialog-progress-bar").dialog("option","height",200);$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",true);$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+text+"</div>");$(".ui-dialog-titlebar-close").show();if(typeof onError=="function"){onError(r)}}else{var totalItemsLeft=r.totalItems;var pct=Math.round((totalItems-totalItemsLeft)/totalItems*100);$("#ccm-progressive-operation-status").html(1);if(totalItems-totalItemsLeft>0){$("#ccm-progressive-operation-status").html(totalItems-totalItemsLeft)}$("#ccm-progressive-operation-progress-bar div.bar").width(pct+"%");if(totalItemsLeft>0){setTimeout(function(){ccm_doProgressiveOperation(url,params,totalItems,onComplete,onError)},250)}else{setTimeout(function(){$("#ccm-progressive-operation-progress-bar div.bar").width("0%");$("#ccm-dialog-progress-bar").dialog("close");if(typeof onComplete=="function"){onComplete(r)}},1e3)}}}})};ccm_refreshCopyOperations=function(){var dialogTitle=ccmi18n_sitemap.copyProgressTitle;ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_copy_all",[],dialogTitle,function(){$(".ui-dialog-content").dialog("close");window.location.reload()})};moveCopyAliasNode=function(reloadPage){var origCID=$("#origCID").val();var destParentID=$("#destParentID").val();var destCID=$("#destCID").val();var ctask=$("input[name=ctask]:checked").val();var instance_id=$("input[name=instance_id]").val();var display_mode=$("input[name=display_mode]").val();var select_mode=$("input[name=select_mode]").val();var copyAll=$("input[name=copyAll]:checked").val();var saveOldPagePath=$("input[name=saveOldPagePath]:checked").val();params={origCID:origCID,destCID:destCID,ctask:ctask,ccm_token:CCM_SECURITY_TOKEN,copyAll:copyAll,saveOldPagePath:saveOldPagePath};if(copyAll==1){var dialogTitle=ccmi18n_sitemap.copyProgressTitle;ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_copy_all",[{name:"origCID",value:origCID},{name:"destCID",value:destCID}],dialogTitle,function(){$(".ui-dialog-content").dialog("close");openSub(instance_id,destParentID,display_mode,select_mode,function(){openSub(instance_id,destCID,display_mode,select_mode)})})}else{jQuery.fn.dialog.showLoader();$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php",params,function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeAll();jQuery.fn.dialog.hideLoader();ccmAlert.hud(resp.message,2e3);if(reloadPage==true){if(typeof CCM_LAUNCHER_SITEMAP!="undefined"){if(CCM_LAUNCHER_SITEMAP=="explore"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+destCID;return false}if(CCM_LAUNCHER_SITEMAP=="search"){ccm_deactivateSearchResults(CCM_SEARCH_INSTANCE_ID);$("#ccm-"+CCM_SEARCH_INSTANCE_ID+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,CCM_SEARCH_INSTANCE_ID)})}}else{setTimeout(function(){window.location.href=CCM_DISPATCHER_FILENAME+"?cID="+resp.cID},2e3);return false}}switch(ctask){case"COPY":case"ALIAS":showBranch(origCID);break;case"MOVE":deleteBranchDirect(origCID);break}openSub(instance_id,destParentID,display_mode,select_mode,function(){openSub(instance_id,destCID,display_mode,select_mode)});jQuery.fn.dialog.closeTop();jQuery.fn.dialog.closeTop()})})}};toggleSub=function(instanceID,nodeID,display_mode,select_mode){ccm_hideMenus();var container=$("ul[tree-root-node-id="+nodeID+"][sitemap-instance-id="+instanceID+"]");if(container.attr("tree-root-state")=="closed"){openSub(instanceID,nodeID,display_mode,select_mode)}else{closeSub(instanceID,nodeID,display_mode,select_mode)}};ccm_sitemapDeleteForever=function(instance_id,nodeID,isTrash){var dialogTitle=isTrash?ccmi18n_sitemap.emptyTrash:ccmi18n_sitemap.deletePages;ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/dashboard/sitemap_delete_forever",[{name:"cID",value:nodeID}],dialogTitle,function(){if(isTrash){closeSub(instance_id,nodeID,"full","");var container=$("ul[tree-root-node-id="+nodeID+"]").parent();container.find("img.tree-plus").remove();container.find("span.ccm-sitemap-num-subpages").remove()}else{deleteBranchFade(nodeID);ccmAlert.hud(ccmi18n_sitemap.deletePageSuccessMsg,2e3)}})};setLoading=function(nodeID){var listNode=$("#tree-node"+nodeID);listNode.removeClass("tree-node-"+listNode.attr("tree-node-type"));listNode.addClass("tree-node-loading")};removeLoading=function(nodeID){var listNode=$("#tree-node"+nodeID);listNode.removeClass("tree-node-loading");listNode.addClass("tree-node-"+listNode.attr("tree-node-type"))};openSub=function(instanceID,nodeID,display_mode,select_mode,onComplete){setLoading(nodeID);var container=$("#tree-root"+nodeID);cancelReorder();ccm_sitemap_html="";$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?instance_id="+instanceID+"&node="+nodeID+"&display_mode="+display_mode+"&select_mode="+select_mode+"&selectedPageID="+container.attr("selected-page-id"),function(resp){parseSitemapResponse(instanceID,"full",select_mode,nodeID,resp);activateLabels(instanceID,"full",select_mode);if(select_mode!="move_copy_delete"&&select_mode!="select_page"){activateReorder()}setTimeout(function(){removeLoading(nodeID);if(onComplete!=null){onComplete()}},200)})};closeSub=function(instanceID,nodeID,display_mode,select_mode){var container=$("ul[tree-root-node-id="+nodeID+"][sitemap-instance-id="+instanceID+"]");if(tr_doAnim){setLoading(nodeID);container.slideUp(150,"easeOutExpo",function(){removeLoading(nodeID);container.attr("tree-root-state","closed");container.html("");$("#ccm-tree-search"+nodeID).hide();$("#tree-collapse"+nodeID).attr("src",CCM_IMAGE_PATH+"/dashboard/plus.jpg");container.removeClass("ccm-sitemap-search-results")})}else{container.hide();container.attr("tree-root-state","closed");container.removeClass("ccm-sitemap-search-results");$("#ccm-tree-search"+nodeID).hide();$("#tree-collapse"+nodeID).attr("src",CCM_IMAGE_PATH+"/dashboard/plus.jpg")}if(tr_moveCopyMode==true){$("#ccm-tree-search-trigger"+cID).show()}$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?instance_id="+instanceID+"&select_mode="+select_mode+"&display_mode="+display_mode+"&node="+nodeID+"&display_mode=full&ctask=close-node")};toggleMove=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=true;$("#copyChildren").get(0).disabled=true;$("#saveOldPagePath").attr("disabled",false)}};toggleAlias=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=true;$("#copyChildren").get(0).disabled=true;$("#saveOldPagePath").attr("checked",false);$("#saveOldPagePath").attr("disabled","disabled")}};toggleCopy=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=false;$("#copyThisPage").get(0).checked=true;$("#copyChildren").get(0).disabled=false;$("#saveOldPagePath").attr("checked",false);$("#saveOldPagePath").attr("disabled","disabled")}};showSitemapMessage=function(msg){$("#ccm-sitemap-message").addClass("message");$("#ccm-sitemap-message").html(msg);$("#ccm-sitemap-message").fadeIn(200)};hideSitemapMessage=function(){$("#ccm-sitemap-message").hide()};function fixResortingDroppables(){if(tr_reorderMode==false){return false}var DZs=$(".dropzone");for(var i=0;i<DZs.length;i++){var nodeID=$(DZs[i]).attr("id").substr(7);if(nodeID.indexOf("-sub")>0){nodeID=nodeID.substr(0,nodeID.length-4)}addResortDroppable(nodeID)}}function addResortDroppable(nodeID){if($(".tree-branch"+nodeID).length<=1)return;$("div.tree-dz"+nodeID).droppable({accept:".tree-branch"+nodeID,activeClass:"dropzone-ready",hoverClass:"dropzone-active",drop:function(e,ui){var node=ui.draggable;$(node).insertAfter(this);var dzNode=$(node).attr("id").substring(9);$("#tree-dz"+dzNode).insertAfter($(node));rescanDisplayOrder($(this).attr("tree-parent"))}})}ccmSitemapExploreNode=function(instance_id,display_mode,select_mode,cID,selectedPageID){jQuery.fn.dialog.showLoader();$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php",{instance_id:instance_id,display_mode:display_mode,select_mode:select_mode,node:cID,selectedPageID:selectedPageID},function(resp){parseSitemapResponse(instance_id,"explore",select_mode,0,resp);activateLabels(instance_id,"explore",select_mode);jQuery.fn.dialog.hideLoader();ccm_sitemap_html=""})};ccmSitemapLoad=function(instance_id,display_mode,select_mode,node,selectedPageID,onComplete){if(select_mode=="move_copy_delete"||select_mode=="select_page"){ccmSitemapExploreNode(instance_id,display_mode,select_mode,node,selectedPageID)}else if(display_mode=="full"){activateLabels(instance_id,display_mode,select_mode);if(select_mode!="move_copy_delete"&&select_mode!="select_page"){activateReorder()}tr_doAnim=true;tr_parseSubnodes=false;ccm_sitemap_html=""}else{if(select_mode!="move_copy_delete"&&select_mode!="select_page"){$("ul[sitemap-instance-id="+instance_id+"]").sortable({cursor:"move",items:"li[draggable=true]",opacity:.5,stop:function(sor){var ss=$("ul[sitemap-instance-id="+instance_id+"]").sortable("toArray");var queryString="";for(i=0;i<ss.length;i++){if(ss[i]!=""){queryString+="&cID[]="+ss[i].substring(9)}}$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_update.php",queryString,function(resp){ccm_parseJSON(resp,function(){})})}})}activateLabels(instance_id,display_mode,select_mode)}if(onComplete){onComplete()}};ccm_sitemapSetupSearch=function(instance_id){ccm_setupAdvancedSearch(instance_id);ccm_sitemapSetupSearchPages(instance_id);ccm_searchActivatePostFunction[instance_id]=function(){ccm_sitemapSetupSearchPages(instance_id);ccm_sitemapSearchSetupCheckboxes(instance_id)};ccm_sitemapSearchSetupCheckboxes(instance_id)};ccm_sitemapSearchSetupCheckboxes=function(instance_id){$("#ccm-"+instance_id+"-list-cb-all").click(function(e){e.stopPropagation();if($(this).prop("checked")==true){$(".ccm-list-record td.ccm-"+instance_id+"-list-cb input[type=checkbox]").attr("checked",true);$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",false)}else{$(".ccm-list-record td.ccm-"+instance_id+"-list-cb input[type=checkbox]").attr("checked",false);$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",true)}});$("td.ccm-"+instance_id+"-list-cb input[type=checkbox]").click(function(e){e.stopPropagation();if($("td.ccm-"+instance_id+"-list-cb input[type=checkbox]:checked").length>0){$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",false)}else{$("#ccm-"+instance_id+"-list-multiple-operations").attr("disabled",true)}});$("#ccm-"+instance_id+"-list-multiple-operations").change(function(){var action=$(this).val();cIDstring="";$("td.ccm-"+instance_id+"-list-cb input[type=checkbox]:checked").each(function(){cIDstring=cIDstring+"&cID[]="+$(this).val()});switch(action){case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/delete?"+cIDstring+"&searchInstance="+instance_id,title:ccmi18n_sitemap.deletePages});break;case"design":jQuery.fn.dialog.open({width:610,height:405,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/design?"+cIDstring+"&searchInstance="+instance_id,title:ccmi18n_sitemap.pageDesign});break;case"move_copy":jQuery.fn.dialog.open({width:640,height:340,modal:false,href:CCM_TOOLS_PATH+"/sitemap_overlay?instance_id="+instance_id+"&select_mode=move_copy_delete&"+cIDstring,title:ccmi18n_sitemap.moveCopyPage});break;case"speed_settings":jQuery.fn.dialog.open({width:610,height:340,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/speed_settings?"+cIDstring,title:ccmi18n_sitemap.speedSettingsTitle});break;case"permissions":jQuery.fn.dialog.open({width:430,height:630,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/permissions?"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"permissions_add_access":jQuery.fn.dialog.open({width:440,height:200,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/permissions_access?task=add&"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"permissions_remove_access":jQuery.fn.dialog.open({width:440,height:300,modal:false,appendButtons:true,href:CCM_TOOLS_PATH+"/pages/permissions_access?task=remove&"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"properties":jQuery.fn.dialog.open({width:630,height:450,modal:false,href:CCM_TOOLS_PATH+"/pages/bulk_metadata_update?"+cIDstring,title:ccmi18n_sitemap.pagePropertiesTitle});break}$(this).get(0).selectedIndex=0})};ccm_sitemapSetupSearchPages=function(instance_id){$("#ccm-"+instance_id+"-list tr").click(function(e){var node=$(this);if(node.hasClass("ccm-results-list-header")){return false}if(node.attr("sitemap-select-mode")=="select_page"){var callback=node.attr("sitemap-select-callback");if(callback==null||callback==""||typeof callback=="undefined"){callback="ccm_selectSitemapNode"}eval(callback+"(node.attr('cID'), unescape(node.attr('cName')));");jQuery.fn.dialog.closeTop()}else if(node.attr("sitemap-select-mode")=="move_copy_delete"){var destCID=node.attr("cID");var origCID=node.attr("selected-page-id");selectMoveCopyTarget(node.attr("sitemap-instance-id"),node.attr("sitemap-display-mode"),node.attr("sitemap-select-mode"),destCID,origCID)}else{params={cID:node.attr("cID"),select_mode:node.attr("sitemap-select-mode"),display_mode:node.attr("sitemap-display-mode"),instance_id:node.attr("sitemap-instance-id"),isTrash:node.attr("tree-node-istrash"),inTrash:node.attr("tree-node-intrash"),canCompose:node.attr("tree-node-cancompose"),canEditProperties:node.attr("tree-node-can-edit-properties"),canEditSpeedSettings:node.attr("tree-node-can-edit-speed-settings"),canEditPermissions:node.attr("tree-node-can-edit-permissions"),canEditDesign:node.attr("tree-node-can-edit-design"),canViewVersions:node.attr("tree-node-can-view-versions"),canDelete:node.attr("tree-node-can-delete"),canAddSubpages:node.attr("tree-node-can-add-subpages"),canAddExternalLinks:node.attr("tree-node-can-add-external-links"),cNumChildren:node.attr("cNumChildren"),cAlias:node.attr("cAlias")};showPageMenu(params,e)}})};ccm_sitemapSelectDisplayMode=function(instance_id,display_mode,select_mode,selectedPageID){var ul=$("ul[sitemap-instance-id="+instance_id+"]");ul.html("");ul.attr("sitemap-display-mode",display_mode);ul.attr("sitemap-select-mode",select_mode);ul.attr("sitemap-display-mode",display_mode);if(display_mode=="explore"){var node=1}else{var node=0}ccmSitemapLoad(instance_id,display_mode,select_mode,node,selectedPageID,function(){if(display_mode=="explore"){$("div[sitemap-wrapper=1][sitemap-instance-id="+instance_id+"]").addClass("ccm-sitemap-explore")}else{$("div[sitemap-wrapper=1][sitemap-instance-id="+instance_id+"]").removeClass("ccm-sitemap-explore")}});$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?task=save_sitemap_display_mode&display_mode="+display_mode)};ccm_sitemapDeletePages=function(searchInstance){var params=$("#ccm-"+searchInstance+"-delete-form").formToArray(true);ccm_triggerProgressiveOperation(CCM_TOOLS_PATH+"/pages/delete",params,ccmi18n_sitemap.deletePages,function(){$(".ui-dialog-content").dialog("close");ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)});if(isTrash){closeSub(instance_id,nodeID,"full","");var container=$("ul[tree-root-node-id="+nodeID+"]").parent();container.find("img.tree-plus").remove();container.find("span.ccm-sitemap-num-subpages").remove()}else{deleteBranchFade(nodeID);ccmAlert.hud(ccmi18n_sitemap.deletePageSuccessMsg,2e3)}})};ccm_sitemapUpdateDesign=function(searchInstance){$("#ccm-"+searchInstance+"-design-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(resp){ccm_parseAdvancedSearchResponse(resp,searchInstance)})})})};$(function(){$(document).click(function(){ccm_hideMenus();$("div.tree-label").removeClass("tree-label-selected")});$("#ccm-show-all-pages-cb").click(function(){var showSystemPages=$(this).get(0).checked==true?1:0;$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?show_system="+showSystemPages,function(resp){location.reload()})})});var ccmCustomStyle={tabs:function(aLink,tab){$(".ccm-styleEditPane").hide();$("#ccm-styleEditPane-"+tab).show();$(aLink.parentNode.parentNode).find("li").removeClass("ccm-nav-active");$(aLink.parentNode).addClass("ccm-nav-active");return false},resetAll:function(){if(!confirm(ccmi18n.confirmCssReset)){return false}jQuery.fn.dialog.showLoader();$("#ccm-reset-style").val(1);$("#ccmCustomCssForm").get(0).submit();return true},showPresetDeleteIcon:function(){if($("select[name=cspID]").val()>0){$("#ccm-style-delete-preset").show()}else{$("#ccm-style-delete-preset").hide()}},deletePreset:function(){var cspID=$("select[name=cspID]").val();if(cspID>0){if(!confirm(ccmi18n.confirmCssPresetDelete))return false;var action=$("#ccm-custom-style-refresh-action").val()+"&deleteCspID="+cspID+"&subtask=delete_custom_style_preset";jQuery.fn.dialog.showLoader();$.get(action,function(r){$("#ccm-custom-style-wrapper").html(r);jQuery.fn.dialog.hideLoader()})}},initForm:function(){if($("#cspFooterPreset").length>0){$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select, #ccmCustomCssFormTabs textarea").bind("change click",function(){$("#cspFooterPreset").show();$("#cspFooterNoPreset").remove();$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select").unbind("change click")})}$("input[name=cspPresetAction]").click(function(){if($(this).val()=="create_new_preset"&&$(this).prop("checked")){$("input[name=cspName]").attr("disabled",false).focus()}else{$("input[name=cspName]").val("").attr("disabled",true)}});ccmCustomStyle.showPresetDeleteIcon();ccmCustomStyle.lastPresetID=parseInt($("select[name=cspID]").val());$("select[name=cspID]").change(function(){var cspID=parseInt($(this).val());var selectedCsrID=parseInt($("input[name=selectedCsrID]").val());if(ccmCustomStyle.lastPresetID==cspID)return false;ccmCustomStyle.lastPresetID=cspID;jQuery.fn.dialog.showLoader();if(cspID>0){var action=$("#ccm-custom-style-refresh-action").val()+"&cspID="+cspID}else{var action=$("#ccm-custom-style-refresh-action").val()+"&csrID="+selectedCsrID}$.get(action,function(r){$("#ccm-custom-style-wrapper").html(r);jQuery.fn.dialog.hideLoader()})});$("#ccmCustomCssForm").submit(function(){if($("input[name=cspCreateNew]").prop("checked")==true){if($("input[name=cspName]").val()==""){$("input[name=cspName]").focus();alert(ccmi18n.errorCustomStylePresetNoName);return false}}jQuery.fn.dialog.showLoader();return true});if(!parseInt(ccmCustomStyle.lastPresetID))setTimeout('$("#ccmCustomCssFormTabs input").attr("disabled", false).get(0).focus()',500)},validIdCheck:function(el,prevID){var selEl=$("#"+el.value);if(selEl&&selEl.get(0)&&selEl.get(0).id!=prevID){$("#ccm-styles-invalid-id").css("display","block")}else{$("#ccm-styles-invalid-id").css("display","none")}}};ccm_activateTabBar=function(selector){$("#ccm-tab-content-"+selector.find("li[class=active] a").attr("data-tab")).show();selector.find("a").unbind().click(function(){selector.find("li").removeClass("active");$(this).parent().addClass("active");selector.find("a").each(function(){$("#ccm-tab-content-"+$(this).attr("data-tab")).hide()});var tab=$(this).attr("data-tab");$("#ccm-tab-content-"+tab).show();return false})};var CCMToolbar=function(){var $toolbar=$("#ccm-toolbar");var $searchInput=$("#ccm-nav-intelligent-search");var $searchResults=$("#ccm-intelligent-search-results");var remotesearchquery,ajaxtimer;setupToolbarMenus=function(){$("a[data-toggle=ccm-toolbar-hover-menu]").hoverIntent(function(){$(".ccm-toolbar-hover-menu").hide();$($(this).data("toggle-menu")).show()},function(){});$(document).on("click.ccm-toolbar",function(){$(".ccm-toolbar-hover-menu").hide()});$toolbar.find("#ccm-toolbar").on("click",function(e){e.stopPropagation()});$toolbar.find("#ccm-exit-edit-mode-comment form").on("click",function(e){e.stopPropagation()});$($toolbar.find(".ccm-toolbar-hover-menu a")).on("click",function(){$(".ccm-toolbar-hover-menu").hide()});$toolbar.find("#ccm-exit-edit-mode-publish-menu a").on("click",function(){switch($(this).data("publish-action")){case"approve":$("#ccm-approve-field").val("APPROVE");break;case"discard":$("#ccm-approve-field").val("DISCARD");break}$("#ccm-exit-edit-mode-comment form").submit()})};setupStatusBar=function(){$("#ccm-page-status-bar .alert").bind("closed",function(){$(this).remove();var visi=$("#ccm-page-status-bar .alert:visible").length;if(visi==0){$("#ccm-page-status-bar").remove()}});$("#ccm-page-status-bar .ccm-status-bar-ajax-form").ajaxForm({dataType:"json",beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(r){if(r.redirect){window.location.href=r.redirect}}})};setupIntelligentSearch=function(){$searchInput.bind("keydown.ccm-intelligent-search",function(e){if(e.keyCode==13||e.keyCode==40||e.keyCode==38){e.preventDefault();e.stopPropagation();if(e.keyCode==13&&$("a.ccm-intelligent-search-result-selected").length>0){var href=$("a.ccm-intelligent-search-result-selected").attr("href");if(!href||href=="#"||href=="javascript:void(0)"){$("a.ccm-intelligent-search-result-selected").click()}else{window.location.href=href}}var visibleitems=$("#ccm-intelligent-search-results li:visible");var sel;if(e.keyCode==40||e.keyCode==38){$.each(visibleitems,function(i,item){if($(item).children("a").hasClass("ccm-intelligent-search-result-selected")){if(e.keyCode==38){io=visibleitems[i-1]}else{io=visibleitems[i+1]}sel=$(io).find("a")}});if(sel&&sel.length>0){$("a.ccm-intelligent-search-result-selected").removeClass();$(sel).addClass("ccm-intelligent-search-result-selected")}}}});$searchInput.liveUpdate("ccm-intelligent-search-results","intelligent-search");$searchInput.bind("keyup.ccm-intelligent-search",function(e){doRemoteSearchCall($(this).val())});$searchInput.bind("click",function(e){if(this.value==""){$searchResults.hide()}})};activateIntelligentSearchResults=function(){if($("#ccm-intelligent-search-results div:visible").length==0){$("#ccm-intelligent-search-results").hide()}$("#ccm-intelligent-search-results a").hover(function(){$("a.ccm-intelligent-search-result-selected").removeClass();$(this).addClass("ccm-intelligent-search-result-selected")},function(){$(this).removeClass("ccm-intelligent-search-result-selected")})};doRemoteSearchCall=function(query){query=jQuery.trim(query);if(!query){return}if(query.length>2){if(query==remotesearchquery){return}if(ajaxtimer){window.clearTimeout(ajaxtimer)}remotesearchquery=query;ajaxtimer=window.setTimeout(function(){ajaxtimer=null;$("#ccm-intelligent-search-results-list-marketplace").parent().show();$("#ccm-intelligent-search-results-list-help").parent().show();$("#ccm-intelligent-search-results-list-your-site").parent().show();$("#ccm-intelligent-search-results-list-marketplace").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").parent().addClass("ccm-intelligent-search-results-module-loading");$.getJSON(CCM_TOOLS_PATH+"/marketplace/intelligent_search",{q:remotesearchquery},function(r){$("#ccm-intelligent-search-results-list-marketplace").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-marketplace").html("");for(i=0;i<r.length;i++){var rr=r[i];var _onclick="ccm_getMarketplaceItemDetails("+rr.mpID+")";$("#ccm-intelligent-search-results-list-marketplace").append('<li><a href="javascript:void(0)" onclick="'+_onclick+'"><img src="'+rr.img+'" />'+rr.name+"</a></li>")}if(r.length==0){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/get_remote_help",{q:remotesearchquery},function(r){$("#ccm-intelligent-search-results-list-help").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").html("");for(i=0;i<r.length;i++){var rr=r[i];$("#ccm-intelligent-search-results-list-help").append('<li><a href="'+rr.href+'">'+rr.name+"</a></li>")}if(r.length==0){$("#ccm-intelligent-search-results-list-help").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-help").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/pages/intelligent_search",{q:remotesearchquery},function(r){$("#ccm-intelligent-search-results-list-your-site").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").html("");for(i=0;i<r.length;i++){var rr=r[i];$("#ccm-intelligent-search-results-list-your-site").append('<li><a href="'+rr.href+'">'+rr.name+"</a></li>")}if(r.length==0){$("#ccm-intelligent-search-results-list-your-site").parent().hide()}if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-your-site").parent().hide()})},500)}};return{start:function(){if($toolbar.length>0){$toolbar.find(".dialog-launch").dialog();setupToolbarMenus();setupStatusBar();setupIntelligentSearch();$("#ccm-toolbar-menu-dashboard").on("click",function(e){e.stopPropagation()})}},disableDirectExit:function(){$("li.ccm-toolbar-page-edit a").attr("data-toggle-menu","#ccm-exit-edit-mode-comment");setupToolbarMenus()}}}();function ccm_previewInternalTheme(cID,themeID,themeName){var ctID=$("input[name=ctID]").val();$.fn.dialog.open({title:themeName,href:CCM_TOOLS_PATH+"/themes/preview?themeID="+themeID+"&previewCID="+cID+"&ctID="+ctID,width:"85%",modal:false,height:"75%"})}function ccm_previewMarketplaceTheme(cID,themeCID,themeName,themeHandle){var ctID=$("input[name=ctID]").val();$.fn.dialog.open({title:themeName,href:CCM_TOOLS_PATH+"/themes/preview?themeCID="+themeCID+"&previewCID="+cID+"&themeHandle="+encodeURIComponent(themeHandle)+"&ctID="+ctID,width:"85%",modal:false,height:"75%"})}ccm_marketplaceDetailShowMore=function(){$(".ccm-marketplace-item-information-more").hide();$(".ccm-marketplace-item-information-inner").css("max-height","none")};ccm_marketplaceUpdatesShowMore=function(obj){$(obj).parent().hide();$(obj).parent().parent().find(".ccm-marketplace-update-changelog").css("max-height","none")};ccm_enableDesignScrollers=function(){$("a.ccm-scroller-l").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l.png")});$("a.ccm-scroller-r").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r.png")});var numThumbs=4;var thumbWidth=132;$("a.ccm-scroller-r").unbind("click");$("a.ccm-scroller-l").unbind("click");$("a.ccm-scroller-r").click(function(){var item=$(this).parent().children("div.ccm-scroller-inner").children("ul");var currentPage=$(this).parent().attr("current-page");var currentPos=$(this).parent().attr("current-pos");var numPages=$(this).parent().attr("num-pages");var migratePos=numThumbs*thumbWidth;currentPos=parseInt(currentPos)-migratePos;currentPage++;$(this).parent().attr("current-page",currentPage);$(this).parent().attr("current-pos",currentPos);if(currentPage==numPages){$(this).hide()}if(currentPage>1){$(this).siblings("a.ccm-scroller-l").show()}$(item).css("left",currentPos+"px")
});$("a.ccm-scroller-l").click(function(){var item=$(this).parent().children("div.ccm-scroller-inner").children("ul");var currentPage=$(this).parent().attr("current-page");var currentPos=$(this).parent().attr("current-pos");var numPages=$(this).parent().attr("num-pages");var migratePos=numThumbs*thumbWidth;currentPos=parseInt(currentPos)+migratePos;currentPage--;$(this).parent().attr("current-page",currentPage);$(this).parent().attr("current-pos",currentPos);if(currentPage==1){$(this).hide()}if(currentPage<numPages){$(this).siblings("a.ccm-scroller-r").show()}$(item).css("left",currentPos+"px")});$("a.ccm-scroller-l").hide();$("a.ccm-scroller-r").each(function(){if(parseInt($(this).parent().attr("num-pages"))==1){$(this).hide()}});$("#ccm-select-page-type a").click(function(){$("#ccm-select-page-type li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=ctID]").val($(this).attr("ccm-page-type-id"))});$("#ccm-select-theme a").click(function(){$("#ccm-select-theme li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=plID]").val($(this).attr("ccm-theme-id"))})};