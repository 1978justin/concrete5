/**
 *
 * Color picker
 * Author: Stefan Petre www.eyecon.ro
 * 
 */function ccm_previewInternalTheme(e,t,n){var r=$("input[name=ptID]").val();$.fn.dialog.open({title:n,href:CCM_TOOLS_PATH+"/themes/preview?themeID="+t+"&previewCID="+e+"&ptID="+r,width:"85%",modal:!1,height:"75%"})}function ccm_previewMarketplaceTheme(e,t,n,r){var i=$("input[name=ptID]").val();$.fn.dialog.open({title:n,href:CCM_TOOLS_PATH+"/themes/preview?themeCID="+t+"&previewCID="+e+"&themeHandle="+encodeURIComponent(r)+"&ptID="+i,width:"85%",modal:!1,height:"75%"})}(function(e){var t=function(){var t={},n,r=65,i,s='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" class="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><input type="button" class="colorpicker_none" name="none" value="x" /><input type="button" class="colorpicker_submit" name="save" value="Ok" /></div>',o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onNone:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},u=function(t,n){var r=R(t);e(n).data("colorpicker").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,n){e(n).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},f=function(t,n){e(n).data("colorpicker").fields.eq(0).val(z(t)).end()},l=function(t,n){e(n).data("colorpicker").selector.css("backgroundColor","#"+z({h:t.h,s:100,b:100}));e(n).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},c=function(t,n){e(n).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},h=function(t,n){e(n).data("colorpicker").currentColor.css("backgroundColor","#"+z(t))},p=function(t,n){e(n).data("colorpicker").newColor.css("backgroundColor","#"+z(t))},d=function(t){var n=t.charCode||t.keyCode||-1;if(n>r&&n<=90||n==32)return!1;var i=e(this).parent().parent();i.data("colorpicker").livePreview===!0&&v.apply(this)},v=function(t){var n=e(this).parent().parent(),r;if(!n.data("colorpicker")||!n.data("colorpicker").fields)return;this.parentNode.className.indexOf("_hex")>0?n.data("colorpicker").color=r=I(j(this.value)):this.parentNode.className.indexOf("_hsb")>0?n.data("colorpicker").color=r=H({h:parseInt(n.data("colorpicker").fields.eq(4).val(),10),s:parseInt(n.data("colorpicker").fields.eq(5).val(),10),b:parseInt(n.data("colorpicker").fields.eq(6).val(),10)}):n.data("colorpicker").color=r=q(B({r:parseInt(n.data("colorpicker").fields.eq(1).val(),10),g:parseInt(n.data("colorpicker").fields.eq(2).val(),10),b:parseInt(n.data("colorpicker").fields.eq(3).val(),10)}));if(t){u(r,n.get(0));f(r,n.get(0));a(r,n.get(0))}l(r,n.get(0));c(r,n.get(0));p(r,n.get(0));n.data("colorpicker").onChange.apply(n,[r,z(r),R(r)])},m=function(t){var n=e(this).parent().parent(),r=n.data("colorpicker");r&&r.fields&&r.fields.parent().removeClass("colorpicker_focus")},g=function(){r=this.parentNode.className.indexOf("_hex")>0?70:65;var t=e(this).parent().parent().data("colorpicker");t&&t.fields&&t.fields.parent().removeClass("colorpicker_focus");e(this).parent().addClass("colorpicker_focus")},y=function(t){var n=e(this).parent().find("input").focus(),r={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:n,val:parseInt(n.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",r,w);e(document).bind("mousemove",r,b)},b=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10))));e.data.preview&&v.apply(e.data.field.get(0),[!0]);return!1},w=function(t){v.apply(t.data.field.get(0),[!0]);t.data.el.removeClass("colorpicker_slider").find("input").focus();e(document).unbind("mouseup",w);e(document).unbind("mousemove",b);return!1},E=function(t){var n={cal:e(this).parent(),y:e(this).offset().top};n.preview=n.cal.data("colorpicker").livePreview;e(document).bind("mouseup",n,x);e(document).bind("mousemove",n,S)},S=function(e){v.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]);return!1},x=function(t){u(t.data.cal.data("colorpicker").color,t.data.cal.get(0));f(t.data.cal.data("colorpicker").color,t.data.cal.get(0));e(document).unbind("mouseup",x);e(document).unbind("mousemove",S);return!1},T=function(t){var n={cal:e(this).parent(),pos:e(this).offset()};n.preview=n.cal.data("colorpicker").livePreview;e(document).bind("mouseup",n,C);e(document).bind("mousemove",n,N)},N=function(e){v.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]);return!1},C=function(t){u(t.data.cal.data("colorpicker").color,t.data.cal.get(0));f(t.data.cal.data("colorpicker").color,t.data.cal.get(0));e(document).unbind("mouseup",C);e(document).unbind("mousemove",N);return!1},k=function(t){e(this).addClass("colorpicker_focus")},L=function(t){e(this).removeClass("colorpicker_focus")},A=function(t){var n=e(this).parent(),r=n.data("colorpicker").color;n.data("colorpicker").origColor=r;h(r,n.get(0));var i=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onSubmit(r,z(r),R(r),n)},O=function(t){var n=e(this).parent();n.data("colorpicker").onNone(n);n.hide()},M=function(t){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onBeforeShow.apply(this,[n.get(0)]);var r=e(this).offset(),i=P(),s=r.top+this.offsetHeight,o=r.left;s+176>i.t+i.h&&(s-=this.offsetHeight+176);o+356>i.l+i.w&&(o-=356);n.css({left:o+"px",top:s+"px"});n.data("colorpicker").onShow.apply(this,[n.get(0)])!=0&&n.show();e(document).bind("mousedown",{cal:n},_);return!1},_=function(t){if(!D(t.data.cal.get(0),t.target,t.data.cal.get(0))){t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])!=0&&t.data.cal.hide();e(document).unbind("mousedown",_)}},D=function(e,t,n){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(e.compareDocumentPosition(t)&16);var r=t.parentNode;while(r&&r!=n){if(r==e)return!0;r=r.parentNode}return!1},P=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},H=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},B=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},j=function(e){var t=6-e.length;if(t>0){var n=[];for(var r=0;r<t;r++)n.push("0");n.push(e);e=n.join("")}return e},F=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},I=function(e){return q(F(e))},q=function(e){var t={};t.b=Math.max(Math.max(e.r,e.g),e.b);t.s=t.b<=0?0:Math.round(100*(t.b-Math.min(Math.min(e.r,e.g),e.b))/t.b);t.b=Math.round(t.b/255*100);e.r==e.g&&e.g==e.b?t.h=0:e.r>=e.g&&e.g>=e.b?t.h=60*(e.g-e.b)/(e.r-e.b):e.g>=e.r&&e.r>=e.b?t.h=60+60*(e.g-e.r)/(e.g-e.b):e.g>=e.b&&e.b>=e.r?t.h=120+60*(e.b-e.r)/(e.g-e.r):e.b>=e.g&&e.g>=e.r?t.h=180+60*(e.b-e.g)/(e.b-e.r):e.b>=e.r&&e.r>=e.g?t.h=240+60*(e.r-e.g)/(e.b-e.g):e.r>=e.b&&e.b>=e.g?t.h=300+60*(e.r-e.b)/(e.r-e.g):t.h=0;t.h=Math.round(t.h);return t},R=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100);if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0);if(n<60){t.r=s;t.b=o;t.g=o+u}else if(n<120){t.g=s;t.b=o;t.r=s-u}else if(n<180){t.g=s;t.r=o;t.b=o+u}else if(n<240){t.b=s;t.r=o;t.g=s-u}else if(n<300){t.b=s;t.g=o;t.r=o+u}else if(n<360){t.r=s;t.g=o;t.b=s-u}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},U=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)});return n.join("")},z=function(e){return U(R(e))};return{init:function(t){t=e.extend({},o,t||{});if(typeof t.color=="string")t.color=I(t.color);else if(t.color.r!=undefined&&t.color.g!=undefined&&t.color.b!=undefined)t.color=q(t.color);else{if(t.color.h==undefined||t.color.s==undefined||t.color.b==undefined)return this;t.color=H(t.color)}t.change=v;t.origColor=t.color;return this.each(function(){if(!e(this).data("colorpickerId")){var n="collorpicker_"+parseInt(Math.random()*1e3);e(this).data("colorpickerId",n);var r=e(s).attr("id",n);t.flat?r.appendTo(this).show():r.appendTo(document.body);t.fields=r.find("input").bind("keydown",d).bind("change",v).bind("blur",m).bind("focus",g);r.find("span").bind("mousedown",y);t.selector=r.find("div.colorpicker_color").bind("mousedown",T);t.selectorIndic=t.selector.find("div div");t.hue=r.find("div.colorpicker_hue div");r.find("div.colorpicker_hue").bind("mousedown",E);t.newColor=r.find("div.colorpicker_new_color");t.currentColor=r.find("div.colorpicker_current_color");r.data("colorpicker",t);r.find("input.colorpicker_none").bind("click",O);r.find("input.colorpicker_submit").bind("click",A);u(t.color,r.get(0));a(t.color,r.get(0));f(t.color,r.get(0));c(t.color,r.get(0));l(t.color,r.get(0));h(t.color,r.get(0));p(t.color,r.get(0));t.flat?r.css({position:"relative",display:"block"}):e(this).bind(t.eventName,M)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&M.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if(typeof t=="string")t=I(t);else if(t.r!=undefined&&t.g!=undefined&&t.b!=undefined)t=q(t);else{if(t.h==undefined||t.s==undefined||t.b==undefined)return this;t=H(t)}return this.each(function(){if(e(this).data("colorpickerId")){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").color=t;n.data("colorpicker").origColor=t;u(t,n.get(0));a(t,n.get(0));f(t,n.get(0));c(t,n.get(0));l(t,n.get(0));h(t,n.get(0));p(t,n.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hide,ColorPickerShow:t.show,ColorPickerSetColor:t.setColor})})(jQuery);(function(e){e.fn.hoverIntent=function(t,n){var r={sensitivity:7,interval:100,timeout:0};r=e.extend(r,n?{over:t,out:n}:t);var i,s,o,u,a=function(e){i=e.pageX;s=e.pageY},f=function(t,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);if(Math.abs(o-i)+Math.abs(u-s)<r.sensitivity){e(n).unbind("mousemove",a);n.hoverIntent_s=1;return r.over.apply(n,[t])}o=i;u=s;n.hoverIntent_t=setTimeout(function(){f(t,n)},r.interval)},l=function(e,t){t.hoverIntent_t=clearTimeout(t.hoverIntent_t);t.hoverIntent_s=0;return r.out.apply(t,[e])},c=function(t){var n=jQuery.extend({},t),i=this;i.hoverIntent_t&&(i.hoverIntent_t=clearTimeout(i.hoverIntent_t));if(t.type=="mouseenter"){o=n.pageX;u=n.pageY;e(i).bind("mousemove",a);i.hoverIntent_s!=1&&(i.hoverIntent_t=setTimeout(function(){f(n,i)},r.interval))}else{e(i).unbind("mousemove",a);i.hoverIntent_s==1&&(i.hoverIntent_t=setTimeout(function(){l(n,i)},r.timeout))}};return this.bind("mouseenter",c).bind("mouseleave",c)}})(jQuery);(function(e){var t=null,n="blocktypes",r=null;e.fn.liveUpdate=function(t,n){return this.each(function(){new e.liveUpdate(this,t,n)})};e.liveUpdate=function(t,n,r){this.field=e(t);e(t).data("liveUpdate",this);this.list=e("#"+n);this.lutype="blocktypes";typeof r!="undefined"&&(this.lutype=r);this.list.length>0&&this.init()};e.liveUpdate.prototype={init:function(){var e=this;this.setupCache();this.field.parents("form").submit(function(){return!1});this.field.keyup(function(){e.filter()});e.filter()},filter:function(){if(this.field.val()!=r){if(e.trim(this.field.val())==""){if(this.lutype!="blocktypes")if(this.lutype=="attributes"){this.list.find("h5").show();this.list.find("li").show()}else if(this.lutype=="stacks"){this.list.children("li").addClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected")}else this.lutype=="intelligent-search"?this.list.is(":visible")&&this.list.hide():this.list.children("li").show();return}this.lutype!="intelligent-search"||this.field.val().length>2?this.displayResults(this.getScores(this.field.val().toLowerCase())):this.lutype=="intelligent-search"&&this.list.is(":visible")&&this.list.hide()}r=this.field.val();r==""&&this.lutype=="intelligent-search"&&this.list.is(":visible")&&this.list.hide()},setupCache:function(){var t=this;this.cache=[];this.rows=[];var n=this.lutype;this.list.find("li").each(function(){if(n=="blocktypes")t.cache.push(e(this).find("span").html().toLowerCase());else if(n=="attributes"){var r=e(this).find("a,span").html().toLowerCase();t.cache.push(r)}else if(n=="stacks"){var r=e(this).find("a,span").html().toLowerCase();t.cache.push(r)}else if(n=="fileset")t.cache.push(e(this).find("span").html().toLowerCase());else if(n=="intelligent-search"){var i=e(this).find("span").html();i&&t.cache.push(i.toLowerCase())}t.rows.push(e(this))});this.cache_length=this.cache.length},displayResults:function(t){var n=this;if(this.lutype=="blocktypes"){this.list.children("li").hide();e.each(t,function(e,t){n.rows[t[1]].show()})}else if(this.lutype=="attributes"){this.list.find("h5").hide();this.list.find("li").hide();e.each(t,function(e,t){n.rows[t[1]].show()})}else if(this.lutype=="stacks"){this.list.children("li").removeClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected");this.list.children("li").removeClass("ccm-item-selected");e.each(t,function(e,t){n.rows[t[1]].addClass("ccm-stack-available")});this.list.children("li.item-select-list-header").removeClass("ccm-stack-available");e(this.list.find("li.ccm-stack-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="intelligent-search"){this.list.is(":visible")||this.list.fadeIn(160,"easeOutExpo");this.list.find(".ccm-intelligent-search-results-module-onsite").hide();this.list.find("li").hide();var r=0;e.each(t,function(e,t){$li=n.rows[t[1]];if(t[0]>.75){r++;$li.parent().parent().is(":visible")||$li.parent().parent().show();$li.show()}});this.list.find("li a").removeClass("ccm-intelligent-search-result-selected");this.list.find("li:visible a:first").addClass("ccm-intelligent-search-result-selected")}else{this.list.children("li").hide();e.each(t,function(e,t){n.rows[t[1]].show()})}},getScores:function(e){var t=[];for(var n=0;n<this.cache_length;n++){var r=this.cache[n].score(e);r>0&&t.push([r,n])}return t.sort(function(e,t){return t[0]-e[0]})}}})(jQuery);(function(){var e,t,n,r,i=function(e,t){return function(){return e.apply(t,arguments)}};r=this;e=jQuery;e.fn.extend({chosen:function(n){return e.browser!=="msie"||e.browser.version!=="6.0"&&e.browser.version!=="7.0"?e(this).each(function(r){if(!e(this).hasClass("chzn-done"))return new t(this,n)}):this}});t=function(){function t(t,n){this.form_field=t;this.options=n!=null?n:{};this.set_default_values();this.form_field_jq=e(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done")}t.prototype.set_default_values=function(){this.click_test_action=i(function(e){return this.test_active_click(e)},this);this.activate_action=i(function(e){return this.activate_field(e)},this);this.active_field=!1;this.mouse_on_container=!1;this.results_showing=!1;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:!1;this.disable_search_threshold=this.options.disable_search_threshold||0;this.choices=0;return this.results_none_found=this.options.no_results_text||"No results match"};t.prototype.set_up_html=function(){var t,r,i,s;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.outerWidth();this.default_text=this.form_field_jq.data("placeholder")?this.form_field_jq.data("placeholder"):this.default_text_default;t=e("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"});this.is_multiple?t.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>'):t.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');this.form_field_jq.hide().after(t);this.container=e("#"+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));!this.is_multiple&&this.form_field.options.length<=this.disable_search_threshold&&this.container.addClass("chzn-container-single-nosearch");this.dropdown=this.container.find("div.chzn-drop").first();r=this.container.height();i=this.f_width-n(this.dropdown);this.dropdown.css({width:i+"px",top:r+"px"});this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chzn-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chzn-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chzn-search").first();this.selected_item=this.container.find(".chzn-single").first();s=i-n(this.search_container)-n(this.search_field);this.search_field.css({width:s+"px"})}this.results_build();return this.set_tab_index()};t.prototype.register_observers=function(){this.container.mousedown(i(function(e){return this.container_mousedown(e)},this));this.container.mouseup(i(function(e){return this.container_mouseup(e)},this));this.container.mouseenter(i(function(e){return this.mouse_enter(e)},this));this.container.mouseleave(i(function(e){return this.mouse_leave(e)},this));this.search_results.mouseup(i(function(e){return this.search_results_mouseup(e)},this));this.search_results.mouseover(i(function(e){return this.search_results_mouseover(e)},this));this.search_results.mouseout(i(function(e){return this.search_results_mouseout(e)},this));this.form_field_jq.bind("liszt:updated",i(function(e){return this.results_update_field(e)},this));this.search_field.blur(i(function(e){return this.input_blur(e)},this));this.search_field.keyup(i(function(e){return this.keyup_checker(e)},this));this.search_field.keydown(i(function(e){return this.keydown_checker(e)},this));if(this.is_multiple){this.search_choices.click(i(function(e){return this.choices_click(e)},this));return this.search_field.focus(i(function(e){return this.input_focus(e)},this))}};t.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq.attr("disabled");if(this.is_disabled){this.container.addClass("chzn-disabled");this.search_field.attr("disabled",!0);this.is_multiple||this.selected_item.unbind("focus",this.activate_action);return this.close_field()}this.container.removeClass("chzn-disabled");this.search_field.attr("disabled",!1);if(!this.is_multiple)return this.selected_item.bind("focus",this.activate_action)};t.prototype.container_mousedown=function(t){var n;if(!this.is_disabled){n=t!=null?e(t.target).hasClass("search-choice-close"):!1;t&&t.type==="mousedown"&&t.stopPropagation();if(!this.pending_destroy_click&&!n){if(!this.active_field){this.is_multiple&&this.search_field.val("");e(document).click(this.click_test_action);this.results_show()}else if(!this.is_multiple&&t&&(e(t.target)===this.selected_item||e(t.target).parents("a.chzn-single").length)){t.preventDefault();this.results_toggle()}return this.activate_field()}return this.pending_destroy_click=!1}};t.prototype.container_mouseup=function(e){if(e.target.nodeName==="ABBR")return this.results_reset(e)};t.prototype.mouse_enter=function(){return this.mouse_on_container=!0};t.prototype.mouse_leave=function(){return this.mouse_on_container=!1};t.prototype.input_focus=function(e){if(!this.active_field)return setTimeout(i(function(){return this.container_mousedown()},this),50)};t.prototype.input_blur=function(e){if(!this.mouse_on_container){this.active_field=!1;return setTimeout(i(function(){return this.blur_test()},this),100)}};t.prototype.blur_test=function(e){if(!this.active_field&&this.container.hasClass("chzn-container-active"))return this.close_field()};t.prototype.close_field=function(){e(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1)}this.active_field=!1;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};t.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1)}this.container.addClass("chzn-container-active");this.active_field=!0;this.search_field.val(this.search_field.val());return this.search_field.focus()};t.prototype.test_active_click=function(t){return e(t.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()};t.prototype.results_build=function(){var e,t,n,i,s,o;n=new Date;this.parsing=!0;this.results_data=r.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0}else this.is_multiple||this.selected_item.find("span").text(this.default_text);e="";o=this.results_data;for(i=0,s=o.length;i<s;i++){t=o[i];if(t.group)e+=this.result_add_group(t);else if(!t.empty){e+=this.result_add_option(t);if(t.selected&&this.is_multiple)this.choice_build(t);else if(t.selected&&!this.is_multiple){this.selected_item.find("span").text(t.text);this.allow_single_deselect&&this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}}}this.search_field_disabled();this.show_search_field_default();this.search_field_scale();this.search_results.html(e);return this.parsing=!1};t.prototype.result_add_group=function(t){if(!t.disabled){t.dom_id=this.container_id+"_g_"+t.array_index;return'<li id="'+t.dom_id+'" class="group-result">'+e("<div />").text(t.label).html()+"</li>"}return""};t.prototype.result_add_option=function(e){var t,n;if(!e.disabled){e.dom_id=this.container_id+"_o_"+e.array_index;t=e.selected&&this.is_multiple?[]:["active-result"];e.selected&&t.push("result-selected");e.group_array_index!=null&&t.push("group-option");e.classes!==""&&t.push(e.classes);n=e.style.cssText!==""?' style="'+e.style+'"':"";return'<li id="'+e.dom_id+'" class="'+t.join(" ")+'"'+n+">"+e.html+"</li>"}return""};t.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build()};t.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){this.result_clear_highlight();this.result_highlight=e;this.result_highlight.addClass("highlighted");r=parseInt(this.search_results.css("maxHeight"),10);s=this.search_results.scrollTop();i=r+s;n=this.result_highlight.position().top+this.search_results.scrollTop();t=n+this.result_highlight.outerHeight();if(t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(n<s)return this.search_results.scrollTop(n)}};t.prototype.result_clear_highlight=function(){this.result_highlight&&this.result_highlight.removeClass("highlighted");return this.result_highlight=null};t.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()};t.prototype.results_show=function(){var e;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");this.result_single_selected&&this.result_do_highlight(this.result_single_selected)}e=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({top:e+"px",left:0});this.results_showing=!0;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};t.prototype.results_hide=function(){this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop");this.result_clear_highlight();this.dropdown.css({left:"-9000px"});return this.results_showing=!1};t.prototype.set_tab_index=function(e){var t;if(this.form_field_jq.attr("tabindex")){t=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple)return this.search_field.attr("tabindex",t);this.selected_item.attr("tabindex",t);return this.search_field.attr("tabindex",-1)}};t.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}this.search_field.val("");return this.search_field.removeClass("default")};t.prototype.search_results_mouseup=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n.length){this.result_highlight=n;return this.result_select(t)}};t.prototype.search_results_mouseover=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n)return this.result_do_highlight(n)};t.prototype.search_results_mouseout=function(t){if(e(t.target).hasClass("active-result"))return this.result_clear_highlight()};t.prototype.choices_click=function(t){t.preventDefault();if(this.active_field&&!e(t.target).hasClass("search-choice")&&!this.results_showing)return this.results_show()};t.prototype.choice_build=function(t){var n,r;n=this.container_id+"_c_"+t.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+n+'"><span>'+t.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+t.array_index+'"></a></li>');r=e("#"+n).find("a").first();return r.click(i(function(e){return this.choice_destroy_link_click(e)},this))};t.prototype.choice_destroy_link_click=function(t){t.preventDefault();if(!this.is_disabled){this.pending_destroy_click=!0;return this.choice_destroy(e(t.target))}return t.stopPropagation};t.prototype.choice_destroy=function(e){this.choices-=1;this.show_search_field_default();this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide();this.result_deselect(e.attr("rel"));return e.parents("li").first().remove()};t.prototype.results_reset=function(t){this.form_field.options[0].selected=!0;this.selected_item.find("span").text(this.default_text);this.show_search_field_default();e(t.target).remove();this.form_field_jq.trigger("change");if(this.active_field)return this.results_hide()};t.prototype.result_select=function(e){var t,n,r,i;if(this.result_highlight){t=this.result_highlight;n=t.attr("id");this.result_clear_highlight();if(this.is_multiple)this.result_deactivate(t);else{this.search_results.find(".result-selected").removeClass("result-selected");this.result_single_selected=t}t.addClass("result-selected");i=n.substr(n.lastIndexOf("_")+1);r=this.results_data[i];r.selected=!0;this.form_field.options[r.options_index].selected=!0;if(this.is_multiple)this.choice_build(r);else{this.selected_item.find("span").first().text(r.text);this.allow_single_deselect&&this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}(!e.metaKey||!this.is_multiple)&&this.results_hide();this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale()}};t.prototype.result_activate=function(e){return e.addClass("active-result")};t.prototype.result_deactivate=function(e){return e.removeClass("active-result")};t.prototype.result_deselect=function(t){var n,r;r=this.results_data[t];r.selected=!1;this.form_field.options[r.options_index].selected=!1;n=e("#"+this.container_id+"_o_"+t);n.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale()};t.prototype.results_search=function(e){return this.results_showing?this.winnow_results():this.results_show()};t.prototype.winnow_results=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;f=new Date;this.no_results_clear();u=0;a=this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html();s=new RegExp("^"+a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");h=new RegExp(a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");g=this.results_data;for(p=0,v=g.length;p<v;p++){n=g[p];if(!n.disabled&&!n.empty)if(n.group)e("#"+n.dom_id).hide();else if(!this.is_multiple||!n.selected){t=!1;o=n.dom_id;if(s.test(n.html)){t=!0;u+=1}else if(n.html.indexOf(" ")>=0||n.html.indexOf("[")===0){i=n.html.replace(/\[|\]/g,"").split(" ");if(i.length)for(d=0,m=i.length;d<m;d++){r=i[d];if(s.test(r)){t=!0;u+=1}}}if(t){if(a.length){l=n.html.search(h);c=n.html.substr(0,l+a.length)+"</em>"+n.html.substr(l+a.length);c=c.substr(0,l)+"<em>"+c.substr(l)}else c=n.html;e("#"+o).html!==c&&e("#"+o).html(c);this.result_activate(e("#"+o));n.group_array_index!=null&&e("#"+this.results_data[n.group_array_index].dom_id).show()}else{this.result_highlight&&o===this.result_highlight.attr("id")&&this.result_clear_highlight();this.result_deactivate(e("#"+o))}}}return u<1&&a.length?this.no_results(a):this.winnow_results_set_highlight()};t.prototype.winnow_results_clear=function(){var t,n,r,i,s;this.search_field.val("");n=this.search_results.find("li");s=[];for(r=0,i=n.length;r<i;r++){t=n[r];t=e(t);s.push(t.hasClass("group-result")?t.show():!this.is_multiple||!t.hasClass("result-selected")?this.result_activate(t):void 0)}return s};t.prototype.winnow_results_set_highlight=function(){var e,t;if(!this.result_highlight){t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result");e=t.length?t.first():this.search_results.find(".active-result").first();if(e!=null)return this.result_do_highlight(e)}};t.prototype.no_results=function(t){var n;n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');n.find("span").first().html(t);return this.search_results.append(n)};t.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};t.prototype.keydown_arrow=function(){var t,n;if(!this.result_highlight){t=this.search_results.find("li.active-result").first();t&&this.result_do_highlight(e(t))}else if(this.results_showing){n=this.result_highlight.nextAll("li.active-result").first();n&&this.result_do_highlight(n)}if(!this.results_showing)return this.results_show()};t.prototype.keyup_arrow=function(){var e;if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight){e=this.result_highlight.prevAll("li.active-result");if(e.length)return this.result_do_highlight(e.first());this.choices>0&&this.results_hide();return this.result_clear_highlight()}};t.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}this
.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus")};t.prototype.clear_backstroke=function(){this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus");return this.pending_backstroke=null};t.prototype.keyup_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode;this.search_field_scale();switch(t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}break;case 13:e.preventDefault();if(this.results_showing)return this.result_select(e);break;case 27:if(this.results_showing)return this.results_hide();break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};t.prototype.keydown_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode;this.search_field_scale();t!==8&&this.pending_backstroke&&this.clear_backstroke();switch(t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow()}};t.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,a,f;if(this.is_multiple){r=0;u=0;s="position:absolute; left: -1000px; top: -1000px; display:none;";o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(a=0,f=o.length;a<f;a++){i=o[a];s+=i+":"+this.search_field.css(i)+";"}n=e("<div />",{style:s});n.text(this.search_field.val());e("body").append(n);u=n.width()+25;n.remove();u>this.f_width-10&&(u=this.f_width-10);this.search_field.css({width:u+"px"});t=this.container.height();return this.dropdown.css({top:t+"px"})}};t.prototype.generate_field_id=function(){var e;e=this.generate_random_id();this.form_field.id=e;return e};t.prototype.generate_random_id=function(){var t;t="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while(e("#"+t).length>0)t+=this.generate_random_char();return t};t.prototype.generate_random_char=function(){var e,t,n;e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";n=Math.floor(Math.random()*e.length);return t=e.substring(n,n+1)};return t}();n=function(e){var t;return t=e.outerWidth()-e.width()};r.get_side_border_padding=n}).call(this);(function(){var e;e=function(){function e(){this.options_index=0;this.parsed=[]}e.prototype.add_node=function(e){return e.nodeName==="OPTGROUP"?this.add_group(e):this.add_option(e)};e.prototype.add_group=function(e){var t,n,r,i,s,o;t=this.parsed.length;this.parsed.push({array_index:t,group:!0,label:e.label,children:0,disabled:e.disabled});s=e.childNodes;o=[];for(r=0,i=s.length;r<i;r++){n=s[r];o.push(this.add_option(n,t,e.disabled))}return o};e.prototype.add_option=function(e,t,n){if(e.nodeName==="OPTION"){if(e.text!==""){t!=null&&(this.parsed[t].children+=1);this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})}else this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0});return this.options_index+=1}};return e}();e.select_to_array=function(t){var n,r,i,s,o;r=new e;o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];r.add_node(n)}return r.parsed};this.SelectParser=e}).call(this);ccm_t=function(e){return $("input[name=ccm-string-"+e+"]").val()};ccm_parseJSON=function(e,t){e.error?alert(e.message):t()};ccm_addHeaderItem=function(e,t){var n=e.indexOf("?")!=-1?"":"?ts=";if(t=="CSS")if(navigator.userAgent.indexOf("MSIE")!=-1){var r=document.createElement("link"),i=document.getElementsByTagName("head")[0];r.type="text/css";r.rel="stylesheet";r.href=e;r.media="screen";i.appendChild(r)}else $("head").children('link[href*="'+e+'"]').length||$("head").append('<link rel="stylesheet" media="screen" type="text/css" href="'+e+n+(new Date).getTime()+'" />');else t=="JAVASCRIPT"?$('script[src*="'+e+'"]').length||$("head").append('<script type="text/javascript" src="'+e+n+(new Date).getTime()+'"></script>'):$("head").children(e).length||$("head").append(e)};var ccm_isBlockError=!1,ccm_blockError=!1;ccm_addError=function(e){if(!ccm_isBlockError){ccm_blockError="";ccm_blockError+="<ul>"}ccm_isBlockError=!0;ccm_blockError+="<li>"+e+"</li>"};ccm_resetBlockErrors=function(){ccm_isBlockError=!1;ccm_blockError=""};ccm_fadeInMenu=function(e,t){var n=e.find("div.popover div.inner").width(),r=e.find("div.popover").height();e.hide();e.css("visibility","visible");var i=t.pageX+2,s=t.pageY+2;if($(window).height()<t.clientY+r){s=s-r-10;i-=n/2;e.find("div.popover").removeClass("below");e.find("div.popover").addClass("above")}else{i-=n/2;s+=10;e.find("div.popover").removeClass("above");e.find("div.popover").addClass("below")}e.css("top",s+"px");e.css("left",i+"px");e.fadeIn(60)};ccm_hideMenus=function(){ccm_activeMenu=!1;$("div.ccm-menu").hide();$("div.ccm-menu").css("visibility","hidden");$("div.ccm-menu").show()};ccm_paneToggleOptions=function(e){var t=$(e).parent().find("div.ccm-pane-options-content");if($(e).hasClass("ccm-icon-option-closed")){$(e).removeClass("ccm-icon-option-closed").addClass("ccm-icon-option-open");t.slideDown("fast","easeOutExpo")}else{$(e).removeClass("ccm-icon-option-open").addClass("ccm-icon-option-closed");t.slideUp("fast","easeOutExpo")}};var CCMEditMode=function(){setupMenus=function(){$(".ccm-area").each(function(){var e=parseInt($(this).attr("data-total-blocks")),t=parseInt($(this).attr("data-maximum-blocks"));t>-1&&(e==t||e>t)?$(this).find("div.ccm-area-footer li[data-list-item=block_limit_row]").hide():$(this).find("div.ccm-area-footer li[data-list-item=block_limit_row]").show()});$(".ccm-block-edit").each(function(){var e=$(this),t=e.attr("data-block-id"),n=e.attr("data-area-id"),r=e.closest("div.ccm-area").attr("data-area-handle");e.find("a[data-menu-action=edit_inline]").unbind().on("click",function(){CCMInlineEditMode.editBlock(CCM_CID,n,r,t,$(this).attr("data-menu-action-params"));return!1});e.find("a[data-menu-action=block_dialog]").each(function(){var e=$(this).attr("data-menu-href");e.indexOf("?")!==-1?e+="&cID="+CCM_CID:e+="?cID="+CCM_CID;e+="&arHandle="+encodeURIComponent(r)+"&bID="+t;$(this).attr("href",e);$(this).dialog()});e.find("a[data-menu-action=block_scrapbook]").unbind().on("click",function(){CCMEditMode.addBlockToScrapbook(CCM_CID,t,r);return!1});e.find("a[data-menu-action=delete_block]").unbind().on("click",function(){CCMEditMode.deleteBlock(CCM_CID,t,n,r,$(this).attr("data-menu-delete-message"));return!1})});$(".ccm-area").ccmmenu();$(".ccm-block-edit").ccmmenu()};saveArrangement=function(e,t,n,r){var i=CCM_CID;jQuery.fn.dialog.showLoader();if(!r)var r="";var s="&sourceBlockID="+e+"&sourceBlockTypeHandle="+r+"&sourceBlockAreaID="+t+"&destinationBlockAreaID="+n,o=$("div.ccm-area[data-area-id="+t+"]");if(t==n)var u=[o];else var a=$("div.ccm-area[data-area-id="+n+"]"),u=[o,a];$.each(u,function(e,t){var n=$(t);areaStr="&area["+n.attr("data-area-id")+"][]=";n.find("> div.ccm-area-block-list > div.ccm-block-edit").each(function(){var e=$(this).attr("data-block-id");$(this).attr("custom-style")&&(e+="-"+$(this).attr("custom-style"));s+=areaStr+e})});$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,dataType:"json",data:"cID="+i+"&ccm_token="+CCM_SECURITY_TOKEN+"&btask=ajax_do_arrange"+s,complete:function(){CCMEditMode.start()},success:function(t){ccm_parseJSON(t,function(){jQuery.fn.dialog.hideLoader();if(r=="core_gathering_item"){a.find("div[data-gathering-item-id="+e+"]").remove();CCMEditMode.parseBlockResponse(t,t.bID,"add")}else if(o&&a){var i=parseInt(o.attr("data-total-blocks")),s=parseInt(a.attr("data-total-blocks"));o.attr("data-total-blocks",i-1);a.attr("data-total-blocks",s+1);a.find("div[data-block-id="+e+"]").attr("data-area-id",n)}CCMToolbar.disableDirectExit()})}})};addBlockType=function(e,t,n,r,i){var s=r.attr("data-btID"),o=parseInt(r.attr("data-supports-inline-add")),u=parseInt(r.attr("data-has-add-template"));CCMPanelManager.exitPanelMode();if(!u){var a=CCM_DISPATCHER_FILENAME+"?cID="+e+"&arHandle="+encodeURIComponent(n)+"&btID="+s+"&mode=edit&processBlock=1&add=1&ccm_token="+CCM_SECURITY_TOKEN;$.get(a,function(e){CCMEditMode.parseBlockResponse(e,!1,"add")})}else o?CCMInlineEditMode.loadAdd(e,n,t,s):jQuery.fn.dialog.open({onClose:function(){$(document).trigger("blockWindowClose");i&&jQuery.fn.dialog.closeAll()},width:parseInt(r.attr("data-dialog-width")),height:parseInt(r.attr("data-dialog-height"))+20,title:r.attr("data-dialog-title"),href:CCM_TOOLS_PATH+"/add_block_popup?cID="+e+"&btID="+s+"&arHandle="+encodeURIComponent(n)})};setupSortablesAndDroppables=function(){$("div.ccm-area-block-dropzone").remove();$(".ui-droppable").droppable("destroy");$emptyareas=$("div.ccm-area[data-total-blocks=0]");$emptyareas.droppable({hoverClass:"ccm-area-drag-block-type-over",tolerance:"pointer",accept:function(e){var t=parseInt($(this).attr("data-total-blocks")),n=parseInt($(this).attr("data-maximum-blocks"));if(n==-1||t<n){var r=e.attr("data-block-type-handle");return $(this).attr("data-accepts-block-types").indexOf(r)!==-1}return!1},greedy:!0,drop:function(e,t){$(".ccm-area-drag-block-type-over").removeClass("ccm-area-drag-block-type-over");if(t.helper.is(".ccm-panel-add-block-draggable-block-type"))addBlockType($(this).attr("data-cID"),$(this).attr("data-area-id"),$(this).attr("data-area-handle"),t.helper,!0);else if(t.helper.is(".ccm-panel-add-block-clipboard-item")){jQuery.fn.dialog.showLoader();var n=CCM_DISPATCHER_FILENAME+"?pcID[]="+t.draggable.attr("data-clipboard-item-id")+"&add=1&processBlock=1&cID="+$(this).attr("data-cID")+"&arHandle="+$(this).attr("data-area-handle")+"&btask=alias_existing_block&ccm_token="+CCM_SECURITY_TOKEN;$.get(n,function(e){CCMEditMode.parseBlockResponse(e,!1,"add")})}else{t.draggable.appendTo($(this).find(".ccm-area-block-list"));var r=t.draggable.attr("data-block-id"),i=t.draggable.attr("data-block-type-handle");if(i=="core_gathering_item")var r=t.draggable.attr("data-gathering-item-id");saveArrangement(r,t.draggable.attr("data-area-id"),$(this).attr("data-area-id"),i)}}});var e=$("<div />").addClass("ccm-area-block-dropzone").append($("<div />").addClass("ccm-area-block-dropzone-inner"));e.clone().insertBefore($(".ccm-block-edit"));$nonemptyareas=$("div.ccm-area[data-total-blocks!=0] > div.ccm-area-block-list");$nonemptyareas.append(e.clone());$(".ccm-area-block-dropzone").droppable({hoverClass:"ccm-area-block-dropzone-over",tolerance:"pointer",accept:function(e){var t=e.attr("data-block-type-handle");if(t=="core_gathering_item")return!1;var n=$(this).closest(".ccm-area"),r=parseInt(n.attr("data-total-blocks")),i=parseInt(n.attr("data-maximum-blocks"));if(i==-1||r<i){var s=n.attr("data-accepts-block-types");if(s)return s.indexOf(t)!==-1}return!1},drop:function(e,t){$(".ccm-area-drag-block-type-over").removeClass("ccm-area-drag-block-type-over");if(t.helper.is(".ccm-panel-add-block-draggable-block-type")){$(this).replaceWith($("<div />",{id:"ccm-add-new-block-placeholder"}));var n=$("#ccm-add-new-block-placeholder").closest(".ccm-area");addBlockType(n.attr("data-cID"),n.attr("data-area-id"),n.attr("data-area-handle"),t.helper,!0)}else if(t.helper.is(".ccm-panel-add-block-clipboard-item")){jQuery.fn.dialog.showLoader();$(this).replaceWith($("<div />",{id:"ccm-add-new-block-placeholder"}));var n=$("#ccm-add-new-block-placeholder").closest(".ccm-area"),r=CCM_DISPATCHER_FILENAME+"?pcID[]="+t.draggable.attr("data-clipboard-item-id")+"&add=1&processBlock=1&cID="+n.attr("data-cID")+"&arHandle="+n.attr("data-area-handle")+"&btask=alias_existing_block&ccm_token="+CCM_SECURITY_TOKEN;$.get(r,function(e){CCMEditMode.parseBlockResponse(e,!1,"add")})}else{var i=t.draggable.attr("data-block-id"),s=t.draggable.attr("data-block-type-handle"),o=t.draggable.attr("data-area-id"),n=$(this).closest(".ccm-area");$(this).replaceWith(t.draggable.clone());t.draggable.remove();setTimeout(function(){saveArrangement(i,o,n.attr("data-area-id"),s)},100)}}});$("[data-inline-command=move-block]").on("mousedown",function(){$(".ccm-area-block-dropzone").addClass("ccm-area-block-dropzone-active")});$("[data-inline-command=move-block]").on("mouseup",function(){$(".ccm-area-block-dropzone-active").removeClass("ccm-area-block-dropzone-active")});$(".ccm-block-edit").draggable({cursor:"move",cursorAt:{right:10,top:10},handle:"[data-inline-command=move-block]",opacity:.5,helper:function(){var e=$(this).width(),t=$(this).height();t>300&&(t=300);var n=$("<div />",{"class":"ccm-block-type-sorting"}).css("width",e).css("height",t);n.append($(this).clone());return n},stop:function(){$.fn.ccmmenu.enable()},start:function(e,t){$.fn.ccmmenu.disable()}})};return{start:function(){setupMenus();setupSortablesAndDroppables()},exitPreviewMode:function(){$("html").removeClass("ccm-panel-preview-mode");$("#ccm-page-preview-frame").remove();$("html").removeClass("ccm-page-preview-mode")},launchPageComposer:function(){$("a[data-launch-panel=page]").toggleClass("ccm-launch-panel-active");CCMPanelManager.getByIdentifier("page").show();ccm_event.subscribe("panel.open",function(e){var t=e.eventData;t.options.identifier=="page"&&$("#"+t.getDOMID()).find("[data-launch-panel-detail='page/composer']").addClass("ccm-panel-menu-item-active")});CCMPanelManager.getByIdentifier("page").openPanelDetail({url:CCM_TOOLS_PATH+"/panels/details/page/composer",identifier:"page-composer"})},setupBlockForm:function(e,t,n){e.ajaxForm({type:"POST",iframe:!0,beforeSubmit:function(){$("input[name=ccm-block-form-method]").val("AJAX");jQuery.fn.dialog.showLoader();if(typeof window.ccmValidateBlockForm=="function"){r=window.ccmValidateBlockForm();if(ccm_isBlockError){jQuery.fn.dialog.hideLoader();ccm_blockError&&ccmAlert.notice(ccmi18n.error,ccm_blockError+"</ul>");ccm_resetBlockErrors();return!1}}},success:function(e){CCMEditMode.parseBlockResponse(e,t,n)}})},addBlockToScrapbook:function(e,t,n){CCMToolbar.disableDirectExit();$.ajax({type:"POST",url:CCM_TOOLS_PATH+"/pile_manager.php",data:"cID="+e+"&bID="+t+"&arHandle="+encodeURIComponent(n)+"&btask=add&scrapbookName=userScrapbook",success:function(e){ccmAlert.hud(ccmi18n.copyBlockToScrapbookMsg,2e3,"add",ccmi18n.copyBlockToScrapbook)}})},deleteBlock:function(e,t,n,r,i,s){if(confirm(i)){CCMToolbar.disableDirectExit();$d=$("[data-block-id="+t+"][data-area-id="+n+"]");$d.hide().remove();$.fn.ccmmenu.reset();ccmAlert.hud(ccmi18n.deleteBlockMsg,2e3,"delete_small",ccmi18n.deleteBlock);var o=parseInt($("[data-area-id="+n+"]").attr("data-total-blocks"));$("[data-area-id="+n+"]").attr("data-total-blocks",o-1);CCMEditMode.start();$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+e+"&ccm_token="+CCM_SECURITY_TOKEN+"&isAjax=true&btask=remove&bID="+t+"&arHandle="+encodeURIComponent(r)});typeof s=="function"&&s()}},parseBlockResponse:function(r,currentBlockID,task){try{if(typeof r=="string"){r=r.replace(/(<([^>]+)>)/ig,"");resp=eval("("+r+")")}else resp=r;if(resp.error==1){var message="<ul>";for(i=0;i<resp.response.length;i++)message+="<li>"+resp.response[i]+"</li>";message+="</ul>";ccmAlert.notice(ccmi18n.error,message)}else{jQuery.fn.dialog.closeTop();$(document).trigger("blockWindowAfterClose");resp.cID?cID=resp.cID:cID=CCM_CID;var action=CCM_TOOLS_PATH+"/edit_block_popup?cID="+cID+"&bID="+resp.bID+"&arHandle="+encodeURIComponent(resp.arHandle)+"&btask=view_edit_mode";$.get(action,function(e){if(task=="add")if($("#ccm-add-new-block-placeholder").length>0){$("#ccm-add-new-block-placeholder").before(e).remove();saveArrangement(resp.bID,resp.aID,resp.aID)}else $("#a"+resp.aID+" > div.ccm-area-block-list").append(e);else $("[data-block-id="+currentBlockID+"][data-area-id="+resp.aID+"]").before(e).remove();CCMInlineEditMode.exit();CCMToolbar.disableDirectExit();jQuery.fn.dialog.hideLoader();if(task=="add"){var t=parseInt($("div.ccm-area[data-area-id="+resp.aID+"]").attr("data-total-blocks"));$("div.ccm-area[data-area-id="+resp.aID+"]").attr("data-total-blocks",t+1);ccmAlert.hud(ccmi18n.addBlockMsg,2e3,"ok",ccmi18n.addBlock);jQuery.fn.dialog.closeAll()}else ccmAlert.hud(ccmi18n.updateBlockMsg,2e3,"ok",ccmi18n.updateBlock);CCMEditMode.start();$.fn.ccmmenu.reset();typeof window.ccm_parseBlockResponsePost=="function"&&ccm_parseBlockResponsePost(resp)})}}catch(e){ccmAlert.notice(ccmi18n.error,r)}},launchLayoutPresets:function(e,t,n){var r=CCM_TOOLS_PATH+"/area/layout_presets?arLayoutID="+e+"&ccm_token="+t;n&&(r+="&task="+n);jQuery.fn.dialog.open({width:280,height:200,href:r,title:ccmi18n.areaLayoutPresets,onOpen:function(){$("#ccm-layout-save-preset-form select").on("change",function(e){if($(this).val()=="-1"){$("#ccm-layout-save-preset-name").show().focus();$("#ccm-layout-save-preset-override").hide()}else{$("#ccm-layout-save-preset-name").hide();$("#ccm-layout-save-preset-override").show()}}).trigger("change");$("#ccm-layout-save-preset-form").on("submit",function(){$.fn.dialog.showLoader();var e=$("#ccm-layout-save-preset-form").serializeArray();e.push({name:"submit",value:1});$.ajax({url:r,type:"POST",data:e,dataType:"json",success:function(e){$.fn.dialog.hideLoader();$.fn.dialog.closeAll()}});return!1})}})},showResponseNotification:function(e,t,n){$('<div id="ccm-notification-hud" class="ccm-ui ccm-notification ccm-notification-'+n+'"><i class="glyphicon glyphicon-'+t+'"></i><div class="ccm-notification-inner">'+e+"</div></div>").appendTo(document.body).delay(5).queue(function(){$(this).css("opacity",1);$(this).dequeue()}).delay(2e3).queue(function(){$(this).css("opacity",0);$(this).dequeue()}).delay(1e3).queue(function(){$(this).remove();$(this).dequeue()})},activateAddBlocksPanel:function(){$("#ccm-panel-add-block-dragging").length==0&&$('<div id="ccm-panel-add-block-dragging" />').appendTo(document.body);$("#ccm-add-new-block-placeholder").remove();$("#ccm-panel-add-block [data-panel-add-block-drag-item]").each(function(){var e=$(this);e.css("cursor","move");e.draggable({helper:"clone",appendTo:$("#ccm-panel-add-block-dragging"),revert:!1,start:function(e,t){$(".ccm-area-block-dropzone").addClass("ccm-area-block-dropzone-active");$.fn.ccmmenu.disable()},stop:function(){$.fn.ccmmenu.enable()}})});$("a[data-delete=clipboard-item]").on("click",function(){var e=$(this).parent(),t=e.attr("data-clipboard-item-id");e.addClass("ccm-panel-add-block-clipboard-item-delete").delay(500).queue(function(){$(this).remove();$(this).dequeue()});$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"pcID="+t+"&ptask=delete_content&ccm_token="+CCM_SECURITY_TOKEN})})}}}(),ccm_totalAdvancedSearchFields=0,ccm_alLaunchType=new Array,ccm_alActiveAssetField="",ccm_alProcessorTarget="",ccm_alDebug=!1;ccm_triggerSelectFile=function(e,t){if(t==null)var t=ccm_alActiveAssetField;var n=$("#"+t+"-fm-selected"),r=$("#"+t+"-fm-display");r.hide();n.show();n.load(CCM_TOOLS_PATH+"/files/selector_data?fID="+e+"&ccm_file_selected_field="+t,function(){n.attr("fID",e);n.attr("ccm-file-manager-can-view",n.children("div").attr("ccm-file-manager-can-view"));n.attr("ccm-file-manager-can-edit",n.children("div").attr("ccm-file-manager-can-edit"));n.attr("ccm-file-manager-can-admin",n.children("div").attr("ccm-file-manager-can-admin"));n.attr("ccm-file-manager-can-replace",n.children("div").attr("ccm-file-manager-can-replace"));n.attr("ccm-file-manager-instance",t);n.click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});typeof ccm_triggerSelectFileComplete=="function"&&ccm_triggerSelectFileComplete(e,t);ccm_event.publish("FileManagerFileSelected",{fID:e,af:t})});var i=$("#"+t+"-fm-value");i.attr("value",e);ccm_alSetupFileProcessor()};ccm_alGetFileData=function(e,t){$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?fID="+e,t)};ccm_clearFile=function(e,t){e.stopPropagation();var n=$("#"+t+"-fm-selected"),r=$("#"+t+"-fm-display"),i=$("#"+t+"-fm-value");i.attr("value",0);n.hide();r.show()};ccm_activateFileManager=function(e,t){ccm_alLaunchType[t]=e;ccm_alSetupSelectFiles(t);$(document).click(function(e){e.stopPropagation();ccm_alSelectNone()});ccm_setupAdvancedSearch(t);e=="DASHBOARD"&&$(".dialog-launch").dialog();ccm_alSetupCheckboxes(t);ccm_alSetupFileProcessor();ccm_alSetupSingleUploadForm();$("form#ccm-"+t+"-advanced-search select[name=fssID]").change(function(){if(e=="DASHBOARD")window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/files/search?fssID="+$(this).val();else{jQuery.fn.dialog.showLoader();var n=$("div#ccm-"+t+"-overlay-wrapper input[name=dialogAction]").val()+"&refreshDialog=1&fssID="+$(this).val();$.get(n,function(e){jQuery.fn.dialog.hideLoader();$("div#ccm-"+t+"-overlay-wrapper").html(e);$("div#ccm-"+t+"-overlay-wrapper a.dialog-launch").dialog()})}});ccm_searchActivatePostFunction[t]=function(){ccm_alSetupCheckboxes(t);ccm_alSetupSelectFiles(t);ccm_alSetupSingleUploadForm()}};ccm_alSetupSingleUploadForm=function(){$(".ccm-file-manager-submit-single").submit(function(){$(this).attr("target",ccm_alProcessorTarget);ccm_alSubmitSingle($(this).get(0))})};ccm_activateFileSelectors=function(){$(".ccm-file-manager-launch").unbind();$(".ccm-file-manager-launch").click(function(){ccm_alLaunchSelectorFileManager($(this).parent().attr("ccm-file-manager-field"))})};ccm_alLaunchSelectorFileManager=function(e){ccm_alActiveAssetField=e;var t="",n=$("#"+e+"-fm-display input.ccm-file-manager-filter");if(n.length)for(i=0;i<n.length;i++)t+="&"+$(n[i]).attr("name")+"="+$(n[i]).attr("value");ccm_launchFileManager(t)};ccm_launchFileManager=function(e){$.fn.dialog.open({width:"90%",height:"70%",appendButtons:!0,onOpen:function(){ccm_event.publish("launchFileManager",ccm_alActiveAssetField)},modal:!1,href:CCM_TOOLS_PATH+"/files/search_dialog?ocID="+CCM_CID+"&search=1"+e,title:ccmi18n_filemanager.title})};ccm_launchFileSetPicker=function(e){$.fn.dialog.open({width:500,height:160,modal:!1,href:CCM_TOOLS_PATH+"/files/pick_set?oldFSID="+e,title:ccmi18n_filemanager.sets})};ccm_alSubmitSetsForm=function(e){ccm_deactivateSearchResults(e);jQuery.fn.dialog.showLoader();$("#ccm-"+e+"-add-to-set-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.hideLoader();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){$("#ccm-"+e+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:e},function(){$(".chosen-select").chosen();ccm_parseAdvancedSearchResponse(t,e)})})})};ccm_alSubmitPasswordForm=function(e){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-password-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})};ccm_alSubmitStorageForm=function(e){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-storage-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})};ccm_alSubmitPermissionsForm=function(e){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-permissions-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})};ccm_alSetupSetsForm=function(e){$("#fsAddToSearchName").liveUpdate("ccm-file-search-add-to-sets-list","fileset");$(".ccm-file-set-add-cb a").each(function(){var e=$(this),t=e.attr("ccm-tri-state-startup");$(this).click(function(){var e=$(this).attr("ccm-tri-state-selected"),n=0;switch(e){case"0":t=="1"?n="1":n="2";break;case"1":n="2";break;case"2":n="0"}$(this).attr("ccm-tri-state-selected",n);$(this).parent().find("input").val(n);$(this).find("img").attr("src",CCM_IMAGE_PATH+"/checkbox_state_"+n+".png")})});$("#ccm-"+e+"-add-to-set-form input[name=fsNew]").click(function(){$(this).prop("checked")||$("#ccm-"+e+"-add-to-set-form input[name=fsNewText]").val("")});$("#ccm-"+e+"-add-to-set-form").submit(function(){ccm_alSubmitSetsForm(e);return!1})};ccm_alSetupPasswordForm=function(){$("#ccm-file-password-form").submit(function(){ccm_alSubmitPasswordForm();return!1})};ccm_alRescanFiles=function(){var e=CCM_TOOLS_PATH+"/files/rescan?",t=arguments;for(i=0;i<t.length;i++)e+="fID[]="+t[i]+"&";$.fn.dialog.open({title:ccmi18n_filemanager.rescan,href:e,width:350,modal:!1,height:200,onClose:function(){if(t.length==1){$("#ccm-file-properties-wrapper").html("");jQuery.fn.dialog.showLoader();$("#ccm-file-properties-wrapper").load(CCM_TOOLS_PATH+"/files/properties?fID="+t[0]+"&reload=1",!1,function(){jQuery.fn.dialog.hideLoader();$(this).find(".dialog-launch").dialog()})}}})};ccm_alSelectPermissionsEntity=function(e,t,n){var r=$("#ccm-file-permissions-entity-base").html();$("#ccm-file-permissions-entities-wrapper").append('<div class="ccm-file-permissions-entity">'+r+"</div>");var i=$(".ccm-file-permissions-entity"),s=i[i.length-1];$(s).find("h3 span").html(n);$(s).find("input[type=hidden]").val(e+"_"+t);$(s).find("select").each(function(){$(this).attr("name",$(this).attr("name")+"_"+e+"_"+t)});$(s).find("div.ccm-file-access-extensions input[type=checkbox]").each(function(){$(this).attr("name",$(this).attr("name")+"_"+e+"_"+t+"[]")});ccm_alActivateFilePermissionsSelector()};ccm_alActivateFilePermissionsSelector=function(){$(".ccm-file-access-add select").unbind();$(".ccm-file-access-add select").change(function(){var e=$(this).parents("div.ccm-file-permissions-entity")[0];$(this).val()==ccmi18n_filemanager.PTYPE_CUSTOM?$(e).find("div.ccm-file-access-add-extensions").show():$(e).find("div.ccm-file-access-add-extensions").hide()});$(".ccm-file-access-file-manager select").change(function(){var e=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()!=ccmi18n_filemanager.PTYPE_NONE){$(e).find(".ccm-file-access-add").show();$(e).find(".ccm-file-access-edit").show();$(e).find(".ccm-file-access-admin").show()}else{$(e).find(".ccm-file-access-add").hide();$(e).find(".ccm-file-access-edit").hide();$(e).find(".ccm-file-access-admin").hide();$(e).find("div.ccm-file-access-add-extensions").hide()}});$("a.ccm-file-permissions-remove").click(function(){$(this).parent().parent().fadeOut(100,function(){$(this).remove()})});$("input[name=toggleCanAddExtension]").unbind();$("input[name=toggleCanAddExtension]").click(function(){var e=$(this).parent().parent().find("div.ccm-file-access-extensions");$(this).prop("checked")==1?e.find("input").attr("checked",!0):e.find("input").attr("checked",!1)})};ccm_alSetupVersionSelector=function(){$("#ccm-file-versions-grid input[type=radio]").click(function(){$("#ccm-file-versions-grid tr").removeClass("ccm-file-versions-grid-active");var e=$(this).parent().parent(),t=e.attr("fID"),n=e.attr("fvID"),r="task=approve_version&fID="+t+"&fvID="+n;$.post(CCM_TOOLS_PATH+"/files/properties",r,function(t){e.addClass("ccm-file-versions-grid-active");e.find("td").show("highlight",{color:"#FFF9BB"})})});$(".ccm-file-versions-remove").click(function(){var e=$(this).parent().parent(),t=e.attr("fID"),n=e.attr("fvID"),r="task=delete_version&fID="+t+"&fvID="+n;$.post(CCM_TOOLS_PATH+"/files/properties",r,function(t){e.fadeOut(200,function(){e.remove()})});return!1})};ccm_alDeleteFiles=function(e){$("#ccm-"+e+"-delete-form").ajaxSubmit(function(t){ccm_parseJSON(t,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(e);$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})})};ccm_alDuplicateFiles=function(searchInstance){$("#ccm-"+searchInstance+"-duplicate-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);var r=eval("("+resp+")");$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(e){ccm_parseAdvancedSearchResponse(e,searchInstance);var t=new Array;for(i=0;i<r.fID.length;i++){fID=r.fID[i];ccm_uploadedFiles.push(fID);t.push(fID)}ccm_alRefresh(t,searchInstance);ccm_filesUploadedDialog(searchInstance)})})})};ccm_alSetupSelectFiles=function(e){$(".ccm-file-list").unbind();$(".ccm-file-list tr.ccm-list-record").click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});$(".ccm-file-list img.ccm-star").click(function(e){e.stopPropagation();var t=$(e.target).parents("tr.ccm-list-record")[0].id;t=t.substring(3);ccm_starFile(e.target,t)});ccm_alLaunchType[e]=="DASHBOARD"&&$(".ccm-file-list-thumbnail").hover(function(e){var t=$(this).attr("fID"),n=$("#fID"+t+"hoverThumbnail");if(n.length>0){var r=n.find("div"),i=n.position();r.css("top",i.top);r.css("left",i.left);r.show()}},function(){var e=$(this).attr("fID"),t=$("#fID"+e+"hoverThumbnail"),n=t.find("div");n.hide()})};ccm_alSetupCheckboxes=function(e){$("#ccm-"+e+"-list-cb-all").unbind();$("#ccm-"+e+"-list-cb-all").click(function(){ccm_hideMenus();if($(this).prop("checked")==1){$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",!0);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1)}else{$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",!1);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)}});$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]").click(function(t){t.stopPropagation();ccm_hideMenus();ccm_alRescanMultiFileMenu(e)});$("#ccm-"+e+"-search-results td.ccm-file-list-cb").click(function(t){t.stopPropagation();ccm_hideMenus();$(this).find("input[type=checkbox]").click();ccm_alRescanMultiFileMenu(e)});if(ccm_alLaunchType[e]!="DASHBOARD"&&ccm_alLaunchType[e]!="BROWSE"){var t=ccmi18n_filemanager.select;$("#ccm-"+e+"-list-multiple-operations option:eq(0)").after('<option value="choose">'+t+"</option>")}$("#ccm-"+e+"-list-multiple-operations").change(function(){var t=$(this).val(),n=ccm_alGetSelectedFileIDs(e);switch(t){case"choose":var r=new Array;$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){r.push($(this).val())});ccm_alSelectFile(r,!0);break;case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/files/delete?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.deleteFile});break;case"duplicate":jQuery.fn.dialog.open({width:500,height:400,modal:!1,href:CCM_TOOLS_PATH+"/files/duplicate?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.duplicateFile});break;case"sets":jQuery.fn.dialog.open({width:500,height:400,modal:!1,href:CCM_TOOLS_PATH+"/files/add_to?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.sets});break;case"properties":jQuery.fn.dialog.open({width:690,height:440,modal:!1,href:CCM_TOOLS_PATH+"/files/bulk_properties?"+n+"&searchInstance="+e,title:ccmi18n.properties});break;case"rescan":jQuery.fn.dialog.open({width:350,height:200,modal:!1,href:CCM_TOOLS_PATH+"/files/rescan?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.rescan,onClose:function(){$("#ccm-"+e+"-advanced-search").submit()}});break;case"download":window.frames[ccm_alProcessorTarget].location=CCM_TOOLS_PATH+"/files/download?"+n}$(this).get(0).selectedIndex=0});ccm_alSetupFileSetSearch(e)};ccm_alSetupFileSetSearch=function(e){$("#ccm-"+e+"-sets-search-wrapper select").chosen().unbind();$("#ccm-"+e+"-sets-search-wrapper select").chosen().change(function(){var t=$("#ccm-"+e+"-sets-search-wrapper option:selected");$("#ccm-"+e+"-advanced-search").submit()})};ccm_alGetSelectedFileIDs=function(e){var t="";$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){t+="fID[]="+$(this).val()+"&"});return t};ccm_alRescanMultiFileMenu=function(e){$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").length>0?$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1):$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)};ccm_alSetupFileProcessor=function(){if(ccm_alProcessorTarget!="")return!1;var e=parseInt((new Date).getTime().toString().substring(0,10)),t;try{t=document.createElement('<iframe name="ccm-al-upload-processor'+e+'">')}catch(n){t=document.createElement("iframe")}t.id="ccm-al-upload-processor"+e;t.name="ccm-al-upload-processor"+e;t.style.border="0px";t.style.width="0px";t.style.height="0px";t.style.display="none";document.body.appendChild(t);ccm_alDebug?ccm_alProcessorTarget="_blank":ccm_alProcessorTarget="ccm-al-upload-processor"+e};ccm_alSubmitSingle=function(e){if($(e).find(".ccm-al-upload-single-file").val()=="")return!1;$(e).find(".ccm-al-upload-single-submit").hide();$(e).find(".ccm-al-upload-single-loader").show()};ccm_alResetSingle=function(){$(".ccm-al-upload-single-file").val("");$(".ccm-al-upload-single-loader").hide();$(".ccm-al-upload-single-submit").show()};var ccm_uploadedFiles=[];ccm_filesUploadedDialog=function(e){document.getElementById("ccm-file-upload-multiple-tab")&&
jQuery.fn.dialog.closeTop();var t="";for(var n=0;n<ccm_uploadedFiles.length;n++)t=t+"&fID[]="+ccm_uploadedFiles[n];jQuery.fn.dialog.open({width:690,height:440,modal:!1,href:CCM_TOOLS_PATH+"/files/bulk_properties/?"+t+"&uploaded=true&searchInstance="+e,onClose:function(){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})},title:ccmi18n_filemanager.uploadComplete});ccm_uploadedFiles=[]};ccm_alSetupUploadDetailsForm=function(e){$("#ccm-"+e+"-update-uploaded-details-form").submit(function(){ccm_alSubmitUploadDetailsForm(e);return!1})};ccm_alSubmitUploadDetailsForm=function(searchInstance){jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-update-uploaded-details-form").ajaxSubmit(function(r1){var r1a=eval("("+r1+")"),form=$("#ccm-"+searchInstance+"-advanced-search");if(form.length>0)form.ajaxSubmit(function(e){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop();ccm_parseAdvancedSearchResponse(e,searchInstance);ccm_alHighlightFileIDArray(r1a)})});else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop()}})};ccm_alRefresh=function(e,t,n){var r=e;ccm_deactivateSearchResults(t);$("#ccm-"+t+"-search-results").load(CCM_TOOLS_PATH+"/files/search_results",{ccm_order_by:"fvDateAdded",ccm_order_dir:"desc",fileSelector:n,searchType:ccm_alLaunchType[t],searchInstance:t},function(){ccm_activateSearchResults(t);r!=0&&ccm_alHighlightFileIDArray(r);ccm_alSetupSelectFiles(t)})};ccm_alHighlightFileIDArray=function(e){for(i=0;i<e.length;i++){var t=$("tr[fID="+e[i]+"] td"),n=t.css("backgroundColor");t.animate({backgroundColor:"#FFF9BB"},{queue:!0,duration:1e3}).animate({backgroundColor:n},500)}};ccm_alSelectFile=function(e){if(typeof ccm_chooseAsset=="function"){var t="";if(typeof e=="object")for(i=0;i<e.length;i++)t+="fID[]="+e[i]+"&";else t+="fID="+e;$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?"+t,function(e){ccm_parseJSON(e,function(){for(i=0;i<e.length;i++)ccm_chooseAsset(e[i]);jQuery.fn.dialog.closeTop()})})}else{if(typeof e=="object")for(i=0;i<e.length;i++)ccm_triggerSelectFile(e[i]);else ccm_triggerSelectFile(e);jQuery.fn.dialog.closeTop()}};ccm_alActivateMenu=function(e,t){var n=$(e).find("div[ccm-file-manager-field]"),r="";n.length>0&&(r=n.attr("ccm-file-manager-field"));r||(r=ccm_alActiveAssetField);ccm_hideMenus();var i=$(e).attr("fID"),s=$(e).attr("ccm-file-manager-instance"),o=document.getElementById("ccm-al-menu"+i+s+r);if(!o){el=document.createElement("DIV");el.id="ccm-al-menu"+i+s+r;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);var u=$("div[ccm-file-manager-field="+r+"] input.ccm-file-manager-filter"),a="";u.length>0&&u.each(function(){a+="&"+$(this).attr("name")+"="+$(this).attr("value")});var f=$(e).attr("al-filepath");o=$("#ccm-al-menu"+i+s+r);o.css("position","absolute");var l='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';l+="<ul>";if(ccm_alLaunchType[s]!="DASHBOARD"&&ccm_alLaunchType[s]!="BROWSE"){var c=n.length>0?"ccm_alLaunchSelectorFileManager('"+r+"')":"ccm_alSelectFile("+i+")",h=n.length>0?ccmi18n_filemanager.chooseNew:ccmi18n_filemanager.select;l+='<li><a class="ccm-menu-icon ccm-icon-choose-file-menu" dialog-modal="false" dialog-width="90%" dialog-height="70%" dialog-title="'+ccmi18n_filemanager.select+'" id="menuSelectFile'+i+'" href="javascript:void(0)" onclick="'+c+'">'+h+"</a></li>"}n.length>0&&(l+='<li><a class="ccm-menu-icon ccm-icon-clear-file-menu" href="javascript:void(0)" id="menuClearFile'+i+s+r+'">'+ccmi18n_filemanager.clear+"</a></li>");ccm_alLaunchType[s]!="DASHBOARD"&&ccm_alLaunchType[s]!="BROWSE"&&n.length>0&&(l+='<li class="ccm-menu-separator"></li>');$(e).attr("ccm-file-manager-can-view")=="1"?l+='<li><a class="ccm-menu-icon ccm-icon-view dialog-launch" dialog-modal="false" dialog-append-buttons="true" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.view+'" id="menuView'+i+'" href="'+CCM_TOOLS_PATH+"/files/view?fID="+i+'">'+ccmi18n_filemanager.view+"</a></li>":l+='<li><a class="ccm-menu-icon ccm-icon-download-menu" href="javascript:void(0)" id="menuDownload'+i+'" onclick="window.frames[\''+ccm_alProcessorTarget+"'].location='"+CCM_TOOLS_PATH+"/files/download?fID="+i+"'\">"+ccmi18n_filemanager.download+"</a></li>";$(e).attr("ccm-file-manager-can-edit")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-edit-menu dialog-launch" dialog-modal="false" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.edit+'" id="menuEdit'+i+'" href="'+CCM_TOOLS_PATH+"/files/edit?searchInstance="+s+"&fID="+i+a+'">'+ccmi18n_filemanager.edit+"</a></li>");l+='<li><a class="ccm-menu-icon ccm-icon-properties-menu dialog-launch" dialog-modal="false" dialog-width="680" dialog-height="450" dialog-title="'+ccmi18n_filemanager.properties+'" id="menuProperties'+i+'" href="'+CCM_TOOLS_PATH+"/files/properties?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.properties+"</a></li>";$(e).attr("ccm-file-manager-can-replace")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-replace dialog-launch" dialog-modal="false" dialog-width="300" dialog-height="260" dialog-title="'+ccmi18n_filemanager.replace+'" id="menuFileReplace'+i+'" href="'+CCM_TOOLS_PATH+"/files/replace?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.replace+"</a></li>");$(e).attr("ccm-file-manager-can-duplicate")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-copy-menu" id="menuFileDuplicate'+i+'" href="javascript:void(0)" onclick="ccm_alDuplicateFile('+i+",'"+s+"')\">"+ccmi18n_filemanager.duplicate+"</a></li>");l+='<li><a class="ccm-menu-icon ccm-icon-sets dialog-launch" dialog-modal="false" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.sets+'" id="menuFileSets'+i+'" href="'+CCM_TOOLS_PATH+"/files/add_to?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.sets+"</a></li>";if($(e).attr("ccm-file-manager-can-admin")=="1"||$(e).attr("ccm-file-manager-can-delete")=="1")l+='<li class="ccm-menu-separator"></li>';$(e).attr("ccm-file-manager-can-admin")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-access-permissions dialog-launch" dialog-modal="false" dialog-width="400" dialog-height="450" dialog-title="'+ccmi18n_filemanager.permissions+'" id="menuFilePermissions'+i+'" href="'+CCM_TOOLS_PATH+"/files/permissions?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.permissions+"</a></li>");$(e).attr("ccm-file-manager-can-delete")=="1"&&(l+='<li><a class="ccm-icon-delete-menu ccm-menu-icon dialog-launch" dialog-append-buttons="true" dialog-modal="false" dialog-width="500" dialog-height="200" dialog-title="'+ccmi18n_filemanager.deleteFile+'" id="menuDeleteFile'+i+'" href="'+CCM_TOOLS_PATH+"/files/delete?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.deleteFile+"</a></li>");l+="</ul>";l+="</div></div></div>";o.append(l);$(o).find("a").bind("click.hide-menu",function(e){ccm_hideMenus();return!1});$("#ccm-al-menu"+i+s+r+" a.dialog-launch").dialog();$("a#menuClearFile"+i+s+r).click(function(e){ccm_clearFile(e,r);ccm_hideMenus()})}else o=$("#ccm-al-menu"+i+s+r);ccm_fadeInMenu(o,t)};ccm_alSelectNone=function(){ccm_hideMenus()};var checkbox_status=!1;toggleCheckboxStatus=function(e){if(checkbox_status){for(i=0;i<e.elements.length;i++)e.elements[i].type=="checkbox"&&(e.elements[i].checked=!1);checkbox_status=!1}else{for(i=0;i<e.elements.length;i++)e.elements[i].type=="checkbox"&&(e.elements[i].checked=!0);checkbox_status=!0}};ccm_alDuplicateFile=function(fID,searchInstance){var postStr="fID="+fID+"&searchInstance="+searchInstance;$.post(CCM_TOOLS_PATH+"/files/duplicate",postStr,function(resp){var r=eval("("+resp+")");if(r.error==1){ccmAlert.notice(ccmi18n.error,r.message);return!1}var highlight=new Array;if(r.fID){highlight.push(r.fID);ccm_alRefresh(highlight,searchInstance);ccm_uploadedFiles.push(r.fID);ccm_filesUploadedDialog(searchInstance)}})};ccm_alSelectMultipleIncomingFiles=function(e){$(e).prop("checked")?$("input.ccm-file-select-incoming").attr("checked",!0):$("input.ccm-file-select-incoming").attr("checked",!1)};ccm_starFile=function(e,t){var n="";if($(e).attr("src").indexOf(CCM_STAR_STATES.unstarred)!=-1){$(e).attr("src",$(e).attr("src").replace(CCM_STAR_STATES.unstarred,CCM_STAR_STATES.starred));n="star"}else{$(e).attr("src",$(e).attr("src").replace(CCM_STAR_STATES.starred,CCM_STAR_STATES.unstarred));n="unstar"}$.post(CCM_TOOLS_PATH+"/"+CCM_STAR_ACTION,{action:n,"file-id":t},function(e,t){})};jQuery.cookie=function(e,t,n){if(typeof t=="undefined"){var a=null;if(document.cookie&&document.cookie!=""){var f=document.cookie.split(";");for(var l=0;l<f.length;l++){var c=jQuery.trim(f[l]);if(c.substring(0,e.length+1)==e+"="){a=decodeURIComponent(c.substring(e.length+1));break}}}return a}n=n||{};if(t===null){t="";n=$.extend({},n);n.expires=-1}var r="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){var i;if(typeof n.expires=="number"){i=new Date;i.setTime(i.getTime()+n.expires*24*60*60*1e3)}else i=n.expires;r="; expires="+i.toUTCString()}var s=n.path?"; path="+n.path:"",o=n.domain?"; domain="+n.domain:"",u=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),r,s,o,u].join("")};var CCMPanel=function(e){this.options=e;this.isOpen=!1;this.detail=!1;this.url=!1;this.getPositionClass=function(){switch(e.position){case"left":var t="ccm-panel-left";break;case"right":var t="ccm-panel-right"}switch(e.transition){case"slide":t+=" ccm-panel-transition-slide";break;default:t+=" ccm-panel-transition-none"}return t};this.setURL=function(e){this.url=e};this.getURL=function(){return this.url};this.getIdentifier=function(){return this.options.identifier};this.getDOMID=function(){return"ccm-panel-"+this.options.identifier.replace("/","-")};this.onPanelLoad=function(){this.setupPanelDetails();this.setupSubPanels();ccm_event.publish("panel.open",this)};this.hide=function(){var e=this.closePanelDetail();e||(e=0);var t=this;$(window).delay(e).queue(function(){$("[data-launch-panel='"+t.getIdentifier()+"']").removeClass("ccm-launch-panel-active");$("#"+t.getDOMID()).removeClass("ccm-panel-active");$("#ccm-panel-overlay").queue(function(){$(this).removeClass("ccm-panel-translucent");$(this).dequeue()}).delay(1e3).hide(0);$("html").removeClass(t.getPositionClass());t.isOpen=!1;$(this).dequeue()})};this.toggle=function(){this.isOpen?this.hide():this.show()};this.setupSubPanels=function(){var e=$("#"+this.getDOMID()),t=this;e.find("[data-launch-sub-panel-url]").unbind(".sub").on("click.sub",function(){var n=$(this).attr("data-launch-sub-panel-url");$("<div />",{"class":"ccm-panel-content ccm-panel-content-appearing"}).appendTo(e.find(".ccm-panel-content-wrapper")).load(n+"?cID="+CCM_CID,function(n){e.find(".ccm-panel-content-visible").removeClass("ccm-panel-content-visible").addClass("ccm-panel-slide-left");$(this).removeClass("ccm-panel-content-appearing").addClass("ccm-panel-content-visible");t.onPanelLoad()});return!1});e.find("[data-panel-navigation=back]").on("click.navigate",function(){t.closePanelDetailImmediately();$(this).queue(function(){var t=e.find(".ccm-panel-content-visible").prev();e.find(".ccm-panel-content-visible").removeClass("ccm-panel-content-visible").addClass("ccm-panel-slide-right");t.removeClass("ccm-panel-slide-left").addClass("ccm-panel-content-visible");$(this).dequeue()}).delay(500).queue(function(){e.find(".ccm-panel-slide-right").remove();$(this).dequeue()});return!1})};this.closePanelDetail=function(){if(!this.detail)return!1;$("a[data-launch-panel-detail="+this.detail.identifier+"]").removeClass("ccm-panel-menu-item-active");var e=this.detail.transition;$("div.ccm-panel-detail").queue(function(){$(this).removeClass("ccm-panel-detail-transition-"+e+"-apply");$(this).dequeue()}).delay(550).queue(function(){$(this).remove();$(this).dequeue()});$("div.ccm-page").queue(function(){$(this).removeClass("ccm-panel-detail-transition-"+e+"-apply");$(this).dequeue()}).delay(550).queue(function(){$("html").removeClass("ccm-panel-detail-open");$(this).addClass("ccm-panel-detail-disable-transition");$(this).dequeue()}).delay(1).queue(function(){$(this).removeClass("ccm-panel-detail-transition-"+e);$(this).dequeue()}).delay(1).queue(function(){$(this).removeClass("ccm-panel-detail-disable-transition");$(this).dequeue()});$("#ccm-panel-detail-form-actions-wrapper .ccm-panel-detail-form-actions").queue(function(){$(this).css("opacity",0);$(this).dequeue(0)}).delay(550).queue(function(){$(this).remove();$(this).dequeue()});ccm_event.publish("panel.closeDetail",this.detail);this.detail=!1;if($(".ccm-panel-detail").length>0)return 550};this.closePanelDetailImmediately=function(){if(!this.detail)return!1;$(".ccm-panel-detail").remove();$(".ccm-panel-detail-form-actions").remove();$(".ccm-page").removeClass().addClass("ccm-page");ccm_event.publish("panel.closeDetail",this.detail);this.detail=!1};this.openPanelDetail=function(e){var t=this,e=$.extend({transition:"none",url:!1,data:""},e),n=e.identifier;t.detail;t.detail&&t.closePanelDetailImmediately();t.detail=e;var r="ccm-panel-detail-"+n;$detail=$("<div />",{id:r,"class":"ccm-panel-detail"}).appendTo(document.body);$content=$("<div />",{"class":"ccm-panel-detail-content"}).appendTo($detail);$("div.ccm-page").queue(function(){$detail.addClass("ccm-panel-detail-transition-"+e.transition);$(this).addClass("ccm-panel-detail-transition-"+e.transition);$(this).dequeue()}).delay(3).queue(function(){$detail.addClass("ccm-panel-detail-transition-"+e.transition+"-apply");$(this).addClass("ccm-panel-detail-transition-"+e.transition+"-apply");$(this).dequeue()});$("html").addClass("ccm-panel-detail-open");$content.load(e.url+"?cID="+CCM_CID+e.data,function(){jQuery.fn.dialog.hideLoader();t.loadPanelDetailActions($content)});ccm_event.publish("panel.openDetail",t)};this.loadPanelDetailActions=function(e){var t=this,n=e.find(".ccm-panel-detail-form-actions");if(n.length){$(document.body).delay(500).queue(function(){var e=$("#ccm-panel-detail-form-actions-wrapper");e.length||(e=$("<div />",{id:"ccm-panel-detail-form-actions-wrapper","class":"ccm-ui"}));e.appendTo(document.body);n.appendTo(e);$(this).dequeue()}).delay(5).queue(function(){$("#ccm-panel-detail-form-actions-wrapper .ccm-panel-detail-form-actions").css("opacity",1);$(this).dequeue()});$("button[data-panel-detail-action=cancel]").on("click",function(){t.closePanelDetail()});$("button[data-panel-detail-action=submit]").on("click",function(){$("[data-panel-detail-form]").ajaxSubmit({type:"post",dataType:"json",beforeSubmit:function(){jQuery.fn.dialog.showLoader()},error:function(e){ccmAlert.notice("Error",'<div class="alert alert-danger">'+e.responseText+"</div>")},success:function(e){if(e.error)ccmAlert.notice("Error",'<div class="alert alert-danger">'+e.errors.join("<br>")+"</div>");else if(e.redirectURL)window.location.href=e.redirectURL;else{CCMEditMode.showResponseNotification(e.message,"ok","success");CCMPanelManager.exitPanelMode()}},complete:function(){jQuery.fn.dialog.hideLoader()}})})}};this.setupPanelDetails=function(){var e=$("#"+this.getDOMID()),t=this;e.find("[data-panel-menu=accordion]").each(function(){var n=$(this),r=$(this).find(">nav>span");r.text($(this).find("a[data-panel-accordion-tab-selected=true]").text());r.on("click.accordion",function(){n.toggleClass("ccm-panel-header-accordion-dropdown-visible")});$(this).find(">nav ul a").on("click.accordion",function(){var i=t.options.url,s=e.find(".ccm-panel-content");n.removeClass("ccm-panel-header-accordion-dropdown-visible");r.html($(this).text());s.load(i+"?cID="+CCM_CID+"&tab="+$(this).attr("data-panel-accordion-tab"),function(){t.onPanelLoad()})})});e.find("[data-panel-menu=collapsible-list-group]").each(function(){var e=$(this);e.find(".list-group-item-collapse").on("click",function(){var t=e.find(".list-group-item-collapse-wrapper"),n=e.attr("data-panel-menu-id"),r=e.find(".list-group-item-collapse span"),i=t.height();if(e.hasClass("ccm-panel-list-group-item-expanded")){r.text(ccmi18n.expand);ccm_event.publish("collapse."+n);t.queue(function(){$(this).css("height",0);$(this).dequeue()}).delay(305).queue(function(){$(this).hide();$(this).css("height","auto");$(this).dequeue()})}else{ccm_event.publish("expand."+n);r.text(ccmi18n.collapse);t.queue(function(){$(this).css("height",0);$(this).show();$(this).dequeue()}).delay(5).queue(function(){$(this).css("height",i);$(this).dequeue()})}e.toggleClass("ccm-panel-list-group-item-expanded")})});e.find("[data-launch-panel-detail]").unbind(".detail").on("click.detail",function(){jQuery.fn.dialog.showLoader();$(".ccm-panel-menu-item-active").removeClass("ccm-panel-menu-item-active");$(this).addClass("ccm-panel-menu-item-active");var e=$(this).attr("data-launch-panel-detail"),n={identifier:e};$(this).attr("data-panel-transition")&&(n.transition=$(this).attr("data-panel-transition"));$(this).attr("data-panel-detail-url")&&(n.url=$(this).attr("data-panel-detail-url"));t.openPanelDetail(n);return!1});t.loadPanelDetailActions(e)};this.show=function(){var e=0;if(this.options.primary){var t=CCMPanelManager.getPanels();for(i=0;i<t.length;i++){var n=t[i];n.getIdentifier()!=this.getIdentifier()&&n.isOpen&&(e=n.hide())}}obj=this;$(window).delay(e).queue(function(){var e=$("#"+obj.getDOMID());e.find(".ccm-panel-content-wrapper").html("");e.addClass("ccm-panel-active ccm-panel-loading");$("<div />",{"class":"ccm-panel-content ccm-panel-content-visible"}).appendTo(e.find(".ccm-panel-content-wrapper")).load(obj.getURL()+"?cID="+CCM_CID,function(){e.delay(1).queue(function(){$(this).removeClass("ccm-panel-loading").addClass("ccm-panel-loaded");$(this).dequeue()});obj.onPanelLoad()});CCMPanelManager.showOverlay(obj.options.translucent);$("[data-launch-panel='"+obj.getIdentifier()+"']").addClass("ccm-launch-panel-active");$("html").addClass(obj.getPositionClass());obj.isOpen=!0;$(this).dequeue()})}},CCMPanelManager=function(){var e=new Array;return{getPanels:function(){return e},showOverlay:function(e){$("#ccm-panel-overlay").clearQueue().show(0).delay(100).queue(function(){e?$(this).addClass("ccm-panel-translucent"):$(this).removeClass("ccm-panel-translucent");$(this).dequeue()})},exitPanelMode:function(){for(i=0;i<e.length;i++)e[i].isOpen&&e[i].hide();CCMEditMode.exitPreviewMode()},register:function(t){var t=$.extend({translucent:!0,position:"left",primary:!0,transition:"slide"},t),n=new CCMPanel(t);e.push(n);$("<div />",{id:n.getDOMID(),"class":"ccm-panel "+n.getPositionClass()}).appendTo($(document.body));$stage=$("<div />",{"class":"ccm-panel-content-wrapper ccm-ui"}).appendTo($("#"+n.getDOMID()));$("<div />",{"class":"ccm-panel-shadow-layer"}).appendTo($("#"+n.getDOMID()))},getByIdentifier:function(t){for(i=0;i<e.length;i++)if(e[i].getIdentifier()==t)return e[i]}}}();$.widget.bridge("jqdialog",$.ui.dialog);jQuery.fn.dialog=function(){if(arguments.length>0){$(this).jqdialog(arguments[0],arguments[1],arguments[2]);return}if($(this).is("div")){$(this).jqdialog();return}return $(this).each(function(){$(this).unbind("click.make-dialog").bind("click.make-dialog",function(e){var t=$(this).attr("href"),n=$(this).attr("dialog-width"),r=$(this).attr("dialog-height"),i=$(this).attr("dialog-title"),s=$(this).attr("dialog-on-open"),o=$(this).attr("dialog-on-destroy"),u=$(this).attr("dialog-on-close"),a=$(this).attr("dialog-on-direct-close");obj={modal:!0,href:t,width:n,height:r,title:i,onOpen:s,onDestroy:o,onClose:u,onDirectClose:a};jQuery.fn.dialog.open(obj);return!1})})};jQuery.fn.dialog.close=function(e){e++;$("#ccm-dialog-content"+e).jqdialog("close")};jQuery.fn.dialog.open=function(options){typeof $.fn.ccmmenu!="undefined"&&$.fn.ccmmenu.hide();if(typeof options.width=="string")if(options.width=="auto")w="auto";else if(options.width.indexOf("%",0)>0){w=options.width.replace("%","");w=$(window).width()*(w/100);w+=50}else w=parseInt(options.width)+50;else options.width?w=parseInt(options.width)+50:w=550;if(typeof options.height=="string")if(options.height=="auto")h="auto";else if(options.height.indexOf("%",0)>0){h=options.height.replace("%","");h=$(window).height()*(h/100);h+=100}else h=parseInt(options.height)+100;else options.height?h=parseInt(options.height)+100:h=400;h!=="auto"&&h>$(window).height()&&(h=$(window).height());options.width=w;options.height=h;var defaults={modal:!0,escapeClose:!0,width:w,height:h,create:function(){$(this).parent().addClass("ccm-dialog-opening")},open:function(){var $dialog=$(this);$dialog.parent().addClass("ccm-dialog-open");var nd=$(".ui-dialog").length;if(nd==1){$("body").attr("data-last-overflow",$("body").css("overflow"));$("body").css("overflow","hidden")}var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(e,t){e+1<overlays&&$(this).css("opacity",0)});jQuery.fn.dialog.activateDialogContents($dialog);typeof options.onOpen!="undefined"&&(typeof options.onOpen=="function"?options.onOpen($dialog):eval(options.onOpen))},beforeClose:function(){var e=$(".ui-dialog").length;e==1&&$("body").css("overflow",$("body").attr("data-last-overflow"))},close:function(ev,u){options.element||$(this).jqdialog("destroy").remove();typeof options.onClose!="undefined"&&(typeof options.onClose=="function"?options.onClose():eval(options.onClose));typeof options.onDirectClose!="undefined"&&ev.handleObj&&(ev.handleObj.type=="keydown"||ev.handleObj.type=="click")&&(typeof options.onDirectClose=="function"?options.onDirectClose():eval(options.onDirectClose));typeof options.onDestroy!="undefined"&&(typeof options.onDestroy=="function"?options.onDestroy():eval(options.onDestroy));var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(e,t){e+1<overlays?$(this).css("opacity",0):$(this).css("opacity",1)})}},finalSettings={autoOpen:!1};$.extend(finalSettings,defaults,options);if(finalSettings.element){$(finalSettings.element).jqdialog(finalSettings).jqdialog();$(finalSettings.element).jqdialog("open")}else{jQuery.fn.dialog.showLoader();$.ajax({type:"GET",url:finalSettings.href,success:function(e){jQuery.fn.dialog.hideLoader();$("<div />").jqdialog(finalSettings).html(e).jqdialog("open")}})}};jQuery.fn.dialog.activateDialogContents=function(e){if(e.find(".dialog-buttons").length>0){e.jqdialog("option","buttons",[{}]);e.parent().find(".ui-dialog-buttonset").remove();e.parent().find(".ui-dialog-buttonpane").html("");e.find(".dialog-buttons").appendTo(e.parent().find(".ui-dialog-buttonpane").addClass("ccm-ui"))}e.find(".dialog-launch").dialog();e.find(".ccm-dialog-close").on("click",function(){e.dialog("close")});$("#tooltip-holder").length==0&&$("<div />").attr("id","tooltip-holder").attr("class","ccm-ui").prependTo(document.body);if(e.find(".dialog-help").length>0){e.find(".dialog-help").hide();var t=e.find(".dialog-help").html();if(ccmi18n.helpPopup)var n=ccmi18n.helpPopup;else var n="Help";e.parent().find(".ui-dialog-titlebar").addClass("ccm-ui").append('<button class="ui-dialog-titlebar-help ccm-menu-help-trigger"><i class="icon-info-sign"></i></button>');e.parent().find(".ui-dialog-titlebar .ccm-menu-help-trigger").popover({content:function(){return t},placement:"bottom",html:!0,container:"#tooltip-holder",trigger:"click"})}};jQuery.fn.dialog.getTop=function(){var e=$(".ui-dialog:visible").length;return $($(".ui-dialog:visible")[e-1]).find(".ui-dialog-content")};jQuery.fn.dialog.replaceTop=function(e){$dialog=jQuery.fn.dialog.getTop();$dialog.html(e);jQuery.fn.dialog.activateDialogContents($dialog)};jQuery.fn.dialog.showLoader=function(e){$("body").addClass("ccm-loading")};jQuery.fn.dialog.hideLoader=function(){$("body").removeClass("ccm-loading")};jQuery.fn.dialog.closeTop=function(){$dialog=jQuery.fn.dialog.getTop();$dialog.jqdialog("close")};jQuery.fn.dialog.closeAll=function(){$($(".ui-dialog-content").get().reverse()).jqdialog("close")};var ccmAlert={notice:function(e,t,n){$.fn.dialog.open({href:CCM_TOOLS_PATH+"/alert",title:e,width:320,height:160,modal:!1,onOpen:function(){$("#ccm-popup-alert-message").html(t)},onDestroy:n})},hud:function(e,t,n,r){if(r==null)var i=e;else var i="<strong>"+r+"</strong><br/><br/>"+e;if(n==null)var n="pencil";var s="info";CCMEditMode.showResponseNotification(i,n,s)}};ccm_closeNewsflow=function(e){$ovl=ccm_getNewsflowOverlayWindow();$ovl.fadeOut(300,"easeOutExpo");$(".ui-widget-overlay").fadeOut(300,"easeOutExpo",function(){$(this).remove()})};ccm_setNewsflowPagingArrowHeight=function(){if($("#ccm-marketplace-detail").length>0)var e=$("#ccm-marketplace-detail");else var e=$("#newsflow-main");var t=e.height();$(".newsflow-paging-previous a, .newsflow-paging-next a").css("height",t+"px");$(".newsflow-paging-previous, .newsflow-paging-next").css("height",t+"px");$(".newsflow-paging-next").show();$(".newsflow-paging-previous").show()};ccm_setNewsflowOverlayDimensions=function(){if($("#newsflow-overlay").length>0){var e=$("#newsflow-overlay").width(),t=$(window).width(),n=$(window).height(),r=650,i=n-80;i>r?h=r:h=i;$("#newsflow-overlay").css("height",r);var s=(t-e)/2,o=(n-h)/2;o+=29;s+="px";o+="px";$("#newsflow-overlay").css("left",s).css("top",o)}};ccm_getNewsflowOverlayWindow=function(){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0&&$("#newsflow-overlay").length==0)var e=$("#newsflow-main").parent();else if($("#newsflow-overlay").length>0)var e=$("#newsflow-overlay");else var e=$("<div />").attr("id","newsflow-overlay").attr("class","ccm-ui").css("display","none").appendTo(document.body);return e};ccm_showNewsflowOverlayWindow=function(e,t){if(!($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0)){if($(".ui-widget-overlay").length<1)var n=$('<div class="ui-widget-overlay"></div>').hide().appendTo("body");$(".ui-widget-overlay").show()}$(window).resize(function(){ccm_setNewsflowOverlayDimensions()});$ovl=ccm_getNewsflowOverlayWindow();$ovl.load(e,function(){$ovl.hide();$(".newsflow-paging-next").hide();$(".newsflow-paging-previous").hide();$ovl.html($(this).html());t&&t();ccm_setNewsflowOverlayDimensions();ccm_setupTrickleUpNewsflowStyles();$ovl.fadeIn("300","easeOutExpo",function(){ccm_setNewsflowPagingArrowHeight()})})};ccm_setupTrickleUpNewsflowStyles=function(){ovl=ccm_getNewsflowOverlayWindow();ovl.find(".newsflow-em1").each(function(){$(this).parent().addClass("newsflow-em1")})};ccm_showDashboardNewsflowWelcome=function(){jQuery.fn.dialog.showLoader(ccmi18n.newsflowLoading);ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/home?_ccm_dashboard_external=1",function(){jQuery.fn.dialog.hideLoader()})};ccm_showNewsflowOffsite=function(e){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cID="+e,function(){jQuery.fn.dialog.hideLoader()})};ccm_showAppIntroduction=function(){ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/welcome?_ccm_dashboard_external=1")};ccm_getNewsflowByPath=function(e){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cPath="+e,function(){jQuery.fn.dialog.hideLoader()})};ccm_doPageReindexing=function(){$.get(CCM_TOOLS_PATH+"/reindex_pending_pages?ccm_token="+CCM_SECURITY_TOKEN)};$.fn.ccmmenu=function(){$.fn.ccmmenu.enable();return $.each($(this),function(e,t){var n=$(t),r;if(!n.prop("has-menu")){n.prop("has-menu",!0);n.attr("data-menu-handle")?r=$(n.attr("data-menu-handle")):r=n;var i=$("#"+n.attr("data-menu"));n.$menu=i;n.highlightClass=n.attr("data-menu-highlight-class");n.highlightOffset=9;n.attr("data-menu-highlight-offset")&&(n.highlightOffset=n.attr("data-menu-highlight-offset"));n.menuClass=n.attr("data-menu-class");r.on("mousemove.ccmmenu",function(e){$.fn.ccmmenu.over(e,n,$(this))})}})};$.fn.ccmmenu.resetHighlight=function(){$.fn.ccmmenu.$highlighter.hide();$("[data-menu-highlight-class]").each(function(){var e=$(this).attr("data-menu-highlight-class");$("."+e).removeClass(e)})};$.fn.ccmmenu.highlight=function(e){var t=e.offset(),n=t.top-$.fn.ccmmenu.$overmenu.highlightOffset,r=t.left-$.fn.ccmmenu.$overmenu.highlightOffset,i=e.outerWidth()+$.fn.ccmmenu.$overmenu.highlightOffset*2,s=e.outerHeight()+$.fn.ccmmenu.$overmenu.highlightOffset*2;$.fn.ccmmenu.$highlighter.css("width",i).css("height",s).css("top",n).css("left",r).css("border-top-left-radius",e.css("border-top-left-radius")).css("border-bottom-left-radius",e.css("border-bottom-left-radius")).css("border-top-right-radius",e.css("border-top-right-radius")).css("border-bottom-right-radius",e.css("border-bottom-right-radius")).removeClass().addClass($.fn.ccmmenu.$overmenu.highlightClass);$.fn.ccmmenu.$highlighter.show()};$.fn.ccmmenu.out=function(e){if(!$.fn.ccmmenu.isactive){$.fn.ccmmenu.$proxy.css("opacity",0);$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$(".ccm-menu-item-active").removeClass("ccm-menu-item-active")}};$.fn.ccmmenu.reset=function(){$.fn.ccmmenu.disable();$.fn.ccmmenu.enable()};$.fn.ccmmenu.enable=function(){$.fn.ccmmenu.isenabled=!0;$("#ccm-menu-click-proxy").length==0?$(document.body).append($("<div />",{id:"ccm-menu-click-proxy"})):$("#ccm-menu-click-proxy").css("width",0).css("height",0).css("top",0).css("left",0);$("#ccm-menu-highlighter").length==0?$(document.body).append($("<div />",{id:"ccm-menu-highlighter"})):$("#ccm-menu-highlighter").css("width",0).css("height",0).css("top",0).css("left",0);$("#ccm-popover-menu-container").length==0&&$(document.body).append($("<div />",{id:"ccm-popover-menu-container","class":"ccm-ui"}));$.fn.ccmmenu.$proxy=$("#ccm-menu-click-proxy");$.fn.ccmmenu.$highlighter=$("#ccm-menu-highlighter");$.fn.ccmmenu.$holder=$("#ccm-popover-menu-container");$.fn.ccmmenu.$proxy.on("mouseout.clickproxy",function(e){$.fn.ccmmenu.out(e)});$.fn.ccmmenu.$proxy.on("mouseover.clickproxy",function(e){$.fn.ccmmenu.over(e)});$.fn.ccmmenu.$proxy.unbind("click.clickproxy").on("click.clickproxy",function(e){$.fn.ccmmenu.$proxy.addClass($.fn.ccmmenu.$overmenu.menuClass);$.fn.ccmmenu.showmenu(e,$.fn.ccmmenu.$overmenu.$menu);$.fn.ccmmenu.highlight($.fn.ccmmenu.$overmenu);$.fn.ccmmenu.$overmenu.addClass($.fn.ccmmenu.$overmenu.highlightClass)})};$.fn.ccmmenu.disable=function(){$.fn.ccmmenu.out();$.fn.ccmmenu.isenabled=!1;$.fn.ccmmenu.$proxy.remove();$.fn.ccmmenu.resetHighlight()};$.fn.ccmmenu.over=function(e,t,n){if($.fn.ccmmenu.isenabled&&!$.fn.ccmmenu.isactive){$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");if(n){var r=n.offset(),i=r.top-5,s=r.left-5,o=n.outerWidth()+10,u=n.outerHeight()+10;$.fn.ccmmenu.$proxy.css("width",o).css("height",u).css("top",i).css("left",s).css("border-top-left-radius",n.css("border-top-left-radius")).css("border-bottom-left-radius",n.css("border-bottom-left-radius")).css("border-top-right-radius",n.css("border-top-right-radius")).css("border-bottom-right-radius",n.css("border-bottom-right-radius")).addClass(t.menuClass);$.fn.ccmmenu.$overmenu=t}$.fn.ccmmenu.$overmenu.addClass("ccm-menu-item-active");$.fn.ccmmenu.$overmenu.parent().addClass("ccm-parent-menu-item-active")}};$.fn.ccmmenu.hide=function(e){e&&e.stopPropagation();if($.fn.ccmmenu.$proxy){$.fn.ccmmenu.isactive=!1;$.fn.ccmmenu.$proxy.css("opacity",0);$.fn.ccmmenu.resetHighlight();$.fn.ccmmenu.$holder.html("");$(".ccm-menu-item-active").removeClass("ccm-menu-item-active");$(".ccm-parent-menu-item-active").removeClass("ccm-parent-menu-item-active");$(document).unbind("click.disableccmmenu");$("div.popover").css("opacity",0).hide()}};$.fn.ccmmenu.showmenu=function(e,t){e.stopPropagation();$.fn.ccmmenu.isactive&&$("div.popover").css("opacity",0).hide();$.fn.ccmmenu.isactive=!0;var n=t.clone(!0,!0);n.addClass($.fn.ccmmenu.$overmenu.menuClass);n.appendTo($.fn.ccmmenu.$holder);n.find(".dialog-launch").dialog();var r=e.pageX+2,i=e.pageY+2;n.css("opacity",0).show();var s=n.height(),o=n.width();if($(window).height()<e.clientY+s+30){i=i-s-10;r-=o/2;n.removeClass("bottom");n.addClass("top")}else{r-=o/2;i+=10;n.removeClass("top");n.addClass("bottom")}n.css("top",i+"px");n.css("left",r+"px");n.show().css("opacity",1);n.find("a").click(function(e){$.fn.ccmmenu.hide(e)});$(document).on("click.disableccmmenu",function(e){$.fn.ccmmenu.hide(e)})};String.prototype.score=function(e,t){t=t||0;if(e.length==0)return.9;if(e.length>this.length)return 0;for(var n=e.length;n>0;n--){var r=e.substring(0,n),i=this.indexOf(r);if(i<0)continue;if(i+e.length>this.length+t)continue;var s=this.substring(i+r.length),o=null;n>=e.length?o="":o=e.substring(n);var u=s.score(o,t+i);if(u>0){var a=this.length-s.length;if(i!=0){var f=0,l=this.charCodeAt(i-1);if(l==32||l==9)for(var f=i-2;f>=0;f--){l=this.charCodeAt(f);a-=l==32||l==9?1:.15}else a-=i}a+=u*s.length
;a/=this.length;return a}}return 0};ccm_openThemeLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/themes",width:"905",modal:!1,height:"410"})},"open_theme_launcher")};ccm_testMarketplaceConnection=function(e,t,n){n?mpIDStr="&mpID="+n:mpIDStr="";t||(t="");params={mpID:n};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(n){if(!n.isConnected){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task="+t+mpIDStr,width:"90%",modal:!1,height:"70%"});return!1}e()})};ccm_openAddonLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/add-ons",width:"905",modal:!1,height:"410"})},"open_addon_launcher")};ccm_setupMarketplaceDialogForm=function(){$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))});$(".ccm-pane-dialog-pagination a").click(function(){jQuery.fn.dialog.showLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").load($(this).attr("href"),function(){jQuery.fn.dialog.hideLoader()});return!1});ccm_marketplaceBrowserInit();$("#ccm-marketplace-browser-form").ajaxForm({beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(e){jQuery.fn.dialog.hideLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").html(e)}})};ccm_marketplaceBrowserInit=function(){$(".ccm-marketplace-item").click(function(){ccm_getMarketplaceItemDetails($(this).attr("mpID"))});$(".ccm-marketplace-item-thumbnail").mouseover(function(){var e=$(this).parent().find("div.ccm-marketplace-results-image-hover").clone().addClass("ccm-marketplace-results-image-hover-displayed").appendTo(document.body),t=$(this).offset().top,n=$(this).offset().left;n+=60;e.css("top",t).css("left",n);e.show()});$(".ccm-marketplace-item-thumbnail").mouseout(function(){$(".ccm-marketplace-results-image-hover-displayed").hide().remove()})};ccm_getMarketplaceItemDetails=function(e){jQuery.fn.dialog.showLoader();$("#ccm-intelligent-search-results").hide();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/details?mpID="+e,width:820,appendButtons:!0,modal:!1,height:640})},"get_item_details",e)};ccm_getMarketplaceItem=function(e){var t=e.mpID,n=e.closeTop;this.onComplete=function(){};e.onComplete&&(ccm_getMarketplaceItem.onComplete=e.onComplete);n&&jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();params={mpID:t};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(e){jQuery.fn.dialog.hideLoader();e.isConnected?e.purchaseRequired?$.fn.dialog.open({title:ccmi18n.communityCheckout,iframe:!0,href:CCM_TOOLS_PATH+"/marketplace/checkout?mpID="+t,width:"560px",modal:!1,height:"400px"}):$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/download?install=1&mpID="+t,width:500,appendButtons:!0,modal:!1,height:400}):$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task=get&mpID="+t,width:"90%",modal:!1,height:"70%"})})};ccm_triggerProgressiveOperation=function(e,t,n,r,i){jQuery.fn.dialog.showLoader();$("#ccm-dialog-progress-bar").remove();$.ajax({url:e,type:"POST",data:t,success:function(s){jQuery.fn.dialog.hideLoader();$('<div id="ccm-dialog-progress-bar" />').appendTo(document.body).html(s).jqdialog({autoOpen:!1,height:200,width:400,modal:!0,title:n,closeOnEscape:!1,open:function(n,s){$(".ui-dialog-titlebar-close",this.parentNode).hide();var o=$("#ccm-progressive-operation-progress-bar").attr("data-total-items");ccm_doProgressiveOperation(e,t,o,r,i)}});$("#ccm-dialog-progress-bar").jqdialog("open")}})};ccm_doProgressiveOperation=function(e,t,n,r,i){t.push({name:"process",value:"1"});t.process=!0;$.ajax({url:e,dataType:"json",type:"POST",data:t,error:function(e,t,n){switch(t){case"timeout":var r=ccmi18n.requestTimeout;break;default:var r=e.responseText}$("#ccm-dialog-progress-bar").dialog("option","height",200);$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",!0);$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+r+"</div>");$(".ui-dialog-titlebar-close").show()},success:function(s){if(s.error){var o=s.message;$("#ccm-dialog-progress-bar").dialog("option","height",200);$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",!0);$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+o+"</div>");$(".ui-dialog-titlebar-close").show();typeof i=="function"&&i(s)}else{var u=s.totalItems,a=Math.round((n-u)/n*100);$("#ccm-progressive-operation-status").html(1);n-u>0&&$("#ccm-progressive-operation-status").html(n-u);$("#ccm-progressive-operation-progress-bar div.bar").width(a+"%");u>0?setTimeout(function(){ccm_doProgressiveOperation(e,t,n,r,i)},250):setTimeout(function(){$("#ccm-progressive-operation-progress-bar div.bar").width("0%");$("#ccm-dialog-progress-bar").dialog("close");typeof r=="function"&&r(s)},1e3)}}})};var CCMInlineEditMode=function(){enterInlineEditMode=function(e){$.fn.ccmmenu.disable();CCMToolbar.disable();$("div.ccm-area").addClass("ccm-area-inline-edit-disabled");e&&e.addClass("ccm-block-edit-inline-active")};completeInlineEditMode=function(e){$("#ccm-inline-toolbar-container").remove();var t=e.find(".ccm-inline-toolbar"),n=$("<div />",{id:"ccm-inline-toolbar-container"}).appendTo(document.body),r=$(window),i=e.offset(),s=i.left;t.appendTo(n);var o=s+parseInt(t.width());if(o>r.width()){var u=o-(s+e.width());t.css("left",s-u)}else t.css("left",s);t.css("opacity",1);t.find(".dialog-launch").dialog();var a=i.top-n.outerHeight()-5;n.css("top",a).css("opacity",1);if(r.scrollTop()>a){$("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",0);n.addClass("ccm-inline-toolbar-affixed")}r.on("scroll.inline-toolbar",function(){n.toggleClass("ccm-inline-toolbar-affixed",r.scrollTop()>a);r.scrollTop()>a?$("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",0):$("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",1)})};return{exit:function(e){$(document).trigger("inlineEditCancel",[e])},finishExit:function(){$("div.ccm-area-edit-inline-active").removeClass("ccm-area-edit-inline-active");$.fn.ccmmenu.enable();$("div.ccm-block-edit-inline-active").remove();$(window).unbind("scroll.inline-toolbar");$("div.ccm-area").removeClass("ccm-area-inline-edit-disabled");CCMToolbar.enable();$("#ccm-toolbar").css("opacity",1);$("#ccm-inline-toolbar-container").remove();jQuery.fn.dialog.hideLoader();CCMEditMode.start()},editBlock:function(e,t,n,r,i){var s=[{name:"btask",value:"edit"},{name:"cID",value:e},{name:"arHandle",value:n},{name:"aID",value:t},{name:"bID",value:r}];if(i)for(var o in i)s.push({name:o,value:i[o]});jQuery.fn.dialog.showLoader();enterInlineEditMode($("[data-block-id="+r+"][data-area-id="+t+"]"));$.ajax({type:"GET",url:CCM_TOOLS_PATH+"/edit_block_popup",data:s,success:function(e){var n=$("[data-block-id="+r+"][data-area-id="+t+"]");n.html(e);completeInlineEditMode(n);jQuery.fn.dialog.hideLoader()}})},loadAdd:function(e,t,n,r,i){var s=[{name:"btask",value:"edit"},{name:"cID",value:e},{name:"arHandle",value:t},{name:"btID",value:r}];if(i)for(var o in i)s.push({name:o,value:i[o]});jQuery.fn.dialog.showLoader();enterInlineEditMode();$.ajax({type:"GET",url:CCM_TOOLS_PATH+"/add_block_popup",data:s,success:function(e){jQuery.fn.dialog.closeAll();if($("#ccm-add-new-block-placeholder").length>0)var t=$("#ccm-add-new-block-placeholder");else var t=$("#a"+n);t.addClass("ccm-area-edit-inline-active");t.append($('<div id="a'+n+"-bt"+r+'" class="ccm-block-edit-inline-active">'+e+"</div>"));var i=$("#a"+n+"-bt"+r);completeInlineEditMode(i);jQuery.fn.dialog.hideLoader()}})}}}(),ccm_searchActivatePostFunction=new Array;ccm_setupAdvancedSearchFields=function(e){ccm_totalAdvancedSearchFields=$(".ccm-search-request-field-set").length;$("#ccm-"+e+"-search-add-option").unbind();$("#ccm-"+e+"-search-add-option").click(function(){ccm_totalAdvancedSearchFields++;$("#ccm-search-fields-wrapper").length>0?$("#ccm-search-fields-wrapper").append('<div class="ccm-search-field" id="ccm-'+e+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</div>"):$("#ccm-"+e+"-search-advanced-fields").append('<tr class="ccm-search-field" id="ccm-'+e+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</tr>");ccm_activateAdvancedSearchFields(e,ccm_totalAdvancedSearchFields)});var t=1;$(".ccm-search-request-field-set").each(function(){ccm_activateAdvancedSearchFields(e,t);t++})};ccm_setupAdvancedSearch=function(e){ccm_setupAdvancedSearchFields(e);$("#ccm-"+e+"-advanced-search").ajaxForm({beforeSubmit:function(){ccm_deactivateSearchResults(e)},success:function(t){ccm_parseAdvancedSearchResponse(t,e)}});ccm_setupInPagePaginationAndSorting(e);ccm_setupSortableColumnSelection(e)};ccm_parseAdvancedSearchResponse=function(e,t){var n=$("#ccm-"+t+"-search-results");if(n.length==0||t==null)n=$("#ccm-search-results");n.html(e);ccm_activateSearchResults(t)};ccm_deactivateSearchResults=function(e){var t=$("#ccm-"+e+"-search-fields-submit");if(t.length==0||e==null)t=$("#ccm-search-fields-submit");t.attr("disabled",!0);var t=$("#ccm-"+e+"-search-results table.ccm-results-list");if(t.length==0||e==null)t=$("#ccm-search-results");t.css("opacity",.4);jQuery.fn.dialog.showLoader()};ccm_activateSearchResults=function(e){$(".ui-dialog-content").length==0?window.scrollTo(0,0):$(".ui-dialog-content").each(function(e){$(this).get(0).scrollTop=0});$(".dialog-launch").dialog();var t=$("#ccm-"+e+"-search-results table.ccm-results-list");if(t.length==0||e==null)t=$("#ccm-search-results");t.css("opacity",1);jQuery.fn.dialog.hideLoader();var t=$("#ccm-"+e+"-search-fields-submit");if(t.length==0||e==null)t=$("#ccm-search-fields-submit");t.attr("disabled",!1);ccm_setupInPagePaginationAndSorting(e);ccm_setupSortableColumnSelection(e);typeof ccm_searchActivatePostFunction[e]=="function"&&ccm_searchActivatePostFunction[e]()};ccm_setupInPagePaginationAndSorting=function(e){$(".ccm-results-list th a").click(function(){ccm_deactivateSearchResults(e);var t=$("#ccm-"+e+"-search-results");t.length==0&&(t=$("#ccm-search-results"));t.load($(this).attr("href"),!1,function(){ccm_activateSearchResults(e)});return!1});$("div.ccm-pagination a").click(function(){if(!$(this).parent().hasClass("disabled")){ccm_deactivateSearchResults(e);var t=$("#ccm-"+e+"-search-results");t.length==0&&(t=$("#ccm-search-results"));t.load($(this).attr("href"),!1,function(){ccm_activateSearchResults(e);$("div.ccm-dialog-content").attr("scrollTop",0)})}return!1});$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupSortableColumnSelection=function(e){$("#ccm-list-view-customize").unbind();$("#ccm-list-view-customize").click(function(){jQuery.fn.dialog.open({width:550,height:350,appendButtons:!0,modal:!1,href:$(this).attr("href"),title:ccmi18n.customizeSearch});return!1})};ccm_checkSelectedAdvancedSearchField=function(e,t){$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-option-type-date_time input").each(function(){$(this).attr("id",$(this).attr("id")+t)});$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-option-type-date_time input").datepicker({showAnim:"fadeIn"});$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-option-type-rating input").rating()};ccm_activateAdvancedSearchFields=function(e,t){var n=$("#ccm-"+e+"-search-field-set"+t+" select:first");n.unbind();n.change(function(){var n=$(this).find(":selected").val();$(this).parent().parent().find("input.ccm-"+e+"-selected-field").val(n);var r=$("#ccm-"+e+"-search-field-base-elements span[search-field="+n+"]");$("#ccm-"+e+"-search-field-set"+t+" .ccm-selected-field-content").html("");r.clone().appendTo("#ccm-"+e+"-search-field-set"+t+" .ccm-selected-field-content");$("#ccm-"+e+"-search-field-set"+t+" .ccm-selected-field-content .ccm-search-option").show();ccm_checkSelectedAdvancedSearchField(e,t)});$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-remove-option").unbind();$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-remove-option").click(function(){$(this).parents("div.ccm-search-field").remove();$(this).parents("tr.ccm-search-field").remove()});ccm_checkSelectedAdvancedSearchField(e,t)};ccm_activateEditablePropertiesGrid=function(){$("tr.ccm-attribute-editable-field").each(function(){var e=$(this);$(this).find("a").click(function(){e.find(".ccm-attribute-editable-field-text").hide();e.find(".ccm-attribute-editable-field-clear-button").hide();e.find(".ccm-attribute-editable-field-form").show();e.find(".ccm-attribute-editable-field-save-button").show()});e.find("form").submit(function(){return!1});e.find(".ccm-attribute-editable-field-save-button").parent().click(function(){var t=e.find("form input[name=task]");if(t.val()=="clear_extended_attribute"){t.val(t.attr("data-original-task"));t.attr("data-original-task","")}ccm_submitEditablePropertiesGrid(e)});e.find(".ccm-attribute-editable-field-clear-button").parent().unbind();e.find(".ccm-attribute-editable-field-clear-button").parent().click(function(){var t=e.find("form input[name=task]");t.attr("data-original-task",t.val());t.val("clear_extended_attribute");ccm_submitEditablePropertiesGrid(e);return!1})})};ccm_submitEditablePropertiesGrid=function(e){e.find(".ccm-attribute-editable-field-save-button").hide();e.find(".ccm-attribute-editable-field-clear-button").hide();e.find(".ccm-attribute-editable-field-loading").show();try{tinyMCE.triggerSave(!0,!0)}catch(t){}e.find("form").ajaxSubmit(function(t){e.find(".ccm-attribute-editable-field-loading").hide();e.find(".ccm-attribute-editable-field-save-button").show();e.find(".ccm-attribute-editable-field-text").html(t);e.find(".ccm-attribute-editable-field-form").hide();e.find(".ccm-attribute-editable-field-save-button").hide();e.find(".ccm-attribute-editable-field-text").show();e.find(".ccm-attribute-editable-field-clear-button").show();e.find("td").show("highlight",{color:"#FFF9BB"})})};ccm_triggerSelectUser=function(e,t,n){alert(e);alert(t);alert(n)};ccm_triggerSelectGroup=function(e,t){alert(e);alert(t)};ccm_setupUserSearch=function(e){$(".chosen-select").chosen();$("#ccm-user-list-cb-all").click(function(){if($(this).prop("checked")==1){$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",!0);$("#ccm-user-list-multiple-operations").attr("disabled",!1)}else{$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",!1);$("#ccm-user-list-multiple-operations").attr("disabled",!0)}});$("td.ccm-user-list-cb input[type=checkbox]").click(function(e){$("td.ccm-user-list-cb input[type=checkbox]:checked").length>0?$("#ccm-user-list-multiple-operations").attr("disabled",!1):$("#ccm-user-list-multiple-operations").attr("disabled",!0)});$("#ccm-user-list-multiple-operations").change(function(){var t=$(this).val();switch(t){case"choose":var n="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){ccm_triggerSelectUser($(this).val(),$(this).attr("user-name"),$(this).attr("user-email"))});jQuery.fn.dialog.closeTop();break;case"properties":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_properties?"+uIDstring,title:ccmi18n.properties});break;case"activate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_activate?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_activate});break;case"deactivate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_deactivate?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_deactivate});break;case"group_add":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_group_add?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_group_add});break;case"group_remove":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_group_remove?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_group_remove});break;case"delete":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_delete?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_delete})}$(this).get(0).selectedIndex=0})};ccm_setupGroupSearchPaging=function(){$("div#ccm-group-paging").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupGroupSearch=function(e){$("div.ccm-group a").unbind();e?func=window[e]:func=ccm_triggerSelectGroup;$("div.ccm-group a").each(function(e){var t=$(this);$(this).click(function(){func(t.attr("group-id"),t.attr("group-name"));$.fn.dialog.closeTop();return!1})});$("#ccm-group-search").ajaxForm({beforeSubmit:function(){$("#ccm-group-search-wrapper").html("")},success:function(e){$("#ccm-group-search-wrapper").html(e)}});ccm_setupGroupSearchPaging();$("div#ccm-group-paging a").click(function(){$("#ccm-group-search-wrapper").html("");$.ajax({type:"GET",url:$(this).attr("href"),success:function(e){$("#ccm-group-search-wrapper").html(e)}});return!1})};typeof ccm_selectSitemapNode!="function"&&(ccm_selectSitemapNode=function(e,t){alert(e);alert(t)});ccm_sitemapSetupSearch=function(e){$.fn.ccmmenu.enable();ccm_setupAdvancedSearch(e);ccm_sitemapSetupSearchPages(e);ccm_searchActivatePostFunction[e]=function(){ccm_sitemapSetupSearchPages(e);ccm_sitemapSearchSetupCheckboxes(e)};ccm_sitemapSearchSetupCheckboxes(e)};ccm_sitemapSearchSetupCheckboxes=function(e){$("#ccm-"+e+"-list-cb-all").click(function(t){t.stopPropagation();if($(this).prop("checked")==1){$(".ccm-list-record td.ccm-"+e+"-list-cb input[type=checkbox]").attr("checked",!0);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1)}else{$(".ccm-list-record td.ccm-"+e+"-list-cb input[type=checkbox]").attr("checked",!1);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)}});$("td.ccm-"+e+"-list-cb input[type=checkbox]").click(function(t){t.stopPropagation();$("td.ccm-"+e+"-list-cb input[type=checkbox]:checked").length>0?$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1):$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)});$("#ccm-"+e+"-list-multiple-operations").change(function(){var t=$(this).val();cIDstring="";$("td.ccm-"+e+"-list-cb input[type=checkbox]:checked").each(function(){cIDstring=cIDstring+"&cID[]="+$(this).val()});switch(t){case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/delete?"+cIDstring+"&searchInstance="+e,title:ccmi18n_sitemap.deletePages});break;case"design":jQuery.fn.dialog.open({width:610,height:405,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/design?"+cIDstring+"&searchInstance="+e,title:ccmi18n_sitemap.pageDesign});break;case"move_copy":jQuery.fn.dialog.open({width:640,height:340,modal:!1,href:CCM_TOOLS_PATH+"/sitemap_overlay?instance_id="+e+"&select_mode=move_copy_delete&"+cIDstring,title:ccmi18n_sitemap.moveCopyPage});break;case"speed_settings":jQuery.fn.dialog.open({width:610,height:340,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/speed_settings?"+cIDstring,title:ccmi18n_sitemap.speedSettingsTitle});break;case"permissions":jQuery.fn.dialog.open({width:430,height:630,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/permissions?"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"permissions_add_access":jQuery.fn.dialog.open({width:440,height:200,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/permissions_access?task=add&"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"permissions_remove_access":jQuery.fn.dialog.open({width:440,height:300,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/permissions_access?task=remove&"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"properties":jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/pages/bulk_metadata_update?"+cIDstring,title:ccmi18n_sitemap.pagePropertiesTitle})}$(this).get(0).selectedIndex=0})};ccm_sitemapSetupSearchPages=function(e){$("#ccm-"+e+"-list tr").click(function(e){var t=$(this);if(t.hasClass("ccm-results-list-header"))return!1;var n=$.fn.ccmsitemap("getMenu",jQuery.parseJSON($(this).attr("data-page-menu")));n&&$.fn.ccmmenu.showmenu(e,n)})};var ccmCustomStyle={tabs:function(e,t){$(".ccm-styleEditPane").hide();$("#ccm-styleEditPane-"+t).show();$(e.parentNode.parentNode).find("li").removeClass("ccm-nav-active");$(e.parentNode).addClass("ccm-nav-active");return!1},resetAll:function(){if(!confirm(ccmi18n.confirmCssReset))return!1;jQuery.fn.dialog.showLoader();$("#ccm-reset-style").val(1);$("#ccmCustomCssForm").get(0).submit();return!0},showPresetDeleteIcon:function(){$("select[name=cspID]").val()>0?$("#ccm-style-delete-preset").show():$("#ccm-style-delete-preset").hide()},deletePreset:function(){var e=$("select[name=cspID]").val();if(e>0){if(!confirm(ccmi18n.confirmCssPresetDelete))return!1;var t=$("#ccm-custom-style-refresh-action").val()+"&deleteCspID="+e+"&subtask=delete_custom_style_preset";jQuery.fn.dialog.showLoader();$.get(t,function(e){$("#ccm-custom-style-wrapper").html(e);jQuery.fn.dialog.hideLoader()})}},initForm:function(){$("#cspFooterPreset").length>0&&$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select, #ccmCustomCssFormTabs textarea").bind("change click",function(){$("#cspFooterPreset").show();$("#cspFooterNoPreset").remove();$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select").unbind("change click")});$("input[name=cspPresetAction]").click(function(){$(this).val()=="create_new_preset"&&$(this).prop("checked")?$("input[name=cspName]").attr("disabled",!1).focus():$("input[name=cspName]").val("").attr("disabled",!0)});ccmCustomStyle.showPresetDeleteIcon();ccmCustomStyle.lastPresetID=parseInt($("select[name=cspID]").val());$("select[name=cspID]").change(function(){var e=parseInt($(this).val()),t=parseInt($("input[name=selectedCsrID]").val());if(ccmCustomStyle.lastPresetID==e)return!1;ccmCustomStyle.lastPresetID=e;jQuery.fn.dialog.showLoader();if(e>0)var n=$("#ccm-custom-style-refresh-action").val()+"&cspID="+e;else var n=$("#ccm-custom-style-refresh-action").val()+"&csrID="+t;$.get(n,function(e){$("#ccm-custom-style-wrapper").html(e);jQuery.fn.dialog.hideLoader()})});$("#ccmCustomCssForm").submit(function(){if($("input[name=cspCreateNew]").prop("checked")==1&&$("input[name=cspName]").val()==""){$("input[name=cspName]").focus();alert(ccmi18n.errorCustomStylePresetNoName);return!1}jQuery.fn.dialog.showLoader();return!0});parseInt(ccmCustomStyle.lastPresetID)||setTimeout('$("#ccmCustomCssFormTabs input").attr("disabled", false).get(0).focus()',500)},validIdCheck:function(e,t){var n=$("#"+e.value);n&&n.get(0)&&n.get(0).id!=t?$("#ccm-styles-invalid-id").css("display","block"):$("#ccm-styles-invalid-id").css("display","none")}};ccm_activateTabBar=function(e){$("#ccm-tab-content-"+e.find("li[class=active] a").attr("data-tab")).show();e.find("a").unbind().click(function(){e.find("li").removeClass("active");$(this).parent().addClass("active");e.find("a").each(function(){$("#ccm-tab-content-"+$(this).attr("data-tab")).hide()});var t=$(this).attr("data-tab");$("#ccm-tab-content-"+t).show();return!1})};var CCMToolbar=function(){var e=$("#ccm-toolbar"),t=$("#ccm-nav-intelligent-search"),n=$("#ccm-intelligent-search-results"),r,s;setupHelpNotifications=function(){$(document.body).on("click","a[data-dismiss]",function(){var e=$(this).attr("data-dismiss")=="help-all"?"all":"this";$(this).parentsUntil(".ccm-notification-help").parent().queue(function(){$(this).css("opacity",0);$(this).dequeue()}).delay(500).queue(function(){$(this).remove();$(this).dequeue()});$.ajax({type:"post",data:{type:$(this).attr("data-help-notification-type"),identifier:$(this).attr("data-help-notification-identifier"),action:e,ccm_token:CCM_SECURITY_TOKEN},url:CCM_TOOLS_PATH+"/help/dismiss",success:function(e){}})})};setupPanels=function(){CCMPanelManager.register({identifier:"dashboard",position:"right"});CCMPanelManager.register({identifier:"page"});CCMPanelManager.register({identifier:"sitemap",position:"right"});CCMPanelManager.register({identifier:"add-block",translucent:!1,position:"left"});CCMPanelManager.register({identifier:"check-in",position:"left"});$("<div />",{id:"ccm-panel-overlay"}).appendTo($(document.body));$("[data-launch-panel]").unbind().on("click",function(){var e=$(this).attr("data-launch-panel");$(this).toggleClass("ccm-launch-panel-active");var t=CCMPanelManager.getByIdentifier(e);t.setURL($(this).attr("data-panel-url"));t.toggle();return!1});$("html").addClass("ccm-panel-ready")};setupStatusBar=function(){$("#ccm-page-status-bar .alert").bind("closed",function(){$(this).remove();var e=$("#ccm-page-status-bar .alert:visible").length;e==0&&$("#ccm-page-status-bar").remove()});$("#ccm-page-status-bar .ccm-status-bar-ajax-form").ajaxForm({dataType:"json",beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(e){e.redirect&&(window.location.href=e.redirect)}})};setupIntelligentSearch=function(){t.bind("keydown.ccm-intelligent-search",function(e){if(e.keyCode==13||e.keyCode==40||e.keyCode==38){e.preventDefault();e.stopPropagation();if(e.keyCode==13&&$("a.ccm-intelligent-search-result-selected").length>0){var t=$("a.ccm-intelligent-search-result-selected").attr("href");!t||t=="#"||t=="javascript:void(0)"?$("a.ccm-intelligent-search-result-selected").click():window.location.href=t}var n=$("#ccm-intelligent-search-results li:visible"),r;if(e.keyCode==40||e.keyCode==38){$.each(n,function(t,i){if($(i).children("a").hasClass("ccm-intelligent-search-result-selected")){e.keyCode==38?io=n[t-1]:io=n[t+1];r=$(io).find("a")}});if(r&&r.length>0){$("a.ccm-intelligent-search-result-selected").removeClass();$(r).addClass("ccm-intelligent-search-result-selected")}}}});t.liveUpdate("ccm-intelligent-search-results","intelligent-search");t.bind("keyup.ccm-intelligent-search",function(e){doRemoteSearchCall($(this).val())});t.bind("click",function(e){this.value==""&&n.hide()})};activateIntelligentSearchResults=function(){$("#ccm-intelligent-search-results div:visible").length==0&&$("#ccm-intelligent-search-results").hide();$("#ccm-intelligent-search-results a").hover(function(){$("a.ccm-intelligent-search-result-selected").removeClass();$(this).addClass("ccm-intelligent-search-result-selected")},function(){$(this).removeClass("ccm-intelligent-search-result-selected")})};doRemoteSearchCall=function(e){e=jQuery.trim(e);if(!e)return;if(e.length>2){if(e==r)return;s&&window.clearTimeout(s);r=e;s=window.setTimeout(function(){s=null;$("#ccm-intelligent-search-results-list-marketplace").parent().show();$("#ccm-intelligent-search-results-list-help").parent().show();$("#ccm-intelligent-search-results-list-your-site").parent().show();$("#ccm-intelligent-search-results-list-marketplace").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").parent().addClass("ccm-intelligent-search-results-module-loading");$.getJSON(CCM_TOOLS_PATH+"/marketplace/intelligent_search",{q:r},function(e){$("#ccm-intelligent-search-results-list-marketplace").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-marketplace").html("");for(i=0;i<e.length;i++){var t=e[i],n="ccm_getMarketplaceItemDetails("+t.mpID+")";$("#ccm-intelligent-search-results-list-marketplace").append('<li><a href="javascript:void(0)" onclick="'+n+'"><img src="'+t.img+'" />'+t.name+"</a></li>")}e.length==0&&$("#ccm-intelligent-search-results-list-marketplace").parent().hide();if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/get_remote_help",{q:r},function(e){$("#ccm-intelligent-search-results-list-help").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").html("");for(i=0;i<e.length;i++){var t=e[i];$("#ccm-intelligent-search-results-list-help").append('<li><a href="'+t.href+'">'+t.name+"</a></li>")}e.length==0&&$("#ccm-intelligent-search-results-list-help").parent().hide();if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-help").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/pages/intelligent_search",{q:r},function(e){$("#ccm-intelligent-search-results-list-your-site").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").html("");for(i=0;i<e.length;i++){var t=e[i];$("#ccm-intelligent-search-results-list-your-site").append('<li><a href="'+t.href+'">'+t.name+"</a></li>")}e.length==0&&$("#ccm-intelligent-search-results-list-your-site").parent().hide();if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-your-site").parent().hide()})},500)}};return{start:function(){if(e.length>0){e.find(".dialog-launch").dialog();setupStatusBar();setupIntelligentSearch();setupPanels();setupHelpNotifications();$("#ccm-toolbar-menu-dashboard").on("click",function(e){e.stopPropagation()})}},disable:function(){$("#ccm-toolbar-disabled").remove();$("<div />",{id:"ccm-toolbar-disabled"}).appendTo(document.body);setTimeout(function(){$("#ccm-toolbar-disabled").css("opacity",1)},10)},enable:function(){$("#ccm-toolbar-disabled").remove()},disableDirectExit:function(){var e=$("li.ccm-toolbar-page-edit a");e.attr("data-launch-panel")!="check-in"&&e.attr("data-launch-panel","check-in").on("click",function(){$(this).toggleClass("ccm-launch-panel-active");var e=CCMPanelManager.getByIdentifier("check-in");e.setURL($(this).attr("data-panel-url"));e.toggle();return!1})}}}();ccm_marketplaceDetailShowMore=function(){$(".ccm-marketplace-item-information-more").hide();$(".ccm-marketplace-item-information-inner").css("max-height","none")};ccm_marketplaceUpdatesShowMore=function(e){$(e).parent().hide();$(e).parent().parent().find(".ccm-marketplace-update-changelog").css("max-height","none")};ccm_enableDesignScrollers=function(){$("a.ccm-scroller-l").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l.png")});$("a.ccm-scroller-r").hover(function(){$(this).find("img"
).attr("src",CCM_IMAGE_PATH+"/button_scroller_r_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r.png")});var e=4,t=132;$("a.ccm-scroller-r").unbind("click");$("a.ccm-scroller-l").unbind("click");$("a.ccm-scroller-r").click(function(){var n=$(this).parent().children("div.ccm-scroller-inner").children("ul"),r=$(this).parent().attr("current-page"),i=$(this).parent().attr("current-pos"),s=$(this).parent().attr("num-pages"),o=e*t;i=parseInt(i)-o;r++;$(this).parent().attr("current-page",r);$(this).parent().attr("current-pos",i);r==s&&$(this).hide();r>1&&$(this).siblings("a.ccm-scroller-l").show();$(n).css("left",i+"px")});$("a.ccm-scroller-l").click(function(){var n=$(this).parent().children("div.ccm-scroller-inner").children("ul"),r=$(this).parent().attr("current-page"),i=$(this).parent().attr("current-pos"),s=$(this).parent().attr("num-pages"),o=e*t;i=parseInt(i)+o;r--;$(this).parent().attr("current-page",r);$(this).parent().attr("current-pos",i);r==1&&$(this).hide();r<s&&$(this).siblings("a.ccm-scroller-r").show();$(n).css("left",i+"px")});$("a.ccm-scroller-l").hide();$("a.ccm-scroller-r").each(function(){parseInt($(this).parent().attr("num-pages"))==1&&$(this).hide()});$("#ccm-select-page-type a").click(function(){$("#ccm-select-page-type li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=ptID]").val($(this).attr("ccm-page-type-id"))});$("#ccm-select-theme a").click(function(){$("#ccm-select-theme li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=plID]").val($(this).attr("ccm-theme-id"))})};