!function(a,b){"use strict";function c(a,c){c=c||{},c=b.extend({items:[],columns:[],pagination:{},fields:[]},c),this.$element=a,this.$results=a.find("div[data-search-results]"),this.$resultsTableBody=this.$results.find("tbody"),this.$resultsTableHead=this.$results.find("thead"),this.$resultsPagination=this.$results.find("div.ccm-search-results-pagination"),this.$advancedFields=a.find("div.ccm-search-fields-advanced"),this.options=c,this._templateAdvancedSearchFieldRow=_.template(a.find("script[data-template=search-field-row]").html()),this._templateSearchResultsTableHead=_.template(a.find("script[data-template=search-results-table-head]").html()),this._templateSearchResultsTableBody=_.template(a.find("script[data-template=search-results-table-body]").html()),this._templateSearchResultsPagination=_.template(a.find("script[data-template=search-results-pagination]").html()),this.setupCheckboxes(),this.setupSort(),this.setupSearch(),this.setupPagination(),this.setupAdvancedSearch(),this.updateResults(c)}c.prototype.ajaxUpdate=function(a,c,d){c=c||[];var e=this;jQuery.fn.dialog.showLoader(),b.ajax({type:"post",data:c,dataType:"json",url:a,complete:function(){jQuery.fn.dialog.hideLoader()},error:function(a){ccmAlert.notice(a)},success:function(a){d?d(a):e.updateResults(a)}})},c.prototype.updateResults=function(a){var c=this;c.$resultsTableHead.html(c._templateSearchResultsTableHead({columns:a.columns})),c.$resultsTableBody.html(c._templateSearchResultsTableBody({items:a.items})),c.$resultsPagination.html(c._templateSearchResultsPagination({pagination:a.pagination})),c.$advancedFields.html(""),b.each(a.fields,function(a,b){c.$advancedFields.append(c._templateAdvancedSearchFieldRow({field:b}))})},c.prototype.setupAdvancedSearch=function(){var a=this;a.$element.on("click","a[data-search-toggle=advanced]",function(){return a.$advancedFields.append(a._templateAdvancedSearchFieldRow()),!1}),a.$element.on("change","select[data-search-field]",function(){var c=b(this).parent().find(".ccm-search-field-content");c.html("");var d=b(this).find(":selected").attr("data-search-field-url");d&&a.ajaxUpdate(d,!1,function(a){c.html(a.html)})}),a.$element.on("click","a[data-search-remove=search-field]",function(){var a=b(this).parent();return a.queue(function(){b(this).addClass("ccm-search-field-removing"),b(this).dequeue()}).delay(200).queue(function(){b(this).remove(),b(this).dequeue()}),!1})},c.prototype.setupSort=function(){var a=this;this.$element.on("click","thead th a",function(){return a.ajaxUpdate(b(this).attr("href")),!1})},c.prototype.setupSearch=function(){var a=this;this.$element.on("submit","form[data-search-form]",function(){var c=b(this).serializeArray();return c.push({name:"submitSearch",value:"1"}),a.ajaxUpdate(b(this).attr("action"),c),!1})},c.prototype.setupPagination=function(){var a=this;this.$element.on("click","ul.pagination a",function(){return a.ajaxUpdate(b(this).attr("href")),!1})},c.prototype.setupCheckboxes=function(){var a=this;this.$element.on("click","input[data-search-checkbox=select-all]",function(){a.$element.find("input[data-search-checkbox=individual]").prop("checked",b(this).is(":checked"))})},b.fn.concreteAjaxSearch=function(a){return new c(this,a)}}(window,$);