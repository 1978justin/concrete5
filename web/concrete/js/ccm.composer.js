(function(e,t){var n={saveinterval:!1,"private":{saveDraft:function(t,n){formData=t.serializeArray();e.ajax({dataType:"json",type:"post",data:formData,url:t.data("saveURL"),success:function(e){t.find(".ccm-composer-save-status").html('<div class="alert alert-info"><?=t("Page saved at ")?>'+e.time+"</div>");e.saveurl&&t.data("saveURL",e.saveurl);e.discardurl&&t.data("discardURL",e.discardurl);e.publishurl&&t.data("publishURL",e.publishurl);n&&n()}})}},init:function(r){var i=e.extend({autoSaveEnabled:!0,autoSaveTimeout:5e3,publishReturnMethod:"reload",onExit:function(){t.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/composer/drafts"},onAfterDiscard:function(){t.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/composer/drafts"},onAfterSaveAndExit:function(){t.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/composer/drafts"}},r);return this.each(function(){var t=e(this);t.data("settings",i);t.data("saveURL",i.saveURL);t.data("discardURL",i.discardURL);t.data("publishURL",i.publishURL);i.autoSaveEnabled&&(n.saveinternal=setInterval(function(){n.private.saveDraft(t)},i.autoSaveTimeout));t.find("button[data-composer-btn=exit]").on("click",function(){i.onExit()});t.find("button[data-composer-btn=discard]").on("click",function(){t.data("discardURL")?e.ajax({type:"get",url:t.data("discardURL"),success:function(e){i.onAfterDiscard()}}):i.onAfterDiscard()});t.find("button[data-composer-btn=save]").on("click",function(){clearInterval(n.saveinterval);n.private.saveDraft(t,function(){i.onAfterSaveAndExit()})});t.find("button[data-composer-btn=publish]").on("click",function(){clearInterval(n.saveinterval);t.attr("action",t.data("publishURL"));i.publishReturnMethod=="ajax"&&t.on("submit.composer",function(){e(this).prop("disabled",!0);formData=t.serializeArray();e.ajax({type:"post",data:formData,dataType:"json",url:t.data("publishURL"),success:function(t){e(this).prop("disabled",!1)},complete:function(){t.unbind("submit.composer");t.removeAttr("action")}});return!1});t.submit()})})}};e.fn.ccmcomposer=function(t){if(n[t])return n[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return n.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.ccmcomposer")}})(jQuery,window);