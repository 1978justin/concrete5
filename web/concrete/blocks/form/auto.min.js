var miniSurvey={bid:0,serviceURL:$("input[name=miniSurveyServices]").val()+"?block=form&",init:function(){this.tabSetup();$("#answerType").change(function(a){miniSurvey.optionsCheck($("#answerType").get(0));miniSurvey.settingsCheck($("#answerType").get(0))}).trigger("change");$("#answerTypeEdit").change(function(a){miniSurvey.optionsCheck($("#answerTypeEdit").get(0),"Edit");miniSurvey.settingsCheck($("#answerTypeEdit").get(0),"Edit")});$("#addQuestion").click(function(){miniSurvey.addQuestion();return!1});
$("#editQuestion").click(function(){miniSurvey.addQuestion("Edit");return!1});$("#cancelEditQuestion").click(function(){$("#miniSurvey").show();$("#editQuestionForm").css("display","none")});this.serviceURL+="cID="+this.cID+"&arHandle="+this.arHandle+"&bID="+this.bID+"&btID="+this.btID+"&";miniSurvey.refreshSurvey();$("#emailSettings").hide()},tabSetup:function(){$("ul#ccm-formblock-tabs li a").each(function(a,b){b.onclick=function(){var b=this.id.replace("ccm-formblock-tab-","");miniSurvey.showPane(b)}})},
showPane:function(a){$("ul#ccm-formblock-tabs li").each(function(b,a){$(a).removeClass("active")});$(document.getElementById("ccm-formblock-tab-"+a).parentNode).addClass("active");$("div.ccm-formBlockPane").each(function(b,a){a.style.display="none"});$("#ccm-formBlockPane-"+a).css("display","block")},refreshSurvey:function(){$.ajax({url:this.serviceURL+"mode=refreshSurvey&qsID="+parseInt(this.qsID)+"&hide="+miniSurvey.hideQuestions.join(","),success:function(a){$("#miniSurveyPreviewWrap").html(a)}});
$.ajax({url:this.serviceURL+"mode=refreshSurvey&qsID="+parseInt(this.qsID)+"&showEdit=1&hide="+miniSurvey.hideQuestions.join(","),success:function(a){$("#miniSurveyWrap").html(a)}})},optionsCheck:function(a,b){"Edit"!=b&&(b="");"select"==a.value||"radios"==a.value||"checkboxlist"==a.value?$("#answerOptionsArea"+b).css("display","block"):$("#answerOptionsArea"+b).css("display","none");"email"==a.value?$("#emailSettings"+b).show():$("#emailSettings"+b).hide()},settingsCheck:function(a,b){"Edit"!=b&&
(b="");"text"==a.value?$("#answerSettings"+b).css("display","block"):$("#answerSettings"+b).css("display","none")},addQuestion:function(a){var b=0;"Edit"!=a?a="":b=parseInt($("#msqID").val(),10);answerType=$("#answerType"+a).val();var c=encodeURIComponent($("#answerOptions"+a).val()),c="question="+encodeURIComponent($("#question"+a).val())+"&options="+c,c=c+("&width="+escape($("#width"+a).val())),c=c+("&height="+escape($("#height"+a).val())),d=$('input[type="radio"][name="required'+a+'"]:checked').val(),
c=c+("&required="+d)+("&position="+escape($("#position"+a).val()));document.getElementById("ccm-block-form");c+="&inputType="+answerType;c+="&msqID="+b+"&qsID="+parseInt(this.qsID);"email"==answerType&&(c+="&send_notification_from=",fieldID="Edit"==a?"#send_notification_from_edit":"#send_notification_from",c+=$(fieldID).is(":checked")?"1":"0");$.ajax({type:"POST",data:c,url:this.serviceURL+"mode=addQuestion&qsID="+parseInt(this.qsID),success:function(b){eval("var jsonObj="+b);if(jsonObj)if(jsonObj.noRequired)alert(ccm_t("complete-required"));
else{if("Edit"==jsonObj.mode){var a=$("#questionEditedMsg");a.fadeIn();setTimeout(function(){a.fadeOut()},5E3);jsonObj.hideQID&&(miniSurvey.hideQuestions.push(miniSurvey.edit_qID),miniSurvey.edit_qID=0)}else a=$("#questionAddedMsg"),a.fadeIn(),setTimeout(function(){a.fadeOut()},5E3);$("#editQuestionForm").css("display","none");$("#miniSurvey").show();miniSurvey.qsID=jsonObj.qsID;miniSurvey.ignoreQuestionId(jsonObj.msqID);$("#qsID").val(jsonObj.qsID);miniSurvey.resetQuestion();miniSurvey.refreshSurvey()}else alert(ccm_t("ajax-error"))}})},
ignoreQuestionId:function(a){var b=$("#ccm-ignoreQuestionIDs");msqIDs=b.val()?b.val().split(","):[];msqIDs.push(parseInt(a,10));b.val(msqIDs.join(","))},reloadQuestion:function(a){$.ajax({url:this.serviceURL+"mode=getQuestion&qsID="+parseInt(this.qsID)+"&qID="+parseInt(a),success:function(b){eval("var jsonObj="+b);$("#editQuestionForm").css("display","block");$("#questionEdit").val(jsonObj.question);$("#answerOptionsEdit").val(jsonObj.optionVals.replace(/%%/g,"\r\n"));$("#widthEdit").val(jsonObj.width);
$("#heightEdit").val(jsonObj.height);$("#positionEdit").val(jsonObj.position);1==parseInt(jsonObj.required,10)?($('input[name="requiredEdit"][value=1]').prop("checked",!0),$('input[name="requiredEdit"][value=0]').prop("checked",!1)):($('input[name="requiredEdit"][value=1]').prop("checked",!1),$('input[name="requiredEdit"][value=0]').prop("checked",!0));if("email"==jsonObj.inputType){b=jsonObj.optionVals.split(";");for(var c=0;c<b.length;c++)key_val=b[c].split("::"),2==key_val.length&&"send_notification_from"==
key_val[0]&&(1==key_val[1]?$(".send_notification_from_edit input").prop("checked",!0):$(".send_notification_from_edit input").prop("checked",!1))}$("#msqID").val(jsonObj.msqID);$("#answerTypeEdit").val(jsonObj.inputType);$("#miniSurvey").hide();miniSurvey.optionsCheck($("#answerTypeEdit").get(0),"Edit");miniSurvey.settingsCheck($("#answerTypeEdit").get(0),"Edit");0<parseInt(jsonObj.bID)&&(miniSurvey.edit_qID=parseInt(a));$(".miniSurveyOptions").first().closest(".ui-dialog-content").get(0).scrollTop=
0}})},pendingDeleteQuestionId:function(a){var b=$("#ccm-pendingDeleteIDs");msqIDs=b.val()?b.val().split(","):[];msqIDs.push(parseInt(a,10));b.val(msqIDs.join(","))},hideQuestions:[],deleteQuestion:function(a,b,c){confirm(ccm_t("delete-question"))&&($.ajax({url:this.serviceURL+"mode=delQuestion&qsID="+parseInt(this.qsID)+"&msqID="+parseInt(b),success:function(a){miniSurvey.resetQuestion();miniSurvey.refreshSurvey()}}),miniSurvey.ignoreQuestionId(b),miniSurvey.hideQuestions.push(c),miniSurvey.pendingDeleteQuestionId(b))},
resetQuestion:function(){$("#question").val("");$("#answerOptions").val("");$("#width").val("50");$("#height").val("3");$("#msqID").val("");$("#answerType").val("field").change();$("#answerOptionsArea").hide();$("#answerSettings").hide();$("#required input").prop("checked",!1)},validate:function(){var a=0,b=$("#surveyName");b&&0!=parseInt(b.val().length,10)||(alert(ccm_t("form-name")),this.showPane("options"),b.focus(),a=1);b=$(".miniSurveyQuestionRow");if(!b||1>parseInt(b.length,10))alert(ccm_t("form-min-1")),
a=1;return a?(ccm_isBlockError=1,!1):!0},moveUp:function(a,b){for(var c=this.serialize(),d=0,e=0;e<c.length;e++){if(c[e]==b){if(0==d)break;$("#miniSurveyQuestionRow"+b).after($("#miniSurveyQuestionRow"+d));break}d=c[e]}this.saveOrder()},moveDown:function(a,b){for(var c=this.serialize(),d=0,e=0;e<c.length;e++)if(c[e]==b)d=1;else if(d){$("#miniSurveyQuestionRow"+c[e]).after($("#miniSurveyQuestionRow"+b));break}this.saveOrder()},serialize:function(){for(var a=document.getElementById("miniSurveyPreviewTable"),
b=[],c=0;c<a.childNodes.length;c++)if(a.childNodes[c].className&&0<=a.childNodes[c].className.indexOf("miniSurveyQuestionRow")){var d=a.childNodes[c].id.substr(21);b.push(d)}return b},saveOrder:function(){var a="qIDs="+this.serialize().join(",")+"&qsID="+parseInt(this.qsID);$.ajax({type:"POST",data:a,url:this.serviceURL+"mode=reorderQuestions",success:function(a){miniSurvey.refreshSurvey()}})}};ccmValidateBlockForm=function(){return miniSurvey.validate()};$(document).ready(function(){$("#ccm-block-form").closest("div").addClass("ccm-ui")});
